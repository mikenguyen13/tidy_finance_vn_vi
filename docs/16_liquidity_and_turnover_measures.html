<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; Liquidity and Turnover Measures ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./17_beta_estimation.html" rel="next">
<link href="./15_missing_data_and_survivorship.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-72097b8a1e3a3da1d7b8bbfaaf81c3d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="14&nbsp; Liquidity and Turnover Measures ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta property="og:description" content="">
<meta property="og:site_name" content="T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta name="twitter:title" content="14&nbsp; Liquidity and Turnover Measures ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn_vi/"> 
<span class="menu-text">üìò English Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn_vi/"> 
<span class="menu-text">üìó S√°ch Ti·∫øng Vi·ªát</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn_vi" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_modern_portfolio_theory.html">X√¢y d·ª±ng danh m·ª•c ƒë·∫ßu t∆∞, r·ªßi ro v√† c∆° h·ªçc th·ª±c nghi·ªám</a></li><li class="breadcrumb-item"><a href="./16_liquidity_and_turnover_measures.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Th·ªã tr∆∞·ªùng t√†i ch√≠nh, th·ªÉ ch·∫ø v√† d·ªØ li·ªáu Vi·ªát Nam</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Institutional Background and Market Structure of Vietnam‚Äôs Equity Market</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Accessing and Managing VN Financial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datacore Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_market_microstructure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_risk_free_rate_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk-Free Rate Construction in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_compound_return.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Compound Returns</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">X√¢y d·ª±ng danh m·ª•c ƒë·∫ßu t∆∞, r·ªßi ro v√† c∆° h·ªçc th·ª±c nghi·ªám</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_size_sorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Size Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_value_bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Value and Bivariate Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_portfolio_weighting_and_rebalancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Portfolio Weighting and Rebalancing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_missing_data_and_survivorship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Missing Data and Survivorship Bias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_liquidity_and_turnover_measures.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh ƒë·ªãnh gi√° t√†i s·∫£n</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_momentum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_factor_construction_principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Factor Construction Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_factor_zoo_and_multiple_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Factor Zoo and Multiple Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_time_series_vs_cross_section.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Time-Series vs.&nbsp;Cross-Sectional Factor Tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">C√°c y·∫øu t·ªë c∆° b·∫£n c·ªßa c√¥ng ty, ƒë·ªãnh gi√° v√† t√≠n hi·ªáu doanh nghi·ªáp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_info_earnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Information Content of Earnings Announcements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_accruals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Accruals, Earnings Persistence, and Market Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_earning_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./35_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./36_valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./37_disclosure_quality_and_timing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Disclosure Quality and Timing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./38_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./39_divop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Quy·ªÅn s·ªü h·ªØu, ma s√°t th·ªã tr∆∞·ªùng v√† r·ªßi ro qu·ªëc t·∫ø</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52_institutional_trade_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Institutional Trades, Flows, and Turnover Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./53_governance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Corporate Governance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./54_return_gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Return Gap: Measuring Unobserved Actions of Fund Managers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./55_price_limits_and_volatility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Price Limits and Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./56_market_integration_and_segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Market Integration and Segmentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./57_exchange_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Exchange Rate Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh t√†i ch√≠nh n√¢ng cao</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_event_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./61_tail_risk_extreme_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Tail Risk and Extreme Events</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./62_corporate_finance_estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Corporate Finance Estimators and Identification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./63_structural_models_finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Structural Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">D·ªØ li·ªáu thay th·∫ø v√† Tr√≠ tu·ªá nh√¢n t·∫°o trong t√†i ch√≠nh</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_textual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Textual Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./71_image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Image and Visual Data in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./73_networks_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Networks and Graphs in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./74_multimodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Multimodal Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-liquidity-theory" id="toc-sec-liquidity-theory" class="nav-link active" data-scroll-target="#sec-liquidity-theory"><span class="header-section-number">14.1</span> Theoretical Foundations</a>
  <ul class="collapse">
  <li><a href="#why-liquidity-matters" id="toc-why-liquidity-matters" class="nav-link" data-scroll-target="#why-liquidity-matters"><span class="header-section-number">14.1.1</span> Why Liquidity Matters</a></li>
  <li><a href="#liquidity-dimensions" id="toc-liquidity-dimensions" class="nav-link" data-scroll-target="#liquidity-dimensions"><span class="header-section-number">14.1.2</span> Liquidity Dimensions</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-data" id="toc-sec-liquidity-data" class="nav-link" data-scroll-target="#sec-liquidity-data"><span class="header-section-number">14.2</span> Data Construction</a></li>
  <li><a href="#sec-liquidity-measures" id="toc-sec-liquidity-measures" class="nav-link" data-scroll-target="#sec-liquidity-measures"><span class="header-section-number">14.3</span> Constructing Liquidity Measures</a>
  <ul class="collapse">
  <li><a href="#amihud-illiquidity-ratio" id="toc-amihud-illiquidity-ratio" class="nav-link" data-scroll-target="#amihud-illiquidity-ratio"><span class="header-section-number">14.3.1</span> Amihud Illiquidity Ratio</a></li>
  <li><a href="#zero-return-days-lesmond-measure" id="toc-zero-return-days-lesmond-measure" class="nav-link" data-scroll-target="#zero-return-days-lesmond-measure"><span class="header-section-number">14.3.2</span> Zero-Return Days (Lesmond Measure)</a></li>
  <li><a href="#turnover-ratio" id="toc-turnover-ratio" class="nav-link" data-scroll-target="#turnover-ratio"><span class="header-section-number">14.3.3</span> Turnover Ratio</a></li>
  <li><a href="#roll-spread-estimator" id="toc-roll-spread-estimator" class="nav-link" data-scroll-target="#roll-spread-estimator"><span class="header-section-number">14.3.4</span> Roll Spread Estimator</a></li>
  <li><a href="#corwin-schultz-high-low-spread" id="toc-corwin-schultz-high-low-spread" class="nav-link" data-scroll-target="#corwin-schultz-high-low-spread"><span class="header-section-number">14.3.5</span> Corwin-Schultz High-Low Spread</a></li>
  <li><a href="#quoted-bid-ask-spread" id="toc-quoted-bid-ask-spread" class="nav-link" data-scroll-target="#quoted-bid-ask-spread"><span class="header-section-number">14.3.6</span> Quoted Bid-Ask Spread</a></li>
  <li><a href="#kyles-lambda-price-impact-regression" id="toc-kyles-lambda-price-impact-regression" class="nav-link" data-scroll-target="#kyles-lambda-price-impact-regression"><span class="header-section-number">14.3.7</span> Kyle‚Äôs Lambda (Price Impact Regression)</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-panel" id="toc-sec-liquidity-panel" class="nav-link" data-scroll-target="#sec-liquidity-panel"><span class="header-section-number">14.4</span> Assembling the Liquidity Panel</a></li>
  <li><a href="#sec-liquidity-cross-section" id="toc-sec-liquidity-cross-section" class="nav-link" data-scroll-target="#sec-liquidity-cross-section"><span class="header-section-number">14.5</span> Cross-Sectional Properties of Liquidity</a>
  <ul class="collapse">
  <li><a href="#summary-statistics-by-size-quintile" id="toc-summary-statistics-by-size-quintile" class="nav-link" data-scroll-target="#summary-statistics-by-size-quintile"><span class="header-section-number">14.5.1</span> Summary Statistics by Size Quintile</a></li>
  <li><a href="#correlation-structure" id="toc-correlation-structure" class="nav-link" data-scroll-target="#correlation-structure"><span class="header-section-number">14.5.2</span> Correlation Structure</a></li>
  <li><a href="#principal-component-analysis-of-liquidity" id="toc-principal-component-analysis-of-liquidity" class="nav-link" data-scroll-target="#principal-component-analysis-of-liquidity"><span class="header-section-number">14.5.3</span> Principal Component Analysis of Liquidity</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-aggregate" id="toc-sec-liquidity-aggregate" class="nav-link" data-scroll-target="#sec-liquidity-aggregate"><span class="header-section-number">14.6</span> Aggregate Liquidity and Market Conditions</a>
  <ul class="collapse">
  <li><a href="#time-series-of-market-liquidity" id="toc-time-series-of-market-liquidity" class="nav-link" data-scroll-target="#time-series-of-market-liquidity"><span class="header-section-number">14.6.1</span> Time Series of Market Liquidity</a></li>
  <li><a href="#commonality-in-liquidity" id="toc-commonality-in-liquidity" class="nav-link" data-scroll-target="#commonality-in-liquidity"><span class="header-section-number">14.6.2</span> Commonality in Liquidity</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-pricing" id="toc-sec-liquidity-pricing" class="nav-link" data-scroll-target="#sec-liquidity-pricing"><span class="header-section-number">14.7</span> Is Liquidity Priced?</a>
  <ul class="collapse">
  <li><a href="#portfolio-sorts" id="toc-portfolio-sorts" class="nav-link" data-scroll-target="#portfolio-sorts"><span class="header-section-number">14.7.1</span> Portfolio Sorts</a></li>
  <li><a href="#fama-macbeth-cross-sectional-regressions" id="toc-fama-macbeth-cross-sectional-regressions" class="nav-link" data-scroll-target="#fama-macbeth-cross-sectional-regressions"><span class="header-section-number">14.7.2</span> Fama-MacBeth Cross-Sectional Regressions</a></li>
  <li><a href="#factor-adjusted-liquidity-premium" id="toc-factor-adjusted-liquidity-premium" class="nav-link" data-scroll-target="#factor-adjusted-liquidity-premium"><span class="header-section-number">14.7.3</span> Factor-Adjusted Liquidity Premium</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-implementation" id="toc-sec-liquidity-implementation" class="nav-link" data-scroll-target="#sec-liquidity-implementation"><span class="header-section-number">14.8</span> Liquidity and Transaction Cost Estimation</a>
  <ul class="collapse">
  <li><a href="#translating-measures-to-trading-costs" id="toc-translating-measures-to-trading-costs" class="nav-link" data-scroll-target="#translating-measures-to-trading-costs"><span class="header-section-number">14.8.1</span> Translating Measures to Trading Costs</a></li>
  <li><a href="#strategy-implementability" id="toc-strategy-implementability" class="nav-link" data-scroll-target="#strategy-implementability"><span class="header-section-number">14.8.2</span> Strategy Implementability</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-stress" id="toc-sec-liquidity-stress" class="nav-link" data-scroll-target="#sec-liquidity-stress"><span class="header-section-number">14.9</span> Liquidity During Market Stress</a>
  <ul class="collapse">
  <li><a href="#flight-to-liquidity" id="toc-flight-to-liquidity" class="nav-link" data-scroll-target="#flight-to-liquidity"><span class="header-section-number">14.9.1</span> Flight to Liquidity</a></li>
  <li><a href="#liquidity-co-movement-with-global-risk" id="toc-liquidity-co-movement-with-global-risk" class="nav-link" data-scroll-target="#liquidity-co-movement-with-global-risk"><span class="header-section-number">14.9.2</span> Liquidity Co-Movement with Global Risk</a></li>
  </ul></li>
  <li><a href="#sec-liquidity-factor" id="toc-sec-liquidity-factor" class="nav-link" data-scroll-target="#sec-liquidity-factor"><span class="header-section-number">14.10</span> Constructing a Tradeable Liquidity Factor</a></li>
  <li><a href="#sec-liquidity-practical" id="toc-sec-liquidity-practical" class="nav-link" data-scroll-target="#sec-liquidity-practical"><span class="header-section-number">14.11</span> Practical Guidance for Vietnam</a></li>
  <li><a href="#sec-liquidity-summary" id="toc-sec-liquidity-summary" class="nav-link" data-scroll-target="#sec-liquidity-summary"><span class="header-section-number">14.12</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/16_liquidity_and_turnover_measures.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_modern_portfolio_theory.html">X√¢y d·ª±ng danh m·ª•c ƒë·∫ßu t∆∞, r·ªßi ro v√† c∆° h·ªçc th·ª±c nghi·ªám</a></li><li class="breadcrumb-item"><a href="./16_liquidity_and_turnover_measures.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter, we construct a comprehensive suite of liquidity measures for the Vietnamese equity market, validate them against each other and against known benchmarks, test whether liquidity is priced in the cross-section of stock returns, examine commonality in liquidity, and analyze how liquidity conditions vary over time and across market regimes.</p>
</div>
</div>
<p>Liquidity (i.e., the ability to trade quickly at low cost without moving the price) is arguably the single most important practical consideration for anyone working with Vietnamese equity data. A factor premium that looks attractive in a frictionless backtest may be completely unimplementable if the long and short legs load on illiquid stocks whose prices move against you when you trade. Conversely, a genuine liquidity premium (i.e., compensation for bearing the risk that a stock will be hard to sell when you need to) is one of the most robust and theoretically grounded anomalies in asset pricing.</p>
<p>The challenge is that liquidity is inherently multidimensional and difficult to measure. In developed markets with continuous limit order books and sub-second trade reporting, researchers can observe bid-ask spreads, market depth, and price impact directly. In Vietnam, microstructure data at this granularity are limited: HOSE operates a periodic call auction at open and close with continuous matching in between, the tick size is coarse relative to price levels, and many stocks trade so infrequently that the concept of a ‚Äúquoted spread‚Äù is meaningful only on days when the stock actually trades. This forces researchers to rely on low-frequency proxies computed from daily price and volume data.</p>
<p>This chapter constructs the major liquidity proxies used in the academic literature, validates them in the Vietnamese context, and demonstrates their use in asset pricing and portfolio construction.</p>
<section id="sec-liquidity-theory" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="sec-liquidity-theory"><span class="header-section-number">14.1</span> Theoretical Foundations</h2>
<section id="why-liquidity-matters" class="level3" data-number="14.1.1">
<h3 data-number="14.1.1" class="anchored" data-anchor-id="why-liquidity-matters"><span class="header-section-number">14.1.1</span> Why Liquidity Matters</h3>
<p>Liquidity affects asset prices through at least three channels:</p>
<ol type="1">
<li><strong>Level effect.</strong> Investors demand compensation for the expected cost of trading. <span class="citation" data-cites="amihud1986asset">Amihud and Mendelson (<a href="references.html#ref-amihud1986asset" role="doc-biblioref">1986</a>)</span> show that stocks with higher bid-ask spreads earn higher expected returns, with the premium being an increasing function of the investor‚Äôs holding period. In equilibrium, illiquid stocks must offer higher expected returns to compensate for higher round-trip trading costs.</li>
<li><strong>Risk effect.</strong> Liquidity is time-varying and co-moves across stocks. <span class="citation" data-cites="pastor2003liquidity">P√°stor and Stambaugh (<a href="references.html#ref-pastor2003liquidity" role="doc-biblioref">2003</a>)</span> show that stocks whose returns are more sensitive to aggregate liquidity shocks earn higher expected returns. <span class="citation" data-cites="acharya2005asset">Acharya and Pedersen (<a href="references.html#ref-acharya2005asset" role="doc-biblioref">2005</a>)</span> formalize this in a liquidity-adjusted CAPM where the required return includes a premium for bearing liquidity risk (i.e., the risk that the stock becomes illiquid precisely when the investor needs to sell).</li>
<li><strong>Commonality effect.</strong> <span class="citation" data-cites="chordia2000commonality">Chordia, Roll, and Subrahmanyam (<a href="references.html#ref-chordia2000commonality" role="doc-biblioref">2000</a>)</span> document that individual stock liquidity co-moves strongly with market-wide liquidity. <span class="citation" data-cites="brunnermeier2009market">Brunnermeier and Pedersen (<a href="references.html#ref-brunnermeier2009market" role="doc-biblioref">2009</a>)</span> explain this through a ‚Äúliquidity spiral‚Äù: when asset values fall, margin constraints tighten, forcing leveraged investors to sell, which reduces market liquidity, which depresses prices further. This mechanism is particularly relevant in Vietnam, where retail investors with margin accounts are the dominant trading population.</li>
</ol>
</section>
<section id="liquidity-dimensions" class="level3" data-number="14.1.2">
<h3 data-number="14.1.2" class="anchored" data-anchor-id="liquidity-dimensions"><span class="header-section-number">14.1.2</span> Liquidity Dimensions</h3>
<p><span class="citation" data-cites="kyle1985continuous">Kyle (<a href="references.html#ref-kyle1985continuous" role="doc-biblioref">1985</a>)</span> identifies three dimensions of liquidity:</p>
<ol type="1">
<li><strong>Tightness.</strong> The cost of turning around a position quickly, which is measured by the bid-ask spread.</li>
<li><strong>Depth.</strong> The volume that can be traded without moving the price, which is related to price impact.</li>
<li><strong>Resiliency.</strong> The speed at which prices recover from uninformative order flow shocks.</li>
</ol>
<p>No single measure captures all three dimensions. <span class="citation" data-cites="goyenko2009liquidity">Goyenko, Holden, and Trzcinka (<a href="references.html#ref-goyenko2009liquidity" role="doc-biblioref">2009</a>)</span> and <span class="citation" data-cites="fong2017best">Fong, Holden, and Trzcinka (<a href="references.html#ref-fong2017best" role="doc-biblioref">2017</a>)</span> systematically evaluate which low-frequency proxies best capture each dimension by benchmarking against high-frequency measures. Their key finding: the <span class="citation" data-cites="amihud2002illiquidity">Amihud (<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">2002</a>)</span> measure best captures the price impact dimension, the <span class="citation" data-cites="roll1984simple">Roll (<a href="references.html#ref-roll1984simple" role="doc-biblioref">1984</a>)</span> estimator and <span class="citation" data-cites="corwin2012simple">Corwin and Schultz (<a href="references.html#ref-corwin2012simple" role="doc-biblioref">2012</a>)</span> spread best capture tightness, and the <span class="citation" data-cites="lesmond1999new">Lesmond, Ogden, and Trzcinka (<a href="references.html#ref-lesmond1999new" role="doc-biblioref">1999</a>)</span> zero-return measure captures a blend of transaction costs and information asymmetry. For emerging markets specifically, <span class="citation" data-cites="fong2017best">Fong, Holden, and Trzcinka (<a href="references.html#ref-fong2017best" role="doc-biblioref">2017</a>)</span> recommend the Amihud measure and the Closing Percent Quoted Spread as the most reliable proxies.</p>
</section>
</section>
<section id="sec-liquidity-data" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="sec-liquidity-data"><span class="header-section-number">14.2</span> Data Construction</h2>
<div id="setup" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> linearmodels.panel <span class="im">import</span> PanelOLS</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> linearmodels.asset_pricing <span class="im">import</span> LinearFactorModel</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">12</span>, <span class="dv">6</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">150</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">11</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.top'</span>: <span class="va">False</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.right'</span>: <span class="va">False</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="data-load" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datacore <span class="im">import</span> DataCoreClient</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> DataCoreClient()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily trading data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>daily <span class="op">=</span> client.get_daily_prices(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'date'</span>, <span class="st">'open'</span>, <span class="st">'high'</span>, <span class="st">'low'</span>, <span class="st">'close'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'adjusted_close'</span>, <span class="st">'volume'</span>, <span class="st">'turnover_value'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'market_cap'</span>, <span class="st">'shares_outstanding'</span>, <span class="st">'free_float_pct'</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bid'</span>, <span class="st">'ask'</span>, <span class="st">'foreign_buy_volume'</span>, <span class="st">'foreign_sell_volume'</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly aggregates</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>monthly <span class="op">=</span> client.get_monthly_returns(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>, <span class="st">'market_cap'</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'volume_avg_20d'</span>, <span class="st">'turnover_value_avg_20d'</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_trading_days'</span>, <span class="st">'n_zero_volume_days'</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Firm characteristics for cross-sectional tests</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>fundamentals <span class="op">=</span> client.get_fundamentals(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    frequency<span class="op">=</span><span class="st">'annual'</span>,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'fiscal_year'</span>, <span class="st">'total_assets'</span>, <span class="st">'total_equity'</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'net_income'</span>, <span class="st">'revenue'</span>, <span class="st">'book_equity'</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Factor returns for asset pricing tests</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> client.get_factor_returns(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    market<span class="op">=</span><span class="st">'vietnam'</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>[<span class="st">'mkt_excess'</span>, <span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'wml'</span>]</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(daily[<span class="st">'date'</span>])</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>daily <span class="op">=</span> daily.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Daily observations: </span><span class="sc">{</span>daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly observations: </span><span class="sc">{</span>monthly<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique tickers: </span><span class="sc">{</span>daily[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="daily-returns" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily returns</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'daily_return'</span>] <span class="op">=</span> (</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    daily.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].pct_change()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'abs_return'</span>] <span class="op">=</span> daily[<span class="st">'daily_return'</span>].<span class="bu">abs</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'log_return'</span>] <span class="op">=</span> np.log(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    daily[<span class="st">'adjusted_close'</span>] <span class="op">/</span> daily.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Turnover ratio (shares traded / shares outstanding)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'turnover_ratio'</span>] <span class="op">=</span> daily[<span class="st">'volume'</span>] <span class="op">/</span> daily[<span class="st">'shares_outstanding'</span>]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero indicators</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'zero_return'</span>] <span class="op">=</span> (daily[<span class="st">'daily_return'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'zero_volume'</span>] <span class="op">=</span> (daily[<span class="st">'volume'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># VND turnover (in billions)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'turnover_vnd_bn'</span>] <span class="op">=</span> daily[<span class="st">'turnover_value'</span>] <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Daily Return Summary:"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daily[<span class="st">'daily_return'</span>].describe().<span class="bu">round</span>(<span class="dv">6</span>))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Zero-return days: </span><span class="sc">{</span>daily[<span class="st">'zero_return'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-volume days: </span><span class="sc">{</span>daily[<span class="st">'zero_volume'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-liquidity-measures" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="sec-liquidity-measures"><span class="header-section-number">14.3</span> Constructing Liquidity Measures</h2>
<p>We construct seven liquidity proxies that span the dimensions of tightness, depth, and resiliency. Each is computed at the firm-month level, producing a panel that can be merged with monthly return data for cross-sectional tests.</p>
<section id="amihud-illiquidity-ratio" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1" class="anchored" data-anchor-id="amihud-illiquidity-ratio"><span class="header-section-number">14.3.1</span> Amihud Illiquidity Ratio</h3>
<p>The <span class="citation" data-cites="amihud2002illiquidity">Amihud (<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">2002</a>)</span> illiquidity measure is the ratio of absolute daily return to daily volume (in VND):</p>
<p><span id="eq-amihud"><span class="math display">\[
\text{ILLIQ}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{|R_{i,d}|}{\text{DVOL}_{i,d}}
\tag{14.1}\]</span></span></p>
<p>where <span class="math inline">\(|R_{i,d}|\)</span> is the absolute daily return, <span class="math inline">\(\text{DVOL}_{i,d}\)</span> is VND trading volume on day <span class="math inline">\(d\)</span>, and <span class="math inline">\(D_{i,m}\)</span> is the number of trading days with positive volume in month <span class="math inline">\(m\)</span>. Higher values indicate greater illiquidity.</p>
<p>The Amihud measure captures the price impact dimension of liquidity. It is grounded in the <span class="citation" data-cites="kyle1985continuous">Kyle (<a href="references.html#ref-kyle1985continuous" role="doc-biblioref">1985</a>)</span> model where the parameter <span class="math inline">\(\lambda\)</span> (Kyle‚Äôs lambda) measures the price impact of order flow: <span class="math inline">\(\Delta p = \lambda \cdot Q\)</span>. The Amihud ratio is a daily-frequency analog of <span class="math inline">\(\lambda\)</span>.</p>
<div id="amihud" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_amihud(daily_df, min_days<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Amihud (2002) illiquidity ratio at the firm-month level.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Excludes zero-volume days. Requires at least min_days observations</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    with positive volume per firm-month.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[daily_df[<span class="st">'volume'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># |Return| / VND Volume</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_daily'</span>] <span class="op">=</span> df[<span class="st">'abs_return'</span>] <span class="op">/</span> df[<span class="st">'turnover_value'</span>]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove extreme outliers (top 0.1% within each month)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_daily'</span>] <span class="op">=</span> df.groupby(<span class="st">'month'</span>)[<span class="st">'illiq_daily'</span>].transform(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.clip(upper<span class="op">=</span>x.quantile(<span class="fl">0.999</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate to firm-month</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    amihud <span class="op">=</span> (</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            amihud_raw<span class="op">=</span>(<span class="st">'illiq_daily'</span>, <span class="st">'mean'</span>),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            n_positive_vol_days<span class="op">=</span>(<span class="st">'illiq_daily'</span>, <span class="st">'count'</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter: require minimum trading days</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    amihud <span class="op">=</span> amihud[amihud[<span class="st">'n_positive_vol_days'</span>] <span class="op">&gt;=</span> min_days]</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log transform (raw Amihud is heavily right-skewed)</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    amihud[<span class="st">'amihud'</span>] <span class="op">=</span> np.log(<span class="dv">1</span> <span class="op">+</span> amihud[<span class="st">'amihud_raw'</span>] <span class="op">*</span> <span class="fl">1e6</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert period to timestamp for merging</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    amihud[<span class="st">'month_end'</span>] <span class="op">=</span> amihud[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> amihud[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'amihud'</span>, <span class="st">'amihud_raw'</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'n_positive_vol_days'</span>]]</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>amihud_monthly <span class="op">=</span> compute_amihud(daily)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Amihud observations: </span><span class="sc">{</span><span class="bu">len</span>(amihud_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log Amihud distribution:"</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(amihud_monthly[<span class="st">'amihud'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="zero-return-days-lesmond-measure" class="level3" data-number="14.3.2">
<h3 data-number="14.3.2" class="anchored" data-anchor-id="zero-return-days-lesmond-measure"><span class="header-section-number">14.3.2</span> Zero-Return Days (Lesmond Measure)</h3>
<p><span class="citation" data-cites="lesmond1999new">Lesmond, Ogden, and Trzcinka (<a href="references.html#ref-lesmond1999new" role="doc-biblioref">1999</a>)</span> propose using the proportion of zero-return days as a measure of transaction costs. The intuition is that if the true value change on a given day is smaller than the round-trip transaction cost, a rational marginal investor will not trade, and the observed return will be zero. Thus, the zero-return proportion is an increasing function of effective transaction costs.</p>
<p><span class="citation" data-cites="lesmond2005liquidity">Lesmond (<a href="references.html#ref-lesmond2005liquidity" role="doc-biblioref">2005</a>)</span> validates this measure for emerging markets and finds it strongly correlated with explicit cost measures. In Vietnam, where zero-return days are common (as documented in the previous chapter), this measure has particular relevance.</p>
<p><span id="eq-zero-return"><span class="math display">\[
\text{ZeroRet}_{i,m} = \frac{\text{Number of days with } R_{i,d} = 0}{D_{i,m}}
\tag{14.2}\]</span></span></p>
<div id="zero-return" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_zero_return(daily_df):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Lesmond et al. (1999) zero-return measure</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    at the firm-month level.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    zero_ret <span class="op">=</span> (</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            n_days<span class="op">=</span>(<span class="st">'daily_return'</span>, <span class="st">'count'</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            n_zero_return<span class="op">=</span>(<span class="st">'zero_return'</span>, <span class="st">'sum'</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            n_zero_volume<span class="op">=</span>(<span class="st">'zero_volume'</span>, <span class="st">'sum'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'zero_return_pct'</span>] <span class="op">=</span> (</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        zero_ret[<span class="st">'n_zero_return'</span>] <span class="op">/</span> zero_ret[<span class="st">'n_days'</span>]</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'zero_volume_pct'</span>] <span class="op">=</span> (</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        zero_ret[<span class="st">'n_zero_volume'</span>] <span class="op">/</span> zero_ret[<span class="st">'n_days'</span>]</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'month_end'</span>] <span class="op">=</span> zero_ret[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> zero_ret[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'zero_return_pct'</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'zero_volume_pct'</span>, <span class="st">'n_days'</span>]]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>zero_monthly <span class="op">=</span> compute_zero_return(daily)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-return observations: </span><span class="sc">{</span><span class="bu">len</span>(zero_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Zero-return proportion distribution:"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zero_monthly[<span class="st">'zero_return_pct'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="turnover-ratio" class="level3" data-number="14.3.3">
<h3 data-number="14.3.3" class="anchored" data-anchor-id="turnover-ratio"><span class="header-section-number">14.3.3</span> Turnover Ratio</h3>
<p>Share turnover (i.e., daily volume divided by shares outstanding) measures trading activity rather than trading cost. <span class="citation" data-cites="datar1998liquidity">Datar, Naik, and Radcliffe (<a href="references.html#ref-datar1998liquidity" role="doc-biblioref">1998</a>)</span> use turnover as a liquidity proxy and document a negative cross-sectional relationship between turnover and expected returns, consistent with the liquidity premium hypothesis.</p>
<p><span id="eq-turnover"><span class="math display">\[
\text{Turn}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{\text{Volume}_{i,d}}{\text{SharesOut}_{i,d}}
\tag{14.3}\]</span></span></p>
<div id="turnover" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_turnover(daily_df):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute average daily turnover ratio at the firm-month level."""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    turnover <span class="op">=</span> (</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            turnover_mean<span class="op">=</span>(<span class="st">'turnover_ratio'</span>, <span class="st">'mean'</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            turnover_sum<span class="op">=</span>(<span class="st">'turnover_ratio'</span>, <span class="st">'sum'</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            volume_mean<span class="op">=</span>(<span class="st">'volume'</span>, <span class="st">'mean'</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            dvol_mean<span class="op">=</span>(<span class="st">'turnover_value'</span>, <span class="st">'mean'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log transform for cross-sectional normality</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'log_turnover'</span>] <span class="op">=</span> np.log(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        turnover[<span class="st">'turnover_mean'</span>].clip(lower<span class="op">=</span><span class="fl">1e-8</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'log_dvol'</span>] <span class="op">=</span> np.log(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        turnover[<span class="st">'dvol_mean'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'month_end'</span>] <span class="op">=</span> turnover[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> turnover[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'turnover_mean'</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'log_turnover'</span>, <span class="st">'log_dvol'</span>]]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>turnover_monthly <span class="op">=</span> compute_turnover(daily)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Turnover observations: </span><span class="sc">{</span><span class="bu">len</span>(turnover_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log turnover distribution:"</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(turnover_monthly[<span class="st">'log_turnover'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="roll-spread-estimator" class="level3" data-number="14.3.4">
<h3 data-number="14.3.4" class="anchored" data-anchor-id="roll-spread-estimator"><span class="header-section-number">14.3.4</span> Roll Spread Estimator</h3>
<p><span class="citation" data-cites="roll1984simple">Roll (<a href="references.html#ref-roll1984simple" role="doc-biblioref">1984</a>)</span> derives an implicit bid-ask spread from the serial covariance of price changes. Under the assumptions that the true value follows a random walk and that observed prices bounce between the bid and ask:</p>
<p><span id="eq-roll"><span class="math display">\[
\text{Roll}_{i,m} = \begin{cases}
2\sqrt{-\text{Cov}(\Delta P_{i,d}, \Delta P_{i,d-1})} &amp; \text{if } \text{Cov} &lt; 0 \\
0 &amp; \text{if } \text{Cov} \geq 0
\end{cases}
\tag{14.4}\]</span></span></p>
<p>where <span class="math inline">\(\Delta P_{i,d} = P_{i,d} - P_{i,d-1}\)</span>. The measure is intuitive: the bid-ask bounce creates negative serial correlation in transaction prices, and the magnitude of this negative correlation reflects the spread.</p>
<div id="roll-spread" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_roll_spread(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Roll (1984) effective spread from serial</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    covariance of daily price changes.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'price_change'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].diff()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'price_change_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'price_change'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> roll_estimate(group):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> group[<span class="st">'price_change'</span>].cov(group[<span class="st">'price_change_lag'</span>])</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cov <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="op">-</span>cov)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Normalize by average price</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            avg_price <span class="op">=</span> group[<span class="st">'adjusted_close'</span>].mean()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> spread <span class="op">/</span> avg_price <span class="cf">if</span> avg_price <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    roll <span class="op">=</span> (</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        df.dropna(subset<span class="op">=</span>[<span class="st">'price_change'</span>, <span class="st">'price_change_lag'</span>])</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(roll_estimate)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'roll_spread'</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    roll[<span class="st">'month_end'</span>] <span class="op">=</span> roll[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> roll[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'roll_spread'</span>]]</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>roll_monthly <span class="op">=</span> compute_roll_spread(daily)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Roll spread observations: </span><span class="sc">{</span><span class="bu">len</span>(roll_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Roll spread distribution:"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roll_monthly[<span class="st">'roll_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="corwin-schultz-high-low-spread" class="level3" data-number="14.3.5">
<h3 data-number="14.3.5" class="anchored" data-anchor-id="corwin-schultz-high-low-spread"><span class="header-section-number">14.3.5</span> Corwin-Schultz High-Low Spread</h3>
<p><span class="citation" data-cites="corwin2012simple">Corwin and Schultz (<a href="references.html#ref-corwin2012simple" role="doc-biblioref">2012</a>)</span> estimate the effective spread from daily high and low prices. The key insight is that daily high and low prices contain information about both volatility and the spread‚Äîthe high is typically a buy and the low a sell, so the high-low range reflects both true volatility and the bid-ask spread. By comparing one-day and two-day high-low ranges, the method separates the two components:</p>
<p><span id="eq-corwin-schultz"><span class="math display">\[
\hat{S}_{i,m} = \frac{2(e^{\hat{\alpha}} - 1)}{1 + e^{\hat{\alpha}}}
\tag{14.5}\]</span></span></p>
<p>where:</p>
<p><span id="eq-cs-alpha"><span class="math display">\[
\hat{\alpha} = \frac{\sqrt{2\hat{\beta}} - \sqrt{\hat{\beta}}}{3 - 2\sqrt{2}} - \sqrt{\frac{\hat{\gamma}}{3 - 2\sqrt{2}}}
\tag{14.6}\]</span></span></p>
<p>with <span class="math inline">\(\hat{\beta}\)</span> and <span class="math inline">\(\hat{\gamma}\)</span> computed from one-day and two-day log high-low ratios.</p>
<div id="corwin-schultz" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_corwin_schultz(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Corwin and Schultz (2012) bid-ask spread</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator from daily high and low prices.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log high-low ratio</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl'</span>] <span class="op">=</span> np.log(df[<span class="st">'high'</span>] <span class="op">/</span> df[<span class="st">'low'</span>])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_sq'</span>] <span class="op">=</span> df[<span class="st">'log_hl'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Two-day high and low</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'high_2d'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'high'</span>].transform(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.rolling(<span class="dv">2</span>).<span class="bu">max</span>()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'low_2d'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'low'</span>].transform(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.rolling(<span class="dv">2</span>).<span class="bu">min</span>()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_2d'</span>] <span class="op">=</span> np.log(df[<span class="st">'high_2d'</span>] <span class="op">/</span> df[<span class="st">'low_2d'</span>])</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_2d_sq'</span>] <span class="op">=</span> df[<span class="st">'log_hl_2d'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cs_estimate(group):</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> group[<span class="st">'log_hl_sq'</span>].mean() <span class="op">+</span> group[<span class="st">'log_hl_sq'</span>].shift(<span class="dv">1</span>).mean()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> group[[<span class="st">'log_hl_sq'</span>]].rolling(<span class="dv">2</span>).<span class="bu">sum</span>().mean().values[<span class="dv">0</span>]</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        gamma <span class="op">=</span> group[<span class="st">'log_hl_2d_sq'</span>].mean()</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> np.sqrt(<span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        denom <span class="op">=</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="dv">2</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        term1 <span class="op">=</span> np.sqrt(<span class="bu">max</span>(beta, <span class="dv">0</span>)) <span class="op">/</span> denom</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> beta <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">=</span> (np.sqrt(<span class="dv">2</span> <span class="op">*</span> beta) <span class="op">-</span> np.sqrt(beta)) <span class="op">/</span> denom</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">-=</span> np.sqrt(<span class="bu">max</span>(gamma <span class="op">/</span> denom, <span class="dv">0</span>))</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spread estimate</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> alpha_est <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (np.exp(alpha_est) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(alpha_est))</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(spread, <span class="fl">0.20</span>)  <span class="co"># Cap at 20% (sanity check)</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    cs <span class="op">=</span> (</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        df.dropna(subset<span class="op">=</span>[<span class="st">'log_hl'</span>, <span class="st">'log_hl_2d'</span>])</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(cs_estimate)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'cs_spread'</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    cs[<span class="st">'month_end'</span>] <span class="op">=</span> cs[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cs[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'cs_spread'</span>]]</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>cs_monthly <span class="op">=</span> compute_corwin_schultz(daily)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Corwin-Schultz observations: </span><span class="sc">{</span><span class="bu">len</span>(cs_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">CS spread distribution:"</span>)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cs_monthly[<span class="st">'cs_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="quoted-bid-ask-spread" class="level3" data-number="14.3.6">
<h3 data-number="14.3.6" class="anchored" data-anchor-id="quoted-bid-ask-spread"><span class="header-section-number">14.3.6</span> Quoted Bid-Ask Spread</h3>
<p>When bid and ask quotes are available, the quoted percentage spread provides a direct measure of tightness:</p>
<p><span id="eq-quoted-spread"><span class="math display">\[
\text{PQSPR}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{\text{Ask}_{i,d} - \text{Bid}_{i,d}}{(\text{Ask}_{i,d} + \text{Bid}_{i,d})/2}
\tag{14.7}\]</span></span></p>
<div id="quoted-spread" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_quoted_spread(daily_df):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute average quoted percentage spread at the firm-month level."""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        (daily_df[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (daily_df[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        (daily_df[<span class="st">'ask'</span>] <span class="op">&gt;=</span> daily_df[<span class="st">'bid'</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'pqspr'</span>] <span class="op">=</span> (</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">-</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> ((df[<span class="st">'ask'</span>] <span class="op">+</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Winsorize extreme values</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'pqspr'</span>] <span class="op">=</span> df[<span class="st">'pqspr'</span>].clip(upper<span class="op">=</span>df[<span class="st">'pqspr'</span>].quantile(<span class="fl">0.999</span>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    spread <span class="op">=</span> (</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            quoted_spread<span class="op">=</span>(<span class="st">'pqspr'</span>, <span class="st">'mean'</span>),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            n_quotes<span class="op">=</span>(<span class="st">'pqspr'</span>, <span class="st">'count'</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    spread[<span class="st">'month_end'</span>] <span class="op">=</span> spread[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> spread[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'n_quotes'</span>]]</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>quoted_monthly <span class="op">=</span> compute_quoted_spread(daily)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Quoted spread observations: </span><span class="sc">{</span><span class="bu">len</span>(quoted_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Quoted spread distribution:"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(quoted_monthly[<span class="st">'quoted_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="kyles-lambda-price-impact-regression" class="level3" data-number="14.3.7">
<h3 data-number="14.3.7" class="anchored" data-anchor-id="kyles-lambda-price-impact-regression"><span class="header-section-number">14.3.7</span> Kyle‚Äôs Lambda (Price Impact Regression)</h3>
<p>We estimate Kyle‚Äôs lambda (i.e., the price impact per unit of signed order flow) using a daily regression:</p>
<p><span id="eq-kyle-lambda"><span class="math display">\[
R_{i,d} = \alpha_i + \lambda_i \cdot \text{Sign}(R_{i,d}) \cdot \sqrt{\text{Volume}_{i,d}} + \varepsilon_{i,d}
\tag{14.8}\]</span></span></p>
<p>This is an adaptation of the <span class="citation" data-cites="hasbrouck2009trading">Hasbrouck (<a href="references.html#ref-hasbrouck2009trading" role="doc-biblioref">2009</a>)</span> effective cost measure. The coefficient <span class="math inline">\(\lambda_i\)</span> measures how much prices move per unit of (unsigned, square-rooted) volume.</p>
<div id="kyle-lambda" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_kyle_lambda(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate Kyle's lambda (price impact per unit order flow)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    from daily return-on-signed-volume regressions.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[daily_df[<span class="st">'volume'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Signed square-root volume (sign inferred from return)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'signed_sqrt_vol'</span>] <span class="op">=</span> (</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        np.sign(df[<span class="st">'daily_return'</span>]) <span class="op">*</span> np.sqrt(df[<span class="st">'volume'</span>])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> estimate_lambda(group):</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> group[<span class="st">'daily_return'</span>].values</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> group[<span class="st">'signed_sqrt_vol'</span>].values</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> sm.add_constant(x)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, x).fit()</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            lam <span class="op">=</span> model.params[<span class="dv">1</span>]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">max</span>(lam, <span class="dv">0</span>)  <span class="co"># Lambda should be non-negative</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    kyle <span class="op">=</span> (</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(estimate_lambda)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'kyle_lambda'</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    kyle[<span class="st">'log_kyle'</span>] <span class="op">=</span> np.log(kyle[<span class="st">'kyle_lambda'</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>))</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    kyle[<span class="st">'month_end'</span>] <span class="op">=</span> kyle[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kyle[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'kyle_lambda'</span>, <span class="st">'log_kyle'</span>]]</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>kyle_monthly <span class="op">=</span> compute_kyle_lambda(daily)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kyle lambda observations: </span><span class="sc">{</span><span class="bu">len</span>(kyle_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log Kyle lambda distribution:"</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(kyle_monthly[<span class="st">'log_kyle'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-panel" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="sec-liquidity-panel"><span class="header-section-number">14.4</span> Assembling the Liquidity Panel</h2>
<p>We merge all seven measures into a single firm-month panel for comparative analysis.</p>
<div id="merge-panel" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with monthly returns as the base</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> monthly[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'market_cap'</span>]].copy()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge each liquidity measure</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, df, key_col <span class="kw">in</span> [</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Amihud'</span>, amihud_monthly, <span class="st">'amihud'</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Zero Return'</span>, zero_monthly, <span class="st">'zero_return_pct'</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Turnover'</span>, turnover_monthly, <span class="st">'log_turnover'</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Roll'</span>, roll_monthly, <span class="st">'roll_spread'</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Corwin-Schultz'</span>, cs_monthly, <span class="st">'cs_spread'</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Quoted Spread'</span>, quoted_monthly, <span class="st">'quoted_spread'</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Kyle Lambda'</span>, kyle_monthly, <span class="st">'log_kyle'</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    panel <span class="op">=</span> panel.merge(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        df[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, key_col]],</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>],</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add log market cap</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'log_mcap'</span>] <span class="op">=</span> np.log(panel[<span class="st">'market_cap'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fundamentals (lagged)</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>fund_lagged <span class="op">=</span> fundamentals.copy()</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>fund_lagged[<span class="st">'merge_year'</span>] <span class="op">=</span> fund_lagged[<span class="st">'fiscal_year'</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> panel.merge(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    fund_lagged[[<span class="st">'ticker'</span>, <span class="st">'merge_year'</span>, <span class="st">'book_equity'</span>]].rename(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>{<span class="st">'merge_year'</span>: <span class="st">'year'</span>}),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>[<span class="st">'ticker'</span>, panel[<span class="st">'month_end'</span>].dt.year],</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'year'</span>],</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'bm'</span>] <span class="op">=</span> panel[<span class="st">'book_equity'</span>] <span class="op">/</span> panel[<span class="st">'market_cap'</span>]</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unified panel: </span><span class="sc">{</span><span class="bu">len</span>(panel)<span class="sc">:,}</span><span class="ss"> firm-months"</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Coverage by measure:"</span>)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>liquidity_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'log_turnover'</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> liquidity_cols:</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> panel[col].notna().mean()</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>col<span class="sc">:&lt;20}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.1%}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-liquidity-cross-section" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="sec-liquidity-cross-section"><span class="header-section-number">14.5</span> Cross-Sectional Properties of Liquidity</h2>
<section id="summary-statistics-by-size-quintile" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1" class="anchored" data-anchor-id="summary-statistics-by-size-quintile"><span class="header-section-number">14.5.1</span> Summary Statistics by Size Quintile</h3>
<p>Liquidity varies enormously across the size distribution. Small-cap Vietnamese stocks can be orders of magnitude less liquid than large-caps.</p>
<div id="liquidity-by-size" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign size quintiles within each month</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'size_quintile'</span>] <span class="op">=</span> (</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'market_cap'</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .transform(<span class="kw">lambda</span> x: pd.qcut(x, <span class="dv">5</span>, labels<span class="op">=</span>[<span class="st">'Q1 (Small)'</span>, <span class="st">'Q2'</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">'Q3'</span>, <span class="st">'Q4'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">'Q5 (Large)'</span>],</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                                   duplicates<span class="op">=</span><span class="st">'drop'</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Average liquidity by quintile</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>liq_by_size <span class="op">=</span> (</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'size_quintile'</span>)[liquidity_cols]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average Liquidity by Market Cap Quintile:"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(liq_by_size.to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-liquidity-by-size" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="14">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-by-size-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>measures_to_plot <span class="op">=</span> [</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'amihud'</span>, <span class="st">'Amihud (log)'</span>, <span class="st">'#2C5F8A'</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'zero_return_pct'</span>, <span class="st">'Zero-Return %'</span>, <span class="st">'#C0392B'</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'log_turnover'</span>, <span class="st">'Log Turnover'</span>, <span class="st">'#27AE60'</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'roll_spread'</span>, <span class="st">'Roll Spread'</span>, <span class="st">'#E67E22'</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'cs_spread'</span>, <span class="st">'Corwin-Schultz Spread'</span>, <span class="st">'#8E44AD'</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'quoted_spread'</span>, <span class="st">'Quoted Spread'</span>, <span class="st">'#1ABC9C'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (col, label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(measures_to_plot):</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> panel.groupby(<span class="st">'size_quintile'</span>)[col].mean()</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    axes[i].bar(<span class="bu">range</span>(<span class="bu">len</span>(data)), data.values,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(data)))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticklabels(data.index, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(label)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(label)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Liquidity Measures by Market Cap Quintile'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-liquidity-by-size-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.1
</figcaption>
</figure>
</div>
</section>
<section id="correlation-structure" class="level3" data-number="14.5.2">
<h3 data-number="14.5.2" class="anchored" data-anchor-id="correlation-structure"><span class="header-section-number">14.5.2</span> Correlation Structure</h3>
<p>How strongly do the different liquidity measures correlate? If they capture the same underlying dimension, we expect high correlations. If they capture different dimensions (tightness vs.&nbsp;depth vs.&nbsp;activity), correlations will be moderate.</p>
<div id="fig-liquidity-correlations" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="15">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank correlations (Spearman) among liquidity measures</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse turnover sign so higher = less liquid (consistent direction)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>panel_corr <span class="op">=</span> panel[liquidity_cols].copy()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>panel_corr[<span class="st">'neg_log_turnover'</span>] <span class="op">=</span> <span class="op">-</span>panel_corr[<span class="st">'log_turnover'</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>corr_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'neg_log_turnover'</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>corr_labels <span class="op">=</span> [<span class="st">'Amihud'</span>, <span class="st">'Zero-Return'</span>, <span class="st">'Neg. Turnover'</span>, <span class="st">'Roll'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Corwin-Schultz'</span>, <span class="st">'Quoted Spread'</span>, <span class="st">'Kyle Œª'</span>]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>rank_corr <span class="op">=</span> panel_corr[corr_cols].corr(method<span class="op">=</span><span class="st">'spearman'</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>rank_corr.index <span class="op">=</span> corr_labels</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>rank_corr.columns <span class="op">=</span> corr_labels</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">8</span>))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(rank_corr, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    rank_corr, mask<span class="op">=</span>mask, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlOrRd'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>, square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, ax<span class="op">=</span>ax,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Spearman Rank Correlation'</span>}</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Cross-Sectional Rank Correlations Among Liquidity Measures'</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-liquidity-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.2
</figcaption>
</figure>
</div>
</section>
<section id="principal-component-analysis-of-liquidity" class="level3" data-number="14.5.3">
<h3 data-number="14.5.3" class="anchored" data-anchor-id="principal-component-analysis-of-liquidity"><span class="header-section-number">14.5.3</span> Principal Component Analysis of Liquidity</h3>
<p>Given the multidimensionality of liquidity, we extract a composite liquidity factor using PCA:</p>
<div id="pca-liquidity" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize each measure within each month (cross-sectional)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>liq_data <span class="op">=</span> panel[liquidity_cols].copy()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>liq_data[<span class="st">'neg_log_turnover'</span>] <span class="op">=</span> <span class="op">-</span>liq_data[<span class="st">'log_turnover'</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>pca_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'neg_log_turnover'</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any missing liquidity measure</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>liq_complete <span class="op">=</span> panel.dropna(subset<span class="op">=</span>pca_cols).copy()</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-sectional standardization by month</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize_within_month(df, cols):</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        df[col <span class="op">+</span> <span class="st">'_z'</span>] <span class="op">=</span> (</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>            df.groupby(<span class="st">'month_end'</span>)[col]</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>            .transform(<span class="kw">lambda</span> x: (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std())</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>liq_complete <span class="op">=</span> standardize_within_month(liq_complete, pca_cols)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>z_cols <span class="op">=</span> [c <span class="op">+</span> <span class="st">'_z'</span> <span class="cf">for</span> c <span class="kw">in</span> pca_cols]</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Pool all months for PCA</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>pca_input <span class="op">=</span> liq_complete[z_cols].dropna()</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>pca.fit(pca_input)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PCA Explained Variance Ratios:"</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (var, cumvar) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    pca.explained_variance_ratio_,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    np.cumsum(pca.explained_variance_ratio_)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>)):</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  PC</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>var<span class="sc">:.3f}</span><span class="ss"> (cumulative: </span><span class="sc">{</span>cumvar<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">PC1 Loadings:"</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, loading <span class="kw">in</span> <span class="bu">zip</span>(pca_cols, pca.components_[<span class="dv">0</span>]):</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>col<span class="sc">:&lt;20}</span><span class="ss">: </span><span class="sc">{</span>loading<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign PC1 as composite illiquidity</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>liq_complete[<span class="st">'illiq_pc1'</span>] <span class="op">=</span> pca.transform(</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    liq_complete[z_cols].values</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>)[:, <span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-aggregate" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="sec-liquidity-aggregate"><span class="header-section-number">14.6</span> Aggregate Liquidity and Market Conditions</h2>
<section id="time-series-of-market-liquidity" class="level3" data-number="14.6.1">
<h3 data-number="14.6.1" class="anchored" data-anchor-id="time-series-of-market-liquidity"><span class="header-section-number">14.6.1</span> Time Series of Market Liquidity</h3>
<p>Aggregate liquidity (i.e., the average illiquidity across all stocks) varies substantially over time. <span class="citation" data-cites="chordia2001market">Chordia, Roll, and Subrahmanyam (<a href="references.html#ref-chordia2001market" role="doc-biblioref">2001</a>)</span> document that market-wide liquidity declines during periods of high volatility and negative market returns.</p>
<div id="fig-aggregate-liquidity" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="17">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aggregate-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute monthly cross-sectional aggregates</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>agg_liquidity <span class="op">=</span> (</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        amihud_median<span class="op">=</span>(<span class="st">'amihud'</span>, <span class="st">'median'</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        zero_ret_median<span class="op">=</span>(<span class="st">'zero_return_pct'</span>, <span class="st">'median'</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        turnover_median<span class="op">=</span>(<span class="st">'log_turnover'</span>, <span class="st">'median'</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        roll_median<span class="op">=</span>(<span class="st">'roll_spread'</span>, <span class="st">'median'</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        cs_median<span class="op">=</span>(<span class="st">'cs_spread'</span>, <span class="st">'median'</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        n_stocks<span class="op">=</span>(<span class="st">'ticker'</span>, <span class="st">'nunique'</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize for plotting</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'amihud_median'</span>, <span class="st">'zero_ret_median'</span>, <span class="st">'roll_median'</span>]:</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[col <span class="op">+</span> <span class="st">'_z'</span>] <span class="op">=</span> (</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        (agg_liquidity[col] <span class="op">-</span> agg_liquidity[col].mean())</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">/</span> agg_liquidity[col].std()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">9</span>), height_ratios<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Aggregate illiquidity</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'amihud_median_z'</span>],</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#2C5F8A'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Amihud'</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'zero_ret_median_z'</span>],</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#C0392B'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Zero-Return'</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'roll_median_z'</span>],</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#27AE60'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Roll Spread'</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Illiquidity'</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Aggregate Illiquidity Over Time'</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Shade crisis periods</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>crisis_periods <span class="op">=</span> [</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2008-06-01'</span>, <span class="st">'2009-03-31'</span>, <span class="st">'GFC'</span>),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2011-01-01'</span>, <span class="st">'2011-12-31'</span>, <span class="st">'Tightening'</span>),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2020-02-01'</span>, <span class="st">'2020-05-31'</span>, <span class="st">'COVID'</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start, end, label <span class="kw">in</span> crisis_periods:</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].axvspan(pd.Timestamp(start), pd.Timestamp(end),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>                     alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> pd.Timestamp(start) <span class="op">+</span> (pd.Timestamp(end) <span class="op">-</span> pd.Timestamp(start)) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].text(mid, axes[<span class="dv">0</span>].get_ylim()[<span class="dv">1</span>] <span class="op">*</span> <span class="fl">0.9</span>, label,</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                 ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Market return</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>market_monthly <span class="op">=</span> factors[[<span class="st">'month_end'</span>, <span class="st">'mkt_excess'</span>]].copy()</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>market_monthly[<span class="st">'month_end'</span>] <span class="op">=</span> pd.to_datetime(market_monthly[<span class="st">'month_end'</span>])</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].bar(market_monthly[<span class="st">'month_end'</span>],</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>            market_monthly[<span class="st">'mkt_excess'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>[<span class="st">'#27AE60'</span> <span class="cf">if</span> r <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'#C0392B'</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> r <span class="kw">in</span> market_monthly[<span class="st">'mkt_excess'</span>]],</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Market Excess Return (%)'</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: VN-Index Monthly Excess Return'</span>)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-aggregate-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.3
</figcaption>
</figure>
</div>
</section>
<section id="commonality-in-liquidity" class="level3" data-number="14.6.2">
<h3 data-number="14.6.2" class="anchored" data-anchor-id="commonality-in-liquidity"><span class="header-section-number">14.6.2</span> Commonality in Liquidity</h3>
<p><span class="citation" data-cites="chordia2000commonality">Chordia, Roll, and Subrahmanyam (<a href="references.html#ref-chordia2000commonality" role="doc-biblioref">2000</a>)</span> find that individual stock liquidity co-moves with market liquidity, even after controlling for firm-specific factors. We test for commonality in Vietnam by regressing changes in firm-level liquidity on changes in market-level liquidity:</p>
<p><span id="eq-commonality"><span class="math display">\[
\Delta L_{i,m} = \alpha_i + \beta_i \Delta L_{M,m} + \gamma_i \Delta L_{M,m-1} + \delta_i \Delta L_{M,m+1} + \varepsilon_{i,m}
\tag{14.9}\]</span></span></p>
<p>where <span class="math inline">\(\Delta L_{i,m}\)</span> is the change in firm <span class="math inline">\(i\)</span>‚Äôs illiquidity, <span class="math inline">\(\Delta L_{M,m}\)</span> is the change in market-average illiquidity (excluding firm <span class="math inline">\(i\)</span>), and the lead/lag terms capture non-synchronous adjustment. The coefficient <span class="math inline">\(\beta_i\)</span> measures the sensitivity of firm <span class="math inline">\(i\)</span>‚Äôs liquidity to market-wide liquidity shocks.</p>
<div id="commonality" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute monthly changes in Amihud for each firm and the market</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'amihud'</span>]].dropna().copy()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel_common.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>panel_common[<span class="st">'d_amihud'</span>] <span class="op">=</span> (</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    panel_common.groupby(<span class="st">'ticker'</span>)[<span class="st">'amihud'</span>].diff()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Market-level illiquidity change (equal-weighted, excluding firm i)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>mkt_liq <span class="op">=</span> (</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    panel_common.groupby(<span class="st">'month_end'</span>)[<span class="st">'amihud'</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    .diff()</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'d_amihud_mkt'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>mkt_liq[<span class="st">'d_amihud_mkt_lag'</span>] <span class="op">=</span> mkt_liq[<span class="st">'d_amihud_mkt'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>mkt_liq[<span class="st">'d_amihud_mkt_lead'</span>] <span class="op">=</span> mkt_liq[<span class="st">'d_amihud_mkt'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel_common.merge(mkt_liq, on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate commonality for each firm</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_commonality(group, min_obs<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">'d_amihud'</span>, <span class="st">'d_amihud_mkt'</span>])</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> min_obs:</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> g[<span class="st">'d_amihud'</span>]</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(g[[<span class="st">'d_amihud_mkt'</span>, <span class="st">'d_amihud_mkt_lag'</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'d_amihud_mkt_lead'</span>]])</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series({</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'beta_mkt'</span>: model.params[<span class="st">'d_amihud_mkt'</span>],</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'beta_t'</span>: model.tvalues[<span class="st">'d_amihud_mkt'</span>],</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'r_squared'</span>: model.rsquared</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>commonality <span class="op">=</span> (</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    panel_common</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'ticker'</span>)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_commonality)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Commonality in Liquidity (Amihud):"</span>)</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean beta_mkt: </span><span class="sc">{</span>commonality[<span class="st">'beta_mkt'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Median beta_mkt: </span><span class="sc">{</span>commonality[<span class="st">'beta_mkt'</span>]<span class="sc">.</span>median()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  % significant at 5%: "</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>(commonality[<span class="st">'beta_t'</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="fl">1.96</span>)<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean R-squared: </span><span class="sc">{</span>commonality[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-pricing" class="level2" data-number="14.7">
<h2 data-number="14.7" class="anchored" data-anchor-id="sec-liquidity-pricing"><span class="header-section-number">14.7</span> Is Liquidity Priced?</h2>
<section id="portfolio-sorts" class="level3" data-number="14.7.1">
<h3 data-number="14.7.1" class="anchored" data-anchor-id="portfolio-sorts"><span class="header-section-number">14.7.1</span> Portfolio Sorts</h3>
<p>We test whether illiquidity predicts future returns by sorting stocks into quintile portfolios based on lagged liquidity measures and comparing average returns across quintiles.</p>
<div id="portfolio-sorts" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liquidity_portfolio_sort(panel_df, liq_col, n_groups<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute quintile portfolio returns sorted on lagged liquidity.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Lag the sorting variable by one month to avoid look-ahead bias.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> panel_df[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'market_cap'</span>, liq_col]].dropna().copy()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag the sorting variable</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'liq_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[liq_col].shift(<span class="dv">1</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'liq_lag'</span>, <span class="st">'monthly_return'</span>])</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign quintiles within each month</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'quintile'</span>] <span class="op">=</span> (</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        df.groupby(<span class="st">'month_end'</span>)[<span class="st">'liq_lag'</span>]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        .transform(<span class="kw">lambda</span> x: pd.qcut(x, n_groups, labels<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                                       duplicates<span class="op">=</span><span class="st">'drop'</span>))</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EW portfolio returns by quintile-month</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    port_returns <span class="op">=</span> (</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'month_end'</span>, <span class="st">'quintile'</span>])[<span class="st">'monthly_return'</span>]</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        .mean()</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        .unstack()</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Long-short (Q5 - Q1)</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_groups <span class="op">-</span> <span class="dv">1</span> <span class="kw">in</span> port_returns.columns <span class="kw">and</span> <span class="dv">0</span> <span class="kw">in</span> port_returns.columns:</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        port_returns[<span class="st">'long_short'</span>] <span class="op">=</span> (</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>            port_returns[n_groups <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> port_returns[<span class="dv">0</span>]</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> port_returns</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Run sorts for each illiquidity measure</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>sort_measures <span class="op">=</span> {</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Amihud'</span>: <span class="st">'amihud'</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-Return'</span>: <span class="st">'zero_return_pct'</span>,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neg. Turnover'</span>: <span class="st">'log_turnover'</span>,  <span class="co"># Will reverse below</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Roll Spread'</span>: <span class="st">'roll_spread'</span>,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Corwin-Schultz'</span>: <span class="st">'cs_spread'</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="co"># For turnover, negate so higher = less liquid</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>panel_sorts <span class="op">=</span> panel.copy()</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>panel_sorts[<span class="st">'neg_turnover'</span>] <span class="op">=</span> <span class="op">-</span>panel_sorts[<span class="st">'log_turnover'</span>]</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>sort_measures_actual <span class="op">=</span> {</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Amihud'</span>: <span class="st">'amihud'</span>,</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-Return'</span>: <span class="st">'zero_return_pct'</span>,</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neg. Turnover'</span>: <span class="st">'neg_turnover'</span>,</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Roll Spread'</span>: <span class="st">'roll_spread'</span>,</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Corwin-Schultz'</span>: <span class="st">'cs_spread'</span>,</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Liquidity Premium (EW, Quintile Sorts):"</span>)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Measure'</span><span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Q1 (Liquid)'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Q5 (Illiquid)'</span><span class="sc">:&gt;14}</span><span class="ss"> "</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span><span class="st">'Q5-Q1'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;8}</span><span class="ss">"</span>)</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">62</span>)</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>sort_results <span class="op">=</span> {}</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, col <span class="kw">in</span> sort_measures_actual.items():</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    ports <span class="op">=</span> liquidity_portfolio_sort(panel_sorts, col)</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    sort_results[name] <span class="op">=</span> ports</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>    q1 <span class="op">=</span> ports[<span class="dv">0</span>].mean() <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    q5 <span class="op">=</span> ports[<span class="dv">4</span>].mean() <span class="op">*</span> <span class="dv">12</span> <span class="cf">if</span> <span class="dv">4</span> <span class="kw">in</span> ports.columns <span class="cf">else</span> np.nan</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> ports[<span class="st">'long_short'</span>].mean() <span class="op">*</span> <span class="dv">12</span> <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">in</span> ports <span class="cf">else</span> np.nan</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    ls_se <span class="op">=</span> ports[<span class="st">'long_short'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(ports)) <span class="op">*</span> np.sqrt(<span class="dv">12</span>) <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">in</span> ports <span class="cf">else</span> np.nan</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ls <span class="op">/</span> ls_se <span class="cf">if</span> ls_se <span class="kw">and</span> ls_se <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span>q1<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>q5<span class="sc">:&gt;14.4f}</span><span class="ss"> </span><span class="sc">{</span>ls<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-liquidity-premium" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-premium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>colors_quintile <span class="op">=</span> [<span class="st">'#27AE60'</span>, <span class="st">'#2ECC71'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#E67E22'</span>, <span class="st">'#C0392B'</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (name, ports) <span class="kw">in</span> <span class="bu">enumerate</span>(sort_results.items()):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    quintile_means <span class="op">=</span> [ports[q].mean() <span class="op">*</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> q <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> q <span class="kw">in</span> ports.columns]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    axes[i].bar(<span class="bu">range</span>(<span class="bu">len</span>(quintile_means)), quintile_means,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>colors_quintile[:<span class="bu">len</span>(quintile_means)],</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(quintile_means)))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticklabels([<span class="ss">f'Q</span><span class="sc">{</span>q<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> q <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(quintile_means))])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">'Annualized Return (%)'</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(name)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    axes[i].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplot</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(sort_results) <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">5</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Average Returns by Illiquidity Quintile'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-liquidity-premium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.4
</figcaption>
</figure>
</div>
</section>
<section id="fama-macbeth-cross-sectional-regressions" class="level3" data-number="14.7.2">
<h3 data-number="14.7.2" class="anchored" data-anchor-id="fama-macbeth-cross-sectional-regressions"><span class="header-section-number">14.7.2</span> Fama-MacBeth Cross-Sectional Regressions</h3>
<p>Portfolio sorts are informative but cannot control for multiple characteristics simultaneously. We use <span class="citation" data-cites="fama1993common">Fama and French (<a href="references.html#ref-fama1993common" role="doc-biblioref">1993</a>)</span> -style cross-sectional regressions to test whether liquidity predicts returns after controlling for size, value, and momentum:</p>
<p><span id="eq-fama-macbeth"><span class="math display">\[
R_{i,m+1} = \gamma_{0,m} + \gamma_{1,m} \text{ILLIQ}_{i,m} + \gamma_{2,m} \ln(\text{MCap}_{i,m}) + \gamma_{3,m} \text{BM}_{i,m} + \gamma_{4,m} R_{i,m-12:m-1} + \varepsilon_{i,m+1}
\tag{14.10}\]</span></span></p>
<p>The time-series average of the monthly coefficient <span class="math inline">\(\bar{\gamma}_1\)</span> estimates the illiquidity premium, and its t-statistic uses the <span class="citation" data-cites="fama1993common">Fama and French (<a href="references.html#ref-fama1993common" role="doc-biblioref">1993</a>)</span> standard error.</p>
<div id="fama-macbeth" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fama_macbeth(panel_df, illiq_col, controls<span class="op">=</span>[<span class="st">'log_mcap'</span>, <span class="st">'bm'</span>],</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                  min_stocks<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Run Fama-MacBeth cross-sectional regressions of</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">    next-month returns on lagged illiquidity and controls.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> panel_df.copy()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag the illiquidity measure</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[illiq_col].shift(<span class="dv">1</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag controls</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> controls:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        df[c <span class="op">+</span> <span class="st">'_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[c].shift(<span class="dv">1</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    regressors <span class="op">=</span> [<span class="st">'illiq_lag'</span>] <span class="op">+</span> [c <span class="op">+</span> <span class="st">'_lag'</span> <span class="cf">for</span> c <span class="kw">in</span> controls]</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'monthly_return'</span>] <span class="op">+</span> regressors)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Month-by-month cross-sectional regressions</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    months <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'month_end'</span>].unique())</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    gamma_list <span class="op">=</span> []</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> months:</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        cross <span class="op">=</span> df[df[<span class="st">'month_end'</span>] <span class="op">==</span> month]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(cross) <span class="op">&lt;</span> min_stocks:</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> cross[<span class="st">'monthly_return'</span>].values</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> sm.add_constant(cross[regressors].values)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>            gammas <span class="op">=</span> {<span class="st">'month_end'</span>: month, <span class="st">'intercept'</span>: model.params[<span class="dv">0</span>]}</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, reg <span class="kw">in</span> <span class="bu">enumerate</span>(regressors):</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                gammas[reg] <span class="op">=</span> model.params[j <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>            gamma_list.append(gammas)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    gamma_df <span class="op">=</span> pd.DataFrame(gamma_list)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-series averages and t-statistics</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'intercept'</span>] <span class="op">+</span> regressors:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>        mean <span class="op">=</span> gamma_df[col].mean()</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>        se <span class="op">=</span> gamma_df[col].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(gamma_df))</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> mean <span class="op">/</span> se <span class="cf">if</span> se <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>        results[col] <span class="op">=</span> {<span class="st">'Coefficient'</span>: mean, <span class="st">'SE'</span>: se, <span class="st">'t-stat'</span>: t}</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results).T, gamma_df</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Run for each illiquidity measure</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Fama-MacBeth Regressions: R_{i,m+1} on ILLIQ_{i,m} + controls"</span>)</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, col <span class="kw">in</span> [(<span class="st">'Amihud'</span>, <span class="st">'amihud'</span>),</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Zero-Return'</span>, <span class="st">'zero_return_pct'</span>),</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Roll Spread'</span>, <span class="st">'roll_spread'</span>),</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Corwin-Schultz'</span>, <span class="st">'cs_spread'</span>)]:</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    results, gammas <span class="op">=</span> fama_macbeth(panel, col)</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(results[[<span class="st">'Coefficient'</span>, <span class="st">'t-stat'</span>]].<span class="bu">round</span>(<span class="dv">4</span>).to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="factor-adjusted-liquidity-premium" class="level3" data-number="14.7.3">
<h3 data-number="14.7.3" class="anchored" data-anchor-id="factor-adjusted-liquidity-premium"><span class="header-section-number">14.7.3</span> Factor-Adjusted Liquidity Premium</h3>
<p>The liquidity premium may be partially or fully explained by existing risk factors (size, value, momentum). We test this by regressing the long-short liquidity portfolio returns on the Fama-French-Carhart factors:</p>
<div id="factor-adjusted" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Factor-Adjusted Liquidity Premium:"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Measure'</span><span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Alpha (ann.)'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Alpha t'</span><span class="sc">:&gt;10}</span><span class="ss"> "</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span><span class="st">'MKT'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'SMB'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'HML'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'R2'</span><span class="sc">:&gt;6}</span><span class="ss">"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">72</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, ports <span class="kw">in</span> sort_results.items():</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">not</span> <span class="kw">in</span> ports.columns:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    ls_series <span class="op">=</span> ports[<span class="st">'long_short'</span>].to_frame(<span class="st">'ls'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    ls_series.index <span class="op">=</span> pd.to_datetime(ls_series.index)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> ls_series.merge(factors, left_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                              right_on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(merged) <span class="op">&lt;</span> <span class="dv">24</span>:</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> merged[<span class="st">'ls'</span>]</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(merged[[<span class="st">'mkt_excess'</span>, <span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'wml'</span>]])</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">'HAC'</span>, cov_kwds<span class="op">=</span>{<span class="st">'maxlags'</span>: <span class="dv">6</span>})</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    alpha_ann <span class="op">=</span> model.params[<span class="st">'const'</span>] <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    alpha_t <span class="op">=</span> model.tvalues[<span class="st">'const'</span>]</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    mkt_b <span class="op">=</span> model.params[<span class="st">'mkt_excess'</span>]</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    smb_b <span class="op">=</span> model.params[<span class="st">'smb'</span>]</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    hml_b <span class="op">=</span> model.params[<span class="st">'hml'</span>]</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> model.rsquared</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span>alpha_ann<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>alpha_t<span class="sc">:&gt;10.2f}</span><span class="ss"> "</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>mkt_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>smb_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>hml_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>r2<span class="sc">:&gt;6.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-implementation" class="level2" data-number="14.8">
<h2 data-number="14.8" class="anchored" data-anchor-id="sec-liquidity-implementation"><span class="header-section-number">14.8</span> Liquidity and Transaction Cost Estimation</h2>
<section id="translating-measures-to-trading-costs" class="level3" data-number="14.8.1">
<h3 data-number="14.8.1" class="anchored" data-anchor-id="translating-measures-to-trading-costs"><span class="header-section-number">14.8.1</span> Translating Measures to Trading Costs</h3>
<p>For practitioners, the key question is: what does a given Amihud or spread value <em>mean</em> in terms of actual VND cost per trade? We calibrate the relationship between our low-frequency proxies and explicit trading costs.</p>
<div id="cost-calibration" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_round_trip_cost(row):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate total round-trip trading cost (in %) from</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">    multiple liquidity proxies.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Components:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Explicit: commission + tax (~0.35% round-trip)</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Spread cost: half-spread each way</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Price impact: function of trade size</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    explicit <span class="op">=</span> <span class="fl">0.0035</span>  <span class="co"># 35 bps round-trip</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use Corwin-Schultz or quoted spread as spread estimate</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    spread <span class="op">=</span> row.get(<span class="st">'cs_spread'</span>, row.get(<span class="st">'quoted_spread'</span>, <span class="fl">0.005</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    spread_cost <span class="op">=</span> spread  <span class="co"># Full spread = round-trip cost</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price impact (approximate from Amihud)</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For a trade of 1% of daily volume</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    amihud_raw <span class="op">=</span> row.get(<span class="st">'amihud_raw'</span>, <span class="dv">0</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    impact <span class="op">=</span> amihud_raw <span class="op">*</span> <span class="fl">0.01</span>  <span class="co"># Rough approximation</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> explicit <span class="op">+</span> spread_cost <span class="op">+</span> impact</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'estimated_rtc'</span>] <span class="op">=</span> panel.<span class="bu">apply</span>(estimate_round_trip_cost, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution by size quintile</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>rtc_by_size <span class="op">=</span> (</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'size_quintile'</span>)[<span class="st">'estimated_rtc'</span>]</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">'mean'</span>, <span class="st">'median'</span>, <span class="st">'std'</span>])</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Estimated Round-Trip Cost by Size Quintile (%):"</span>)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((rtc_by_size <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>).to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-cost-distribution" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="24">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cost-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Distribution</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, color <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">'Q1 (Small)'</span>, <span class="st">'Q3'</span>, <span class="st">'Q5 (Large)'</span>],</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'#C0392B'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#27AE60'</span>]):</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> panel[panel[<span class="st">'size_quintile'</span>] <span class="op">==</span> q][<span class="st">'estimated_rtc'</span>].dropna()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset <span class="op">&lt;</span> <span class="fl">0.15</span>]  <span class="co"># Trim extreme</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].hist(subset <span class="op">*</span> <span class="dv">100</span>, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span>color, label<span class="op">=</span>q, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Estimated Round-Trip Cost (%)'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Cost Distribution by Size'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Time series of median cost</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>cost_ts <span class="op">=</span> (</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'estimated_rtc'</span>]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(pd.to_datetime(cost_ts[<span class="st">'month_end'</span>]),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>             cost_ts[<span class="st">'estimated_rtc'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#2C5F8A'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Median Round-Trip Cost (%)'</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: Aggregate Trading Costs Over Time'</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-cost-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.5
</figcaption>
</figure>
</div>
</section>
<section id="strategy-implementability" class="level3" data-number="14.8.2">
<h3 data-number="14.8.2" class="anchored" data-anchor-id="strategy-implementability"><span class="header-section-number">14.8.2</span> Strategy Implementability</h3>
<p>A critical application of liquidity measurement is testing whether a given anomaly strategy remains profitable after accounting for realistic trading costs. We compute net-of-cost returns for the liquidity-sorted portfolios themselves. This is an inherently conservative test because the illiquid long leg carries the highest costs.</p>
<div id="net-of-cost" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For each quintile, estimate average monthly turnover and cost</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and subtract from gross returns</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, ports <span class="kw">in</span> sort_results.items():</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">not</span> <span class="kw">in</span> ports.columns:</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    gross_ann <span class="op">=</span> ports[<span class="st">'long_short'</span>].mean() <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate costs: illiquid quintile has higher costs</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assume monthly turnover of ~15% for long-short with monthly rebalancing</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    turnover <span class="op">=</span> <span class="fl">0.15</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    cost_q1 <span class="op">=</span> <span class="fl">0.003</span>  <span class="co"># 30 bps per trade for liquid stocks</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    cost_q5 <span class="op">=</span> <span class="fl">0.015</span>  <span class="co"># 150 bps for illiquid stocks</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    avg_cost <span class="op">=</span> (cost_q1 <span class="op">+</span> cost_q5) <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Average across long and short</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    monthly_tc <span class="op">=</span> turnover <span class="op">*</span> avg_cost</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    net_ann <span class="op">=</span> gross_ann <span class="op">-</span> monthly_tc <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss">: Gross = </span><span class="sc">{</span>gross_ann<span class="op">*</span><span class="dv">100</span><span class="sc">:&gt;6.2f}</span><span class="ss">%, "</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"TC = </span><span class="sc">{</span>monthly_tc<span class="op">*</span><span class="dv">1200</span><span class="sc">:&gt;6.1f}</span><span class="ss"> bps/mo, "</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Net = </span><span class="sc">{</span>net_ann<span class="op">*</span><span class="dv">100</span><span class="sc">:&gt;6.2f}</span><span class="ss">%"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-stress" class="level2" data-number="14.9">
<h2 data-number="14.9" class="anchored" data-anchor-id="sec-liquidity-stress"><span class="header-section-number">14.9</span> Liquidity During Market Stress</h2>
<section id="flight-to-liquidity" class="level3" data-number="14.9.1">
<h3 data-number="14.9.1" class="anchored" data-anchor-id="flight-to-liquidity"><span class="header-section-number">14.9.1</span> Flight to Liquidity</h3>
<p>During market stress, investors sell illiquid assets and buy liquid ones, which is a ‚Äúflight to liquidity‚Äù that widens the return differential between liquid and illiquid stocks. <span class="citation" data-cites="hameed2010stock">Hameed, Kang, and Viswanathan (<a href="references.html#ref-hameed2010stock" role="doc-biblioref">2010</a>)</span> show that this pattern is strongest when market returns are most negative.</p>
<div id="flight-to-liquidity" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Amihud-sorted portfolio returns with market returns</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>amihud_ports <span class="op">=</span> sort_results.get(<span class="st">'Amihud'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> amihud_ports <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="st">'long_short'</span> <span class="kw">in</span> amihud_ports.columns:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    ftl_data <span class="op">=</span> pd.merge(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        amihud_ports[<span class="st">'long_short'</span>].to_frame(<span class="st">'illiq_premium'</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        factors[[<span class="st">'month_end'</span>, <span class="st">'mkt_excess'</span>]].set_index(<span class="st">'month_end'</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Classify market states</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    ftl_data[<span class="st">'mkt_state'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        ftl_data[<span class="st">'mkt_excess'</span>],</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>              ftl_data[<span class="st">'mkt_excess'</span>].quantile(<span class="fl">0.20</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>              ftl_data[<span class="st">'mkt_excess'</span>].quantile(<span class="fl">0.80</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>              np.inf],</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">'Bear (bottom 20%)'</span>, <span class="st">'Normal'</span>, <span class="st">'Bull (top 20%)'</span>]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Illiquidity premium by market state</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    state_premium <span class="op">=</span> (</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        ftl_data.groupby(<span class="st">'mkt_state'</span>)[<span class="st">'illiq_premium'</span>]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        .agg([<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>])</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    state_premium[<span class="st">'ann_premium'</span>] <span class="op">=</span> state_premium[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    state_premium[<span class="st">'t_stat'</span>] <span class="op">=</span> (</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        state_premium[<span class="st">'mean'</span>]</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">/</span> (state_premium[<span class="st">'std'</span>] <span class="op">/</span> np.sqrt(state_premium[<span class="st">'count'</span>]))</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Illiquidity Premium by Market State:"</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(state_premium[[<span class="st">'ann_premium'</span>, <span class="st">'t_stat'</span>, <span class="st">'count'</span>]].<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-flight-to-liquidity" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="27">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-flight-to-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'state_premium'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    colors_state <span class="op">=</span> [<span class="st">'#C0392B'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#27AE60'</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(<span class="bu">range</span>(<span class="bu">len</span>(state_premium)),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                   state_premium[<span class="st">'ann_premium'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>colors_state, alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(state_premium)))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(state_premium.index)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Annualized Q5-Q1 Return (%)'</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Illiquidity Premium by Market State'</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(state_premium.iterrows()):</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'ann_premium'</span>] <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="fl">0.3</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"t=</span><span class="sc">{</span>row[<span class="st">'t_stat'</span>]<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-flight-to-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.6
</figcaption>
</figure>
</div>
</section>
<section id="liquidity-co-movement-with-global-risk" class="level3" data-number="14.9.2">
<h3 data-number="14.9.2" class="anchored" data-anchor-id="liquidity-co-movement-with-global-risk"><span class="header-section-number">14.9.2</span> Liquidity Co-Movement with Global Risk</h3>
<p>Vietnamese market liquidity may be driven by global risk factors, particularly for stocks held by foreign investors. We test whether global risk measures (VIX, USD strength) predict Vietnamese aggregate liquidity:</p>
<div id="global-risk" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge aggregate liquidity with global variables</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>global_vars <span class="op">=</span> client.get_macro_data(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'vix_close'</span>, <span class="st">'dxy_index'</span>],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    frequency<span class="op">=</span><span class="st">'monthly'</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>agg_liq_global <span class="op">=</span> agg_liquidity.merge(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    global_vars, on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Changes in all variables</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'amihud_median'</span>, <span class="st">'vix_close'</span>, <span class="st">'dxy_index'</span>]:</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    agg_liq_global[<span class="ss">f'd_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> agg_liq_global[col].diff()</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> agg_liq_global[<span class="st">'d_amihud_median'</span>].dropna()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    agg_liq_global.loc[y.index, [<span class="st">'d_vix_close'</span>, <span class="st">'d_dxy_index'</span>]]</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">'HAC'</span>, cov_kwds<span class="op">=</span>{<span class="st">'maxlags'</span>: <span class="dv">3</span>})</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Aggregate Illiquidity ~ Global Risk:"</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary().tables[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-liquidity-factor" class="level2" data-number="14.10">
<h2 data-number="14.10" class="anchored" data-anchor-id="sec-liquidity-factor"><span class="header-section-number">14.10</span> Constructing a Tradeable Liquidity Factor</h2>
<p>Following <span class="citation" data-cites="pastor2003liquidity">P√°stor and Stambaugh (<a href="references.html#ref-pastor2003liquidity" role="doc-biblioref">2003</a>)</span>, we construct an aggregate liquidity factor that can be used in asset pricing tests. The factor captures innovations in aggregate liquidity (unexpected changes in market-wide trading conditions).</p>
<div id="liquidity-factor" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Compute market-level Amihud as EW average</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mkt_amihud <span class="op">=</span> (</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'amihud'</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'mkt_amihud'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Estimate AR(2) model for aggregate illiquidity</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'mkt_amihud_lag1'</span>] <span class="op">=</span> mkt_amihud[<span class="st">'mkt_amihud'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'mkt_amihud_lag2'</span>] <span class="op">=</span> mkt_amihud[<span class="st">'mkt_amihud'</span>].shift(<span class="dv">2</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>mkt_amihud <span class="op">=</span> mkt_amihud.dropna()</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>ar_model <span class="op">=</span> sm.OLS(</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    mkt_amihud[<span class="st">'mkt_amihud'</span>],</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    sm.add_constant(mkt_amihud[[<span class="st">'mkt_amihud_lag1'</span>, <span class="st">'mkt_amihud_lag2'</span>]])</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Residuals = liquidity innovations</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative innovation = liquidity improved (good)</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Positive innovation = liquidity deteriorated (bad)</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'liq_innovation'</span>] <span class="op">=</span> ar_model.resid</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Test whether liquidity innovations predict returns</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher sensitivity to negative innovations = higher expected return</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AR(2) Model for Aggregate Amihud:"</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared: </span><span class="sc">{</span>ar_model<span class="sc">.</span>rsquared<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  AR(1) coef: </span><span class="sc">{</span>ar_model<span class="sc">.</span>params[<span class="st">'mkt_amihud_lag1'</span>]<span class="sc">:.3f}</span><span class="ss"> "</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(t=</span><span class="sc">{</span>ar_model<span class="sc">.</span>tvalues[<span class="st">'mkt_amihud_lag1'</span>]<span class="sc">:.2f}</span><span class="ss">)"</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Estimate liquidity betas for each firm</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>panel_liq_beta <span class="op">=</span> panel.merge(</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    mkt_amihud[[<span class="st">'liq_innovation'</span>]],</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'month_end'</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_liq_beta(group, min_obs<span class="op">=</span><span class="dv">36</span>):</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">'monthly_return'</span>, <span class="st">'liq_innovation'</span>])</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> min_obs:</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> g[<span class="st">'monthly_return'</span>]</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(g[<span class="st">'liq_innovation'</span>])</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> model.params[<span class="st">'liq_innovation'</span>]</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>liq_betas <span class="op">=</span> (</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>    panel_liq_beta</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'ticker'</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_liq_beta)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'liq_beta'</span>)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Liquidity Beta Distribution:"</span>)</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(liq_betas[<span class="st">'liq_beta'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-liquidity-practical" class="level2" data-number="14.11">
<h2 data-number="14.11" class="anchored" data-anchor-id="sec-liquidity-practical"><span class="header-section-number">14.11</span> Practical Guidance for Vietnam</h2>
<p>The analysis in this chapter yields the following recommendations:</p>
<p><strong>For researchers:</strong> The Amihud illiquidity ratio is the single best all-purpose liquidity proxy for Vietnamese equities. It has the highest coverage, the strongest cross-sectional return predictability, and the most robust relationship with firm size. When a second measure is needed for robustness, the zero-return proportion is the natural complement‚Äîit captures a different dimension (transaction cost threshold) and has near-complete coverage.</p>
<p><strong>For portfolio construction:</strong> Any backtest of a Vietnamese equity strategy should compute and report estimated round-trip costs by quintile. Strategies that load on the bottom two size quintiles face costs of 2‚Äì5% per round trip, making monthly rebalancing uneconomical. Quarterly or annual rebalancing with a turnover constraint is more realistic.</p>
<p><strong>For risk management:</strong> Monitor aggregate liquidity conditions using the cross-sectional median Amihud or the market-wide zero-return fraction. Liquidity deterioration predicts negative market returns and wider spreads in subsequent months. Tighten risk limits when aggregate illiquidity exceeds its 90th historical percentile.</p>
<p><strong>For international comparisons:</strong> When comparing Vietnamese factor premia to U.S. or other developed market evidence, always report results on a ‚Äúliquid universe‚Äù subset (top 60% by market cap) alongside the full sample. Many anomalies that appear large in the full sample shrink substantially when restricted to stocks that can actually be traded at scale.</p>
</section>
<section id="sec-liquidity-summary" class="level2" data-number="14.12">
<h2 data-number="14.12" class="anchored" data-anchor-id="sec-liquidity-summary"><span class="header-section-number">14.12</span> Summary</h2>
<p>Table <a href="#tbl-liquidity-summary" class="quarto-xref">Table&nbsp;<span>14.1</span></a> shows different measures of liquidity.</p>
<div id="tbl-liquidity-summary" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-liquidity-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14.1: Summary of liquidity measure properties in the Vietnamese market.
</figcaption>
<div aria-describedby="tbl-liquidity-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Measure</th>
<th>Dimension</th>
<th>Coverage</th>
<th>Size Gradient</th>
<th>Return Predictive</th>
<th>Recommended Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Amihud</td>
<td>Price impact</td>
<td>High</td>
<td>Very steep</td>
<td>Strong</td>
<td>Primary proxy; portfolio sorts; Fama-MacBeth</td>
</tr>
<tr class="even">
<td>Zero-Return</td>
<td>Transaction cost</td>
<td>Complete</td>
<td>Steep</td>
<td>Strong</td>
<td>Robustness check; emerging market studies</td>
</tr>
<tr class="odd">
<td>Turnover</td>
<td>Trading activity</td>
<td>High</td>
<td>Moderate</td>
<td>Moderate</td>
<td>Volume-based filters; flow analysis</td>
</tr>
<tr class="even">
<td>Roll Spread</td>
<td>Tightness</td>
<td>Moderate</td>
<td>Moderate</td>
<td>Moderate</td>
<td>Spread estimation without bid-ask data</td>
</tr>
<tr class="odd">
<td>Corwin-Schultz</td>
<td>Tightness</td>
<td>Moderate</td>
<td>Moderate</td>
<td>Moderate</td>
<td>High-low based spread; calibration</td>
</tr>
<tr class="even">
<td>Quoted Spread</td>
<td>Tightness</td>
<td>Variable</td>
<td>Steep</td>
<td>Strong</td>
<td>Direct measure when available</td>
</tr>
<tr class="odd">
<td>Kyle Lambda</td>
<td>Price impact</td>
<td>Moderate</td>
<td>Steep</td>
<td>Strong</td>
<td>Market microstructure research</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Liquidity is not a secondary consideration for Vietnamese equity research; it is a first-order determinant of which strategies are implementable, which anomalies are real, and which results are artifacts of trading in stocks that cannot actually be traded. Every empirical finding in this book should be evaluated through the lens of the liquidity analysis developed in this chapter.</p>
<!-- ## Exercises {#sec-liquidity-exercises}

1. **Closing percent quoted spread.** @fong2017best recommend the closing percent quoted spread as the best global liquidity proxy. Compute this as the closing bid-ask spread divided by the midpoint, averaged over the month. Compare its correlation with the Amihud measure and the Corwin-Schultz spread. Does the recommendation hold for Vietnam?

2. **Liquidity-adjusted momentum.** Compute momentum portfolio returns (12-1 month) separately within each Amihud illiquidity tercile. Is the momentum premium concentrated in illiquid stocks? What does this imply about the implementability of momentum strategies in Vietnam? Connect your findings to @novy2016taxonomy.

3. **Foreign investor liquidity demand.** Using foreign buy and sell volume data, compute a net foreign flow measure for each stock. Test whether foreign net buying predicts next-month liquidity improvements (lower Amihud, lower spreads). Does foreign ownership create a liquidity externality?

4. **Intraday liquidity patterns.** If intraday data are available, compute the Amihud ratio separately for the opening call auction, the morning continuous session, and the afternoon continuous session. How does intraday liquidity variation compare to cross-sectional variation?

5. **Liquidity and earnings announcements.** Test whether liquidity deteriorates before and improves after quarterly earnings announcements. Use an event study framework with the Amihud ratio as the dependent variable. Is the pre-announcement illiquidity increase consistent with the @glosten1985bid adverse selection model?

6. **Market-making profitability.** Using the Roll spread as a proxy for the bid-ask bounce, estimate the gross profit a hypothetical market maker would earn from providing liquidity in Vietnamese stocks. How does this compare to the explicit cost of capital for market making?

7. **Liquidity factor mimicking portfolio.** Construct a tradeable liquidity factor by sorting stocks into deciles based on their liquidity beta (sensitivity to aggregate liquidity innovations). The long-short return of this factor should be correlated with aggregate liquidity changes. Test whether this factor earns a significant premium and whether it explains returns beyond the Fama-French factors.

8. **COVID-19 liquidity shock.** Analyze the liquidity dynamics around the March 2020 COVID-19 market crash. How quickly did aggregate liquidity deteriorate? Which firms experienced the largest liquidity drops? Did the SBV's policy responses (rate cuts, reserve requirement reductions) improve liquidity, and with what lag? -->


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-acharya2005asset" class="csl-entry" role="listitem">
Acharya, Viral V, and Lasse Heje Pedersen. 2005. <span>‚ÄúAsset Pricing with Liquidity Risk.‚Äù</span> <em>Journal of Financial Economics</em> 77 (2): 375‚Äì410.
</div>
<div id="ref-amihud2002illiquidity" class="csl-entry" role="listitem">
Amihud, Yakov. 2002. <span>‚ÄúIlliquidity and Stock Returns: Cross-Section and Time-Series Effects.‚Äù</span> <em>Journal of Financial Markets</em> 5 (1): 31‚Äì56.
</div>
<div id="ref-amihud1986asset" class="csl-entry" role="listitem">
Amihud, Yakov, and Haim Mendelson. 1986. <span>‚ÄúAsset Pricing and the Bid-Ask Spread.‚Äù</span> <em>Journal of Financial Economics</em> 17 (2): 223‚Äì49.
</div>
<div id="ref-brunnermeier2009market" class="csl-entry" role="listitem">
Brunnermeier, Markus K, and Lasse Heje Pedersen. 2009. <span>‚ÄúMarket Liquidity and Funding Liquidity.‚Äù</span> <em>The Review of Financial Studies</em> 22 (6): 2201‚Äì38.
</div>
<div id="ref-chordia2000commonality" class="csl-entry" role="listitem">
Chordia, Tarun, Richard Roll, and Avanidhar Subrahmanyam. 2000. <span>‚ÄúCommonality in Liquidity.‚Äù</span> <em>Journal of Financial Economics</em> 56 (1): 3‚Äì28.
</div>
<div id="ref-chordia2001market" class="csl-entry" role="listitem">
‚Äî‚Äî‚Äî. 2001. <span>‚ÄúMarket Liquidity and Trading Activity.‚Äù</span> <em>The Journal of Finance</em> 56 (2): 501‚Äì30.
</div>
<div id="ref-corwin2012simple" class="csl-entry" role="listitem">
Corwin, Shane A, and Paul Schultz. 2012. <span>‚ÄúA Simple Way to Estimate Bid-Ask Spreads from Daily High and Low Prices.‚Äù</span> <em>The Journal of Finance</em> 67 (2): 719‚Äì60.
</div>
<div id="ref-datar1998liquidity" class="csl-entry" role="listitem">
Datar, Vinay T, Narayan Y Naik, and Robert Radcliffe. 1998. <span>‚ÄúLiquidity and Stock Returns: An Alternative Test.‚Äù</span> <em>Journal of Financial Markets</em> 1 (2): 203‚Äì19.
</div>
<div id="ref-fama1993common" class="csl-entry" role="listitem">
Fama, Eugene F., and Kenneth R. French. 1993. <span>‚Äú<span class="nocase">Common risk factors in the returns on stocks and bonds</span>.‚Äù</span> <em><span>Journal of Financial Economics</span></em> 33 (1): 3‚Äì56. <a href="https://doi.org/10.1016/0304-405X(93)90023-5">https://doi.org/10.1016/0304-405X(93)90023-5</a>.
</div>
<div id="ref-fong2017best" class="csl-entry" role="listitem">
Fong, Kingsley YL, Craig W Holden, and Charles A Trzcinka. 2017. <span>‚ÄúWhat Are the Best Liquidity Proxies for Global Research?‚Äù</span> <em>Review of Finance</em> 21 (4): 1355‚Äì1401.
</div>
<div id="ref-goyenko2009liquidity" class="csl-entry" role="listitem">
Goyenko, Ruslan Y, Craig W Holden, and Charles A Trzcinka. 2009. <span>‚ÄúDo Liquidity Measures Measure Liquidity?‚Äù</span> <em>Journal of Financial Economics</em> 92 (2): 153‚Äì81.
</div>
<div id="ref-hameed2010stock" class="csl-entry" role="listitem">
Hameed, Allaudeen, Wenjin Kang, and Shivesh Viswanathan. 2010. <span>‚ÄúStock Market Declines and Liquidity.‚Äù</span> <em>The Journal of Finance</em> 65 (1): 257‚Äì93.
</div>
<div id="ref-hasbrouck2009trading" class="csl-entry" role="listitem">
Hasbrouck, Joel. 2009. <span>‚ÄúTrading Costs and Returns for US Equities: Estimating Effective Costs from Daily Data.‚Äù</span> <em>The Journal of Finance</em> 64 (3): 1445‚Äì77.
</div>
<div id="ref-kyle1985continuous" class="csl-entry" role="listitem">
Kyle, Albert S. 1985. <span>‚ÄúContinuous Auctions and Insider Trading.‚Äù</span> <em>Econometrica: Journal of the Econometric Society</em>, 1315‚Äì35.
</div>
<div id="ref-lesmond2005liquidity" class="csl-entry" role="listitem">
Lesmond, David A. 2005. <span>‚ÄúLiquidity of Emerging Markets.‚Äù</span> <em>Journal of Financial Economics</em> 77 (2): 411‚Äì52.
</div>
<div id="ref-lesmond1999new" class="csl-entry" role="listitem">
Lesmond, David A, Joseph P Ogden, and Charles A Trzcinka. 1999. <span>‚ÄúA New Estimate of Transaction Costs.‚Äù</span> <em>The Review of Financial Studies</em> 12 (5): 1113‚Äì41.
</div>
<div id="ref-pastor2003liquidity" class="csl-entry" role="listitem">
P√°stor, L‚Äôubo≈°, and Robert F Stambaugh. 2003. <span>‚ÄúLiquidity Risk and Expected Stock Returns.‚Äù</span> <em>Journal of Political Economy</em> 111 (3): 642‚Äì85.
</div>
<div id="ref-roll1984simple" class="csl-entry" role="listitem">
Roll, Richard. 1984. <span>‚ÄúA Simple Implicit Measure of the Effective Bid-Ask Spread in an Efficient Market.‚Äù</span> <em>The Journal of Finance</em> 39 (4): 1127‚Äì39.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "¬© " + year;
});
</script>
<script>
(function () {
  const GA_ID = "G-LG91D0C6RB";   // your real GA4 ID
  const CONSENT_KEY = "cookie_consent_v1";

  function log(msg) {
    console.log("[GA Loader]", msg);
  }

  function loadGtag() {
    if (window.__gtag_loaded__) {
      log("GA already loaded, skipping");
      return;
    }

    log("Loading Google Analytics...");

    window.__gtag_loaded__ = true;

    const script = document.createElement("script");
    script.async = true;
    script.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(GA_ID);

    script.onload = function () {
      log("gtag.js loaded");

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;

      gtag("js", new Date());
      gtag("config", GA_ID, {
        anonymize_ip: true,
        transport_type: "beacon"
      });

      log("GA initialized successfully");
    };

    script.onerror = function () {
      log("FAILED to load gtag.js. Likely blocked by ad blocker or network.");
    };

    document.head.appendChild(script);
  }

  function checkConsentAndLoad() {
    const consent = localStorage.getItem(CONSENT_KEY);
    log("Stored consent value = " + consent);

    if (consent === "accepted") {
      loadGtag();
    } else {
      log("Analytics blocked due to missing or declined consent");
    }
  }

  // Run on page load
  checkConsentAndLoad();

  // Listen for cookie banner decisions
  window.addEventListener("cookie-consent-changed", function (e) {
    log("Consent event received: " + e.detail);
    if (e.detail === "accepted") {
      loadGtag();
    }
  });

})();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mikenguyen13\.github\.io\/tidy_finance_vn_vi\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./15_missing_data_and_survivorship.html" class="pagination-link" aria-label="Missing Data and Survivorship Bias">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Missing Data and Survivorship Bias</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./17_beta_estimation.html" class="pagination-link" aria-label="Beta Estimation">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Liquidity and Turnover Measures</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>In this chapter, we construct a comprehensive suite of liquidity measures for the Vietnamese equity market, validate them against each other and against known benchmarks, test whether liquidity is priced in the cross-section of stock returns, examine commonality in liquidity, and analyze how liquidity conditions vary over time and across market regimes.</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>Liquidity (i.e., the ability to trade quickly at low cost without moving the price) is arguably the single most important practical consideration for anyone working with Vietnamese equity data. A factor premium that looks attractive in a frictionless backtest may be completely unimplementable if the long and short legs load on illiquid stocks whose prices move against you when you trade. Conversely, a genuine liquidity premium (i.e., compensation for bearing the risk that a stock will be hard to sell when you need to) is one of the most robust and theoretically grounded anomalies in asset pricing.</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>The challenge is that liquidity is inherently multidimensional and difficult to measure. In developed markets with continuous limit order books and sub-second trade reporting, researchers can observe bid-ask spreads, market depth, and price impact directly. In Vietnam, microstructure data at this granularity are limited: HOSE operates a periodic call auction at open and close with continuous matching in between, the tick size is coarse relative to price levels, and many stocks trade so infrequently that the concept of a "quoted spread" is meaningful only on days when the stock actually trades. This forces researchers to rely on low-frequency proxies computed from daily price and volume data.</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>This chapter constructs the major liquidity proxies used in the academic literature, validates them in the Vietnamese context, and demonstrates their use in asset pricing and portfolio construction.</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Theoretical Foundations {#sec-liquidity-theory}</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Liquidity Matters</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>Liquidity affects asset prices through at least three channels:</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Level effect.** Investors demand compensation for the expected cost of trading. @amihud1986asset show that stocks with higher bid-ask spreads earn higher expected returns, with the premium being an increasing function of the investor's holding period. In equilibrium, illiquid stocks must offer higher expected returns to compensate for higher round-trip trading costs.</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Risk effect.** Liquidity is time-varying and co-moves across stocks. @pastor2003liquidity show that stocks whose returns are more sensitive to aggregate liquidity shocks earn higher expected returns. @acharya2005asset formalize this in a liquidity-adjusted CAPM where the required return includes a premium for bearing liquidity risk (i.e., the risk that the stock becomes illiquid precisely when the investor needs to sell).</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Commonality effect.** @chordia2000commonality document that individual stock liquidity co-moves strongly with market-wide liquidity. @brunnermeier2009market explain this through a "liquidity spiral": when asset values fall, margin constraints tighten, forcing leveraged investors to sell, which reduces market liquidity, which depresses prices further. This mechanism is particularly relevant in Vietnam, where retail investors with margin accounts are the dominant trading population.</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Liquidity Dimensions</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>@kyle1985continuous identifies three dimensions of liquidity:</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Tightness.** The cost of turning around a position quickly, which is measured by the bid-ask spread.</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Depth.** The volume that can be traded without moving the price, which is related to price impact.</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Resiliency.** The speed at which prices recover from uninformative order flow shocks.</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>No single measure captures all three dimensions. @goyenko2009liquidity and @fong2017best systematically evaluate which low-frequency proxies best capture each dimension by benchmarking against high-frequency measures. Their key finding: the @amihud2002illiquidity measure best captures the price impact dimension, the @roll1984simple estimator and @corwin2012simple spread best capture tightness, and the @lesmond1999new zero-return measure captures a blend of transaction costs and information asymmetry. For emerging markets specifically, @fong2017best recommend the Amihud measure and the Closing Percent Quoted Spread as the most reliable proxies.</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Construction {#sec-liquidity-data}</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Import libraries and configure environment"</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> linearmodels.panel <span class="im">import</span> PanelOLS</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> linearmodels.asset_pricing <span class="im">import</span> LinearFactorModel</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">12</span>, <span class="dv">6</span>),</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">150</span>,</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">11</span>,</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.top'</span>: <span class="va">False</span>,</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.right'</span>: <span class="va">False</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-load</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Load daily and monthly data"</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datacore <span class="im">import</span> DataCoreClient</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> DataCoreClient()</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily trading data</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>daily <span class="op">=</span> client.get_daily_prices(</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'date'</span>, <span class="st">'open'</span>, <span class="st">'high'</span>, <span class="st">'low'</span>, <span class="st">'close'</span>,</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'adjusted_close'</span>, <span class="st">'volume'</span>, <span class="st">'turnover_value'</span>,</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'market_cap'</span>, <span class="st">'shares_outstanding'</span>, <span class="st">'free_float_pct'</span>,</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bid'</span>, <span class="st">'ask'</span>, <span class="st">'foreign_buy_volume'</span>, <span class="st">'foreign_sell_volume'</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly aggregates</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>monthly <span class="op">=</span> client.get_monthly_returns(</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>, <span class="st">'market_cap'</span>,</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">'volume_avg_20d'</span>, <span class="st">'turnover_value_avg_20d'</span>,</span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_trading_days'</span>, <span class="st">'n_zero_volume_days'</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Firm characteristics for cross-sectional tests</span></span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a>fundamentals <span class="op">=</span> client.get_fundamentals(</span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a>    exchanges<span class="op">=</span>[<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>    include_delisted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>    frequency<span class="op">=</span><span class="st">'annual'</span>,</span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>[</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ticker'</span>, <span class="st">'fiscal_year'</span>, <span class="st">'total_assets'</span>, <span class="st">'total_equity'</span>,</span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'net_income'</span>, <span class="st">'revenue'</span>, <span class="st">'book_equity'</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Factor returns for asset pricing tests</span></span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> client.get_factor_returns(</span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a>    market<span class="op">=</span><span class="st">'vietnam'</span>,</span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>[<span class="st">'mkt_excess'</span>, <span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'wml'</span>]</span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(daily[<span class="st">'date'</span>])</span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>daily <span class="op">=</span> daily.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Daily observations: </span><span class="sc">{</span>daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly observations: </span><span class="sc">{</span>monthly<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique tickers: </span><span class="sc">{</span>daily[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: daily-returns</span></span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute daily returns and basic trading statistics"</span></span>
<span id="cb29-131"><a href="#cb29-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-132"><a href="#cb29-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily returns</span></span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'daily_return'</span>] <span class="op">=</span> (</span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a>    daily.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].pct_change()</span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'abs_return'</span>] <span class="op">=</span> daily[<span class="st">'daily_return'</span>].<span class="bu">abs</span>()</span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'log_return'</span>] <span class="op">=</span> np.log(</span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a>    daily[<span class="st">'adjusted_close'</span>] <span class="op">/</span> daily.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Turnover ratio (shares traded / shares outstanding)</span></span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'turnover_ratio'</span>] <span class="op">=</span> daily[<span class="st">'volume'</span>] <span class="op">/</span> daily[<span class="st">'shares_outstanding'</span>]</span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero indicators</span></span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'zero_return'</span>] <span class="op">=</span> (daily[<span class="st">'daily_return'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'zero_volume'</span>] <span class="op">=</span> (daily[<span class="st">'volume'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a><span class="co"># VND turnover (in billions)</span></span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a>daily[<span class="st">'turnover_vnd_bn'</span>] <span class="op">=</span> daily[<span class="st">'turnover_value'</span>] <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-151"><a href="#cb29-151" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Daily Return Summary:"</span>)</span>
<span id="cb29-152"><a href="#cb29-152" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daily[<span class="st">'daily_return'</span>].describe().<span class="bu">round</span>(<span class="dv">6</span>))</span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Zero-return days: </span><span class="sc">{</span>daily[<span class="st">'zero_return'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-volume days: </span><span class="sc">{</span>daily[<span class="st">'zero_volume'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructing Liquidity Measures {#sec-liquidity-measures}</span></span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-159"><a href="#cb29-159" aria-hidden="true" tabindex="-1"></a>We construct seven liquidity proxies that span the dimensions of tightness, depth, and resiliency. Each is computed at the firm-month level, producing a panel that can be merged with monthly return data for cross-sectional tests.</span>
<span id="cb29-160"><a href="#cb29-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-161"><a href="#cb29-161" aria-hidden="true" tabindex="-1"></a><span class="fu">### Amihud Illiquidity Ratio</span></span>
<span id="cb29-162"><a href="#cb29-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a>The @amihud2002illiquidity illiquidity measure is the ratio of absolute daily return to daily volume (in VND):</span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>\text{ILLIQ}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{|R_{i,d}|}{\text{DVOL}_{i,d}}</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a>$$ {#eq-amihud}</span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a>where $|R_{i,d}|$ is the absolute daily return, $\text{DVOL}_{i,d}$ is VND trading volume on day $d$, and $D_{i,m}$ is the number of trading days with positive volume in month $m$. Higher values indicate greater illiquidity.</span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-171"><a href="#cb29-171" aria-hidden="true" tabindex="-1"></a>The Amihud measure captures the price impact dimension of liquidity. It is grounded in the @kyle1985continuous model where the parameter $\lambda$ (Kyle's lambda) measures the price impact of order flow: $\Delta p = \lambda \cdot Q$. The Amihud ratio is a daily-frequency analog of $\lambda$.</span>
<span id="cb29-172"><a href="#cb29-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-175"><a href="#cb29-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-176"><a href="#cb29-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: amihud</span></span>
<span id="cb29-177"><a href="#cb29-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute monthly Amihud illiquidity ratio"</span></span>
<span id="cb29-178"><a href="#cb29-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-179"><a href="#cb29-179" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_amihud(daily_df, min_days<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb29-180"><a href="#cb29-180" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-181"><a href="#cb29-181" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Amihud (2002) illiquidity ratio at the firm-month level.</span></span>
<span id="cb29-182"><a href="#cb29-182" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb29-183"><a href="#cb29-183" aria-hidden="true" tabindex="-1"></a><span class="co">    Excludes zero-volume days. Requires at least min_days observations</span></span>
<span id="cb29-184"><a href="#cb29-184" aria-hidden="true" tabindex="-1"></a><span class="co">    with positive volume per firm-month.</span></span>
<span id="cb29-185"><a href="#cb29-185" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-186"><a href="#cb29-186" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[daily_df[<span class="st">'volume'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb29-187"><a href="#cb29-187" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-188"><a href="#cb29-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-189"><a href="#cb29-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># |Return| / VND Volume</span></span>
<span id="cb29-190"><a href="#cb29-190" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_daily'</span>] <span class="op">=</span> df[<span class="st">'abs_return'</span>] <span class="op">/</span> df[<span class="st">'turnover_value'</span>]</span>
<span id="cb29-191"><a href="#cb29-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-192"><a href="#cb29-192" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove extreme outliers (top 0.1% within each month)</span></span>
<span id="cb29-193"><a href="#cb29-193" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_daily'</span>] <span class="op">=</span> df.groupby(<span class="st">'month'</span>)[<span class="st">'illiq_daily'</span>].transform(</span>
<span id="cb29-194"><a href="#cb29-194" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.clip(upper<span class="op">=</span>x.quantile(<span class="fl">0.999</span>))</span>
<span id="cb29-195"><a href="#cb29-195" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-196"><a href="#cb29-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-197"><a href="#cb29-197" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate to firm-month</span></span>
<span id="cb29-198"><a href="#cb29-198" aria-hidden="true" tabindex="-1"></a>    amihud <span class="op">=</span> (</span>
<span id="cb29-199"><a href="#cb29-199" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-200"><a href="#cb29-200" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb29-201"><a href="#cb29-201" aria-hidden="true" tabindex="-1"></a>            amihud_raw<span class="op">=</span>(<span class="st">'illiq_daily'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-202"><a href="#cb29-202" aria-hidden="true" tabindex="-1"></a>            n_positive_vol_days<span class="op">=</span>(<span class="st">'illiq_daily'</span>, <span class="st">'count'</span>)</span>
<span id="cb29-203"><a href="#cb29-203" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-204"><a href="#cb29-204" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb29-205"><a href="#cb29-205" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-206"><a href="#cb29-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-207"><a href="#cb29-207" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter: require minimum trading days</span></span>
<span id="cb29-208"><a href="#cb29-208" aria-hidden="true" tabindex="-1"></a>    amihud <span class="op">=</span> amihud[amihud[<span class="st">'n_positive_vol_days'</span>] <span class="op">&gt;=</span> min_days]</span>
<span id="cb29-209"><a href="#cb29-209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-210"><a href="#cb29-210" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log transform (raw Amihud is heavily right-skewed)</span></span>
<span id="cb29-211"><a href="#cb29-211" aria-hidden="true" tabindex="-1"></a>    amihud[<span class="st">'amihud'</span>] <span class="op">=</span> np.log(<span class="dv">1</span> <span class="op">+</span> amihud[<span class="st">'amihud_raw'</span>] <span class="op">*</span> <span class="fl">1e6</span>)</span>
<span id="cb29-212"><a href="#cb29-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-213"><a href="#cb29-213" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert period to timestamp for merging</span></span>
<span id="cb29-214"><a href="#cb29-214" aria-hidden="true" tabindex="-1"></a>    amihud[<span class="st">'month_end'</span>] <span class="op">=</span> amihud[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-215"><a href="#cb29-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-216"><a href="#cb29-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> amihud[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'amihud'</span>, <span class="st">'amihud_raw'</span>,</span>
<span id="cb29-217"><a href="#cb29-217" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'n_positive_vol_days'</span>]]</span>
<span id="cb29-218"><a href="#cb29-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-219"><a href="#cb29-219" aria-hidden="true" tabindex="-1"></a>amihud_monthly <span class="op">=</span> compute_amihud(daily)</span>
<span id="cb29-220"><a href="#cb29-220" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Amihud observations: </span><span class="sc">{</span><span class="bu">len</span>(amihud_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-221"><a href="#cb29-221" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log Amihud distribution:"</span>)</span>
<span id="cb29-222"><a href="#cb29-222" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(amihud_monthly[<span class="st">'amihud'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb29-223"><a href="#cb29-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-224"><a href="#cb29-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-225"><a href="#cb29-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zero-Return Days (Lesmond Measure)</span></span>
<span id="cb29-226"><a href="#cb29-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-227"><a href="#cb29-227" aria-hidden="true" tabindex="-1"></a>@lesmond1999new propose using the proportion of zero-return days as a measure of transaction costs. The intuition is that if the true value change on a given day is smaller than the round-trip transaction cost, a rational marginal investor will not trade, and the observed return will be zero. Thus, the zero-return proportion is an increasing function of effective transaction costs.</span>
<span id="cb29-228"><a href="#cb29-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-229"><a href="#cb29-229" aria-hidden="true" tabindex="-1"></a>@lesmond2005liquidity validates this measure for emerging markets and finds it strongly correlated with explicit cost measures. In Vietnam, where zero-return days are common (as documented in the previous chapter), this measure has particular relevance.</span>
<span id="cb29-230"><a href="#cb29-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-231"><a href="#cb29-231" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-232"><a href="#cb29-232" aria-hidden="true" tabindex="-1"></a>\text{ZeroRet}_{i,m} = \frac{\text{Number of days with } R_{i,d} = 0}{D_{i,m}}</span>
<span id="cb29-233"><a href="#cb29-233" aria-hidden="true" tabindex="-1"></a>$$ {#eq-zero-return}</span>
<span id="cb29-234"><a href="#cb29-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-237"><a href="#cb29-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-238"><a href="#cb29-238" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: zero-return</span></span>
<span id="cb29-239"><a href="#cb29-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-240"><a href="#cb29-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute monthly zero-return proportion"</span></span>
<span id="cb29-241"><a href="#cb29-241" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_zero_return(daily_df):</span>
<span id="cb29-242"><a href="#cb29-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-243"><a href="#cb29-243" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Lesmond et al. (1999) zero-return measure</span></span>
<span id="cb29-244"><a href="#cb29-244" aria-hidden="true" tabindex="-1"></a><span class="co">    at the firm-month level.</span></span>
<span id="cb29-245"><a href="#cb29-245" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-246"><a href="#cb29-246" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb29-247"><a href="#cb29-247" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-248"><a href="#cb29-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-249"><a href="#cb29-249" aria-hidden="true" tabindex="-1"></a>    zero_ret <span class="op">=</span> (</span>
<span id="cb29-250"><a href="#cb29-250" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-251"><a href="#cb29-251" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb29-252"><a href="#cb29-252" aria-hidden="true" tabindex="-1"></a>            n_days<span class="op">=</span>(<span class="st">'daily_return'</span>, <span class="st">'count'</span>),</span>
<span id="cb29-253"><a href="#cb29-253" aria-hidden="true" tabindex="-1"></a>            n_zero_return<span class="op">=</span>(<span class="st">'zero_return'</span>, <span class="st">'sum'</span>),</span>
<span id="cb29-254"><a href="#cb29-254" aria-hidden="true" tabindex="-1"></a>            n_zero_volume<span class="op">=</span>(<span class="st">'zero_volume'</span>, <span class="st">'sum'</span>)</span>
<span id="cb29-255"><a href="#cb29-255" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-256"><a href="#cb29-256" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb29-257"><a href="#cb29-257" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-258"><a href="#cb29-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-259"><a href="#cb29-259" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'zero_return_pct'</span>] <span class="op">=</span> (</span>
<span id="cb29-260"><a href="#cb29-260" aria-hidden="true" tabindex="-1"></a>        zero_ret[<span class="st">'n_zero_return'</span>] <span class="op">/</span> zero_ret[<span class="st">'n_days'</span>]</span>
<span id="cb29-261"><a href="#cb29-261" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-262"><a href="#cb29-262" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'zero_volume_pct'</span>] <span class="op">=</span> (</span>
<span id="cb29-263"><a href="#cb29-263" aria-hidden="true" tabindex="-1"></a>        zero_ret[<span class="st">'n_zero_volume'</span>] <span class="op">/</span> zero_ret[<span class="st">'n_days'</span>]</span>
<span id="cb29-264"><a href="#cb29-264" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-265"><a href="#cb29-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-266"><a href="#cb29-266" aria-hidden="true" tabindex="-1"></a>    zero_ret[<span class="st">'month_end'</span>] <span class="op">=</span> zero_ret[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-267"><a href="#cb29-267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-268"><a href="#cb29-268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> zero_ret[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'zero_return_pct'</span>,</span>
<span id="cb29-269"><a href="#cb29-269" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'zero_volume_pct'</span>, <span class="st">'n_days'</span>]]</span>
<span id="cb29-270"><a href="#cb29-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-271"><a href="#cb29-271" aria-hidden="true" tabindex="-1"></a>zero_monthly <span class="op">=</span> compute_zero_return(daily)</span>
<span id="cb29-272"><a href="#cb29-272" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-return observations: </span><span class="sc">{</span><span class="bu">len</span>(zero_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-273"><a href="#cb29-273" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Zero-return proportion distribution:"</span>)</span>
<span id="cb29-274"><a href="#cb29-274" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zero_monthly[<span class="st">'zero_return_pct'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb29-275"><a href="#cb29-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-276"><a href="#cb29-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-277"><a href="#cb29-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Turnover Ratio</span></span>
<span id="cb29-278"><a href="#cb29-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-279"><a href="#cb29-279" aria-hidden="true" tabindex="-1"></a>Share turnover (i.e., daily volume divided by shares outstanding) measures trading activity rather than trading cost. @datar1998liquidity use turnover as a liquidity proxy and document a negative cross-sectional relationship between turnover and expected returns, consistent with the liquidity premium hypothesis.</span>
<span id="cb29-280"><a href="#cb29-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-281"><a href="#cb29-281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-282"><a href="#cb29-282" aria-hidden="true" tabindex="-1"></a>\text{Turn}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{\text{Volume}_{i,d}}{\text{SharesOut}_{i,d}}</span>
<span id="cb29-283"><a href="#cb29-283" aria-hidden="true" tabindex="-1"></a>$$ {#eq-turnover}</span>
<span id="cb29-284"><a href="#cb29-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-287"><a href="#cb29-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-288"><a href="#cb29-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: turnover</span></span>
<span id="cb29-289"><a href="#cb29-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute monthly average turnover ratio"</span></span>
<span id="cb29-290"><a href="#cb29-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-291"><a href="#cb29-291" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_turnover(daily_df):</span>
<span id="cb29-292"><a href="#cb29-292" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute average daily turnover ratio at the firm-month level."""</span></span>
<span id="cb29-293"><a href="#cb29-293" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb29-294"><a href="#cb29-294" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-295"><a href="#cb29-295" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-296"><a href="#cb29-296" aria-hidden="true" tabindex="-1"></a>    turnover <span class="op">=</span> (</span>
<span id="cb29-297"><a href="#cb29-297" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-298"><a href="#cb29-298" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb29-299"><a href="#cb29-299" aria-hidden="true" tabindex="-1"></a>            turnover_mean<span class="op">=</span>(<span class="st">'turnover_ratio'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-300"><a href="#cb29-300" aria-hidden="true" tabindex="-1"></a>            turnover_sum<span class="op">=</span>(<span class="st">'turnover_ratio'</span>, <span class="st">'sum'</span>),</span>
<span id="cb29-301"><a href="#cb29-301" aria-hidden="true" tabindex="-1"></a>            volume_mean<span class="op">=</span>(<span class="st">'volume'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-302"><a href="#cb29-302" aria-hidden="true" tabindex="-1"></a>            dvol_mean<span class="op">=</span>(<span class="st">'turnover_value'</span>, <span class="st">'mean'</span>)</span>
<span id="cb29-303"><a href="#cb29-303" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-304"><a href="#cb29-304" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb29-305"><a href="#cb29-305" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-306"><a href="#cb29-306" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-307"><a href="#cb29-307" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log transform for cross-sectional normality</span></span>
<span id="cb29-308"><a href="#cb29-308" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'log_turnover'</span>] <span class="op">=</span> np.log(</span>
<span id="cb29-309"><a href="#cb29-309" aria-hidden="true" tabindex="-1"></a>        turnover[<span class="st">'turnover_mean'</span>].clip(lower<span class="op">=</span><span class="fl">1e-8</span>)</span>
<span id="cb29-310"><a href="#cb29-310" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-311"><a href="#cb29-311" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'log_dvol'</span>] <span class="op">=</span> np.log(</span>
<span id="cb29-312"><a href="#cb29-312" aria-hidden="true" tabindex="-1"></a>        turnover[<span class="st">'dvol_mean'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-313"><a href="#cb29-313" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-314"><a href="#cb29-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-315"><a href="#cb29-315" aria-hidden="true" tabindex="-1"></a>    turnover[<span class="st">'month_end'</span>] <span class="op">=</span> turnover[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-316"><a href="#cb29-316" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-317"><a href="#cb29-317" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> turnover[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'turnover_mean'</span>,</span>
<span id="cb29-318"><a href="#cb29-318" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'log_turnover'</span>, <span class="st">'log_dvol'</span>]]</span>
<span id="cb29-319"><a href="#cb29-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-320"><a href="#cb29-320" aria-hidden="true" tabindex="-1"></a>turnover_monthly <span class="op">=</span> compute_turnover(daily)</span>
<span id="cb29-321"><a href="#cb29-321" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Turnover observations: </span><span class="sc">{</span><span class="bu">len</span>(turnover_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-322"><a href="#cb29-322" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log turnover distribution:"</span>)</span>
<span id="cb29-323"><a href="#cb29-323" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(turnover_monthly[<span class="st">'log_turnover'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb29-324"><a href="#cb29-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-325"><a href="#cb29-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-326"><a href="#cb29-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Roll Spread Estimator</span></span>
<span id="cb29-327"><a href="#cb29-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-328"><a href="#cb29-328" aria-hidden="true" tabindex="-1"></a>@roll1984simple derives an implicit bid-ask spread from the serial covariance of price changes. Under the assumptions that the true value follows a random walk and that observed prices bounce between the bid and ask:</span>
<span id="cb29-329"><a href="#cb29-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-330"><a href="#cb29-330" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-331"><a href="#cb29-331" aria-hidden="true" tabindex="-1"></a>\text{Roll}_{i,m} = \begin{cases}</span>
<span id="cb29-332"><a href="#cb29-332" aria-hidden="true" tabindex="-1"></a>2\sqrt{-\text{Cov}(\Delta P_{i,d}, \Delta P_{i,d-1})} &amp; \text{if } \text{Cov} &lt; 0 <span class="sc">\\</span></span>
<span id="cb29-333"><a href="#cb29-333" aria-hidden="true" tabindex="-1"></a>0 &amp; \text{if } \text{Cov} \geq 0</span>
<span id="cb29-334"><a href="#cb29-334" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb29-335"><a href="#cb29-335" aria-hidden="true" tabindex="-1"></a>$$ {#eq-roll}</span>
<span id="cb29-336"><a href="#cb29-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-337"><a href="#cb29-337" aria-hidden="true" tabindex="-1"></a>where $\Delta P_{i,d} = P_{i,d} - P_{i,d-1}$. The measure is intuitive: the bid-ask bounce creates negative serial correlation in transaction prices, and the magnitude of this negative correlation reflects the spread.</span>
<span id="cb29-338"><a href="#cb29-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-341"><a href="#cb29-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-342"><a href="#cb29-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: roll-spread</span></span>
<span id="cb29-343"><a href="#cb29-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-344"><a href="#cb29-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute monthly Roll (1984) effective spread estimator"</span></span>
<span id="cb29-345"><a href="#cb29-345" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_roll_spread(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb29-346"><a href="#cb29-346" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-347"><a href="#cb29-347" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Roll (1984) effective spread from serial</span></span>
<span id="cb29-348"><a href="#cb29-348" aria-hidden="true" tabindex="-1"></a><span class="co">    covariance of daily price changes.</span></span>
<span id="cb29-349"><a href="#cb29-349" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-350"><a href="#cb29-350" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb29-351"><a href="#cb29-351" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-352"><a href="#cb29-352" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'price_change'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].diff()</span>
<span id="cb29-353"><a href="#cb29-353" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'price_change_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'price_change'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb29-354"><a href="#cb29-354" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-355"><a href="#cb29-355" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> roll_estimate(group):</span>
<span id="cb29-356"><a href="#cb29-356" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb29-357"><a href="#cb29-357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb29-358"><a href="#cb29-358" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> group[<span class="st">'price_change'</span>].cov(group[<span class="st">'price_change_lag'</span>])</span>
<span id="cb29-359"><a href="#cb29-359" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cov <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb29-360"><a href="#cb29-360" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="op">-</span>cov)</span>
<span id="cb29-361"><a href="#cb29-361" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Normalize by average price</span></span>
<span id="cb29-362"><a href="#cb29-362" aria-hidden="true" tabindex="-1"></a>            avg_price <span class="op">=</span> group[<span class="st">'adjusted_close'</span>].mean()</span>
<span id="cb29-363"><a href="#cb29-363" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> spread <span class="op">/</span> avg_price <span class="cf">if</span> avg_price <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb29-364"><a href="#cb29-364" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-365"><a href="#cb29-365" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb29-366"><a href="#cb29-366" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-367"><a href="#cb29-367" aria-hidden="true" tabindex="-1"></a>    roll <span class="op">=</span> (</span>
<span id="cb29-368"><a href="#cb29-368" aria-hidden="true" tabindex="-1"></a>        df.dropna(subset<span class="op">=</span>[<span class="st">'price_change'</span>, <span class="st">'price_change_lag'</span>])</span>
<span id="cb29-369"><a href="#cb29-369" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-370"><a href="#cb29-370" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(roll_estimate)</span>
<span id="cb29-371"><a href="#cb29-371" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'roll_spread'</span>)</span>
<span id="cb29-372"><a href="#cb29-372" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-373"><a href="#cb29-373" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-374"><a href="#cb29-374" aria-hidden="true" tabindex="-1"></a>    roll[<span class="st">'month_end'</span>] <span class="op">=</span> roll[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-375"><a href="#cb29-375" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-376"><a href="#cb29-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> roll[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'roll_spread'</span>]]</span>
<span id="cb29-377"><a href="#cb29-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-378"><a href="#cb29-378" aria-hidden="true" tabindex="-1"></a>roll_monthly <span class="op">=</span> compute_roll_spread(daily)</span>
<span id="cb29-379"><a href="#cb29-379" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Roll spread observations: </span><span class="sc">{</span><span class="bu">len</span>(roll_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-380"><a href="#cb29-380" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Roll spread distribution:"</span>)</span>
<span id="cb29-381"><a href="#cb29-381" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roll_monthly[<span class="st">'roll_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span>
<span id="cb29-382"><a href="#cb29-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-383"><a href="#cb29-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-384"><a href="#cb29-384" aria-hidden="true" tabindex="-1"></a><span class="fu">### Corwin-Schultz High-Low Spread</span></span>
<span id="cb29-385"><a href="#cb29-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-386"><a href="#cb29-386" aria-hidden="true" tabindex="-1"></a>@corwin2012simple estimate the effective spread from daily high and low prices. The key insight is that daily high and low prices contain information about both volatility and the spread‚Äîthe high is typically a buy and the low a sell, so the high-low range reflects both true volatility and the bid-ask spread. By comparing one-day and two-day high-low ranges, the method separates the two components:</span>
<span id="cb29-387"><a href="#cb29-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-388"><a href="#cb29-388" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-389"><a href="#cb29-389" aria-hidden="true" tabindex="-1"></a>\hat{S}_{i,m} = \frac{2(e^{\hat{\alpha}} - 1)}{1 + e^{\hat{\alpha}}}</span>
<span id="cb29-390"><a href="#cb29-390" aria-hidden="true" tabindex="-1"></a>$$ {#eq-corwin-schultz}</span>
<span id="cb29-391"><a href="#cb29-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-392"><a href="#cb29-392" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb29-393"><a href="#cb29-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-394"><a href="#cb29-394" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-395"><a href="#cb29-395" aria-hidden="true" tabindex="-1"></a>\hat{\alpha} = \frac{\sqrt{2\hat{\beta}} - \sqrt{\hat{\beta}}}{3 - 2\sqrt{2}} - \sqrt{\frac{\hat{\gamma}}{3 - 2\sqrt{2}}}</span>
<span id="cb29-396"><a href="#cb29-396" aria-hidden="true" tabindex="-1"></a>$$ {#eq-cs-alpha}</span>
<span id="cb29-397"><a href="#cb29-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-398"><a href="#cb29-398" aria-hidden="true" tabindex="-1"></a>with $\hat{\beta}$ and $\hat{\gamma}$ computed from one-day and two-day log high-low ratios.</span>
<span id="cb29-399"><a href="#cb29-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-402"><a href="#cb29-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-403"><a href="#cb29-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: corwin-schultz</span></span>
<span id="cb29-404"><a href="#cb29-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-405"><a href="#cb29-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute the Corwin-Schultz (2012) high-low spread estimator"</span></span>
<span id="cb29-406"><a href="#cb29-406" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_corwin_schultz(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb29-407"><a href="#cb29-407" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-408"><a href="#cb29-408" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the Corwin and Schultz (2012) bid-ask spread</span></span>
<span id="cb29-409"><a href="#cb29-409" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator from daily high and low prices.</span></span>
<span id="cb29-410"><a href="#cb29-410" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-411"><a href="#cb29-411" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df.copy()</span>
<span id="cb29-412"><a href="#cb29-412" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-413"><a href="#cb29-413" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-414"><a href="#cb29-414" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log high-low ratio</span></span>
<span id="cb29-415"><a href="#cb29-415" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl'</span>] <span class="op">=</span> np.log(df[<span class="st">'high'</span>] <span class="op">/</span> df[<span class="st">'low'</span>])</span>
<span id="cb29-416"><a href="#cb29-416" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_sq'</span>] <span class="op">=</span> df[<span class="st">'log_hl'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb29-417"><a href="#cb29-417" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-418"><a href="#cb29-418" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Two-day high and low</span></span>
<span id="cb29-419"><a href="#cb29-419" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'high_2d'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'high'</span>].transform(</span>
<span id="cb29-420"><a href="#cb29-420" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.rolling(<span class="dv">2</span>).<span class="bu">max</span>()</span>
<span id="cb29-421"><a href="#cb29-421" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-422"><a href="#cb29-422" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'low_2d'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'low'</span>].transform(</span>
<span id="cb29-423"><a href="#cb29-423" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.rolling(<span class="dv">2</span>).<span class="bu">min</span>()</span>
<span id="cb29-424"><a href="#cb29-424" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-425"><a href="#cb29-425" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_2d'</span>] <span class="op">=</span> np.log(df[<span class="st">'high_2d'</span>] <span class="op">/</span> df[<span class="st">'low_2d'</span>])</span>
<span id="cb29-426"><a href="#cb29-426" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_hl_2d_sq'</span>] <span class="op">=</span> df[<span class="st">'log_hl_2d'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb29-427"><a href="#cb29-427" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-428"><a href="#cb29-428" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cs_estimate(group):</span>
<span id="cb29-429"><a href="#cb29-429" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb29-430"><a href="#cb29-430" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb29-431"><a href="#cb29-431" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-432"><a href="#cb29-432" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> group[<span class="st">'log_hl_sq'</span>].mean() <span class="op">+</span> group[<span class="st">'log_hl_sq'</span>].shift(<span class="dv">1</span>).mean()</span>
<span id="cb29-433"><a href="#cb29-433" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> group[[<span class="st">'log_hl_sq'</span>]].rolling(<span class="dv">2</span>).<span class="bu">sum</span>().mean().values[<span class="dv">0</span>]</span>
<span id="cb29-434"><a href="#cb29-434" aria-hidden="true" tabindex="-1"></a>        gamma <span class="op">=</span> group[<span class="st">'log_hl_2d_sq'</span>].mean()</span>
<span id="cb29-435"><a href="#cb29-435" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-436"><a href="#cb29-436" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> np.sqrt(<span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb29-437"><a href="#cb29-437" aria-hidden="true" tabindex="-1"></a>        denom <span class="op">=</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="dv">2</span>)</span>
<span id="cb29-438"><a href="#cb29-438" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-439"><a href="#cb29-439" aria-hidden="true" tabindex="-1"></a>        term1 <span class="op">=</span> np.sqrt(<span class="bu">max</span>(beta, <span class="dv">0</span>)) <span class="op">/</span> denom</span>
<span id="cb29-440"><a href="#cb29-440" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> beta <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb29-441"><a href="#cb29-441" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">=</span> (np.sqrt(<span class="dv">2</span> <span class="op">*</span> beta) <span class="op">-</span> np.sqrt(beta)) <span class="op">/</span> denom</span>
<span id="cb29-442"><a href="#cb29-442" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">-=</span> np.sqrt(<span class="bu">max</span>(gamma <span class="op">/</span> denom, <span class="dv">0</span>))</span>
<span id="cb29-443"><a href="#cb29-443" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-444"><a href="#cb29-444" aria-hidden="true" tabindex="-1"></a>            alpha_est <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-445"><a href="#cb29-445" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-446"><a href="#cb29-446" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spread estimate</span></span>
<span id="cb29-447"><a href="#cb29-447" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> alpha_est <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb29-448"><a href="#cb29-448" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (np.exp(alpha_est) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(alpha_est))</span>
<span id="cb29-449"><a href="#cb29-449" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-450"><a href="#cb29-450" aria-hidden="true" tabindex="-1"></a>            spread <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-451"><a href="#cb29-451" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-452"><a href="#cb29-452" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(spread, <span class="fl">0.20</span>)  <span class="co"># Cap at 20% (sanity check)</span></span>
<span id="cb29-453"><a href="#cb29-453" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-454"><a href="#cb29-454" aria-hidden="true" tabindex="-1"></a>    cs <span class="op">=</span> (</span>
<span id="cb29-455"><a href="#cb29-455" aria-hidden="true" tabindex="-1"></a>        df.dropna(subset<span class="op">=</span>[<span class="st">'log_hl'</span>, <span class="st">'log_hl_2d'</span>])</span>
<span id="cb29-456"><a href="#cb29-456" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-457"><a href="#cb29-457" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(cs_estimate)</span>
<span id="cb29-458"><a href="#cb29-458" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'cs_spread'</span>)</span>
<span id="cb29-459"><a href="#cb29-459" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-460"><a href="#cb29-460" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-461"><a href="#cb29-461" aria-hidden="true" tabindex="-1"></a>    cs[<span class="st">'month_end'</span>] <span class="op">=</span> cs[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-462"><a href="#cb29-462" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-463"><a href="#cb29-463" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cs[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'cs_spread'</span>]]</span>
<span id="cb29-464"><a href="#cb29-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-465"><a href="#cb29-465" aria-hidden="true" tabindex="-1"></a>cs_monthly <span class="op">=</span> compute_corwin_schultz(daily)</span>
<span id="cb29-466"><a href="#cb29-466" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Corwin-Schultz observations: </span><span class="sc">{</span><span class="bu">len</span>(cs_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-467"><a href="#cb29-467" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">CS spread distribution:"</span>)</span>
<span id="cb29-468"><a href="#cb29-468" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cs_monthly[<span class="st">'cs_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span>
<span id="cb29-469"><a href="#cb29-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-470"><a href="#cb29-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-471"><a href="#cb29-471" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quoted Bid-Ask Spread</span></span>
<span id="cb29-472"><a href="#cb29-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-473"><a href="#cb29-473" aria-hidden="true" tabindex="-1"></a>When bid and ask quotes are available, the quoted percentage spread provides a direct measure of tightness:</span>
<span id="cb29-474"><a href="#cb29-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-475"><a href="#cb29-475" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-476"><a href="#cb29-476" aria-hidden="true" tabindex="-1"></a>\text{PQSPR}_{i,m} = \frac{1}{D_{i,m}} \sum_{d=1}^{D_{i,m}} \frac{\text{Ask}_{i,d} - \text{Bid}_{i,d}}{(\text{Ask}_{i,d} + \text{Bid}_{i,d})/2}</span>
<span id="cb29-477"><a href="#cb29-477" aria-hidden="true" tabindex="-1"></a>$$ {#eq-quoted-spread}</span>
<span id="cb29-478"><a href="#cb29-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-481"><a href="#cb29-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-482"><a href="#cb29-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: quoted-spread</span></span>
<span id="cb29-483"><a href="#cb29-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-484"><a href="#cb29-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute monthly average quoted percentage spread"</span></span>
<span id="cb29-485"><a href="#cb29-485" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_quoted_spread(daily_df):</span>
<span id="cb29-486"><a href="#cb29-486" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute average quoted percentage spread at the firm-month level."""</span></span>
<span id="cb29-487"><a href="#cb29-487" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[</span>
<span id="cb29-488"><a href="#cb29-488" aria-hidden="true" tabindex="-1"></a>        (daily_df[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (daily_df[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span></span>
<span id="cb29-489"><a href="#cb29-489" aria-hidden="true" tabindex="-1"></a>        (daily_df[<span class="st">'ask'</span>] <span class="op">&gt;=</span> daily_df[<span class="st">'bid'</span>])</span>
<span id="cb29-490"><a href="#cb29-490" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb29-491"><a href="#cb29-491" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-492"><a href="#cb29-492" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-493"><a href="#cb29-493" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'pqspr'</span>] <span class="op">=</span> (</span>
<span id="cb29-494"><a href="#cb29-494" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">-</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> ((df[<span class="st">'ask'</span>] <span class="op">+</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb29-495"><a href="#cb29-495" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-496"><a href="#cb29-496" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-497"><a href="#cb29-497" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Winsorize extreme values</span></span>
<span id="cb29-498"><a href="#cb29-498" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'pqspr'</span>] <span class="op">=</span> df[<span class="st">'pqspr'</span>].clip(upper<span class="op">=</span>df[<span class="st">'pqspr'</span>].quantile(<span class="fl">0.999</span>))</span>
<span id="cb29-499"><a href="#cb29-499" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-500"><a href="#cb29-500" aria-hidden="true" tabindex="-1"></a>    spread <span class="op">=</span> (</span>
<span id="cb29-501"><a href="#cb29-501" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-502"><a href="#cb29-502" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb29-503"><a href="#cb29-503" aria-hidden="true" tabindex="-1"></a>            quoted_spread<span class="op">=</span>(<span class="st">'pqspr'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-504"><a href="#cb29-504" aria-hidden="true" tabindex="-1"></a>            n_quotes<span class="op">=</span>(<span class="st">'pqspr'</span>, <span class="st">'count'</span>)</span>
<span id="cb29-505"><a href="#cb29-505" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-506"><a href="#cb29-506" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb29-507"><a href="#cb29-507" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-508"><a href="#cb29-508" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-509"><a href="#cb29-509" aria-hidden="true" tabindex="-1"></a>    spread[<span class="st">'month_end'</span>] <span class="op">=</span> spread[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-510"><a href="#cb29-510" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-511"><a href="#cb29-511" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> spread[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'n_quotes'</span>]]</span>
<span id="cb29-512"><a href="#cb29-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-513"><a href="#cb29-513" aria-hidden="true" tabindex="-1"></a>quoted_monthly <span class="op">=</span> compute_quoted_spread(daily)</span>
<span id="cb29-514"><a href="#cb29-514" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Quoted spread observations: </span><span class="sc">{</span><span class="bu">len</span>(quoted_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-515"><a href="#cb29-515" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Quoted spread distribution:"</span>)</span>
<span id="cb29-516"><a href="#cb29-516" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(quoted_monthly[<span class="st">'quoted_spread'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span>
<span id="cb29-517"><a href="#cb29-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-518"><a href="#cb29-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-519"><a href="#cb29-519" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kyle's Lambda (Price Impact Regression)</span></span>
<span id="cb29-520"><a href="#cb29-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-521"><a href="#cb29-521" aria-hidden="true" tabindex="-1"></a>We estimate Kyle's lambda (i.e., the price impact per unit of signed order flow) using a daily regression:</span>
<span id="cb29-522"><a href="#cb29-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-523"><a href="#cb29-523" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-524"><a href="#cb29-524" aria-hidden="true" tabindex="-1"></a>R_{i,d} = \alpha_i + \lambda_i \cdot \text{Sign}(R_{i,d}) \cdot \sqrt{\text{Volume}_{i,d}} + \varepsilon_{i,d}</span>
<span id="cb29-525"><a href="#cb29-525" aria-hidden="true" tabindex="-1"></a>$$ {#eq-kyle-lambda}</span>
<span id="cb29-526"><a href="#cb29-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-527"><a href="#cb29-527" aria-hidden="true" tabindex="-1"></a>This is an adaptation of the @hasbrouck2009trading effective cost measure. The coefficient $\lambda_i$ measures how much prices move per unit of (unsigned, square-rooted) volume.</span>
<span id="cb29-528"><a href="#cb29-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-531"><a href="#cb29-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-532"><a href="#cb29-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kyle-lambda</span></span>
<span id="cb29-533"><a href="#cb29-533" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-534"><a href="#cb29-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Estimate Kyle's lambda from daily price-volume regressions"</span></span>
<span id="cb29-535"><a href="#cb29-535" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_kyle_lambda(daily_df, min_days<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb29-536"><a href="#cb29-536" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-537"><a href="#cb29-537" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate Kyle's lambda (price impact per unit order flow)</span></span>
<span id="cb29-538"><a href="#cb29-538" aria-hidden="true" tabindex="-1"></a><span class="co">    from daily return-on-signed-volume regressions.</span></span>
<span id="cb29-539"><a href="#cb29-539" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-540"><a href="#cb29-540" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> daily_df[daily_df[<span class="st">'volume'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb29-541"><a href="#cb29-541" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb29-542"><a href="#cb29-542" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-543"><a href="#cb29-543" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Signed square-root volume (sign inferred from return)</span></span>
<span id="cb29-544"><a href="#cb29-544" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'signed_sqrt_vol'</span>] <span class="op">=</span> (</span>
<span id="cb29-545"><a href="#cb29-545" aria-hidden="true" tabindex="-1"></a>        np.sign(df[<span class="st">'daily_return'</span>]) <span class="op">*</span> np.sqrt(df[<span class="st">'volume'</span>])</span>
<span id="cb29-546"><a href="#cb29-546" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-547"><a href="#cb29-547" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-548"><a href="#cb29-548" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> estimate_lambda(group):</span>
<span id="cb29-549"><a href="#cb29-549" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> min_days:</span>
<span id="cb29-550"><a href="#cb29-550" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb29-551"><a href="#cb29-551" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> group[<span class="st">'daily_return'</span>].values</span>
<span id="cb29-552"><a href="#cb29-552" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> group[<span class="st">'signed_sqrt_vol'</span>].values</span>
<span id="cb29-553"><a href="#cb29-553" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> sm.add_constant(x)</span>
<span id="cb29-554"><a href="#cb29-554" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-555"><a href="#cb29-555" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, x).fit()</span>
<span id="cb29-556"><a href="#cb29-556" aria-hidden="true" tabindex="-1"></a>            lam <span class="op">=</span> model.params[<span class="dv">1</span>]</span>
<span id="cb29-557"><a href="#cb29-557" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">max</span>(lam, <span class="dv">0</span>)  <span class="co"># Lambda should be non-negative</span></span>
<span id="cb29-558"><a href="#cb29-558" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb29-559"><a href="#cb29-559" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb29-560"><a href="#cb29-560" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-561"><a href="#cb29-561" aria-hidden="true" tabindex="-1"></a>    kyle <span class="op">=</span> (</span>
<span id="cb29-562"><a href="#cb29-562" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'ticker'</span>, <span class="st">'month'</span>])</span>
<span id="cb29-563"><a href="#cb29-563" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">apply</span>(estimate_lambda)</span>
<span id="cb29-564"><a href="#cb29-564" aria-hidden="true" tabindex="-1"></a>        .reset_index(name<span class="op">=</span><span class="st">'kyle_lambda'</span>)</span>
<span id="cb29-565"><a href="#cb29-565" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-566"><a href="#cb29-566" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-567"><a href="#cb29-567" aria-hidden="true" tabindex="-1"></a>    kyle[<span class="st">'log_kyle'</span>] <span class="op">=</span> np.log(kyle[<span class="st">'kyle_lambda'</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>))</span>
<span id="cb29-568"><a href="#cb29-568" aria-hidden="true" tabindex="-1"></a>    kyle[<span class="st">'month_end'</span>] <span class="op">=</span> kyle[<span class="st">'month'</span>].dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb29-569"><a href="#cb29-569" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-570"><a href="#cb29-570" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kyle[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'kyle_lambda'</span>, <span class="st">'log_kyle'</span>]]</span>
<span id="cb29-571"><a href="#cb29-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-572"><a href="#cb29-572" aria-hidden="true" tabindex="-1"></a>kyle_monthly <span class="op">=</span> compute_kyle_lambda(daily)</span>
<span id="cb29-573"><a href="#cb29-573" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kyle lambda observations: </span><span class="sc">{</span><span class="bu">len</span>(kyle_monthly)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-574"><a href="#cb29-574" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Log Kyle lambda distribution:"</span>)</span>
<span id="cb29-575"><a href="#cb29-575" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(kyle_monthly[<span class="st">'log_kyle'</span>].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb29-576"><a href="#cb29-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-577"><a href="#cb29-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-578"><a href="#cb29-578" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assembling the Liquidity Panel {#sec-liquidity-panel}</span></span>
<span id="cb29-579"><a href="#cb29-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-580"><a href="#cb29-580" aria-hidden="true" tabindex="-1"></a>We merge all seven measures into a single firm-month panel for comparative analysis.</span>
<span id="cb29-581"><a href="#cb29-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-584"><a href="#cb29-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-585"><a href="#cb29-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: merge-panel</span></span>
<span id="cb29-586"><a href="#cb29-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-587"><a href="#cb29-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Merge all liquidity measures into a unified panel"</span></span>
<span id="cb29-588"><a href="#cb29-588" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with monthly returns as the base</span></span>
<span id="cb29-589"><a href="#cb29-589" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> monthly[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>,</span>
<span id="cb29-590"><a href="#cb29-590" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'market_cap'</span>]].copy()</span>
<span id="cb29-591"><a href="#cb29-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-592"><a href="#cb29-592" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge each liquidity measure</span></span>
<span id="cb29-593"><a href="#cb29-593" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, df, key_col <span class="kw">in</span> [</span>
<span id="cb29-594"><a href="#cb29-594" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Amihud'</span>, amihud_monthly, <span class="st">'amihud'</span>),</span>
<span id="cb29-595"><a href="#cb29-595" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Zero Return'</span>, zero_monthly, <span class="st">'zero_return_pct'</span>),</span>
<span id="cb29-596"><a href="#cb29-596" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Turnover'</span>, turnover_monthly, <span class="st">'log_turnover'</span>),</span>
<span id="cb29-597"><a href="#cb29-597" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Roll'</span>, roll_monthly, <span class="st">'roll_spread'</span>),</span>
<span id="cb29-598"><a href="#cb29-598" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Corwin-Schultz'</span>, cs_monthly, <span class="st">'cs_spread'</span>),</span>
<span id="cb29-599"><a href="#cb29-599" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Quoted Spread'</span>, quoted_monthly, <span class="st">'quoted_spread'</span>),</span>
<span id="cb29-600"><a href="#cb29-600" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Kyle Lambda'</span>, kyle_monthly, <span class="st">'log_kyle'</span>),</span>
<span id="cb29-601"><a href="#cb29-601" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb29-602"><a href="#cb29-602" aria-hidden="true" tabindex="-1"></a>    panel <span class="op">=</span> panel.merge(</span>
<span id="cb29-603"><a href="#cb29-603" aria-hidden="true" tabindex="-1"></a>        df[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, key_col]],</span>
<span id="cb29-604"><a href="#cb29-604" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>],</span>
<span id="cb29-605"><a href="#cb29-605" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb29-606"><a href="#cb29-606" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-607"><a href="#cb29-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-608"><a href="#cb29-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Add log market cap</span></span>
<span id="cb29-609"><a href="#cb29-609" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'log_mcap'</span>] <span class="op">=</span> np.log(panel[<span class="st">'market_cap'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb29-610"><a href="#cb29-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-611"><a href="#cb29-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fundamentals (lagged)</span></span>
<span id="cb29-612"><a href="#cb29-612" aria-hidden="true" tabindex="-1"></a>fund_lagged <span class="op">=</span> fundamentals.copy()</span>
<span id="cb29-613"><a href="#cb29-613" aria-hidden="true" tabindex="-1"></a>fund_lagged[<span class="st">'merge_year'</span>] <span class="op">=</span> fund_lagged[<span class="st">'fiscal_year'</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-614"><a href="#cb29-614" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> panel.merge(</span>
<span id="cb29-615"><a href="#cb29-615" aria-hidden="true" tabindex="-1"></a>    fund_lagged[[<span class="st">'ticker'</span>, <span class="st">'merge_year'</span>, <span class="st">'book_equity'</span>]].rename(</span>
<span id="cb29-616"><a href="#cb29-616" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>{<span class="st">'merge_year'</span>: <span class="st">'year'</span>}),</span>
<span id="cb29-617"><a href="#cb29-617" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>[<span class="st">'ticker'</span>, panel[<span class="st">'month_end'</span>].dt.year],</span>
<span id="cb29-618"><a href="#cb29-618" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'year'</span>],</span>
<span id="cb29-619"><a href="#cb29-619" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb29-620"><a href="#cb29-620" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-621"><a href="#cb29-621" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'bm'</span>] <span class="op">=</span> panel[<span class="st">'book_equity'</span>] <span class="op">/</span> panel[<span class="st">'market_cap'</span>]</span>
<span id="cb29-622"><a href="#cb29-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-623"><a href="#cb29-623" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unified panel: </span><span class="sc">{</span><span class="bu">len</span>(panel)<span class="sc">:,}</span><span class="ss"> firm-months"</span>)</span>
<span id="cb29-624"><a href="#cb29-624" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Coverage by measure:"</span>)</span>
<span id="cb29-625"><a href="#cb29-625" aria-hidden="true" tabindex="-1"></a>liquidity_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'log_turnover'</span>,</span>
<span id="cb29-626"><a href="#cb29-626" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb29-627"><a href="#cb29-627" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> liquidity_cols:</span>
<span id="cb29-628"><a href="#cb29-628" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> panel[col].notna().mean()</span>
<span id="cb29-629"><a href="#cb29-629" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>col<span class="sc">:&lt;20}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb29-630"><a href="#cb29-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-631"><a href="#cb29-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-632"><a href="#cb29-632" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cross-Sectional Properties of Liquidity {#sec-liquidity-cross-section}</span></span>
<span id="cb29-633"><a href="#cb29-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-634"><a href="#cb29-634" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary Statistics by Size Quintile</span></span>
<span id="cb29-635"><a href="#cb29-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-636"><a href="#cb29-636" aria-hidden="true" tabindex="-1"></a>Liquidity varies enormously across the size distribution. Small-cap Vietnamese stocks can be orders of magnitude less liquid than large-caps.</span>
<span id="cb29-637"><a href="#cb29-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-640"><a href="#cb29-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-641"><a href="#cb29-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: liquidity-by-size</span></span>
<span id="cb29-642"><a href="#cb29-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute liquidity statistics by market cap quintile"</span></span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign size quintiles within each month</span></span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'size_quintile'</span>] <span class="op">=</span> (</span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'market_cap'</span>]</span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a>    .transform(<span class="kw">lambda</span> x: pd.qcut(x, <span class="dv">5</span>, labels<span class="op">=</span>[<span class="st">'Q1 (Small)'</span>, <span class="st">'Q2'</span>,</span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">'Q3'</span>, <span class="st">'Q4'</span>,</span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">'Q5 (Large)'</span>],</span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a>                                   duplicates<span class="op">=</span><span class="st">'drop'</span>))</span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Average liquidity by quintile</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a>liq_by_size <span class="op">=</span> (</span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'size_quintile'</span>)[liquidity_cols]</span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average Liquidity by Market Cap Quintile:"</span>)</span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(liq_by_size.to_string())</span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-667"><a href="#cb29-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-liquidity-by-size</span></span>
<span id="cb29-668"><a href="#cb29-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-669"><a href="#cb29-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Liquidity measures by market capitalization quintile. All measures confirm the strong negative relationship between size and illiquidity: the smallest quintile is 10--50x more illiquid than the largest by any metric. This gradient is steeper in Vietnam than in developed markets, reflecting the extreme heterogeneity of the listed universe."</span></span>
<span id="cb29-670"><a href="#cb29-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Bar charts of liquidity measures by size quintile"</span></span>
<span id="cb29-671"><a href="#cb29-671" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb29-672"><a href="#cb29-672" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb29-673"><a href="#cb29-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-674"><a href="#cb29-674" aria-hidden="true" tabindex="-1"></a>measures_to_plot <span class="op">=</span> [</span>
<span id="cb29-675"><a href="#cb29-675" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'amihud'</span>, <span class="st">'Amihud (log)'</span>, <span class="st">'#2C5F8A'</span>),</span>
<span id="cb29-676"><a href="#cb29-676" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'zero_return_pct'</span>, <span class="st">'Zero-Return %'</span>, <span class="st">'#C0392B'</span>),</span>
<span id="cb29-677"><a href="#cb29-677" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'log_turnover'</span>, <span class="st">'Log Turnover'</span>, <span class="st">'#27AE60'</span>),</span>
<span id="cb29-678"><a href="#cb29-678" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'roll_spread'</span>, <span class="st">'Roll Spread'</span>, <span class="st">'#E67E22'</span>),</span>
<span id="cb29-679"><a href="#cb29-679" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'cs_spread'</span>, <span class="st">'Corwin-Schultz Spread'</span>, <span class="st">'#8E44AD'</span>),</span>
<span id="cb29-680"><a href="#cb29-680" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'quoted_spread'</span>, <span class="st">'Quoted Spread'</span>, <span class="st">'#1ABC9C'</span>)</span>
<span id="cb29-681"><a href="#cb29-681" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-682"><a href="#cb29-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-683"><a href="#cb29-683" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (col, label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(measures_to_plot):</span>
<span id="cb29-684"><a href="#cb29-684" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> panel.groupby(<span class="st">'size_quintile'</span>)[col].mean()</span>
<span id="cb29-685"><a href="#cb29-685" aria-hidden="true" tabindex="-1"></a>    axes[i].bar(<span class="bu">range</span>(<span class="bu">len</span>(data)), data.values,</span>
<span id="cb29-686"><a href="#cb29-686" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb29-687"><a href="#cb29-687" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(data)))</span>
<span id="cb29-688"><a href="#cb29-688" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticklabels(data.index, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb29-689"><a href="#cb29-689" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(label)</span>
<span id="cb29-690"><a href="#cb29-690" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(label)</span>
<span id="cb29-691"><a href="#cb29-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-692"><a href="#cb29-692" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Liquidity Measures by Market Cap Quintile'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-693"><a href="#cb29-693" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-694"><a href="#cb29-694" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-695"><a href="#cb29-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-696"><a href="#cb29-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-697"><a href="#cb29-697" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlation Structure</span></span>
<span id="cb29-698"><a href="#cb29-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-699"><a href="#cb29-699" aria-hidden="true" tabindex="-1"></a>How strongly do the different liquidity measures correlate? If they capture the same underlying dimension, we expect high correlations. If they capture different dimensions (tightness vs. depth vs. activity), correlations will be moderate.</span>
<span id="cb29-700"><a href="#cb29-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-703"><a href="#cb29-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-704"><a href="#cb29-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-liquidity-correlations</span></span>
<span id="cb29-705"><a href="#cb29-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-706"><a href="#cb29-706" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Pairwise rank correlations among liquidity measures. The measures are positively correlated (all point in the same direction‚Äîhigher values indicate lower liquidity, except turnover where higher means more liquid), but correlations are far from perfect. This confirms that liquidity is multidimensional: each measure captures a different aspect of trading friction."</span></span>
<span id="cb29-707"><a href="#cb29-707" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute and plot cross-sectional rank correlations"</span></span>
<span id="cb29-708"><a href="#cb29-708" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank correlations (Spearman) among liquidity measures</span></span>
<span id="cb29-709"><a href="#cb29-709" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse turnover sign so higher = less liquid (consistent direction)</span></span>
<span id="cb29-710"><a href="#cb29-710" aria-hidden="true" tabindex="-1"></a>panel_corr <span class="op">=</span> panel[liquidity_cols].copy()</span>
<span id="cb29-711"><a href="#cb29-711" aria-hidden="true" tabindex="-1"></a>panel_corr[<span class="st">'neg_log_turnover'</span>] <span class="op">=</span> <span class="op">-</span>panel_corr[<span class="st">'log_turnover'</span>]</span>
<span id="cb29-712"><a href="#cb29-712" aria-hidden="true" tabindex="-1"></a>corr_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'neg_log_turnover'</span>,</span>
<span id="cb29-713"><a href="#cb29-713" aria-hidden="true" tabindex="-1"></a>              <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'quoted_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb29-714"><a href="#cb29-714" aria-hidden="true" tabindex="-1"></a>corr_labels <span class="op">=</span> [<span class="st">'Amihud'</span>, <span class="st">'Zero-Return'</span>, <span class="st">'Neg. Turnover'</span>, <span class="st">'Roll'</span>,</span>
<span id="cb29-715"><a href="#cb29-715" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Corwin-Schultz'</span>, <span class="st">'Quoted Spread'</span>, <span class="st">'Kyle Œª'</span>]</span>
<span id="cb29-716"><a href="#cb29-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-717"><a href="#cb29-717" aria-hidden="true" tabindex="-1"></a>rank_corr <span class="op">=</span> panel_corr[corr_cols].corr(method<span class="op">=</span><span class="st">'spearman'</span>)</span>
<span id="cb29-718"><a href="#cb29-718" aria-hidden="true" tabindex="-1"></a>rank_corr.index <span class="op">=</span> corr_labels</span>
<span id="cb29-719"><a href="#cb29-719" aria-hidden="true" tabindex="-1"></a>rank_corr.columns <span class="op">=</span> corr_labels</span>
<span id="cb29-720"><a href="#cb29-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-721"><a href="#cb29-721" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">8</span>))</span>
<span id="cb29-722"><a href="#cb29-722" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(rank_corr, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-723"><a href="#cb29-723" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb29-724"><a href="#cb29-724" aria-hidden="true" tabindex="-1"></a>    rank_corr, mask<span class="op">=</span>mask, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>,</span>
<span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlOrRd'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>, square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, ax<span class="op">=</span>ax,</span>
<span id="cb29-727"><a href="#cb29-727" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Spearman Rank Correlation'</span>}</span>
<span id="cb29-728"><a href="#cb29-728" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-729"><a href="#cb29-729" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Cross-Sectional Rank Correlations Among Liquidity Measures'</span>)</span>
<span id="cb29-730"><a href="#cb29-730" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-731"><a href="#cb29-731" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-732"><a href="#cb29-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-733"><a href="#cb29-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-734"><a href="#cb29-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Principal Component Analysis of Liquidity</span></span>
<span id="cb29-735"><a href="#cb29-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-736"><a href="#cb29-736" aria-hidden="true" tabindex="-1"></a>Given the multidimensionality of liquidity, we extract a composite liquidity factor using PCA:</span>
<span id="cb29-737"><a href="#cb29-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-740"><a href="#cb29-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-741"><a href="#cb29-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pca-liquidity</span></span>
<span id="cb29-742"><a href="#cb29-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-743"><a href="#cb29-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Extract principal components from standardized liquidity measures"</span></span>
<span id="cb29-744"><a href="#cb29-744" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb29-745"><a href="#cb29-745" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb29-746"><a href="#cb29-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-747"><a href="#cb29-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize each measure within each month (cross-sectional)</span></span>
<span id="cb29-748"><a href="#cb29-748" aria-hidden="true" tabindex="-1"></a>liq_data <span class="op">=</span> panel[liquidity_cols].copy()</span>
<span id="cb29-749"><a href="#cb29-749" aria-hidden="true" tabindex="-1"></a>liq_data[<span class="st">'neg_log_turnover'</span>] <span class="op">=</span> <span class="op">-</span>liq_data[<span class="st">'log_turnover'</span>]</span>
<span id="cb29-750"><a href="#cb29-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-751"><a href="#cb29-751" aria-hidden="true" tabindex="-1"></a>pca_cols <span class="op">=</span> [<span class="st">'amihud'</span>, <span class="st">'zero_return_pct'</span>, <span class="st">'neg_log_turnover'</span>,</span>
<span id="cb29-752"><a href="#cb29-752" aria-hidden="true" tabindex="-1"></a>             <span class="st">'roll_spread'</span>, <span class="st">'cs_spread'</span>, <span class="st">'log_kyle'</span>]</span>
<span id="cb29-753"><a href="#cb29-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-754"><a href="#cb29-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any missing liquidity measure</span></span>
<span id="cb29-755"><a href="#cb29-755" aria-hidden="true" tabindex="-1"></a>liq_complete <span class="op">=</span> panel.dropna(subset<span class="op">=</span>pca_cols).copy()</span>
<span id="cb29-756"><a href="#cb29-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-757"><a href="#cb29-757" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-sectional standardization by month</span></span>
<span id="cb29-758"><a href="#cb29-758" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize_within_month(df, cols):</span>
<span id="cb29-759"><a href="#cb29-759" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb29-760"><a href="#cb29-760" aria-hidden="true" tabindex="-1"></a>        df[col <span class="op">+</span> <span class="st">'_z'</span>] <span class="op">=</span> (</span>
<span id="cb29-761"><a href="#cb29-761" aria-hidden="true" tabindex="-1"></a>            df.groupby(<span class="st">'month_end'</span>)[col]</span>
<span id="cb29-762"><a href="#cb29-762" aria-hidden="true" tabindex="-1"></a>            .transform(<span class="kw">lambda</span> x: (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std())</span>
<span id="cb29-763"><a href="#cb29-763" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-764"><a href="#cb29-764" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb29-765"><a href="#cb29-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-766"><a href="#cb29-766" aria-hidden="true" tabindex="-1"></a>liq_complete <span class="op">=</span> standardize_within_month(liq_complete, pca_cols)</span>
<span id="cb29-767"><a href="#cb29-767" aria-hidden="true" tabindex="-1"></a>z_cols <span class="op">=</span> [c <span class="op">+</span> <span class="st">'_z'</span> <span class="cf">for</span> c <span class="kw">in</span> pca_cols]</span>
<span id="cb29-768"><a href="#cb29-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-769"><a href="#cb29-769" aria-hidden="true" tabindex="-1"></a><span class="co"># Pool all months for PCA</span></span>
<span id="cb29-770"><a href="#cb29-770" aria-hidden="true" tabindex="-1"></a>pca_input <span class="op">=</span> liq_complete[z_cols].dropna()</span>
<span id="cb29-771"><a href="#cb29-771" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb29-772"><a href="#cb29-772" aria-hidden="true" tabindex="-1"></a>pca.fit(pca_input)</span>
<span id="cb29-773"><a href="#cb29-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-774"><a href="#cb29-774" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PCA Explained Variance Ratios:"</span>)</span>
<span id="cb29-775"><a href="#cb29-775" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (var, cumvar) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(</span>
<span id="cb29-776"><a href="#cb29-776" aria-hidden="true" tabindex="-1"></a>    pca.explained_variance_ratio_,</span>
<span id="cb29-777"><a href="#cb29-777" aria-hidden="true" tabindex="-1"></a>    np.cumsum(pca.explained_variance_ratio_)</span>
<span id="cb29-778"><a href="#cb29-778" aria-hidden="true" tabindex="-1"></a>)):</span>
<span id="cb29-779"><a href="#cb29-779" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  PC</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>var<span class="sc">:.3f}</span><span class="ss"> (cumulative: </span><span class="sc">{</span>cumvar<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb29-780"><a href="#cb29-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-781"><a href="#cb29-781" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">PC1 Loadings:"</span>)</span>
<span id="cb29-782"><a href="#cb29-782" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, loading <span class="kw">in</span> <span class="bu">zip</span>(pca_cols, pca.components_[<span class="dv">0</span>]):</span>
<span id="cb29-783"><a href="#cb29-783" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>col<span class="sc">:&lt;20}</span><span class="ss">: </span><span class="sc">{</span>loading<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-784"><a href="#cb29-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-785"><a href="#cb29-785" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign PC1 as composite illiquidity</span></span>
<span id="cb29-786"><a href="#cb29-786" aria-hidden="true" tabindex="-1"></a>liq_complete[<span class="st">'illiq_pc1'</span>] <span class="op">=</span> pca.transform(</span>
<span id="cb29-787"><a href="#cb29-787" aria-hidden="true" tabindex="-1"></a>    liq_complete[z_cols].values</span>
<span id="cb29-788"><a href="#cb29-788" aria-hidden="true" tabindex="-1"></a>)[:, <span class="dv">0</span>]</span>
<span id="cb29-789"><a href="#cb29-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-790"><a href="#cb29-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-791"><a href="#cb29-791" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregate Liquidity and Market Conditions {#sec-liquidity-aggregate}</span></span>
<span id="cb29-792"><a href="#cb29-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-793"><a href="#cb29-793" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series of Market Liquidity</span></span>
<span id="cb29-794"><a href="#cb29-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-795"><a href="#cb29-795" aria-hidden="true" tabindex="-1"></a>Aggregate liquidity (i.e., the average illiquidity across all stocks) varies substantially over time. @chordia2001market document that market-wide liquidity declines during periods of high volatility and negative market returns.</span>
<span id="cb29-796"><a href="#cb29-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-799"><a href="#cb29-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-800"><a href="#cb29-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-aggregate-liquidity</span></span>
<span id="cb29-801"><a href="#cb29-801" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-802"><a href="#cb29-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Aggregate liquidity conditions in the Vietnamese equity market. Panel A shows the cross-sectional median of three illiquidity measures over time (standardized). Panel B shows the VN-Index return for context. Liquidity deteriorated sharply during the 2008--2009 global financial crisis, the 2011 domestic tightening cycle, and the March 2020 COVID crash. Each episode is marked by simultaneous spikes in all illiquidity measures."</span></span>
<span id="cb29-803"><a href="#cb29-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plot aggregate liquidity time series"</span></span>
<span id="cb29-804"><a href="#cb29-804" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute monthly cross-sectional aggregates</span></span>
<span id="cb29-805"><a href="#cb29-805" aria-hidden="true" tabindex="-1"></a>agg_liquidity <span class="op">=</span> (</span>
<span id="cb29-806"><a href="#cb29-806" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)</span>
<span id="cb29-807"><a href="#cb29-807" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb29-808"><a href="#cb29-808" aria-hidden="true" tabindex="-1"></a>        amihud_median<span class="op">=</span>(<span class="st">'amihud'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-809"><a href="#cb29-809" aria-hidden="true" tabindex="-1"></a>        zero_ret_median<span class="op">=</span>(<span class="st">'zero_return_pct'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-810"><a href="#cb29-810" aria-hidden="true" tabindex="-1"></a>        turnover_median<span class="op">=</span>(<span class="st">'log_turnover'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-811"><a href="#cb29-811" aria-hidden="true" tabindex="-1"></a>        roll_median<span class="op">=</span>(<span class="st">'roll_spread'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-812"><a href="#cb29-812" aria-hidden="true" tabindex="-1"></a>        cs_median<span class="op">=</span>(<span class="st">'cs_spread'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-813"><a href="#cb29-813" aria-hidden="true" tabindex="-1"></a>        n_stocks<span class="op">=</span>(<span class="st">'ticker'</span>, <span class="st">'nunique'</span>)</span>
<span id="cb29-814"><a href="#cb29-814" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-815"><a href="#cb29-815" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb29-816"><a href="#cb29-816" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-817"><a href="#cb29-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-818"><a href="#cb29-818" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize for plotting</span></span>
<span id="cb29-819"><a href="#cb29-819" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'amihud_median'</span>, <span class="st">'zero_ret_median'</span>, <span class="st">'roll_median'</span>]:</span>
<span id="cb29-820"><a href="#cb29-820" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[col <span class="op">+</span> <span class="st">'_z'</span>] <span class="op">=</span> (</span>
<span id="cb29-821"><a href="#cb29-821" aria-hidden="true" tabindex="-1"></a>        (agg_liquidity[col] <span class="op">-</span> agg_liquidity[col].mean())</span>
<span id="cb29-822"><a href="#cb29-822" aria-hidden="true" tabindex="-1"></a>        <span class="op">/</span> agg_liquidity[col].std()</span>
<span id="cb29-823"><a href="#cb29-823" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-824"><a href="#cb29-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-825"><a href="#cb29-825" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">9</span>), height_ratios<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb29-826"><a href="#cb29-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-827"><a href="#cb29-827" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Aggregate illiquidity</span></span>
<span id="cb29-828"><a href="#cb29-828" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'amihud_median_z'</span>],</span>
<span id="cb29-829"><a href="#cb29-829" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#2C5F8A'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Amihud'</span>)</span>
<span id="cb29-830"><a href="#cb29-830" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'zero_ret_median_z'</span>],</span>
<span id="cb29-831"><a href="#cb29-831" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#C0392B'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Zero-Return'</span>)</span>
<span id="cb29-832"><a href="#cb29-832" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(agg_liquidity[<span class="st">'month_end'</span>], agg_liquidity[<span class="st">'roll_median_z'</span>],</span>
<span id="cb29-833"><a href="#cb29-833" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#27AE60'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Roll Spread'</span>)</span>
<span id="cb29-834"><a href="#cb29-834" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-835"><a href="#cb29-835" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Illiquidity'</span>)</span>
<span id="cb29-836"><a href="#cb29-836" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Aggregate Illiquidity Over Time'</span>)</span>
<span id="cb29-837"><a href="#cb29-837" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb29-838"><a href="#cb29-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-839"><a href="#cb29-839" aria-hidden="true" tabindex="-1"></a><span class="co"># Shade crisis periods</span></span>
<span id="cb29-840"><a href="#cb29-840" aria-hidden="true" tabindex="-1"></a>crisis_periods <span class="op">=</span> [</span>
<span id="cb29-841"><a href="#cb29-841" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2008-06-01'</span>, <span class="st">'2009-03-31'</span>, <span class="st">'GFC'</span>),</span>
<span id="cb29-842"><a href="#cb29-842" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2011-01-01'</span>, <span class="st">'2011-12-31'</span>, <span class="st">'Tightening'</span>),</span>
<span id="cb29-843"><a href="#cb29-843" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2020-02-01'</span>, <span class="st">'2020-05-31'</span>, <span class="st">'COVID'</span>)</span>
<span id="cb29-844"><a href="#cb29-844" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-845"><a href="#cb29-845" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start, end, label <span class="kw">in</span> crisis_periods:</span>
<span id="cb29-846"><a href="#cb29-846" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].axvspan(pd.Timestamp(start), pd.Timestamp(end),</span>
<span id="cb29-847"><a href="#cb29-847" aria-hidden="true" tabindex="-1"></a>                     alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb29-848"><a href="#cb29-848" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> pd.Timestamp(start) <span class="op">+</span> (pd.Timestamp(end) <span class="op">-</span> pd.Timestamp(start)) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb29-849"><a href="#cb29-849" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].text(mid, axes[<span class="dv">0</span>].get_ylim()[<span class="dv">1</span>] <span class="op">*</span> <span class="fl">0.9</span>, label,</span>
<span id="cb29-850"><a href="#cb29-850" aria-hidden="true" tabindex="-1"></a>                 ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb29-851"><a href="#cb29-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-852"><a href="#cb29-852" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Market return</span></span>
<span id="cb29-853"><a href="#cb29-853" aria-hidden="true" tabindex="-1"></a>market_monthly <span class="op">=</span> factors[[<span class="st">'month_end'</span>, <span class="st">'mkt_excess'</span>]].copy()</span>
<span id="cb29-854"><a href="#cb29-854" aria-hidden="true" tabindex="-1"></a>market_monthly[<span class="st">'month_end'</span>] <span class="op">=</span> pd.to_datetime(market_monthly[<span class="st">'month_end'</span>])</span>
<span id="cb29-855"><a href="#cb29-855" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].bar(market_monthly[<span class="st">'month_end'</span>],</span>
<span id="cb29-856"><a href="#cb29-856" aria-hidden="true" tabindex="-1"></a>            market_monthly[<span class="st">'mkt_excess'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb29-857"><a href="#cb29-857" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb29-858"><a href="#cb29-858" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>[<span class="st">'#27AE60'</span> <span class="cf">if</span> r <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'#C0392B'</span></span>
<span id="cb29-859"><a href="#cb29-859" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> r <span class="kw">in</span> market_monthly[<span class="st">'mkt_excess'</span>]],</span>
<span id="cb29-860"><a href="#cb29-860" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb29-861"><a href="#cb29-861" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Market Excess Return (%)'</span>)</span>
<span id="cb29-862"><a href="#cb29-862" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb29-863"><a href="#cb29-863" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: VN-Index Monthly Excess Return'</span>)</span>
<span id="cb29-864"><a href="#cb29-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-865"><a href="#cb29-865" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-866"><a href="#cb29-866" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-867"><a href="#cb29-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-868"><a href="#cb29-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-869"><a href="#cb29-869" aria-hidden="true" tabindex="-1"></a><span class="fu">### Commonality in Liquidity</span></span>
<span id="cb29-870"><a href="#cb29-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-871"><a href="#cb29-871" aria-hidden="true" tabindex="-1"></a>@chordia2000commonality find that individual stock liquidity co-moves with market liquidity, even after controlling for firm-specific factors. We test for commonality in Vietnam by regressing changes in firm-level liquidity on changes in market-level liquidity:</span>
<span id="cb29-872"><a href="#cb29-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-873"><a href="#cb29-873" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-874"><a href="#cb29-874" aria-hidden="true" tabindex="-1"></a>\Delta L_{i,m} = \alpha_i + \beta_i \Delta L_{M,m} + \gamma_i \Delta L_{M,m-1} + \delta_i \Delta L_{M,m+1} + \varepsilon_{i,m}</span>
<span id="cb29-875"><a href="#cb29-875" aria-hidden="true" tabindex="-1"></a>$$ {#eq-commonality}</span>
<span id="cb29-876"><a href="#cb29-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-877"><a href="#cb29-877" aria-hidden="true" tabindex="-1"></a>where $\Delta L_{i,m}$ is the change in firm $i$'s illiquidity, $\Delta L_{M,m}$ is the change in market-average illiquidity (excluding firm $i$), and the lead/lag terms capture non-synchronous adjustment. The coefficient $\beta_i$ measures the sensitivity of firm $i$'s liquidity to market-wide liquidity shocks.</span>
<span id="cb29-878"><a href="#cb29-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-881"><a href="#cb29-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-882"><a href="#cb29-882" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: commonality</span></span>
<span id="cb29-883"><a href="#cb29-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-884"><a href="#cb29-884" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Test for commonality in liquidity across Vietnamese stocks"</span></span>
<span id="cb29-885"><a href="#cb29-885" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute monthly changes in Amihud for each firm and the market</span></span>
<span id="cb29-886"><a href="#cb29-886" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'amihud'</span>]].dropna().copy()</span>
<span id="cb29-887"><a href="#cb29-887" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel_common.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb29-888"><a href="#cb29-888" aria-hidden="true" tabindex="-1"></a>panel_common[<span class="st">'d_amihud'</span>] <span class="op">=</span> (</span>
<span id="cb29-889"><a href="#cb29-889" aria-hidden="true" tabindex="-1"></a>    panel_common.groupby(<span class="st">'ticker'</span>)[<span class="st">'amihud'</span>].diff()</span>
<span id="cb29-890"><a href="#cb29-890" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-891"><a href="#cb29-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-892"><a href="#cb29-892" aria-hidden="true" tabindex="-1"></a><span class="co"># Market-level illiquidity change (equal-weighted, excluding firm i)</span></span>
<span id="cb29-893"><a href="#cb29-893" aria-hidden="true" tabindex="-1"></a>mkt_liq <span class="op">=</span> (</span>
<span id="cb29-894"><a href="#cb29-894" aria-hidden="true" tabindex="-1"></a>    panel_common.groupby(<span class="st">'month_end'</span>)[<span class="st">'amihud'</span>]</span>
<span id="cb29-895"><a href="#cb29-895" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb29-896"><a href="#cb29-896" aria-hidden="true" tabindex="-1"></a>    .diff()</span>
<span id="cb29-897"><a href="#cb29-897" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'d_amihud_mkt'</span>)</span>
<span id="cb29-898"><a href="#cb29-898" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-899"><a href="#cb29-899" aria-hidden="true" tabindex="-1"></a>mkt_liq[<span class="st">'d_amihud_mkt_lag'</span>] <span class="op">=</span> mkt_liq[<span class="st">'d_amihud_mkt'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb29-900"><a href="#cb29-900" aria-hidden="true" tabindex="-1"></a>mkt_liq[<span class="st">'d_amihud_mkt_lead'</span>] <span class="op">=</span> mkt_liq[<span class="st">'d_amihud_mkt'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb29-901"><a href="#cb29-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-902"><a href="#cb29-902" aria-hidden="true" tabindex="-1"></a>panel_common <span class="op">=</span> panel_common.merge(mkt_liq, on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb29-903"><a href="#cb29-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-904"><a href="#cb29-904" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate commonality for each firm</span></span>
<span id="cb29-905"><a href="#cb29-905" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_commonality(group, min_obs<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb29-906"><a href="#cb29-906" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">'d_amihud'</span>, <span class="st">'d_amihud_mkt'</span>])</span>
<span id="cb29-907"><a href="#cb29-907" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> min_obs:</span>
<span id="cb29-908"><a href="#cb29-908" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-909"><a href="#cb29-909" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> g[<span class="st">'d_amihud'</span>]</span>
<span id="cb29-910"><a href="#cb29-910" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(g[[<span class="st">'d_amihud_mkt'</span>, <span class="st">'d_amihud_mkt_lag'</span>,</span>
<span id="cb29-911"><a href="#cb29-911" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'d_amihud_mkt_lead'</span>]])</span>
<span id="cb29-912"><a href="#cb29-912" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb29-913"><a href="#cb29-913" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb29-914"><a href="#cb29-914" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series({</span>
<span id="cb29-915"><a href="#cb29-915" aria-hidden="true" tabindex="-1"></a>            <span class="st">'beta_mkt'</span>: model.params[<span class="st">'d_amihud_mkt'</span>],</span>
<span id="cb29-916"><a href="#cb29-916" aria-hidden="true" tabindex="-1"></a>            <span class="st">'beta_t'</span>: model.tvalues[<span class="st">'d_amihud_mkt'</span>],</span>
<span id="cb29-917"><a href="#cb29-917" aria-hidden="true" tabindex="-1"></a>            <span class="st">'r_squared'</span>: model.rsquared</span>
<span id="cb29-918"><a href="#cb29-918" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb29-919"><a href="#cb29-919" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb29-920"><a href="#cb29-920" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-921"><a href="#cb29-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-922"><a href="#cb29-922" aria-hidden="true" tabindex="-1"></a>commonality <span class="op">=</span> (</span>
<span id="cb29-923"><a href="#cb29-923" aria-hidden="true" tabindex="-1"></a>    panel_common</span>
<span id="cb29-924"><a href="#cb29-924" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'ticker'</span>)</span>
<span id="cb29-925"><a href="#cb29-925" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_commonality)</span>
<span id="cb29-926"><a href="#cb29-926" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb29-927"><a href="#cb29-927" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-928"><a href="#cb29-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-929"><a href="#cb29-929" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Commonality in Liquidity (Amihud):"</span>)</span>
<span id="cb29-930"><a href="#cb29-930" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean beta_mkt: </span><span class="sc">{</span>commonality[<span class="st">'beta_mkt'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-931"><a href="#cb29-931" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Median beta_mkt: </span><span class="sc">{</span>commonality[<span class="st">'beta_mkt'</span>]<span class="sc">.</span>median()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-932"><a href="#cb29-932" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  % significant at 5%: "</span></span>
<span id="cb29-933"><a href="#cb29-933" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>(commonality[<span class="st">'beta_t'</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="fl">1.96</span>)<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb29-934"><a href="#cb29-934" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean R-squared: </span><span class="sc">{</span>commonality[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-935"><a href="#cb29-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-936"><a href="#cb29-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-937"><a href="#cb29-937" aria-hidden="true" tabindex="-1"></a><span class="fu">## Is Liquidity Priced? {#sec-liquidity-pricing}</span></span>
<span id="cb29-938"><a href="#cb29-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-939"><a href="#cb29-939" aria-hidden="true" tabindex="-1"></a><span class="fu">### Portfolio Sorts</span></span>
<span id="cb29-940"><a href="#cb29-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-941"><a href="#cb29-941" aria-hidden="true" tabindex="-1"></a>We test whether illiquidity predicts future returns by sorting stocks into quintile portfolios based on lagged liquidity measures and comparing average returns across quintiles.</span>
<span id="cb29-942"><a href="#cb29-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-945"><a href="#cb29-945" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-946"><a href="#cb29-946" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: portfolio-sorts</span></span>
<span id="cb29-947"><a href="#cb29-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-948"><a href="#cb29-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Sort stocks into quintiles by lagged illiquidity and compute returns"</span></span>
<span id="cb29-949"><a href="#cb29-949" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liquidity_portfolio_sort(panel_df, liq_col, n_groups<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb29-950"><a href="#cb29-950" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-951"><a href="#cb29-951" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute quintile portfolio returns sorted on lagged liquidity.</span></span>
<span id="cb29-952"><a href="#cb29-952" aria-hidden="true" tabindex="-1"></a><span class="co">    Lag the sorting variable by one month to avoid look-ahead bias.</span></span>
<span id="cb29-953"><a href="#cb29-953" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-954"><a href="#cb29-954" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> panel_df[[<span class="st">'ticker'</span>, <span class="st">'month_end'</span>, <span class="st">'monthly_return'</span>,</span>
<span id="cb29-955"><a href="#cb29-955" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'market_cap'</span>, liq_col]].dropna().copy()</span>
<span id="cb29-956"><a href="#cb29-956" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb29-957"><a href="#cb29-957" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-958"><a href="#cb29-958" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag the sorting variable</span></span>
<span id="cb29-959"><a href="#cb29-959" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'liq_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[liq_col].shift(<span class="dv">1</span>)</span>
<span id="cb29-960"><a href="#cb29-960" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'liq_lag'</span>, <span class="st">'monthly_return'</span>])</span>
<span id="cb29-961"><a href="#cb29-961" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-962"><a href="#cb29-962" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign quintiles within each month</span></span>
<span id="cb29-963"><a href="#cb29-963" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'quintile'</span>] <span class="op">=</span> (</span>
<span id="cb29-964"><a href="#cb29-964" aria-hidden="true" tabindex="-1"></a>        df.groupby(<span class="st">'month_end'</span>)[<span class="st">'liq_lag'</span>]</span>
<span id="cb29-965"><a href="#cb29-965" aria-hidden="true" tabindex="-1"></a>        .transform(<span class="kw">lambda</span> x: pd.qcut(x, n_groups, labels<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb29-966"><a href="#cb29-966" aria-hidden="true" tabindex="-1"></a>                                       duplicates<span class="op">=</span><span class="st">'drop'</span>))</span>
<span id="cb29-967"><a href="#cb29-967" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-968"><a href="#cb29-968" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-969"><a href="#cb29-969" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EW portfolio returns by quintile-month</span></span>
<span id="cb29-970"><a href="#cb29-970" aria-hidden="true" tabindex="-1"></a>    port_returns <span class="op">=</span> (</span>
<span id="cb29-971"><a href="#cb29-971" aria-hidden="true" tabindex="-1"></a>        df.groupby([<span class="st">'month_end'</span>, <span class="st">'quintile'</span>])[<span class="st">'monthly_return'</span>]</span>
<span id="cb29-972"><a href="#cb29-972" aria-hidden="true" tabindex="-1"></a>        .mean()</span>
<span id="cb29-973"><a href="#cb29-973" aria-hidden="true" tabindex="-1"></a>        .unstack()</span>
<span id="cb29-974"><a href="#cb29-974" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-975"><a href="#cb29-975" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-976"><a href="#cb29-976" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Long-short (Q5 - Q1)</span></span>
<span id="cb29-977"><a href="#cb29-977" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_groups <span class="op">-</span> <span class="dv">1</span> <span class="kw">in</span> port_returns.columns <span class="kw">and</span> <span class="dv">0</span> <span class="kw">in</span> port_returns.columns:</span>
<span id="cb29-978"><a href="#cb29-978" aria-hidden="true" tabindex="-1"></a>        port_returns[<span class="st">'long_short'</span>] <span class="op">=</span> (</span>
<span id="cb29-979"><a href="#cb29-979" aria-hidden="true" tabindex="-1"></a>            port_returns[n_groups <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> port_returns[<span class="dv">0</span>]</span>
<span id="cb29-980"><a href="#cb29-980" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-981"><a href="#cb29-981" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-982"><a href="#cb29-982" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> port_returns</span>
<span id="cb29-983"><a href="#cb29-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-984"><a href="#cb29-984" aria-hidden="true" tabindex="-1"></a><span class="co"># Run sorts for each illiquidity measure</span></span>
<span id="cb29-985"><a href="#cb29-985" aria-hidden="true" tabindex="-1"></a>sort_measures <span class="op">=</span> {</span>
<span id="cb29-986"><a href="#cb29-986" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Amihud'</span>: <span class="st">'amihud'</span>,</span>
<span id="cb29-987"><a href="#cb29-987" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-Return'</span>: <span class="st">'zero_return_pct'</span>,</span>
<span id="cb29-988"><a href="#cb29-988" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neg. Turnover'</span>: <span class="st">'log_turnover'</span>,  <span class="co"># Will reverse below</span></span>
<span id="cb29-989"><a href="#cb29-989" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Roll Spread'</span>: <span class="st">'roll_spread'</span>,</span>
<span id="cb29-990"><a href="#cb29-990" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Corwin-Schultz'</span>: <span class="st">'cs_spread'</span>,</span>
<span id="cb29-991"><a href="#cb29-991" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-992"><a href="#cb29-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-993"><a href="#cb29-993" aria-hidden="true" tabindex="-1"></a><span class="co"># For turnover, negate so higher = less liquid</span></span>
<span id="cb29-994"><a href="#cb29-994" aria-hidden="true" tabindex="-1"></a>panel_sorts <span class="op">=</span> panel.copy()</span>
<span id="cb29-995"><a href="#cb29-995" aria-hidden="true" tabindex="-1"></a>panel_sorts[<span class="st">'neg_turnover'</span>] <span class="op">=</span> <span class="op">-</span>panel_sorts[<span class="st">'log_turnover'</span>]</span>
<span id="cb29-996"><a href="#cb29-996" aria-hidden="true" tabindex="-1"></a>sort_measures_actual <span class="op">=</span> {</span>
<span id="cb29-997"><a href="#cb29-997" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Amihud'</span>: <span class="st">'amihud'</span>,</span>
<span id="cb29-998"><a href="#cb29-998" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-Return'</span>: <span class="st">'zero_return_pct'</span>,</span>
<span id="cb29-999"><a href="#cb29-999" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neg. Turnover'</span>: <span class="st">'neg_turnover'</span>,</span>
<span id="cb29-1000"><a href="#cb29-1000" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Roll Spread'</span>: <span class="st">'roll_spread'</span>,</span>
<span id="cb29-1001"><a href="#cb29-1001" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Corwin-Schultz'</span>: <span class="st">'cs_spread'</span>,</span>
<span id="cb29-1002"><a href="#cb29-1002" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-1003"><a href="#cb29-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1004"><a href="#cb29-1004" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Liquidity Premium (EW, Quintile Sorts):"</span>)</span>
<span id="cb29-1005"><a href="#cb29-1005" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Measure'</span><span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Q1 (Liquid)'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Q5 (Illiquid)'</span><span class="sc">:&gt;14}</span><span class="ss"> "</span></span>
<span id="cb29-1006"><a href="#cb29-1006" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span><span class="st">'Q5-Q1'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;8}</span><span class="ss">"</span>)</span>
<span id="cb29-1007"><a href="#cb29-1007" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">62</span>)</span>
<span id="cb29-1008"><a href="#cb29-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1009"><a href="#cb29-1009" aria-hidden="true" tabindex="-1"></a>sort_results <span class="op">=</span> {}</span>
<span id="cb29-1010"><a href="#cb29-1010" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, col <span class="kw">in</span> sort_measures_actual.items():</span>
<span id="cb29-1011"><a href="#cb29-1011" aria-hidden="true" tabindex="-1"></a>    ports <span class="op">=</span> liquidity_portfolio_sort(panel_sorts, col)</span>
<span id="cb29-1012"><a href="#cb29-1012" aria-hidden="true" tabindex="-1"></a>    sort_results[name] <span class="op">=</span> ports</span>
<span id="cb29-1013"><a href="#cb29-1013" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1014"><a href="#cb29-1014" aria-hidden="true" tabindex="-1"></a>    q1 <span class="op">=</span> ports[<span class="dv">0</span>].mean() <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb29-1015"><a href="#cb29-1015" aria-hidden="true" tabindex="-1"></a>    q5 <span class="op">=</span> ports[<span class="dv">4</span>].mean() <span class="op">*</span> <span class="dv">12</span> <span class="cf">if</span> <span class="dv">4</span> <span class="kw">in</span> ports.columns <span class="cf">else</span> np.nan</span>
<span id="cb29-1016"><a href="#cb29-1016" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> ports[<span class="st">'long_short'</span>].mean() <span class="op">*</span> <span class="dv">12</span> <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">in</span> ports <span class="cf">else</span> np.nan</span>
<span id="cb29-1017"><a href="#cb29-1017" aria-hidden="true" tabindex="-1"></a>    ls_se <span class="op">=</span> ports[<span class="st">'long_short'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(ports)) <span class="op">*</span> np.sqrt(<span class="dv">12</span>) <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">in</span> ports <span class="cf">else</span> np.nan</span>
<span id="cb29-1018"><a href="#cb29-1018" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ls <span class="op">/</span> ls_se <span class="cf">if</span> ls_se <span class="kw">and</span> ls_se <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb29-1019"><a href="#cb29-1019" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1020"><a href="#cb29-1020" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span>q1<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>q5<span class="sc">:&gt;14.4f}</span><span class="ss"> </span><span class="sc">{</span>ls<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss">"</span>)</span>
<span id="cb29-1021"><a href="#cb29-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1022"><a href="#cb29-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1025"><a href="#cb29-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1026"><a href="#cb29-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-liquidity-premium</span></span>
<span id="cb29-1027"><a href="#cb29-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1028"><a href="#cb29-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Annualized average returns by illiquidity quintile for each liquidity measure. A monotonically increasing pattern from Q1 (most liquid) to Q5 (most illiquid) indicates a liquidity premium‚Äîcompensation for holding harder-to-trade stocks."</span></span>
<span id="cb29-1029"><a href="#cb29-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Bar chart of quintile returns by liquidity measure"</span></span>
<span id="cb29-1030"><a href="#cb29-1030" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb29-1031"><a href="#cb29-1031" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb29-1032"><a href="#cb29-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1033"><a href="#cb29-1033" aria-hidden="true" tabindex="-1"></a>colors_quintile <span class="op">=</span> [<span class="st">'#27AE60'</span>, <span class="st">'#2ECC71'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#E67E22'</span>, <span class="st">'#C0392B'</span>]</span>
<span id="cb29-1034"><a href="#cb29-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1035"><a href="#cb29-1035" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (name, ports) <span class="kw">in</span> <span class="bu">enumerate</span>(sort_results.items()):</span>
<span id="cb29-1036"><a href="#cb29-1036" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb29-1037"><a href="#cb29-1037" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb29-1038"><a href="#cb29-1038" aria-hidden="true" tabindex="-1"></a>    quintile_means <span class="op">=</span> [ports[q].mean() <span class="op">*</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> q <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)</span>
<span id="cb29-1039"><a href="#cb29-1039" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> q <span class="kw">in</span> ports.columns]</span>
<span id="cb29-1040"><a href="#cb29-1040" aria-hidden="true" tabindex="-1"></a>    axes[i].bar(<span class="bu">range</span>(<span class="bu">len</span>(quintile_means)), quintile_means,</span>
<span id="cb29-1041"><a href="#cb29-1041" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>colors_quintile[:<span class="bu">len</span>(quintile_means)],</span>
<span id="cb29-1042"><a href="#cb29-1042" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb29-1043"><a href="#cb29-1043" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(quintile_means)))</span>
<span id="cb29-1044"><a href="#cb29-1044" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xticklabels([<span class="ss">f'Q</span><span class="sc">{</span>q<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> q <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(quintile_means))])</span>
<span id="cb29-1045"><a href="#cb29-1045" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">'Annualized Return (%)'</span>)</span>
<span id="cb29-1046"><a href="#cb29-1046" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(name)</span>
<span id="cb29-1047"><a href="#cb29-1047" aria-hidden="true" tabindex="-1"></a>    axes[i].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-1048"><a href="#cb29-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1049"><a href="#cb29-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplot</span></span>
<span id="cb29-1050"><a href="#cb29-1050" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(sort_results) <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb29-1051"><a href="#cb29-1051" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">5</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb29-1052"><a href="#cb29-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1053"><a href="#cb29-1053" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Average Returns by Illiquidity Quintile'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-1054"><a href="#cb29-1054" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-1055"><a href="#cb29-1055" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-1056"><a href="#cb29-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1057"><a href="#cb29-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1058"><a href="#cb29-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fama-MacBeth Cross-Sectional Regressions</span></span>
<span id="cb29-1059"><a href="#cb29-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1060"><a href="#cb29-1060" aria-hidden="true" tabindex="-1"></a>Portfolio sorts are informative but cannot control for multiple characteristics simultaneously. We use @fama1993common -style cross-sectional regressions to test whether liquidity predicts returns after controlling for size, value, and momentum:</span>
<span id="cb29-1061"><a href="#cb29-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1062"><a href="#cb29-1062" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-1063"><a href="#cb29-1063" aria-hidden="true" tabindex="-1"></a>R_{i,m+1} = \gamma_{0,m} + \gamma_{1,m} \text{ILLIQ}_{i,m} + \gamma_{2,m} \ln(\text{MCap}_{i,m}) + \gamma_{3,m} \text{BM}_{i,m} + \gamma_{4,m} R_{i,m-12:m-1} + \varepsilon_{i,m+1}</span>
<span id="cb29-1064"><a href="#cb29-1064" aria-hidden="true" tabindex="-1"></a>$$ {#eq-fama-macbeth}</span>
<span id="cb29-1065"><a href="#cb29-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1066"><a href="#cb29-1066" aria-hidden="true" tabindex="-1"></a>The time-series average of the monthly coefficient $\bar{\gamma}_1$ estimates the illiquidity premium, and its t-statistic uses the @fama1993common standard error.</span>
<span id="cb29-1067"><a href="#cb29-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1070"><a href="#cb29-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1071"><a href="#cb29-1071" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fama-macbeth</span></span>
<span id="cb29-1072"><a href="#cb29-1072" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1073"><a href="#cb29-1073" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Fama-MacBeth regressions of returns on lagged liquidity and controls"</span></span>
<span id="cb29-1074"><a href="#cb29-1074" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fama_macbeth(panel_df, illiq_col, controls<span class="op">=</span>[<span class="st">'log_mcap'</span>, <span class="st">'bm'</span>],</span>
<span id="cb29-1075"><a href="#cb29-1075" aria-hidden="true" tabindex="-1"></a>                  min_stocks<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb29-1076"><a href="#cb29-1076" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-1077"><a href="#cb29-1077" aria-hidden="true" tabindex="-1"></a><span class="co">    Run Fama-MacBeth cross-sectional regressions of</span></span>
<span id="cb29-1078"><a href="#cb29-1078" aria-hidden="true" tabindex="-1"></a><span class="co">    next-month returns on lagged illiquidity and controls.</span></span>
<span id="cb29-1079"><a href="#cb29-1079" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-1080"><a href="#cb29-1080" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> panel_df.copy()</span>
<span id="cb29-1081"><a href="#cb29-1081" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'month_end'</span>])</span>
<span id="cb29-1082"><a href="#cb29-1082" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1083"><a href="#cb29-1083" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag the illiquidity measure</span></span>
<span id="cb29-1084"><a href="#cb29-1084" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'illiq_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[illiq_col].shift(<span class="dv">1</span>)</span>
<span id="cb29-1085"><a href="#cb29-1085" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1086"><a href="#cb29-1086" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lag controls</span></span>
<span id="cb29-1087"><a href="#cb29-1087" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> controls:</span>
<span id="cb29-1088"><a href="#cb29-1088" aria-hidden="true" tabindex="-1"></a>        df[c <span class="op">+</span> <span class="st">'_lag'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[c].shift(<span class="dv">1</span>)</span>
<span id="cb29-1089"><a href="#cb29-1089" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1090"><a href="#cb29-1090" aria-hidden="true" tabindex="-1"></a>    regressors <span class="op">=</span> [<span class="st">'illiq_lag'</span>] <span class="op">+</span> [c <span class="op">+</span> <span class="st">'_lag'</span> <span class="cf">for</span> c <span class="kw">in</span> controls]</span>
<span id="cb29-1091"><a href="#cb29-1091" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'monthly_return'</span>] <span class="op">+</span> regressors)</span>
<span id="cb29-1092"><a href="#cb29-1092" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1093"><a href="#cb29-1093" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Month-by-month cross-sectional regressions</span></span>
<span id="cb29-1094"><a href="#cb29-1094" aria-hidden="true" tabindex="-1"></a>    months <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'month_end'</span>].unique())</span>
<span id="cb29-1095"><a href="#cb29-1095" aria-hidden="true" tabindex="-1"></a>    gamma_list <span class="op">=</span> []</span>
<span id="cb29-1096"><a href="#cb29-1096" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1097"><a href="#cb29-1097" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> months:</span>
<span id="cb29-1098"><a href="#cb29-1098" aria-hidden="true" tabindex="-1"></a>        cross <span class="op">=</span> df[df[<span class="st">'month_end'</span>] <span class="op">==</span> month]</span>
<span id="cb29-1099"><a href="#cb29-1099" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(cross) <span class="op">&lt;</span> min_stocks:</span>
<span id="cb29-1100"><a href="#cb29-1100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb29-1101"><a href="#cb29-1101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-1102"><a href="#cb29-1102" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> cross[<span class="st">'monthly_return'</span>].values</span>
<span id="cb29-1103"><a href="#cb29-1103" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> sm.add_constant(cross[regressors].values)</span>
<span id="cb29-1104"><a href="#cb29-1104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-1105"><a href="#cb29-1105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-1106"><a href="#cb29-1106" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb29-1107"><a href="#cb29-1107" aria-hidden="true" tabindex="-1"></a>            gammas <span class="op">=</span> {<span class="st">'month_end'</span>: month, <span class="st">'intercept'</span>: model.params[<span class="dv">0</span>]}</span>
<span id="cb29-1108"><a href="#cb29-1108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, reg <span class="kw">in</span> <span class="bu">enumerate</span>(regressors):</span>
<span id="cb29-1109"><a href="#cb29-1109" aria-hidden="true" tabindex="-1"></a>                gammas[reg] <span class="op">=</span> model.params[j <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb29-1110"><a href="#cb29-1110" aria-hidden="true" tabindex="-1"></a>            gamma_list.append(gammas)</span>
<span id="cb29-1111"><a href="#cb29-1111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb29-1112"><a href="#cb29-1112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb29-1113"><a href="#cb29-1113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1114"><a href="#cb29-1114" aria-hidden="true" tabindex="-1"></a>    gamma_df <span class="op">=</span> pd.DataFrame(gamma_list)</span>
<span id="cb29-1115"><a href="#cb29-1115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1116"><a href="#cb29-1116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-series averages and t-statistics</span></span>
<span id="cb29-1117"><a href="#cb29-1117" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb29-1118"><a href="#cb29-1118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'intercept'</span>] <span class="op">+</span> regressors:</span>
<span id="cb29-1119"><a href="#cb29-1119" aria-hidden="true" tabindex="-1"></a>        mean <span class="op">=</span> gamma_df[col].mean()</span>
<span id="cb29-1120"><a href="#cb29-1120" aria-hidden="true" tabindex="-1"></a>        se <span class="op">=</span> gamma_df[col].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(gamma_df))</span>
<span id="cb29-1121"><a href="#cb29-1121" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> mean <span class="op">/</span> se <span class="cf">if</span> se <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb29-1122"><a href="#cb29-1122" aria-hidden="true" tabindex="-1"></a>        results[col] <span class="op">=</span> {<span class="st">'Coefficient'</span>: mean, <span class="st">'SE'</span>: se, <span class="st">'t-stat'</span>: t}</span>
<span id="cb29-1123"><a href="#cb29-1123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1124"><a href="#cb29-1124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results).T, gamma_df</span>
<span id="cb29-1125"><a href="#cb29-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1126"><a href="#cb29-1126" aria-hidden="true" tabindex="-1"></a><span class="co"># Run for each illiquidity measure</span></span>
<span id="cb29-1127"><a href="#cb29-1127" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Fama-MacBeth Regressions: R_{i,m+1} on ILLIQ_{i,m} + controls"</span>)</span>
<span id="cb29-1128"><a href="#cb29-1128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-1129"><a href="#cb29-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1130"><a href="#cb29-1130" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, col <span class="kw">in</span> [(<span class="st">'Amihud'</span>, <span class="st">'amihud'</span>),</span>
<span id="cb29-1131"><a href="#cb29-1131" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Zero-Return'</span>, <span class="st">'zero_return_pct'</span>),</span>
<span id="cb29-1132"><a href="#cb29-1132" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Roll Spread'</span>, <span class="st">'roll_spread'</span>),</span>
<span id="cb29-1133"><a href="#cb29-1133" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'Corwin-Schultz'</span>, <span class="st">'cs_spread'</span>)]:</span>
<span id="cb29-1134"><a href="#cb29-1134" aria-hidden="true" tabindex="-1"></a>    results, gammas <span class="op">=</span> fama_macbeth(panel, col)</span>
<span id="cb29-1135"><a href="#cb29-1135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb29-1136"><a href="#cb29-1136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(results[[<span class="st">'Coefficient'</span>, <span class="st">'t-stat'</span>]].<span class="bu">round</span>(<span class="dv">4</span>).to_string())</span>
<span id="cb29-1137"><a href="#cb29-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1138"><a href="#cb29-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1139"><a href="#cb29-1139" aria-hidden="true" tabindex="-1"></a><span class="fu">### Factor-Adjusted Liquidity Premium</span></span>
<span id="cb29-1140"><a href="#cb29-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1141"><a href="#cb29-1141" aria-hidden="true" tabindex="-1"></a>The liquidity premium may be partially or fully explained by existing risk factors (size, value, momentum). We test this by regressing the long-short liquidity portfolio returns on the Fama-French-Carhart factors:</span>
<span id="cb29-1142"><a href="#cb29-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1145"><a href="#cb29-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1146"><a href="#cb29-1146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: factor-adjusted</span></span>
<span id="cb29-1147"><a href="#cb29-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1148"><a href="#cb29-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Regress liquidity long-short returns on FF+Carhart factors"</span></span>
<span id="cb29-1149"><a href="#cb29-1149" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Factor-Adjusted Liquidity Premium:"</span>)</span>
<span id="cb29-1150"><a href="#cb29-1150" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Measure'</span><span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Alpha (ann.)'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Alpha t'</span><span class="sc">:&gt;10}</span><span class="ss"> "</span></span>
<span id="cb29-1151"><a href="#cb29-1151" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span><span class="st">'MKT'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'SMB'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'HML'</span><span class="sc">:&gt;8}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'R2'</span><span class="sc">:&gt;6}</span><span class="ss">"</span>)</span>
<span id="cb29-1152"><a href="#cb29-1152" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">72</span>)</span>
<span id="cb29-1153"><a href="#cb29-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1154"><a href="#cb29-1154" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, ports <span class="kw">in</span> sort_results.items():</span>
<span id="cb29-1155"><a href="#cb29-1155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">not</span> <span class="kw">in</span> ports.columns:</span>
<span id="cb29-1156"><a href="#cb29-1156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-1157"><a href="#cb29-1157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1158"><a href="#cb29-1158" aria-hidden="true" tabindex="-1"></a>    ls_series <span class="op">=</span> ports[<span class="st">'long_short'</span>].to_frame(<span class="st">'ls'</span>)</span>
<span id="cb29-1159"><a href="#cb29-1159" aria-hidden="true" tabindex="-1"></a>    ls_series.index <span class="op">=</span> pd.to_datetime(ls_series.index)</span>
<span id="cb29-1160"><a href="#cb29-1160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1161"><a href="#cb29-1161" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> ls_series.merge(factors, left_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-1162"><a href="#cb29-1162" aria-hidden="true" tabindex="-1"></a>                              right_on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb29-1163"><a href="#cb29-1163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1164"><a href="#cb29-1164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(merged) <span class="op">&lt;</span> <span class="dv">24</span>:</span>
<span id="cb29-1165"><a href="#cb29-1165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-1166"><a href="#cb29-1166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1167"><a href="#cb29-1167" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> merged[<span class="st">'ls'</span>]</span>
<span id="cb29-1168"><a href="#cb29-1168" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(merged[[<span class="st">'mkt_excess'</span>, <span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'wml'</span>]])</span>
<span id="cb29-1169"><a href="#cb29-1169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1170"><a href="#cb29-1170" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">'HAC'</span>, cov_kwds<span class="op">=</span>{<span class="st">'maxlags'</span>: <span class="dv">6</span>})</span>
<span id="cb29-1171"><a href="#cb29-1171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1172"><a href="#cb29-1172" aria-hidden="true" tabindex="-1"></a>    alpha_ann <span class="op">=</span> model.params[<span class="st">'const'</span>] <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb29-1173"><a href="#cb29-1173" aria-hidden="true" tabindex="-1"></a>    alpha_t <span class="op">=</span> model.tvalues[<span class="st">'const'</span>]</span>
<span id="cb29-1174"><a href="#cb29-1174" aria-hidden="true" tabindex="-1"></a>    mkt_b <span class="op">=</span> model.params[<span class="st">'mkt_excess'</span>]</span>
<span id="cb29-1175"><a href="#cb29-1175" aria-hidden="true" tabindex="-1"></a>    smb_b <span class="op">=</span> model.params[<span class="st">'smb'</span>]</span>
<span id="cb29-1176"><a href="#cb29-1176" aria-hidden="true" tabindex="-1"></a>    hml_b <span class="op">=</span> model.params[<span class="st">'hml'</span>]</span>
<span id="cb29-1177"><a href="#cb29-1177" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> model.rsquared</span>
<span id="cb29-1178"><a href="#cb29-1178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1179"><a href="#cb29-1179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss"> </span><span class="sc">{</span>alpha_ann<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>alpha_t<span class="sc">:&gt;10.2f}</span><span class="ss"> "</span></span>
<span id="cb29-1180"><a href="#cb29-1180" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>mkt_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>smb_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>hml_b<span class="sc">:&gt;8.3f}</span><span class="ss"> </span><span class="sc">{</span>r2<span class="sc">:&gt;6.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-1181"><a href="#cb29-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1182"><a href="#cb29-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1183"><a href="#cb29-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">## Liquidity and Transaction Cost Estimation {#sec-liquidity-implementation}</span></span>
<span id="cb29-1184"><a href="#cb29-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1185"><a href="#cb29-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Translating Measures to Trading Costs</span></span>
<span id="cb29-1186"><a href="#cb29-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1187"><a href="#cb29-1187" aria-hidden="true" tabindex="-1"></a>For practitioners, the key question is: what does a given Amihud or spread value *mean* in terms of actual VND cost per trade? We calibrate the relationship between our low-frequency proxies and explicit trading costs.</span>
<span id="cb29-1188"><a href="#cb29-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1191"><a href="#cb29-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1192"><a href="#cb29-1192" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cost-calibration</span></span>
<span id="cb29-1193"><a href="#cb29-1193" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1194"><a href="#cb29-1194" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Calibrate liquidity proxies to estimated round-trip trading costs"</span></span>
<span id="cb29-1195"><a href="#cb29-1195" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_round_trip_cost(row):</span>
<span id="cb29-1196"><a href="#cb29-1196" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-1197"><a href="#cb29-1197" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate total round-trip trading cost (in %) from</span></span>
<span id="cb29-1198"><a href="#cb29-1198" aria-hidden="true" tabindex="-1"></a><span class="co">    multiple liquidity proxies.</span></span>
<span id="cb29-1199"><a href="#cb29-1199" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb29-1200"><a href="#cb29-1200" aria-hidden="true" tabindex="-1"></a><span class="co">    Components:</span></span>
<span id="cb29-1201"><a href="#cb29-1201" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Explicit: commission + tax (~0.35% round-trip)</span></span>
<span id="cb29-1202"><a href="#cb29-1202" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Spread cost: half-spread each way</span></span>
<span id="cb29-1203"><a href="#cb29-1203" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Price impact: function of trade size</span></span>
<span id="cb29-1204"><a href="#cb29-1204" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-1205"><a href="#cb29-1205" aria-hidden="true" tabindex="-1"></a>    explicit <span class="op">=</span> <span class="fl">0.0035</span>  <span class="co"># 35 bps round-trip</span></span>
<span id="cb29-1206"><a href="#cb29-1206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1207"><a href="#cb29-1207" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use Corwin-Schultz or quoted spread as spread estimate</span></span>
<span id="cb29-1208"><a href="#cb29-1208" aria-hidden="true" tabindex="-1"></a>    spread <span class="op">=</span> row.get(<span class="st">'cs_spread'</span>, row.get(<span class="st">'quoted_spread'</span>, <span class="fl">0.005</span>))</span>
<span id="cb29-1209"><a href="#cb29-1209" aria-hidden="true" tabindex="-1"></a>    spread_cost <span class="op">=</span> spread  <span class="co"># Full spread = round-trip cost</span></span>
<span id="cb29-1210"><a href="#cb29-1210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1211"><a href="#cb29-1211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price impact (approximate from Amihud)</span></span>
<span id="cb29-1212"><a href="#cb29-1212" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For a trade of 1% of daily volume</span></span>
<span id="cb29-1213"><a href="#cb29-1213" aria-hidden="true" tabindex="-1"></a>    amihud_raw <span class="op">=</span> row.get(<span class="st">'amihud_raw'</span>, <span class="dv">0</span>)</span>
<span id="cb29-1214"><a href="#cb29-1214" aria-hidden="true" tabindex="-1"></a>    impact <span class="op">=</span> amihud_raw <span class="op">*</span> <span class="fl">0.01</span>  <span class="co"># Rough approximation</span></span>
<span id="cb29-1215"><a href="#cb29-1215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1216"><a href="#cb29-1216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> explicit <span class="op">+</span> spread_cost <span class="op">+</span> impact</span>
<span id="cb29-1217"><a href="#cb29-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1218"><a href="#cb29-1218" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">'estimated_rtc'</span>] <span class="op">=</span> panel.<span class="bu">apply</span>(estimate_round_trip_cost, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-1219"><a href="#cb29-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1220"><a href="#cb29-1220" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution by size quintile</span></span>
<span id="cb29-1221"><a href="#cb29-1221" aria-hidden="true" tabindex="-1"></a>rtc_by_size <span class="op">=</span> (</span>
<span id="cb29-1222"><a href="#cb29-1222" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'size_quintile'</span>)[<span class="st">'estimated_rtc'</span>]</span>
<span id="cb29-1223"><a href="#cb29-1223" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">'mean'</span>, <span class="st">'median'</span>, <span class="st">'std'</span>])</span>
<span id="cb29-1224"><a href="#cb29-1224" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb29-1225"><a href="#cb29-1225" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1226"><a href="#cb29-1226" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Estimated Round-Trip Cost by Size Quintile (%):"</span>)</span>
<span id="cb29-1227"><a href="#cb29-1227" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((rtc_by_size <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>).to_string())</span>
<span id="cb29-1228"><a href="#cb29-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1229"><a href="#cb29-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1232"><a href="#cb29-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1233"><a href="#cb29-1233" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cost-distribution</span></span>
<span id="cb29-1234"><a href="#cb29-1234" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1235"><a href="#cb29-1235" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated round-trip trading costs by market cap quintile. Small-cap Vietnamese stocks have estimated costs of 3--8%, making high-frequency rebalancing strategies uneconomical. Even large-cap stocks carry costs of 0.5--1.5%, substantially higher than in developed markets."</span></span>
<span id="cb29-1236"><a href="#cb29-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plot estimated trading costs by size quintile"</span></span>
<span id="cb29-1237"><a href="#cb29-1237" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb29-1238"><a href="#cb29-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1239"><a href="#cb29-1239" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Distribution</span></span>
<span id="cb29-1240"><a href="#cb29-1240" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, color <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">'Q1 (Small)'</span>, <span class="st">'Q3'</span>, <span class="st">'Q5 (Large)'</span>],</span>
<span id="cb29-1241"><a href="#cb29-1241" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'#C0392B'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#27AE60'</span>]):</span>
<span id="cb29-1242"><a href="#cb29-1242" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> panel[panel[<span class="st">'size_quintile'</span>] <span class="op">==</span> q][<span class="st">'estimated_rtc'</span>].dropna()</span>
<span id="cb29-1243"><a href="#cb29-1243" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset <span class="op">&lt;</span> <span class="fl">0.15</span>]  <span class="co"># Trim extreme</span></span>
<span id="cb29-1244"><a href="#cb29-1244" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].hist(subset <span class="op">*</span> <span class="dv">100</span>, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb29-1245"><a href="#cb29-1245" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span>color, label<span class="op">=</span>q, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb29-1246"><a href="#cb29-1246" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Estimated Round-Trip Cost (%)'</span>)</span>
<span id="cb29-1247"><a href="#cb29-1247" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb29-1248"><a href="#cb29-1248" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Cost Distribution by Size'</span>)</span>
<span id="cb29-1249"><a href="#cb29-1249" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb29-1250"><a href="#cb29-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1251"><a href="#cb29-1251" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Time series of median cost</span></span>
<span id="cb29-1252"><a href="#cb29-1252" aria-hidden="true" tabindex="-1"></a>cost_ts <span class="op">=</span> (</span>
<span id="cb29-1253"><a href="#cb29-1253" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'estimated_rtc'</span>]</span>
<span id="cb29-1254"><a href="#cb29-1254" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb29-1255"><a href="#cb29-1255" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb29-1256"><a href="#cb29-1256" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1257"><a href="#cb29-1257" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(pd.to_datetime(cost_ts[<span class="st">'month_end'</span>]),</span>
<span id="cb29-1258"><a href="#cb29-1258" aria-hidden="true" tabindex="-1"></a>             cost_ts[<span class="st">'estimated_rtc'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb29-1259"><a href="#cb29-1259" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'#2C5F8A'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb29-1260"><a href="#cb29-1260" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb29-1261"><a href="#cb29-1261" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Median Round-Trip Cost (%)'</span>)</span>
<span id="cb29-1262"><a href="#cb29-1262" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: Aggregate Trading Costs Over Time'</span>)</span>
<span id="cb29-1263"><a href="#cb29-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1264"><a href="#cb29-1264" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-1265"><a href="#cb29-1265" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-1266"><a href="#cb29-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1267"><a href="#cb29-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1268"><a href="#cb29-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">### Strategy Implementability</span></span>
<span id="cb29-1269"><a href="#cb29-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1270"><a href="#cb29-1270" aria-hidden="true" tabindex="-1"></a>A critical application of liquidity measurement is testing whether a given anomaly strategy remains profitable after accounting for realistic trading costs. We compute net-of-cost returns for the liquidity-sorted portfolios themselves. This is an inherently conservative test because the illiquid long leg carries the highest costs.</span>
<span id="cb29-1271"><a href="#cb29-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1274"><a href="#cb29-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1275"><a href="#cb29-1275" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: net-of-cost</span></span>
<span id="cb29-1276"><a href="#cb29-1276" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1277"><a href="#cb29-1277" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute net-of-cost returns for illiquidity-sorted portfolios"</span></span>
<span id="cb29-1278"><a href="#cb29-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># For each quintile, estimate average monthly turnover and cost</span></span>
<span id="cb29-1279"><a href="#cb29-1279" aria-hidden="true" tabindex="-1"></a><span class="co"># and subtract from gross returns</span></span>
<span id="cb29-1280"><a href="#cb29-1280" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, ports <span class="kw">in</span> sort_results.items():</span>
<span id="cb29-1281"><a href="#cb29-1281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'long_short'</span> <span class="kw">not</span> <span class="kw">in</span> ports.columns:</span>
<span id="cb29-1282"><a href="#cb29-1282" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-1283"><a href="#cb29-1283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1284"><a href="#cb29-1284" aria-hidden="true" tabindex="-1"></a>    gross_ann <span class="op">=</span> ports[<span class="st">'long_short'</span>].mean() <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb29-1285"><a href="#cb29-1285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1286"><a href="#cb29-1286" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate costs: illiquid quintile has higher costs</span></span>
<span id="cb29-1287"><a href="#cb29-1287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assume monthly turnover of ~15% for long-short with monthly rebalancing</span></span>
<span id="cb29-1288"><a href="#cb29-1288" aria-hidden="true" tabindex="-1"></a>    turnover <span class="op">=</span> <span class="fl">0.15</span></span>
<span id="cb29-1289"><a href="#cb29-1289" aria-hidden="true" tabindex="-1"></a>    cost_q1 <span class="op">=</span> <span class="fl">0.003</span>  <span class="co"># 30 bps per trade for liquid stocks</span></span>
<span id="cb29-1290"><a href="#cb29-1290" aria-hidden="true" tabindex="-1"></a>    cost_q5 <span class="op">=</span> <span class="fl">0.015</span>  <span class="co"># 150 bps for illiquid stocks</span></span>
<span id="cb29-1291"><a href="#cb29-1291" aria-hidden="true" tabindex="-1"></a>    avg_cost <span class="op">=</span> (cost_q1 <span class="op">+</span> cost_q5) <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Average across long and short</span></span>
<span id="cb29-1292"><a href="#cb29-1292" aria-hidden="true" tabindex="-1"></a>    monthly_tc <span class="op">=</span> turnover <span class="op">*</span> avg_cost</span>
<span id="cb29-1293"><a href="#cb29-1293" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1294"><a href="#cb29-1294" aria-hidden="true" tabindex="-1"></a>    net_ann <span class="op">=</span> gross_ann <span class="op">-</span> monthly_tc <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb29-1295"><a href="#cb29-1295" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1296"><a href="#cb29-1296" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;18}</span><span class="ss">: Gross = </span><span class="sc">{</span>gross_ann<span class="op">*</span><span class="dv">100</span><span class="sc">:&gt;6.2f}</span><span class="ss">%, "</span></span>
<span id="cb29-1297"><a href="#cb29-1297" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"TC = </span><span class="sc">{</span>monthly_tc<span class="op">*</span><span class="dv">1200</span><span class="sc">:&gt;6.1f}</span><span class="ss"> bps/mo, "</span></span>
<span id="cb29-1298"><a href="#cb29-1298" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Net = </span><span class="sc">{</span>net_ann<span class="op">*</span><span class="dv">100</span><span class="sc">:&gt;6.2f}</span><span class="ss">%"</span>)</span>
<span id="cb29-1299"><a href="#cb29-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1300"><a href="#cb29-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1301"><a href="#cb29-1301" aria-hidden="true" tabindex="-1"></a><span class="fu">## Liquidity During Market Stress {#sec-liquidity-stress}</span></span>
<span id="cb29-1302"><a href="#cb29-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1303"><a href="#cb29-1303" aria-hidden="true" tabindex="-1"></a><span class="fu">### Flight to Liquidity</span></span>
<span id="cb29-1304"><a href="#cb29-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1305"><a href="#cb29-1305" aria-hidden="true" tabindex="-1"></a>During market stress, investors sell illiquid assets and buy liquid ones, which is a "flight to liquidity" that widens the return differential between liquid and illiquid stocks. @hameed2010stock show that this pattern is strongest when market returns are most negative.</span>
<span id="cb29-1306"><a href="#cb29-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1309"><a href="#cb29-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1310"><a href="#cb29-1310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flight-to-liquidity</span></span>
<span id="cb29-1311"><a href="#cb29-1311" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1312"><a href="#cb29-1312" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Test for flight-to-liquidity during market stress"</span></span>
<span id="cb29-1313"><a href="#cb29-1313" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Amihud-sorted portfolio returns with market returns</span></span>
<span id="cb29-1314"><a href="#cb29-1314" aria-hidden="true" tabindex="-1"></a>amihud_ports <span class="op">=</span> sort_results.get(<span class="st">'Amihud'</span>)</span>
<span id="cb29-1315"><a href="#cb29-1315" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> amihud_ports <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="st">'long_short'</span> <span class="kw">in</span> amihud_ports.columns:</span>
<span id="cb29-1316"><a href="#cb29-1316" aria-hidden="true" tabindex="-1"></a>    ftl_data <span class="op">=</span> pd.merge(</span>
<span id="cb29-1317"><a href="#cb29-1317" aria-hidden="true" tabindex="-1"></a>        amihud_ports[<span class="st">'long_short'</span>].to_frame(<span class="st">'illiq_premium'</span>),</span>
<span id="cb29-1318"><a href="#cb29-1318" aria-hidden="true" tabindex="-1"></a>        factors[[<span class="st">'month_end'</span>, <span class="st">'mkt_excess'</span>]].set_index(<span class="st">'month_end'</span>),</span>
<span id="cb29-1319"><a href="#cb29-1319" aria-hidden="true" tabindex="-1"></a>        left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb29-1320"><a href="#cb29-1320" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-1321"><a href="#cb29-1321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1322"><a href="#cb29-1322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Classify market states</span></span>
<span id="cb29-1323"><a href="#cb29-1323" aria-hidden="true" tabindex="-1"></a>    ftl_data[<span class="st">'mkt_state'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb29-1324"><a href="#cb29-1324" aria-hidden="true" tabindex="-1"></a>        ftl_data[<span class="st">'mkt_excess'</span>],</span>
<span id="cb29-1325"><a href="#cb29-1325" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf,</span>
<span id="cb29-1326"><a href="#cb29-1326" aria-hidden="true" tabindex="-1"></a>              ftl_data[<span class="st">'mkt_excess'</span>].quantile(<span class="fl">0.20</span>),</span>
<span id="cb29-1327"><a href="#cb29-1327" aria-hidden="true" tabindex="-1"></a>              ftl_data[<span class="st">'mkt_excess'</span>].quantile(<span class="fl">0.80</span>),</span>
<span id="cb29-1328"><a href="#cb29-1328" aria-hidden="true" tabindex="-1"></a>              np.inf],</span>
<span id="cb29-1329"><a href="#cb29-1329" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">'Bear (bottom 20%)'</span>, <span class="st">'Normal'</span>, <span class="st">'Bull (top 20%)'</span>]</span>
<span id="cb29-1330"><a href="#cb29-1330" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-1331"><a href="#cb29-1331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1332"><a href="#cb29-1332" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Illiquidity premium by market state</span></span>
<span id="cb29-1333"><a href="#cb29-1333" aria-hidden="true" tabindex="-1"></a>    state_premium <span class="op">=</span> (</span>
<span id="cb29-1334"><a href="#cb29-1334" aria-hidden="true" tabindex="-1"></a>        ftl_data.groupby(<span class="st">'mkt_state'</span>)[<span class="st">'illiq_premium'</span>]</span>
<span id="cb29-1335"><a href="#cb29-1335" aria-hidden="true" tabindex="-1"></a>        .agg([<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>])</span>
<span id="cb29-1336"><a href="#cb29-1336" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-1337"><a href="#cb29-1337" aria-hidden="true" tabindex="-1"></a>    state_premium[<span class="st">'ann_premium'</span>] <span class="op">=</span> state_premium[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb29-1338"><a href="#cb29-1338" aria-hidden="true" tabindex="-1"></a>    state_premium[<span class="st">'t_stat'</span>] <span class="op">=</span> (</span>
<span id="cb29-1339"><a href="#cb29-1339" aria-hidden="true" tabindex="-1"></a>        state_premium[<span class="st">'mean'</span>]</span>
<span id="cb29-1340"><a href="#cb29-1340" aria-hidden="true" tabindex="-1"></a>        <span class="op">/</span> (state_premium[<span class="st">'std'</span>] <span class="op">/</span> np.sqrt(state_premium[<span class="st">'count'</span>]))</span>
<span id="cb29-1341"><a href="#cb29-1341" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-1342"><a href="#cb29-1342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1343"><a href="#cb29-1343" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Illiquidity Premium by Market State:"</span>)</span>
<span id="cb29-1344"><a href="#cb29-1344" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(state_premium[[<span class="st">'ann_premium'</span>, <span class="st">'t_stat'</span>, <span class="st">'count'</span>]].<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb29-1345"><a href="#cb29-1345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1346"><a href="#cb29-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1349"><a href="#cb29-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1350"><a href="#cb29-1350" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-flight-to-liquidity</span></span>
<span id="cb29-1351"><a href="#cb29-1351" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1352"><a href="#cb29-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Illiquidity premium (Q5 minus Q1 Amihud) conditional on market returns. In bear markets, illiquid stocks underperform liquid stocks---the illiquidity premium reverses. In normal and bull markets, the premium is positive. This asymmetry reflects flight-to-liquidity behavior: investors flee illiquid stocks during stress, depressing their prices and generating negative contemporaneous returns."</span></span>
<span id="cb29-1353"><a href="#cb29-1353" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Bar chart of conditional illiquidity premium"</span></span>
<span id="cb29-1354"><a href="#cb29-1354" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb29-1355"><a href="#cb29-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1356"><a href="#cb29-1356" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'state_premium'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb29-1357"><a href="#cb29-1357" aria-hidden="true" tabindex="-1"></a>    colors_state <span class="op">=</span> [<span class="st">'#C0392B'</span>, <span class="st">'#F1C40F'</span>, <span class="st">'#27AE60'</span>]</span>
<span id="cb29-1358"><a href="#cb29-1358" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(<span class="bu">range</span>(<span class="bu">len</span>(state_premium)),</span>
<span id="cb29-1359"><a href="#cb29-1359" aria-hidden="true" tabindex="-1"></a>                   state_premium[<span class="st">'ann_premium'</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb29-1360"><a href="#cb29-1360" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>colors_state, alpha<span class="op">=</span><span class="fl">0.85</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb29-1361"><a href="#cb29-1361" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(state_premium)))</span>
<span id="cb29-1362"><a href="#cb29-1362" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(state_premium.index)</span>
<span id="cb29-1363"><a href="#cb29-1363" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Annualized Q5-Q1 Return (%)'</span>)</span>
<span id="cb29-1364"><a href="#cb29-1364" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Illiquidity Premium by Market State'</span>)</span>
<span id="cb29-1365"><a href="#cb29-1365" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb29-1366"><a href="#cb29-1366" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1367"><a href="#cb29-1367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(state_premium.iterrows()):</span>
<span id="cb29-1368"><a href="#cb29-1368" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'ann_premium'</span>] <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="fl">0.3</span>,</span>
<span id="cb29-1369"><a href="#cb29-1369" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"t=</span><span class="sc">{</span>row[<span class="st">'t_stat'</span>]<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb29-1370"><a href="#cb29-1370" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb29-1371"><a href="#cb29-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1372"><a href="#cb29-1372" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb29-1373"><a href="#cb29-1373" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-1374"><a href="#cb29-1374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1375"><a href="#cb29-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1376"><a href="#cb29-1376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Liquidity Co-Movement with Global Risk</span></span>
<span id="cb29-1377"><a href="#cb29-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1378"><a href="#cb29-1378" aria-hidden="true" tabindex="-1"></a>Vietnamese market liquidity may be driven by global risk factors, particularly for stocks held by foreign investors. We test whether global risk measures (VIX, USD strength) predict Vietnamese aggregate liquidity:</span>
<span id="cb29-1379"><a href="#cb29-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1382"><a href="#cb29-1382" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1383"><a href="#cb29-1383" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: global-risk</span></span>
<span id="cb29-1384"><a href="#cb29-1384" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1385"><a href="#cb29-1385" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Regress Vietnamese aggregate liquidity on global risk proxies"</span></span>
<span id="cb29-1386"><a href="#cb29-1386" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge aggregate liquidity with global variables</span></span>
<span id="cb29-1387"><a href="#cb29-1387" aria-hidden="true" tabindex="-1"></a>global_vars <span class="op">=</span> client.get_macro_data(</span>
<span id="cb29-1388"><a href="#cb29-1388" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'vix_close'</span>, <span class="st">'dxy_index'</span>],</span>
<span id="cb29-1389"><a href="#cb29-1389" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">'2008-01-01'</span>,</span>
<span id="cb29-1390"><a href="#cb29-1390" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">'2024-12-31'</span>,</span>
<span id="cb29-1391"><a href="#cb29-1391" aria-hidden="true" tabindex="-1"></a>    frequency<span class="op">=</span><span class="st">'monthly'</span></span>
<span id="cb29-1392"><a href="#cb29-1392" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1393"><a href="#cb29-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1394"><a href="#cb29-1394" aria-hidden="true" tabindex="-1"></a>agg_liq_global <span class="op">=</span> agg_liquidity.merge(</span>
<span id="cb29-1395"><a href="#cb29-1395" aria-hidden="true" tabindex="-1"></a>    global_vars, on<span class="op">=</span><span class="st">'month_end'</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb29-1396"><a href="#cb29-1396" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1397"><a href="#cb29-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1398"><a href="#cb29-1398" aria-hidden="true" tabindex="-1"></a><span class="co"># Changes in all variables</span></span>
<span id="cb29-1399"><a href="#cb29-1399" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'amihud_median'</span>, <span class="st">'vix_close'</span>, <span class="st">'dxy_index'</span>]:</span>
<span id="cb29-1400"><a href="#cb29-1400" aria-hidden="true" tabindex="-1"></a>    agg_liq_global[<span class="ss">f'd_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> agg_liq_global[col].diff()</span>
<span id="cb29-1401"><a href="#cb29-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1402"><a href="#cb29-1402" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb29-1403"><a href="#cb29-1403" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> agg_liq_global[<span class="st">'d_amihud_median'</span>].dropna()</span>
<span id="cb29-1404"><a href="#cb29-1404" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(</span>
<span id="cb29-1405"><a href="#cb29-1405" aria-hidden="true" tabindex="-1"></a>    agg_liq_global.loc[y.index, [<span class="st">'d_vix_close'</span>, <span class="st">'d_dxy_index'</span>]]</span>
<span id="cb29-1406"><a href="#cb29-1406" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1407"><a href="#cb29-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1408"><a href="#cb29-1408" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">'HAC'</span>, cov_kwds<span class="op">=</span>{<span class="st">'maxlags'</span>: <span class="dv">3</span>})</span>
<span id="cb29-1409"><a href="#cb29-1409" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Aggregate Illiquidity ~ Global Risk:"</span>)</span>
<span id="cb29-1410"><a href="#cb29-1410" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary().tables[<span class="dv">1</span>])</span>
<span id="cb29-1411"><a href="#cb29-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1412"><a href="#cb29-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1413"><a href="#cb29-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructing a Tradeable Liquidity Factor {#sec-liquidity-factor}</span></span>
<span id="cb29-1414"><a href="#cb29-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1415"><a href="#cb29-1415" aria-hidden="true" tabindex="-1"></a>Following @pastor2003liquidity, we construct an aggregate liquidity factor that can be used in asset pricing tests. The factor captures innovations in aggregate liquidity (unexpected changes in market-wide trading conditions).</span>
<span id="cb29-1416"><a href="#cb29-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1419"><a href="#cb29-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-1420"><a href="#cb29-1420" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: liquidity-factor</span></span>
<span id="cb29-1421"><a href="#cb29-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb29-1422"><a href="#cb29-1422" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct an aggregate liquidity innovation factor"</span></span>
<span id="cb29-1423"><a href="#cb29-1423" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Compute market-level Amihud as EW average</span></span>
<span id="cb29-1424"><a href="#cb29-1424" aria-hidden="true" tabindex="-1"></a>mkt_amihud <span class="op">=</span> (</span>
<span id="cb29-1425"><a href="#cb29-1425" aria-hidden="true" tabindex="-1"></a>    panel.groupby(<span class="st">'month_end'</span>)[<span class="st">'amihud'</span>]</span>
<span id="cb29-1426"><a href="#cb29-1426" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb29-1427"><a href="#cb29-1427" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'mkt_amihud'</span>)</span>
<span id="cb29-1428"><a href="#cb29-1428" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1429"><a href="#cb29-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1430"><a href="#cb29-1430" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Estimate AR(2) model for aggregate illiquidity</span></span>
<span id="cb29-1431"><a href="#cb29-1431" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'mkt_amihud_lag1'</span>] <span class="op">=</span> mkt_amihud[<span class="st">'mkt_amihud'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb29-1432"><a href="#cb29-1432" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'mkt_amihud_lag2'</span>] <span class="op">=</span> mkt_amihud[<span class="st">'mkt_amihud'</span>].shift(<span class="dv">2</span>)</span>
<span id="cb29-1433"><a href="#cb29-1433" aria-hidden="true" tabindex="-1"></a>mkt_amihud <span class="op">=</span> mkt_amihud.dropna()</span>
<span id="cb29-1434"><a href="#cb29-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1435"><a href="#cb29-1435" aria-hidden="true" tabindex="-1"></a>ar_model <span class="op">=</span> sm.OLS(</span>
<span id="cb29-1436"><a href="#cb29-1436" aria-hidden="true" tabindex="-1"></a>    mkt_amihud[<span class="st">'mkt_amihud'</span>],</span>
<span id="cb29-1437"><a href="#cb29-1437" aria-hidden="true" tabindex="-1"></a>    sm.add_constant(mkt_amihud[[<span class="st">'mkt_amihud_lag1'</span>, <span class="st">'mkt_amihud_lag2'</span>]])</span>
<span id="cb29-1438"><a href="#cb29-1438" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb29-1439"><a href="#cb29-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1440"><a href="#cb29-1440" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Residuals = liquidity innovations</span></span>
<span id="cb29-1441"><a href="#cb29-1441" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative innovation = liquidity improved (good)</span></span>
<span id="cb29-1442"><a href="#cb29-1442" aria-hidden="true" tabindex="-1"></a><span class="co"># Positive innovation = liquidity deteriorated (bad)</span></span>
<span id="cb29-1443"><a href="#cb29-1443" aria-hidden="true" tabindex="-1"></a>mkt_amihud[<span class="st">'liq_innovation'</span>] <span class="op">=</span> ar_model.resid</span>
<span id="cb29-1444"><a href="#cb29-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1445"><a href="#cb29-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Test whether liquidity innovations predict returns</span></span>
<span id="cb29-1446"><a href="#cb29-1446" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher sensitivity to negative innovations = higher expected return</span></span>
<span id="cb29-1447"><a href="#cb29-1447" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AR(2) Model for Aggregate Amihud:"</span>)</span>
<span id="cb29-1448"><a href="#cb29-1448" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared: </span><span class="sc">{</span>ar_model<span class="sc">.</span>rsquared<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-1449"><a href="#cb29-1449" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  AR(1) coef: </span><span class="sc">{</span>ar_model<span class="sc">.</span>params[<span class="st">'mkt_amihud_lag1'</span>]<span class="sc">:.3f}</span><span class="ss"> "</span></span>
<span id="cb29-1450"><a href="#cb29-1450" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(t=</span><span class="sc">{</span>ar_model<span class="sc">.</span>tvalues[<span class="st">'mkt_amihud_lag1'</span>]<span class="sc">:.2f}</span><span class="ss">)"</span>)</span>
<span id="cb29-1451"><a href="#cb29-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1452"><a href="#cb29-1452" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Estimate liquidity betas for each firm</span></span>
<span id="cb29-1453"><a href="#cb29-1453" aria-hidden="true" tabindex="-1"></a>panel_liq_beta <span class="op">=</span> panel.merge(</span>
<span id="cb29-1454"><a href="#cb29-1454" aria-hidden="true" tabindex="-1"></a>    mkt_amihud[[<span class="st">'liq_innovation'</span>]],</span>
<span id="cb29-1455"><a href="#cb29-1455" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'month_end'</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb29-1456"><a href="#cb29-1456" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1457"><a href="#cb29-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1458"><a href="#cb29-1458" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_liq_beta(group, min_obs<span class="op">=</span><span class="dv">36</span>):</span>
<span id="cb29-1459"><a href="#cb29-1459" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">'monthly_return'</span>, <span class="st">'liq_innovation'</span>])</span>
<span id="cb29-1460"><a href="#cb29-1460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> min_obs:</span>
<span id="cb29-1461"><a href="#cb29-1461" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-1462"><a href="#cb29-1462" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> g[<span class="st">'monthly_return'</span>]</span>
<span id="cb29-1463"><a href="#cb29-1463" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(g[<span class="st">'liq_innovation'</span>])</span>
<span id="cb29-1464"><a href="#cb29-1464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb29-1465"><a href="#cb29-1465" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb29-1466"><a href="#cb29-1466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> model.params[<span class="st">'liq_innovation'</span>]</span>
<span id="cb29-1467"><a href="#cb29-1467" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb29-1468"><a href="#cb29-1468" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-1469"><a href="#cb29-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1470"><a href="#cb29-1470" aria-hidden="true" tabindex="-1"></a>liq_betas <span class="op">=</span> (</span>
<span id="cb29-1471"><a href="#cb29-1471" aria-hidden="true" tabindex="-1"></a>    panel_liq_beta</span>
<span id="cb29-1472"><a href="#cb29-1472" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'ticker'</span>)</span>
<span id="cb29-1473"><a href="#cb29-1473" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_liq_beta)</span>
<span id="cb29-1474"><a href="#cb29-1474" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb29-1475"><a href="#cb29-1475" aria-hidden="true" tabindex="-1"></a>    .to_frame(<span class="st">'liq_beta'</span>)</span>
<span id="cb29-1476"><a href="#cb29-1476" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-1477"><a href="#cb29-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1478"><a href="#cb29-1478" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Liquidity Beta Distribution:"</span>)</span>
<span id="cb29-1479"><a href="#cb29-1479" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(liq_betas[<span class="st">'liq_beta'</span>].describe().<span class="bu">round</span>(<span class="dv">4</span>))</span>
<span id="cb29-1480"><a href="#cb29-1480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1481"><a href="#cb29-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1482"><a href="#cb29-1482" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Guidance for Vietnam {#sec-liquidity-practical}</span></span>
<span id="cb29-1483"><a href="#cb29-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1484"><a href="#cb29-1484" aria-hidden="true" tabindex="-1"></a>The analysis in this chapter yields the following recommendations:</span>
<span id="cb29-1485"><a href="#cb29-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1486"><a href="#cb29-1486" aria-hidden="true" tabindex="-1"></a>**For researchers:** The Amihud illiquidity ratio is the single best all-purpose liquidity proxy for Vietnamese equities. It has the highest coverage, the strongest cross-sectional return predictability, and the most robust relationship with firm size. When a second measure is needed for robustness, the zero-return proportion is the natural complement‚Äîit captures a different dimension (transaction cost threshold) and has near-complete coverage.</span>
<span id="cb29-1487"><a href="#cb29-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1488"><a href="#cb29-1488" aria-hidden="true" tabindex="-1"></a>**For portfolio construction:** Any backtest of a Vietnamese equity strategy should compute and report estimated round-trip costs by quintile. Strategies that load on the bottom two size quintiles face costs of 2--5% per round trip, making monthly rebalancing uneconomical. Quarterly or annual rebalancing with a turnover constraint is more realistic.</span>
<span id="cb29-1489"><a href="#cb29-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1490"><a href="#cb29-1490" aria-hidden="true" tabindex="-1"></a>**For risk management:** Monitor aggregate liquidity conditions using the cross-sectional median Amihud or the market-wide zero-return fraction. Liquidity deterioration predicts negative market returns and wider spreads in subsequent months. Tighten risk limits when aggregate illiquidity exceeds its 90th historical percentile.</span>
<span id="cb29-1491"><a href="#cb29-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1492"><a href="#cb29-1492" aria-hidden="true" tabindex="-1"></a>**For international comparisons:** When comparing Vietnamese factor premia to U.S. or other developed market evidence, always report results on a "liquid universe" subset (top 60% by market cap) alongside the full sample. Many anomalies that appear large in the full sample shrink substantially when restricted to stocks that can actually be traded at scale.</span>
<span id="cb29-1493"><a href="#cb29-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1494"><a href="#cb29-1494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary {#sec-liquidity-summary}</span></span>
<span id="cb29-1495"><a href="#cb29-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1496"><a href="#cb29-1496" aria-hidden="true" tabindex="-1"></a>Table @tbl-liquidity-summary shows different measures of liquidity.</span>
<span id="cb29-1497"><a href="#cb29-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1498"><a href="#cb29-1498" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Measure <span class="pp">|</span> Dimension <span class="pp">|</span> Coverage <span class="pp">|</span> Size Gradient <span class="pp">|</span> Return Predictive <span class="pp">|</span> Recommended Use <span class="pp">|</span></span>
<span id="cb29-1499"><a href="#cb29-1499" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------|------------|------------|------------|------------|------------|</span></span>
<span id="cb29-1500"><a href="#cb29-1500" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Amihud <span class="pp">|</span> Price impact <span class="pp">|</span> High <span class="pp">|</span> Very steep <span class="pp">|</span> Strong <span class="pp">|</span> Primary proxy; portfolio sorts; Fama-MacBeth <span class="pp">|</span></span>
<span id="cb29-1501"><a href="#cb29-1501" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Zero-Return <span class="pp">|</span> Transaction cost <span class="pp">|</span> Complete <span class="pp">|</span> Steep <span class="pp">|</span> Strong <span class="pp">|</span> Robustness check; emerging market studies <span class="pp">|</span></span>
<span id="cb29-1502"><a href="#cb29-1502" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Turnover <span class="pp">|</span> Trading activity <span class="pp">|</span> High <span class="pp">|</span> Moderate <span class="pp">|</span> Moderate <span class="pp">|</span> Volume-based filters; flow analysis <span class="pp">|</span></span>
<span id="cb29-1503"><a href="#cb29-1503" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Roll Spread <span class="pp">|</span> Tightness <span class="pp">|</span> Moderate <span class="pp">|</span> Moderate <span class="pp">|</span> Moderate <span class="pp">|</span> Spread estimation without bid-ask data <span class="pp">|</span></span>
<span id="cb29-1504"><a href="#cb29-1504" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Corwin-Schultz <span class="pp">|</span> Tightness <span class="pp">|</span> Moderate <span class="pp">|</span> Moderate <span class="pp">|</span> Moderate <span class="pp">|</span> High-low based spread; calibration <span class="pp">|</span></span>
<span id="cb29-1505"><a href="#cb29-1505" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Quoted Spread <span class="pp">|</span> Tightness <span class="pp">|</span> Variable <span class="pp">|</span> Steep <span class="pp">|</span> Strong <span class="pp">|</span> Direct measure when available <span class="pp">|</span></span>
<span id="cb29-1506"><a href="#cb29-1506" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Kyle Lambda <span class="pp">|</span> Price impact <span class="pp">|</span> Moderate <span class="pp">|</span> Steep <span class="pp">|</span> Strong <span class="pp">|</span> Market microstructure research <span class="pp">|</span></span>
<span id="cb29-1507"><a href="#cb29-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1508"><a href="#cb29-1508" aria-hidden="true" tabindex="-1"></a>: Summary of liquidity measure properties in the Vietnamese market. {#tbl-liquidity-summary}</span>
<span id="cb29-1509"><a href="#cb29-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1510"><a href="#cb29-1510" aria-hidden="true" tabindex="-1"></a>Liquidity is not a secondary consideration for Vietnamese equity research; it is a first-order determinant of which strategies are implementable, which anomalies are real, and which results are artifacts of trading in stocks that cannot actually be traded. Every empirical finding in this book should be evaluated through the lens of the liquidity analysis developed in this chapter.</span>
<span id="cb29-1511"><a href="#cb29-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1512"><a href="#cb29-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1513"><a href="#cb29-1513" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Exercises {#sec-liquidity-exercises}</span></span>
<span id="cb29-1514"><a href="#cb29-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1515"><a href="#cb29-1515" aria-hidden="true" tabindex="-1"></a><span class="co">1. **Closing percent quoted spread.** @fong2017best recommend the closing percent quoted spread as the best global liquidity proxy. Compute this as the closing bid-ask spread divided by the midpoint, averaged over the month. Compare its correlation with the Amihud measure and the Corwin-Schultz spread. Does the recommendation hold for Vietnam?</span></span>
<span id="cb29-1516"><a href="#cb29-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1517"><a href="#cb29-1517" aria-hidden="true" tabindex="-1"></a><span class="co">2. **Liquidity-adjusted momentum.** Compute momentum portfolio returns (12-1 month) separately within each Amihud illiquidity tercile. Is the momentum premium concentrated in illiquid stocks? What does this imply about the implementability of momentum strategies in Vietnam? Connect your findings to @novy2016taxonomy.</span></span>
<span id="cb29-1518"><a href="#cb29-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1519"><a href="#cb29-1519" aria-hidden="true" tabindex="-1"></a><span class="co">3. **Foreign investor liquidity demand.** Using foreign buy and sell volume data, compute a net foreign flow measure for each stock. Test whether foreign net buying predicts next-month liquidity improvements (lower Amihud, lower spreads). Does foreign ownership create a liquidity externality?</span></span>
<span id="cb29-1520"><a href="#cb29-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1521"><a href="#cb29-1521" aria-hidden="true" tabindex="-1"></a><span class="co">4. **Intraday liquidity patterns.** If intraday data are available, compute the Amihud ratio separately for the opening call auction, the morning continuous session, and the afternoon continuous session. How does intraday liquidity variation compare to cross-sectional variation?</span></span>
<span id="cb29-1522"><a href="#cb29-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1523"><a href="#cb29-1523" aria-hidden="true" tabindex="-1"></a><span class="co">5. **Liquidity and earnings announcements.** Test whether liquidity deteriorates before and improves after quarterly earnings announcements. Use an event study framework with the Amihud ratio as the dependent variable. Is the pre-announcement illiquidity increase consistent with the @glosten1985bid adverse selection model?</span></span>
<span id="cb29-1524"><a href="#cb29-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1525"><a href="#cb29-1525" aria-hidden="true" tabindex="-1"></a><span class="co">6. **Market-making profitability.** Using the Roll spread as a proxy for the bid-ask bounce, estimate the gross profit a hypothetical market maker would earn from providing liquidity in Vietnamese stocks. How does this compare to the explicit cost of capital for market making?</span></span>
<span id="cb29-1526"><a href="#cb29-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1527"><a href="#cb29-1527" aria-hidden="true" tabindex="-1"></a><span class="co">7. **Liquidity factor mimicking portfolio.** Construct a tradeable liquidity factor by sorting stocks into deciles based on their liquidity beta (sensitivity to aggregate liquidity innovations). The long-short return of this factor should be correlated with aggregate liquidity changes. Test whether this factor earns a significant premium and whether it explains returns beyond the Fama-French factors.</span></span>
<span id="cb29-1528"><a href="#cb29-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1529"><a href="#cb29-1529" aria-hidden="true" tabindex="-1"></a><span class="co">8. **COVID-19 liquidity shock.** Analyze the liquidity dynamics around the March 2020 COVID-19 market crash. How quickly did aggregate liquidity deteriorate? Which firms experienced the largest liquidity drops? Did the SBV's policy responses (rate cuts, reserve requirement reductions) improve liquidity, and with what lag? --&gt;</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/16_liquidity_and_turnover_measures.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>