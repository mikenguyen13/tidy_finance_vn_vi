<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>40&nbsp; Event Studies in Finance ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./61_tail_risk_extreme_events.html" rel="next">
<link href="./57_exchange_rate.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-72097b8a1e3a3da1d7b8bbfaaf81c3d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="40&nbsp; Event Studies in Finance ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta property="og:description" content="">
<meta property="og:image" content="https://mikenguyen13.github.io/tidy_finance_vn_vi/60_event_studies_files/figure-html/fig-car-dynamics-output-1.png">
<meta property="og:site_name" content="T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta property="og:image:height" content="1204">
<meta property="og:image:width" content="1926">
<meta name="twitter:title" content="40&nbsp; Event Studies in Finance ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://mikenguyen13.github.io/tidy_finance_vn_vi/60_event_studies_files/figure-html/fig-car-dynamics-output-1.png">
<meta name="twitter:image-height" content="1204">
<meta name="twitter:image-width" content="1926">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn/"> 
<span class="menu-text">üìò English Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn_vi/"> 
<span class="menu-text">üìó S√°ch Ti·∫øng Vi·ªát</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn_vi" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./60_event_studies.html">M√¥ h√¨nh t√†i ch√≠nh n√¢ng cao</a></li><li class="breadcrumb-item"><a href="./60_event_studies.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L·ªùi n√≥i ƒë·∫ßu</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Th·ªã tr∆∞·ªùng t√†i ch√≠nh, th·ªÉ ch·∫ø v√† d·ªØ li·ªáu Vi·ªát Nam</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">N·ªÅn t·∫£ng th·ªÉ ch·∫ø v√† c·∫•u tr√∫c th·ªã tr∆∞·ªùng c·ªßa th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Accessing and Managing VN Financial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datacore Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_market_microstructure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_risk_free_rate_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk-Free Rate Construction in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_compound_return.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Compound Returns</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">X√¢y d·ª±ng danh m·ª•c ƒë·∫ßu t∆∞, r·ªßi ro v√† c∆° h·ªçc th·ª±c nghi·ªám</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_size_sorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Size Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_value_bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Value and Bivariate Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_portfolio_weighting_and_rebalancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Portfolio Weighting and Rebalancing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_missing_data_and_survivorship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Missing Data and Survivorship Bias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_liquidity_and_turnover_measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh ƒë·ªãnh gi√° t√†i s·∫£n</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_momentum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_factor_construction_principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Factor Construction Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_factor_zoo_and_multiple_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Factor Zoo and Multiple Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_time_series_vs_cross_section.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Time-Series vs.&nbsp;Cross-Sectional Factor Tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">C√°c y·∫øu t·ªë c∆° b·∫£n c·ªßa c√¥ng ty, ƒë·ªãnh gi√° v√† t√≠n hi·ªáu doanh nghi·ªáp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_info_earnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Information Content of Earnings Announcements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_accruals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Accruals, Earnings Persistence, and Market Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_earning_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./35_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./36_valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./37_disclosure_quality_and_timing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Disclosure Quality and Timing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./38_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./39_divop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Quy·ªÅn s·ªü h·ªØu, ma s√°t th·ªã tr∆∞·ªùng v√† r·ªßi ro qu·ªëc t·∫ø</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52_institutional_trade_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Institutional Trades, Flows, and Turnover Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./53_governance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Corporate Governance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./54_return_gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Return Gap: Measuring Unobserved Actions of Fund Managers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./55_price_limits_and_volatility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Price Limits and Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./56_market_integration_and_segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Market Integration and Segmentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./57_exchange_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Exchange Rate Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh t√†i ch√≠nh n√¢ng cao</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_event_studies.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./61_tail_risk_extreme_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Tail Risk and Extreme Events</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./62_corporate_finance_estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Corporate Finance Estimators and Identification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./63_structural_models_finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Structural Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">D·ªØ li·ªáu thay th·∫ø v√† Tr√≠ tu·ªá nh√¢n t·∫°o trong t√†i ch√≠nh</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_textual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Textual Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./71_image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Image and Visual Data in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./73_networks_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Networks and Graphs in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./74_multimodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Multimodal Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-event-studies-matter" id="toc-why-event-studies-matter" class="nav-link active" data-scroll-target="#why-event-studies-matter"><span class="header-section-number">40.0.1</span> Why Event Studies Matter</a></li>
  <li><a href="#literature-review-and-methodological-evolution" id="toc-literature-review-and-methodological-evolution" class="nav-link" data-scroll-target="#literature-review-and-methodological-evolution"><span class="header-section-number">40.1</span> Literature Review and Methodological Evolution</a>
  <ul class="collapse">
  <li><a href="#the-classical-framework-1969-1985" id="toc-the-classical-framework-1969-1985" class="nav-link" data-scroll-target="#the-classical-framework-1969-1985"><span class="header-section-number">40.1.1</span> The Classical Framework (1969-1985)</a></li>
  <li><a href="#risk-model-refinements-1992-2015" id="toc-risk-model-refinements-1992-2015" class="nav-link" data-scroll-target="#risk-model-refinements-1992-2015"><span class="header-section-number">40.1.2</span> Risk Model Refinements (1992-2015)</a></li>
  <li><a href="#testing-for-abnormal-returns-1976-2010" id="toc-testing-for-abnormal-returns-1976-2010" class="nav-link" data-scroll-target="#testing-for-abnormal-returns-1976-2010"><span class="header-section-number">40.1.3</span> Testing for Abnormal Returns (1976-2010)</a></li>
  <li><a href="#cars-versus-bhars" id="toc-cars-versus-bhars" class="nav-link" data-scroll-target="#cars-versus-bhars"><span class="header-section-number">40.1.4</span> CARs versus BHARs</a></li>
  <li><a href="#emerging-market-considerations" id="toc-emerging-market-considerations" class="nav-link" data-scroll-target="#emerging-market-considerations"><span class="header-section-number">40.1.5</span> Emerging Market Considerations</a></li>
  </ul></li>
  <li><a href="#mathematical-framework" id="toc-mathematical-framework" class="nav-link" data-scroll-target="#mathematical-framework"><span class="header-section-number">40.2</span> Mathematical Framework</a>
  <ul class="collapse">
  <li><a href="#timeline-and-windows" id="toc-timeline-and-windows" class="nav-link" data-scroll-target="#timeline-and-windows"><span class="header-section-number">40.2.1</span> Timeline and Windows</a></li>
  <li><a href="#normal-return-models" id="toc-normal-return-models" class="nav-link" data-scroll-target="#normal-return-models"><span class="header-section-number">40.2.2</span> Normal Return Models</a></li>
  <li><a href="#aggregation-cars-and-bhars" id="toc-aggregation-cars-and-bhars" class="nav-link" data-scroll-target="#aggregation-cars-and-bhars"><span class="header-section-number">40.2.3</span> Aggregation: CARs and BHARs</a></li>
  <li><a href="#standardized-returns" id="toc-standardized-returns" class="nav-link" data-scroll-target="#standardized-returns"><span class="header-section-number">40.2.4</span> Standardized Returns</a></li>
  <li><a href="#test-statistics" id="toc-test-statistics" class="nav-link" data-scroll-target="#test-statistics"><span class="header-section-number">40.2.5</span> Test Statistics</a></li>
  </ul></li>
  <li><a href="#python-implementation" id="toc-python-implementation" class="nav-link" data-scroll-target="#python-implementation"><span class="header-section-number">40.3</span> Python Implementation</a>
  <ul class="collapse">
  <li><a href="#design-philosophy" id="toc-design-philosophy" class="nav-link" data-scroll-target="#design-philosophy"><span class="header-section-number">40.3.1</span> Design Philosophy</a></li>
  <li><a href="#setup-and-imports" id="toc-setup-and-imports" class="nav-link" data-scroll-target="#setup-and-imports"><span class="header-section-number">40.3.2</span> Setup and Imports</a></li>
  <li><a href="#configuration" id="toc-configuration" class="nav-link" data-scroll-target="#configuration"><span class="header-section-number">40.3.3</span> Configuration</a></li>
  <li><a href="#step-1-trading-calendar-construction" id="toc-step-1-trading-calendar-construction" class="nav-link" data-scroll-target="#step-1-trading-calendar-construction"><span class="header-section-number">40.3.4</span> Step 1: Trading Calendar Construction</a></li>
  <li><a href="#step-2-event-date-alignment" id="toc-step-2-event-date-alignment" class="nav-link" data-scroll-target="#step-2-event-date-alignment"><span class="header-section-number">40.3.5</span> Step 2: Event Date Alignment</a></li>
  <li><a href="#step-3-data-extraction-and-factor-merging" id="toc-step-3-data-extraction-and-factor-merging" class="nav-link" data-scroll-target="#step-3-data-extraction-and-factor-merging"><span class="header-section-number">40.3.6</span> Step 3: Data Extraction and Factor Merging</a></li>
  <li><a href="#step-4-risk-model-estimation" id="toc-step-4-risk-model-estimation" class="nav-link" data-scroll-target="#step-4-risk-model-estimation"><span class="header-section-number">40.3.7</span> Step 4: Risk Model Estimation</a></li>
  <li><a href="#step-5-abnormal-return-computation" id="toc-step-5-abnormal-return-computation" class="nav-link" data-scroll-target="#step-5-abnormal-return-computation"><span class="header-section-number">40.3.8</span> Step 5: Abnormal Return Computation</a></li>
  <li><a href="#step-6-comprehensive-test-statistics" id="toc-step-6-comprehensive-test-statistics" class="nav-link" data-scroll-target="#step-6-comprehensive-test-statistics"><span class="header-section-number">40.3.9</span> Step 6: Comprehensive Test Statistics</a></li>
  <li><a href="#step-7-publication-ready-visualization" id="toc-step-7-publication-ready-visualization" class="nav-link" data-scroll-target="#step-7-publication-ready-visualization"><span class="header-section-number">40.3.10</span> Step 7: Publication-Ready Visualization</a></li>
  <li><a href="#the-master-pipeline" id="toc-the-master-pipeline" class="nav-link" data-scroll-target="#the-master-pipeline"><span class="header-section-number">40.3.11</span> The Master Pipeline</a></li>
  </ul></li>
  <li><a href="#demonstration-with-simulated-data" id="toc-demonstration-with-simulated-data" class="nav-link" data-scroll-target="#demonstration-with-simulated-data"><span class="header-section-number">40.4</span> Demonstration with Simulated Data</a>
  <ul class="collapse">
  <li><a href="#running-the-full-pipeline" id="toc-running-the-full-pipeline" class="nav-link" data-scroll-target="#running-the-full-pipeline"><span class="header-section-number">40.4.1</span> Running the Full Pipeline</a></li>
  <li><a href="#visualizing-results" id="toc-visualizing-results" class="nav-link" data-scroll-target="#visualizing-results"><span class="header-section-number">40.4.2</span> Visualizing Results</a></li>
  <li><a href="#complete-test-statistics" id="toc-complete-test-statistics" class="nav-link" data-scroll-target="#complete-test-statistics"><span class="header-section-number">40.4.3</span> Complete Test Statistics</a></li>
  <li><a href="#running-multiple-models-for-robustness" id="toc-running-multiple-models-for-robustness" class="nav-link" data-scroll-target="#running-multiple-models-for-robustness"><span class="header-section-number">40.4.4</span> Running Multiple Models for Robustness</a></li>
  </ul></li>
  <li><a href="#how-to-use-this-framework-with-your-data" id="toc-how-to-use-this-framework-with-your-data" class="nav-link" data-scroll-target="#how-to-use-this-framework-with-your-data"><span class="header-section-number">40.5</span> How to Use This Framework with Your Data</a>
  <ul class="collapse">
  <li><a href="#required-data-format" id="toc-required-data-format" class="nav-link" data-scroll-target="#required-data-format"><span class="header-section-number">40.5.1</span> Required Data Format</a></li>
  <li><a href="#minimal-usage-example" id="toc-minimal-usage-example" class="nav-link" data-scroll-target="#minimal-usage-example"><span class="header-section-number">40.5.2</span> Minimal Usage Example</a></li>
  </ul></li>
  <li><a href="#demonstration-with-vietnamese-market-data" id="toc-demonstration-with-vietnamese-market-data" class="nav-link" data-scroll-target="#demonstration-with-vietnamese-market-data"><span class="header-section-number">40.6</span> Demonstration with Vietnamese Market Data</a>
  <ul class="collapse">
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data"><span class="header-section-number">40.6.1</span> Loading the Data</a></li>
  <li><a href="#creating-sample-events" id="toc-creating-sample-events" class="nav-link" data-scroll-target="#creating-sample-events"><span class="header-section-number">40.6.2</span> Creating Sample Events</a></li>
  <li><a href="#daily-event-study-fama-french-3-factor-model" id="toc-daily-event-study-fama-french-3-factor-model" class="nav-link" data-scroll-target="#daily-event-study-fama-french-3-factor-model"><span class="header-section-number">40.6.3</span> Daily Event Study: Fama-French 3-Factor Model</a></li>
  <li><a href="#visualizing-daily-results" id="toc-visualizing-daily-results" class="nav-link" data-scroll-target="#visualizing-daily-results"><span class="header-section-number">40.6.4</span> Visualizing Daily Results</a></li>
  <li><a href="#complete-test-statistics-daily" id="toc-complete-test-statistics-daily" class="nav-link" data-scroll-target="#complete-test-statistics-daily"><span class="header-section-number">40.6.5</span> Complete Test Statistics (Daily)</a></li>
  <li><a href="#robustness-multiple-risk-models-daily" id="toc-robustness-multiple-risk-models-daily" class="nav-link" data-scroll-target="#robustness-multiple-risk-models-daily"><span class="header-section-number">40.6.6</span> Robustness: Multiple Risk Models (Daily)</a></li>
  <li><a href="#robustness-multiple-event-windows" id="toc-robustness-multiple-event-windows" class="nav-link" data-scroll-target="#robustness-multiple-event-windows"><span class="header-section-number">40.6.7</span> Robustness: Multiple Event Windows</a></li>
  <li><a href="#monthly-event-study-fama-french-3-factor-model" id="toc-monthly-event-study-fama-french-3-factor-model" class="nav-link" data-scroll-target="#monthly-event-study-fama-french-3-factor-model"><span class="header-section-number">40.6.8</span> Monthly Event Study: Fama-French 3-Factor Model</a></li>
  <li><a href="#daily-event-study-fama-french-5-factor-model" id="toc-daily-event-study-fama-french-5-factor-model" class="nav-link" data-scroll-target="#daily-event-study-fama-french-5-factor-model"><span class="header-section-number">40.6.9</span> Daily Event Study: Fama-French 5-Factor Model</a></li>
  <li><a href="#comparing-ff3-vs-ff5-estimation-quality" id="toc-comparing-ff3-vs-ff5-estimation-quality" class="nav-link" data-scroll-target="#comparing-ff3-vs-ff5-estimation-quality"><span class="header-section-number">40.6.10</span> Comparing FF3 vs FF5 Estimation Quality</a></li>
  <li><a href="#event-level-detail" id="toc-event-level-detail" class="nav-link" data-scroll-target="#event-level-detail"><span class="header-section-number">40.6.11</span> Event-Level Detail</a></li>
  <li><a href="#daily-abnormal-return-dynamics" id="toc-daily-abnormal-return-dynamics" class="nav-link" data-scroll-target="#daily-abnormal-return-dynamics"><span class="header-section-number">40.6.12</span> Daily Abnormal Return Dynamics</a></li>
  <li><a href="#summary-of-key-findings" id="toc-summary-of-key-findings" class="nav-link" data-scroll-target="#summary-of-key-findings"><span class="header-section-number">40.6.13</span> Summary of Key Findings</a></li>
  </ul></li>
  <li><a href="#practical-recommendations" id="toc-practical-recommendations" class="nav-link" data-scroll-target="#practical-recommendations"><span class="header-section-number">40.7</span> Practical Recommendations</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/60_event_studies.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./60_event_studies.html">M√¥ h√¨nh t√†i ch√≠nh n√¢ng cao</a></li><li class="breadcrumb-item"><a href="./60_event_studies.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Event studies constitute one of the most enduring and widely deployed empirical methodologies in financial economics. At their core, event studies measure the impact of a specific event on the value of a firm by examining <strong>abnormal security returns</strong> around the time the event occurs. The methodology rests on a simple premise: if capital markets are informationally efficient, the effect of an event will be reflected immediately in security prices, and any deviation from ‚Äúnormal‚Äù expected returns can be attributed to the event itself.</p>
<p>Since the pioneering work of <span class="citation" data-cites="fama1969adjustment">Eugene F. Fama et al. (<a href="references.html#ref-fama1969adjustment" role="doc-biblioref">1969</a>)</span>, who studied how stock prices adjust to new information around stock splits, event studies have become a cornerstone of empirical research across finance, accounting, economics, and law. <span class="citation" data-cites="ball2013empirical">Ball and Brown (<a href="references.html#ref-ball2013empirical" role="doc-biblioref">2013</a>)</span> demonstrated that accounting earnings announcements convey information to the market, a finding that launched decades of research in accounting and disclosure. The methodology has since been refined through contributions by <span class="citation" data-cites="brown1980measuring">Brown and Warner (<a href="references.html#ref-brown1980measuring" role="doc-biblioref">1980</a>)</span> and <span class="citation" data-cites="brown1985using">Brown and Warner (<a href="references.html#ref-brown1985using" role="doc-biblioref">1985</a>)</span>, who established the statistical properties of event study methods, and <span class="citation" data-cites="mackinlay1997event">MacKinlay (<a href="references.html#ref-mackinlay1997event" role="doc-biblioref">1997</a>)</span> codified best practices that remain standard today.</p>
<p>The breadth of applications is remarkable. Event studies have been used to examine the wealth effects of mergers and acquisitions <span class="citation" data-cites="jensen1983market andrade2001new">(<a href="references.html#ref-jensen1983market" role="doc-biblioref">Jensen and Ruback 1983</a>; <a href="references.html#ref-andrade2001new" role="doc-biblioref">Andrade, Mitchell, and Stafford 2001</a>)</span>, earnings announcements <span class="citation" data-cites="bernard1989post">(<a href="references.html#ref-bernard1989post" role="doc-biblioref">Bernard and Thomas 1989</a>)</span>, dividend changes <span class="citation" data-cites="aharony1980quarterly">(<a href="references.html#ref-aharony1980quarterly" role="doc-biblioref">Aharony and Swary 1980</a>)</span>, regulatory changes <span class="citation" data-cites="schwert1981using">(<a href="references.html#ref-schwert1981using" role="doc-biblioref">Schwert 1981</a>)</span>, executive turnover <span class="citation" data-cites="warner1988stock">(<a href="references.html#ref-warner1988stock" role="doc-biblioref">Warner, Watts, and Wruck 1988</a>)</span>, and macroeconomic announcements <span class="citation" data-cites="flannery2002macroeconomic">(<a href="references.html#ref-flannery2002macroeconomic" role="doc-biblioref">Flannery and Protopapadakis 2002</a>)</span>. In law and economics, event studies serve as the primary tool for measuring damages in securities fraud litigation <span class="citation" data-cites="mitchell1993role">(<a href="references.html#ref-mitchell1993role" role="doc-biblioref">Mitchell and Netter 1993</a>)</span> and assessing the impact of regulatory interventions <span class="citation" data-cites="binder1998event">(<a href="references.html#ref-binder1998event" role="doc-biblioref">Binder 1998</a>)</span>. <span class="citation" data-cites="kothari2007econometrics">Kothari and Warner (<a href="references.html#ref-kothari2007econometrics" role="doc-biblioref">2007</a>)</span> documented over 500 published event studies in the top five finance journals alone between 1974 and 2000.</p>
<section id="why-event-studies-matter" class="level3" data-number="40.0.1">
<h3 data-number="40.0.1" class="anchored" data-anchor-id="why-event-studies-matter"><span class="header-section-number">40.0.1</span> Why Event Studies Matter</h3>
<p>The enduring popularity of event studies stems from several compelling properties:</p>
<ul>
<li><p><strong>Direct measurement of economic significance.</strong> Unlike regression-based approaches that estimate associations, event studies directly quantify the dollar impact of events on firm value. A cumulative abnormal return (CAR) of 3% for a firm with $10 billion market capitalization translates to $300 million in wealth creation, which is a tangible, economically meaningful magnitude.</p></li>
<li><p><strong>Minimal maintained assumptions.</strong> The methodology requires only semi-strong market efficiency (i.e., prices reflect publicly available information), a weaker assumption than many alternatives.</p></li>
<li><p><strong>Statistical power.</strong> Daily event studies have remarkable power to detect abnormal performance, even with modest sample sizes. <span class="citation" data-cites="brown1985using">Brown and Warner (<a href="references.html#ref-brown1985using" role="doc-biblioref">1985</a>)</span> demonstrated that the market model detects abnormal returns of 1% or more with high reliability using samples as small as 20 securities.</p></li>
<li><p><strong>Versatility.</strong> The basic framework accommodates events that are firm-specific or market-wide, anticipated or surprising, and can be adapted to various asset classes and market structures.</p></li>
</ul>
<hr>
</section>
<section id="literature-review-and-methodological-evolution" class="level2" data-number="40.1">
<h2 data-number="40.1" class="anchored" data-anchor-id="literature-review-and-methodological-evolution"><span class="header-section-number">40.1</span> Literature Review and Methodological Evolution</h2>
<section id="the-classical-framework-1969-1985" class="level3" data-number="40.1.1">
<h3 data-number="40.1.1" class="anchored" data-anchor-id="the-classical-framework-1969-1985"><span class="header-section-number">40.1.1</span> The Classical Framework (1969-1985)</h3>
<p>The modern event study traces its origins to <span class="citation" data-cites="fama1969adjustment">Eugene F. Fama et al. (<a href="references.html#ref-fama1969adjustment" role="doc-biblioref">1969</a>)</span>, hereafter FFJR, who examined monthly stock returns around 940 stock splits between 1927 and 1959. Their key innovation was the use of the <strong>market model</strong> to decompose returns into expected (normal) and unexpected (abnormal) components.</p>
<p><span class="citation" data-cites="ball2013empirical">Ball and Brown (<a href="references.html#ref-ball2013empirical" role="doc-biblioref">2013</a>)</span> independently developed a similar approach to study earnings announcements, establishing the information content of accounting data. It was a finding with profound implications for both the efficient markets hypothesis and the relevance of financial reporting.</p>
<p><span class="citation" data-cites="brown1980measuring">Brown and Warner (<a href="references.html#ref-brown1980measuring" role="doc-biblioref">1980</a>)</span> provided the first systematic analysis of event study methodology using simulation. Their study of monthly data established several important results: (i) the simple market model performs at least as well as more complex models, (ii) value-weighted market indices can lead to misspecification when the sample is tilted toward smaller firms, and (iii) the standard cross-sectional test has well-specified size under the null hypothesis. Their follow-up study <span class="citation" data-cites="brown1985using">(<a href="references.html#ref-brown1985using" role="doc-biblioref">Brown and Warner 1985</a>)</span> extended the analysis to daily data, documenting the importance of non-normality in daily returns and the increased power of daily versus monthly studies.</p>
</section>
<section id="risk-model-refinements-1992-2015" class="level3" data-number="40.1.2">
<h3 data-number="40.1.2" class="anchored" data-anchor-id="risk-model-refinements-1992-2015"><span class="header-section-number">40.1.2</span> Risk Model Refinements (1992-2015)</h3>
<p>The advent of the <strong>Fama-French three-factor model</strong> <span class="citation" data-cites="Fama1993">(<a href="references.html#ref-Fama1993" role="doc-biblioref">Eugene F. Fama and French 1993</a>)</span> represented a major advance in modeling expected returns. Adding size (SMB) and value (HML) factors to the market model improved the cross-sectional fit of expected returns considerably. <span class="citation" data-cites="Carhart1997">Carhart (<a href="references.html#ref-Carhart1997" role="doc-biblioref">1997</a>)</span> augmented this with a momentum factor (UMD), yielding the four-factor model that became standard in event studies through the 2000s. <span class="citation" data-cites="FamaFrench2015">Eugene F. Fama and French (<a href="references.html#ref-FamaFrench2015" role="doc-biblioref">2015</a>)</span> subsequently introduced profitability (RMW) and investment (CMA) factors in their five-factor model.</p>
<p>The choice of risk model matters for event studies primarily in <strong>long-horizon settings</strong>. <span class="citation" data-cites="kothari2007econometrics">Kothari and Warner (<a href="references.html#ref-kothari2007econometrics" role="doc-biblioref">2007</a>)</span> showed that for short-window studies (3-5 days), the market model and multi-factor models produce virtually identical results because the incremental factors explain very little daily return variation for individual firms. However, for event windows exceeding 20 trading days, model choice can materially affect inferences.</p>
</section>
<section id="testing-for-abnormal-returns-1976-2010" class="level3" data-number="40.1.3">
<h3 data-number="40.1.3" class="anchored" data-anchor-id="testing-for-abnormal-returns-1976-2010"><span class="header-section-number">40.1.3</span> Testing for Abnormal Returns (1976-2010)</h3>
<p>The statistical testing of abnormal returns has evolved considerably:</p>
<div id="tbl-tests" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tests-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.1: Summary of major event study test statistics
</figcaption>
<div aria-describedby="tbl-tests-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 26%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Year</th>
<th>Key Property</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Patell Z</strong></td>
<td>1976</td>
<td>Standardizes by estimation-period <span class="math inline">\(\sigma\)</span>; weights firms inversely by volatility</td>
<td><span class="citation" data-cites="patell1976corporate">Patell (<a href="references.html#ref-patell1976corporate" role="doc-biblioref">1976</a>)</span></td>
</tr>
<tr class="even">
<td><strong>Cross-Sectional</strong> <span class="math inline">\(t\)</span></td>
<td>1980</td>
<td>Allows event-induced variance change</td>
<td><span class="citation" data-cites="brown1980measuring">Brown and Warner (<a href="references.html#ref-brown1980measuring" role="doc-biblioref">1980</a>)</span></td>
</tr>
<tr class="odd">
<td><strong>BMP</strong></td>
<td>1991</td>
<td>Robust to event-induced variance</td>
<td><span class="citation" data-cites="boehmer1991event">Boehmer, Masumeci, and Poulsen (<a href="references.html#ref-boehmer1991event" role="doc-biblioref">1991</a>)</span></td>
</tr>
<tr class="even">
<td><strong>Corrado Rank</strong></td>
<td>1989</td>
<td>Non-parametric; robust to non-normality</td>
<td><span class="citation" data-cites="corrado1989nonparametric">Corrado (<a href="references.html#ref-corrado1989nonparametric" role="doc-biblioref">1989</a>)</span></td>
</tr>
<tr class="odd">
<td><strong>Generalized Sign</strong></td>
<td>1992</td>
<td>Non-parametric; uses estimation-window baseline</td>
<td><span class="citation" data-cites="cowan1992nonparametric">Cowan (<a href="references.html#ref-cowan1992nonparametric" role="doc-biblioref">1992</a>)</span></td>
</tr>
<tr class="even">
<td><strong>Kolari-Pynn√∂nen</strong></td>
<td>2010</td>
<td>Accounts for cross-sectional dependence</td>
<td><span class="citation" data-cites="kolari2010event">Kolari and Pynn√∂nen (<a href="references.html#ref-kolari2010event" role="doc-biblioref">2010</a>)</span></td>
</tr>
<tr class="odd">
<td><strong>Skewness-Adjusted</strong></td>
<td>1992</td>
<td>Corrects for BHAR skewness</td>
<td><span class="citation" data-cites="hall1992removal">Hall (<a href="references.html#ref-hall1992removal" role="doc-biblioref">1992</a>)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="cars-versus-bhars" class="level3" data-number="40.1.4">
<h3 data-number="40.1.4" class="anchored" data-anchor-id="cars-versus-bhars"><span class="header-section-number">40.1.4</span> CARs versus BHARs</h3>
<p>Cumulative abnormal returns (CARs) sum daily abnormal returns, while buy-and-hold abnormal returns (BHARs) compound returns and subtract the compounded benchmark. <span class="citation" data-cites="barber1997detecting">Barber and Lyon (<a href="references.html#ref-barber1997detecting" role="doc-biblioref">1997</a>)</span> demonstrated that BHARs better capture the actual investor experience, since investors earn compound, not cumulative, returns. However, <span class="citation" data-cites="fama1998market">Eugene F. Fama (<a href="references.html#ref-fama1998market" role="doc-biblioref">1998</a>)</span> and <span class="citation" data-cites="mitchell2000managerial">Mitchell and Stafford (<a href="references.html#ref-mitchell2000managerial" role="doc-biblioref">2000</a>)</span> showed that BHARs exhibit severe cross-sectional dependence and positive skewness. For <strong>short event windows</strong> (under 10 days), the difference between CARs and BHARs is negligible. For longer windows, both should be reported.</p>
</section>
<section id="emerging-market-considerations" class="level3" data-number="40.1.5">
<h3 data-number="40.1.5" class="anchored" data-anchor-id="emerging-market-considerations"><span class="header-section-number">40.1.5</span> Emerging Market Considerations</h3>
<p>Event studies in emerging markets face distinct challenges:</p>
<ul>
<li><p><strong>Thin trading.</strong> Many emerging market securities trade infrequently, inducing bias in market model beta estimates. <span class="citation" data-cites="scholes1977estimating">Scholes and Williams (<a href="references.html#ref-scholes1977estimating" role="doc-biblioref">1977</a>)</span> and <span class="citation" data-cites="dimson1979risk">Dimson (<a href="references.html#ref-dimson1979risk" role="doc-biblioref">1979</a>)</span> proposed corrections using leading and lagging market returns.</p></li>
<li><p><strong>Factor availability.</strong> While Fama-French factors are readily available for developed markets, emerging market factors must often be constructed locally.</p></li>
<li><p><strong>Market microstructure.</strong> Price limits (<span class="math inline">\(\pm\)</span> 7% on HOSE, <span class="math inline">\(\pm\)</span> 10% on HNX, <span class="math inline">\(\pm\)</span> 15% on UPCOM in Vietnam), T+2 settlement, and the absence of short-selling affect the speed of price adjustment. Researchers should consider wider event windows to accommodate slower information incorporation <span class="citation" data-cites="bhattacharya2000event griffin2010market">(<a href="references.html#ref-bhattacharya2000event" role="doc-biblioref">Bhattacharya et al. 2000</a>; <a href="references.html#ref-griffin2010market" role="doc-biblioref">Griffin, Kelly, and Nardari 2010</a>)</span>.</p></li>
</ul>
</section>
</section>
<section id="mathematical-framework" class="level2" data-number="40.2">
<h2 data-number="40.2" class="anchored" data-anchor-id="mathematical-framework"><span class="header-section-number">40.2</span> Mathematical Framework</h2>
<p>This section presents the complete mathematical specification of the event study methodology. We follow the notation conventions of <span class="citation" data-cites="campbell1998econometrics">Campbell et al. (<a href="references.html#ref-campbell1998econometrics" role="doc-biblioref">1998</a>)</span> and <span class="citation" data-cites="kothari2007econometrics">Kothari and Warner (<a href="references.html#ref-kothari2007econometrics" role="doc-biblioref">2007</a>)</span>.</p>
<section id="timeline-and-windows" class="level3" data-number="40.2.1">
<h3 data-number="40.2.1" class="anchored" data-anchor-id="timeline-and-windows"><span class="header-section-number">40.2.1</span> Timeline and Windows</h3>
<p>The event study timeline is defined relative to the event date, denoted <span class="math inline">\(\tau = 0\)</span>. All dates are measured in <strong>trading days</strong>:</p>
<p><span class="math display">\[
\underbrace{T_0 + 1, \ldots, T_1}_{\text{Estimation Window (L‚ÇÅ days)}} \quad \underbrace{\quad}_{\text{Gap (G days)}} \quad \underbrace{\tau_1, \ldots, 0, \ldots, \tau_2}_{\text{Event Window (L‚ÇÇ days)}}
\]</span></p>
<p>where:</p>
<ul>
<li><strong>Estimation window</strong>: <span class="math inline">\(L_1\)</span> trading days over which the risk model parameters are estimated</li>
<li><strong>Gap</strong>: <span class="math inline">\(G\)</span> trading days separating estimation and event windows, preventing contamination by pre-event information leakage</li>
<li><strong>Event window</strong>: <span class="math inline">\(L_2 = \tau_2 - \tau_1 + 1\)</span> trading days centered around the event date</li>
</ul>
<p>For example, with <span class="math inline">\(L_1 = 150\)</span>, <span class="math inline">\(G = 15\)</span>, <span class="math inline">\(\tau_1 = -10\)</span>, <span class="math inline">\(\tau_2 = +10\)</span>: the estimation window covers trading days <span class="math inline">\([-175, -25]\)</span> relative to the event, and the event window covers <span class="math inline">\([-10, +10]\)</span>.</p>
</section>
<section id="normal-return-models" class="level3" data-number="40.2.2">
<h3 data-number="40.2.2" class="anchored" data-anchor-id="normal-return-models"><span class="header-section-number">40.2.2</span> Normal Return Models</h3>
<p>Let <span class="math inline">\(R_{it}\)</span> denote the return on security <span class="math inline">\(i\)</span> on trading day <span class="math inline">\(t\)</span>, <span class="math inline">\(R_{ft}\)</span> the risk-free rate, and <span class="math inline">\(R_{mt}\)</span> the market return. We implement six models:</p>
<p><strong>Model 0: Market-Adjusted Returns.</strong> Assumes <span class="math inline">\(\beta_i = 1\)</span> and <span class="math inline">\(\alpha_i = 0\)</span> for all firms:</p>
<p><span class="math display">\[
AR_{it}^{MA} = R_{it} - R_{mt}
\]</span></p>
<p><strong>Model 1: Market Model</strong> <span class="citation" data-cites="Sharpe1964">(<a href="references.html#ref-Sharpe1964" role="doc-biblioref">Sharpe 1964</a>)</span>:</p>
<p><span class="math display">\[
R_{it} = \alpha_i + \beta_i R_{mt} + \varepsilon_{it}, \quad E[\varepsilon_{it}] = 0, \quad \text{Var}[\varepsilon_{it}] = \sigma^2_{\varepsilon_i}
\]</span></p>
<p><span class="math display">\[
AR_{it}^{MM} = R_{it} - \hat{\alpha}_i - \hat{\beta}_i R_{mt}
\]</span></p>
<p><strong>Model 2: Fama-French Three-Factor</strong> <span class="citation" data-cites="Fama1993">(<a href="references.html#ref-Fama1993" role="doc-biblioref">Eugene F. Fama and French 1993</a>)</span>:</p>
<p><span class="math display">\[
R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \varepsilon_{it}
\]</span></p>
<p><strong>Model 3: Carhart Four-Factor</strong> <span class="citation" data-cites="Carhart1997">(<a href="references.html#ref-Carhart1997" role="doc-biblioref">Carhart 1997</a>)</span>:</p>
<p><span class="math display">\[
R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \beta_{i,4} \cdot UMD_t + \varepsilon_{it}
\]</span></p>
<p><strong>Model 4: Fama-French Five-Factor</strong> <span class="citation" data-cites="FamaFrench2015">(<a href="references.html#ref-FamaFrench2015" role="doc-biblioref">Eugene F. Fama and French 2015</a>)</span>:</p>
<p><span class="math display">\[
R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \beta_{i,4} \cdot RMW_t + \beta_{i,5} \cdot CMA_t + \varepsilon_{it}
\]</span></p>
<p><strong>Model 5: User-Specified Factor Model:</strong></p>
<p><span class="math display">\[
R_{it} - R_{ft} = \alpha_i + \sum_{k=1}^{K} \beta_{i,k} F_{k,t} + \varepsilon_{it}
\]</span></p>
</section>
<section id="aggregation-cars-and-bhars" class="level3" data-number="40.2.3">
<h3 data-number="40.2.3" class="anchored" data-anchor-id="aggregation-cars-and-bhars"><span class="header-section-number">40.2.3</span> Aggregation: CARs and BHARs</h3>
<p><strong>Cumulative Abnormal Returns</strong> sum daily abnormal returns:</p>
<p><span class="math display">\[
CAR_i(\tau_1, \tau_2) = \sum_{t=\tau_1}^{\tau_2} AR_{it}, \qquad \overline{CAR}(\tau_1, \tau_2) = \frac{1}{N} \sum_{i=1}^{N} CAR_i(\tau_1, \tau_2)
\]</span></p>
<p><strong>Buy-and-Hold Abnormal Returns</strong> compound returns:</p>
<p><span class="math display">\[
BHAR_i(\tau_1, \tau_2) = \prod_{t=\tau_1}^{\tau_2}(1 + R_{it}) - \prod_{t=\tau_1}^{\tau_2}(1 + \hat{E}[R_{it}])
\]</span></p>
</section>
<section id="standardized-returns" class="level3" data-number="40.2.4">
<h3 data-number="40.2.4" class="anchored" data-anchor-id="standardized-returns"><span class="header-section-number">40.2.4</span> Standardized Returns</h3>
<p>The <strong>standardized abnormal return</strong> for firm <span class="math inline">\(i\)</span> on day <span class="math inline">\(t\)</span> is:</p>
<p><span class="math display">\[
SAR_{it} = \frac{AR_{it}}{\hat{\sigma}_{\varepsilon_i}}
\]</span></p>
<p>The <strong>standardized cumulative abnormal return</strong> is:</p>
<p><span class="math display">\[
SCAR_i(\tau_1, \tau_2) = \frac{CAR_i(\tau_1, \tau_2)}{\hat{\sigma}_{\varepsilon_i} \sqrt{L_2}}
\]</span></p>
</section>
<section id="test-statistics" class="level3" data-number="40.2.5">
<h3 data-number="40.2.5" class="anchored" data-anchor-id="test-statistics"><span class="header-section-number">40.2.5</span> Test Statistics</h3>
<p>Let <span class="math inline">\(N\)</span> denote the number of firm-event observations.</p>
<p><strong>Test 1: Cross-Sectional</strong> <span class="math inline">\(t\)</span>-Test. Allows event-induced variance; assumes cross-sectional independence:</p>
<p><span class="math display">\[
t_{CS} = \frac{\overline{CAR}}{s_{CAR}/\sqrt{N}}, \quad s_{CAR} = \sqrt{\frac{1}{N-1}\sum_{i=1}^{N}(CAR_i - \overline{CAR})^2}
\]</span></p>
<p><strong>Test 2: Patell Z-Test</strong> <span class="citation" data-cites="patell1976corporate">(<a href="references.html#ref-patell1976corporate" role="doc-biblioref">Patell 1976</a>)</span>. Weights firms inversely by volatility:</p>
<p><span class="math display">\[
Z_{Patell} = \frac{\sum_{i=1}^{N} SCAR_i}{\sqrt{\sum_{i=1}^{N} \frac{K_i - 2}{K_i - 4}}}
\]</span></p>
<p><strong>Test 3: BMP Test</strong> <span class="citation" data-cites="boehmer1991event">(<a href="references.html#ref-boehmer1991event" role="doc-biblioref">Boehmer, Masumeci, and Poulsen 1991</a>)</span>. Robust to event-induced variance:</p>
<p><span class="math display">\[
t_{BMP} = \frac{\overline{SCAR}}{s_{SCAR}/\sqrt{N}}
\]</span></p>
<p><strong>Test 4: Kolari-Pynn√∂nen Adjusted BMP</strong> <span class="citation" data-cites="kolari2010event">(<a href="references.html#ref-kolari2010event" role="doc-biblioref">Kolari and Pynn√∂nen 2010</a>)</span>. Accounts for cross-sectional dependence:</p>
<p><span class="math display">\[
t_{KP} = t_{BMP} \times \sqrt{\frac{1}{1 + (N-1)\bar{r}}}
\]</span></p>
<p>where <span class="math inline">\(\bar{r}\)</span> is the mean pairwise cross-correlation of estimation-period residuals.</p>
<p><strong>Test 5: Generalized Sign Test</strong> <span class="citation" data-cites="cowan1992nonparametric">(<a href="references.html#ref-cowan1992nonparametric" role="doc-biblioref">Cowan 1992</a>)</span>:</p>
<p><span class="math display">\[
Z_{GSign} = \frac{\hat{p} - \hat{p}_0}{\sqrt{\hat{p}_0(1-\hat{p}_0)/N}}
\]</span></p>
<p><strong>Test 6: Sign Test:</strong></p>
<p><span class="math display">\[
Z_{Sign} = \frac{N^{+} - 0.5N}{\sqrt{0.25N}}
\]</span></p>
<p><strong>Test 7: Skewness-Adjusted</strong> <span class="math inline">\(t\)</span>-Test <span class="citation" data-cites="hall1992removal">(<a href="references.html#ref-hall1992removal" role="doc-biblioref">Hall 1992</a>)</span>:</p>
<p><span class="math display">\[
t_{SA} = \sqrt{N}\left(\bar{z} + \frac{1}{3}\hat{\gamma}\bar{z}^2 + \frac{1}{27}\hat{\gamma}^2\bar{z}^3 + \frac{1}{6N}\hat{\gamma}\right)
\]</span></p>
<p><strong>Test 8: Wilcoxon Signed-Rank Test:</strong> A non-parametric test of whether the median CAR differs from zero.</p>
<p>The table below summarizes the assumptions of each test:</p>
<div id="tbl-test-assumptions" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-test-assumptions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.2: Assumption requirements for event study test statistics
</figcaption>
<div aria-describedby="tbl-test-assumptions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th style="text-align: center;">Event-Induced Variance</th>
<th style="text-align: center;">Cross-Sectional Independence</th>
<th style="text-align: center;">Normality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cross-Sectional <span class="math inline">\(t\)</span></td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Assumes</td>
</tr>
<tr class="even">
<td>Patell Z</td>
<td style="text-align: center;">Assumes no change</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Assumes</td>
</tr>
<tr class="odd">
<td>BMP</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Assumes</td>
</tr>
<tr class="even">
<td>Kolari-Pynn√∂nen</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
</tr>
<tr class="odd">
<td>Generalized Sign</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Robust</td>
</tr>
<tr class="even">
<td>Corrado Rank</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Robust</td>
</tr>
<tr class="odd">
<td>Skewness-Adjusted</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Partially</td>
</tr>
<tr class="even">
<td>Wilcoxon</td>
<td style="text-align: center;">Robust</td>
<td style="text-align: center;">Assumes</td>
<td style="text-align: center;">Robust</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="python-implementation" class="level2" data-number="40.3">
<h2 data-number="40.3" class="anchored" data-anchor-id="python-implementation"><span class="header-section-number">40.3</span> Python Implementation</h2>
<section id="design-philosophy" class="level3" data-number="40.3.1">
<h3 data-number="40.3.1" class="anchored" data-anchor-id="design-philosophy"><span class="header-section-number">40.3.1</span> Design Philosophy</h3>
<p>Our implementation follows these principles:</p>
<ol type="1">
<li><strong>Modularity</strong>: Each component (calendar, estimation, AR computation, testing) is a separate function.</li>
<li><strong>Vectorization</strong>: All operations use pandas/numpy for performance on large datasets.</li>
<li><strong>Configurability</strong>: All parameters are user-configurable via a dataclass.</li>
<li><strong>Transparency</strong>: Intermediate outputs are preserved for inspection.</li>
<li><strong>Production-ready</strong>: Comprehensive input validation, missing data handling, and edge cases.</li>
</ol>
</section>
<section id="setup-and-imports" class="level3" data-number="40.3.2">
<h3 data-number="40.3.2" class="anchored" data-anchor-id="setup-and-imports"><span class="header-section-number">40.3.2</span> Setup and Imports</h3>
<div id="setup" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass, field</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional, List, Tuple</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All libraries loaded."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>All libraries loaded.</code></pre>
</div>
</div>
<div id="ca47bde4" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>tidy_finance <span class="op">=</span> sqlite3.<span class="ex">connect</span>(database<span class="op">=</span><span class="st">"data/tidy_finance_python.sqlite"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>factors_ff3_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff3_daily"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>factors_ff5_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff5_daily"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>factors_ff3_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff3_monthly"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>factors_ff5_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff5_monthly"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="5ea28457" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, ret_excess, mktcap, mktcap_lag, risk_free</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_monthly</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>{<span class="st">"date"</span>}</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>).dropna()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, ret_excess, mktcap, mktcap_lag, risk_free</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_daily</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>{<span class="st">"date"</span>}</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>).dropna()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="configuration" class="level3" data-number="40.3.3">
<h3 data-number="40.3.3" class="anchored" data-anchor-id="configuration"><span class="header-section-number">40.3.3</span> Configuration</h3>
<div id="config" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RiskModel(Enum):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Supported risk models for expected return computation."""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    MARKET_ADJ <span class="op">=</span> <span class="st">"market_adjusted"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    MARKET_MODEL <span class="op">=</span> <span class="st">"market_model"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    FF3 <span class="op">=</span> <span class="st">"ff3"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    CARHART <span class="op">=</span> <span class="st">"carhart"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    FF5 <span class="op">=</span> <span class="st">"ff5"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    CUSTOM <span class="op">=</span> <span class="st">"custom"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventStudyConfig:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Complete configuration for an event study.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">    estimation_window : int</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Length of estimation period in trading days. Brown and Warner (1985)</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">        suggest ‚â•100 days; MacKinlay (1997) recommends 120 as standard.</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">    event_window_start : int</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Start of event window relative to event date (e.g., -10).</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">    event_window_end : int</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">        End of event window relative to event date (e.g., +10).</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">    gap : int</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Trading days between estimation and event windows. Prevents</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">        contamination from pre-event information leakage.</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    min_estimation_obs : int</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Minimum non-missing returns required in estimation period.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">    risk_model : RiskModel</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Risk model for computing expected returns.</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">    custom_factors : list</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Column names for user-specified factors (CUSTOM model only).</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">    thin_trading_adj : str or None</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">        None, 'scholes_williams', or 'dimson'.</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">    dimson_lags : int</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of leads/lags for Dimson (1979) correction.</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    estimation_window: <span class="bu">int</span> <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    event_window_start: <span class="bu">int</span> <span class="op">=</span> <span class="op">-</span><span class="dv">10</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    event_window_end: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    gap: <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs: <span class="bu">int</span> <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    risk_model: RiskModel <span class="op">=</span> RiskModel.MARKET_MODEL</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    custom_factors: List[<span class="bu">str</span>] <span class="op">=</span> field(default_factory<span class="op">=</span><span class="bu">list</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    thin_trading_adj: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    dimson_lags: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> event_window_length(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.event_window_end <span class="op">-</span> <span class="va">self</span>.event_window_start <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate(<span class="va">self</span>):</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.estimation_window <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.event_window_start <span class="op">&lt;=</span> <span class="va">self</span>.event_window_end</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.gap <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.min_estimation_obs <span class="op">&lt;=</span> <span class="va">self</span>.estimation_window</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.risk_model <span class="op">==</span> RiskModel.CUSTOM:</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="bu">len</span>(<span class="va">self</span>.custom_factors) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>config_demo <span class="op">=</span> EventStudyConfig(</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>config_demo.validate()</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event window length: </span><span class="sc">{</span>config_demo<span class="sc">.</span>event_window_length<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model: </span><span class="sc">{</span>config_demo<span class="sc">.</span>risk_model<span class="sc">.</span>value<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Event window length: 21 days
Model: ff3</code></pre>
</div>
</div>
</section>
<section id="step-1-trading-calendar-construction" class="level3" data-number="40.3.4">
<h3 data-number="40.3.4" class="anchored" data-anchor-id="step-1-trading-calendar-construction"><span class="header-section-number">40.3.4</span> Step 1: Trading Calendar Construction</h3>
<p>A correct trading calendar is fundamental. It maps any event date to the exact calendar dates for the start/end of estimation and event windows, accounting for weekends, holidays, and non-trading days.</p>
<div id="calendar" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_trading_calendar(trading_dates, config):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Build a trading calendar mapping event dates to window boundaries.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    For each potential event date, identifies the calendar dates for the</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    start/end of the estimation period and event window using only actual</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    trading days.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    trading_dates : array-like</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Sorted unique trading dates in the market.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    config : EventStudyConfig</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame with columns: estper_beg, estper_end, evtwin_beg,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">        evtdate, evtwin_end, cal_index</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> pd.Series(<span class="bu">sorted</span>(pd.to_datetime(trading_dates).unique()))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(dates)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    L1 <span class="op">=</span> config.estimation_window</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> config.gap</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> config.event_window_start</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    L2 <span class="op">=</span> config.event_window_length</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Offsets (FIRSTOBS logic)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    o0 <span class="op">=</span> <span class="dv">0</span>                      <span class="co"># estper_beg</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    o1 <span class="op">=</span> L1 <span class="op">-</span> <span class="dv">1</span>                 <span class="co"># estper_end</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    o2 <span class="op">=</span> L1 <span class="op">+</span> G                 <span class="co"># evtwin_beg</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    o3 <span class="op">=</span> L1 <span class="op">+</span> G <span class="op">-</span> s             <span class="co"># evtdate</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    o4 <span class="op">=</span> L1 <span class="op">+</span> G <span class="op">+</span> L2 <span class="op">-</span> <span class="dv">1</span>        <span class="co"># evtwin_end</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    max_offset <span class="op">=</span> o4</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> n <span class="op">-</span> max_offset</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> valid <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Need ‚â•</span><span class="sc">{</span>max_offset<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> trading dates, have </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    cal <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'estper_beg'</span>: dates.iloc[o0:o0<span class="op">+</span>valid].values,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'estper_end'</span>: dates.iloc[o1:o1<span class="op">+</span>valid].values,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtwin_beg'</span>: dates.iloc[o2:o2<span class="op">+</span>valid].values,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtdate'</span>:    dates.iloc[o3:o3<span class="op">+</span>valid].values,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtwin_end'</span>: dates.iloc[o4:o4<span class="op">+</span>valid].values,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    cal[<span class="st">'cal_index'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(cal)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate window lengths using a sample row</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">min</span>(<span class="dv">10</span>, <span class="bu">len</span>(cal)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> cal.iloc[idx]</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    est_n <span class="op">=</span> dates[(dates <span class="op">&gt;=</span> row[<span class="st">'estper_beg'</span>]) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> row[<span class="st">'estper_end'</span>])].shape[<span class="dv">0</span>]</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    evt_n <span class="op">=</span> dates[(dates <span class="op">&gt;=</span> row[<span class="st">'evtwin_beg'</span>]) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> row[<span class="st">'evtwin_end'</span>])].shape[<span class="dv">0</span>]</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> est_n <span class="op">==</span> L1, <span class="ss">f"Estimation window: </span><span class="sc">{</span>est_n<span class="sc">}</span><span class="ss"> ‚â† </span><span class="sc">{</span>L1<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> evt_n <span class="op">==</span> L2, <span class="ss">f"Event window: </span><span class="sc">{</span>evt_n<span class="sc">}</span><span class="ss"> ‚â† </span><span class="sc">{</span>L2<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cal</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Demo</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>demo_dates <span class="op">=</span> pd.bdate_range(<span class="st">'2018-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'B'</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>demo_cal <span class="op">=</span> build_trading_calendar(demo_dates, config_demo)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Calendar: </span><span class="sc">{</span><span class="bu">len</span>(demo_cal)<span class="sc">}</span><span class="ss"> potential event dates"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(demo_cal.head(<span class="dv">3</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calendar: 1380 potential event dates
estper_beg estper_end evtwin_beg    evtdate evtwin_end  cal_index
2018-01-01 2018-07-27 2018-08-20 2018-09-03 2018-09-17          1
2018-01-02 2018-07-30 2018-08-21 2018-09-04 2018-09-18          2
2018-01-03 2018-07-31 2018-08-22 2018-09-05 2018-09-19          3</code></pre>
</div>
</div>
</section>
<section id="step-2-event-date-alignment" class="level3" data-number="40.3.5">
<h3 data-number="40.3.5" class="anchored" data-anchor-id="step-2-event-date-alignment"><span class="header-section-number">40.3.5</span> Step 2: Event Date Alignment</h3>
<p>When an event occurs on a non-trading day, align to the <strong>next</strong> available trading day.</p>
<div id="alignment" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> align_events(events, calendar, id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'event_date'</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Align event dates to trading calendar.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Non-trading-day events are shifted forward to the next trading day.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    events : pd.DataFrame with [id_col, date_col] and optional 'group'</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    calendar : pd.DataFrame from build_trading_calendar()</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame with window boundaries for each firm-event</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    events <span class="op">=</span> events.copy()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    events[date_col] <span class="op">=</span> pd.to_datetime(events[date_col])</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    cal_dates <span class="op">=</span> calendar[[<span class="st">'evtdate'</span>]].drop_duplicates().sort_values(<span class="st">'evtdate'</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> pd.merge_asof(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        events.sort_values(date_col),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        cal_dates.rename(columns<span class="op">=</span>{<span class="st">'evtdate'</span>: <span class="st">'aligned_date'</span>}),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>date_col, right_on<span class="op">=</span><span class="st">'aligned_date'</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        direction<span class="op">=</span><span class="st">'forward'</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> merged.merge(calendar, left_on<span class="op">=</span><span class="st">'aligned_date'</span>, right_on<span class="op">=</span><span class="st">'evtdate'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    shifted <span class="op">=</span> (result[date_col] <span class="op">!=</span> result[<span class="st">'evtdate'</span>]).<span class="bu">sum</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shifted <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>shifted<span class="sc">}</span><span class="ss"> event(s) shifted to next trading day"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.rename(columns<span class="op">=</span>{date_col: <span class="st">'original_date'</span>})</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.drop_duplicates(subset<span class="op">=</span>[id_col, <span class="st">'evtdate'</span>])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-3-data-extraction-and-factor-merging" class="level3" data-number="40.3.6">
<h3 data-number="40.3.6" class="anchored" data-anchor-id="step-3-data-extraction-and-factor-merging"><span class="header-section-number">40.3.6</span> Step 3: Data Extraction and Factor Merging</h3>
<p>Extract returns for each security-event across the full estimation + event window and merge risk factors.</p>
<div id="extraction" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_returns(aligned_events, prices, factors, config,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                    id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'date'</span>, ret_col<span class="op">=</span><span class="st">'ret'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                    mkt_col<span class="op">=</span><span class="st">'mkt_excess'</span>, rf_col<span class="op">=</span><span class="st">'risk_free'</span>):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extract stock returns and merge risk factors for each event.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">    For each security-event, retrieves daily returns from estper_beg</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    through evtwin_end and merges appropriate risk factors.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    prices <span class="op">=</span> prices.copy()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    factors <span class="op">=</span> factors.copy()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    prices[date_col] <span class="op">=</span> pd.to_datetime(prices[date_col])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    factors[date_col] <span class="op">=</span> pd.to_datetime(factors[date_col])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recover raw return from excess return if needed</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ret_col <span class="kw">not</span> <span class="kw">in</span> prices.columns <span class="kw">and</span> <span class="st">'ret_excess'</span> <span class="kw">in</span> prices.columns:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rf_col <span class="kw">in</span> factors.columns:</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            prices <span class="op">=</span> prices.merge(factors[[date_col, rf_col]].drop_duplicates(),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                                  on<span class="op">=</span>date_col, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        prices[ret_col] <span class="op">=</span> prices[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices[rf_col]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Factor columns based on model</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    fac_cols <span class="op">=</span> [mkt_col] <span class="cf">if</span> mkt_col <span class="kw">in</span> factors.columns <span class="cf">else</span> []</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rf_col <span class="kw">in</span> factors.columns:</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        fac_cols.append(rf_col)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    model_factors <span class="op">=</span> {</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">'smb'</span>, <span class="st">'hml'</span>],</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'umd'</span>],</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'rmw'</span>, <span class="st">'cma'</span>],</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> model_factors.get(model, []):</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> f <span class="kw">in</span> factors.columns:</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            fac_cols.append(f)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    fac_cols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>([date_col] <span class="op">+</span> fac_cols))</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorized merge approach: join events with prices on id + date range</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    frames <span class="op">=</span> []</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, evt <span class="kw">in</span> aligned_events.iterrows():</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> ((prices[id_col] <span class="op">==</span> evt[id_col]) <span class="op">&amp;</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                (prices[date_col] <span class="op">&gt;=</span> evt[<span class="st">'estper_beg'</span>]) <span class="op">&amp;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                (prices[date_col] <span class="op">&lt;=</span> evt[<span class="st">'evtwin_end'</span>]))</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        fd <span class="op">=</span> prices.loc[mask, [id_col, date_col, ret_col]].copy()</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(fd) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtdate'</span>] <span class="op">=</span> evt[<span class="st">'evtdate'</span>]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'estper_beg'</span>] <span class="op">=</span> evt[<span class="st">'estper_beg'</span>]</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'estper_end'</span>] <span class="op">=</span> evt[<span class="st">'estper_end'</span>]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtwin_beg'</span>] <span class="op">=</span> evt[<span class="st">'evtwin_beg'</span>]</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtwin_end'</span>] <span class="op">=</span> evt[<span class="st">'evtwin_end'</span>]</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'group'</span> <span class="kw">in</span> evt.index:</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>            fd[<span class="st">'group'</span>] <span class="op">=</span> evt[<span class="st">'group'</span>]</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        frames.append(fd)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> frames:</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"No return data found for any events"</span>)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.concat(frames, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.merge(factors[fac_cols].drop_duplicates(), on<span class="op">=</span>date_col, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Excess and market-adjusted returns</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rf_col <span class="kw">in</span> result.columns:</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_excess'</span>] <span class="op">=</span> result[ret_col] <span class="op">-</span> result[rf_col]</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_excess'</span>] <span class="op">=</span> result[ret_col]</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mkt_col <span class="kw">in</span> result.columns:</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_mktadj'</span>] <span class="op">=</span> result[<span class="st">'ret_excess'</span>] <span class="op">-</span> result[mkt_col]</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.sort_values([id_col, <span class="st">'evtdate'</span>, date_col]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    n_evts <span class="op">=</span> result.groupby([id_col, <span class="st">'evtdate'</span>]).ngroups</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Extracted </span><span class="sc">{</span><span class="bu">len</span>(result)<span class="sc">:,}</span><span class="ss"> obs for </span><span class="sc">{</span>n_evts<span class="sc">}</span><span class="ss"> firm-events"</span>)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-4-risk-model-estimation" class="level3" data-number="40.3.7">
<h3 data-number="40.3.7" class="anchored" data-anchor-id="step-4-risk-model-estimation"><span class="header-section-number">40.3.7</span> Step 4: Risk Model Estimation</h3>
<p>Estimate risk model parameters over the estimation window.</p>
<div id="estimation" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_model(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    event_returns, config, id_col<span class="op">=</span><span class="st">"symbol"</span>, date_col<span class="op">=</span><span class="st">"date"</span>, ret_col<span class="op">=</span><span class="st">"ret"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate risk model parameters for each firm-event.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Runs OLS over the estimation window. Returns alpha, betas, sigma,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    R^2, nobs, and residuals for cross-correlation computation.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define regression specification</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    dep_var_map <span class="op">=</span> {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: <span class="st">"ret_mktadj"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: ret_col,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: <span class="st">"ret_excess"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: <span class="st">"ret_excess"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: <span class="st">"ret_excess"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: <span class="st">"ret_excess"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    indep_var_map <span class="op">=</span> {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: [],</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: [<span class="st">"mkt_excess"</span>],</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>],</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"umd"</span>],</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"rmw"</span>, <span class="st">"cma"</span>],</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    dep_var <span class="op">=</span> dep_var_map[model]</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    indep_vars <span class="op">=</span> indep_var_map[model]</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> event_returns[</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        (event_returns[date_col] <span class="op">&gt;=</span> event_returns[<span class="st">"estper_beg"</span>])</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (event_returns[date_col] <span class="op">&lt;=</span> event_returns[<span class="st">"estper_end"</span>])</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    params_list <span class="op">=</span> []</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (firm, evtdate), grp <span class="kw">in</span> est.groupby([id_col, <span class="st">"evtdate"</span>]):</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> grp.dropna(subset<span class="op">=</span>[dep_var] <span class="op">+</span> indep_vars)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        nobs <span class="op">=</span> <span class="bu">len</span>(valid)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nobs <span class="op">&lt;</span> config.min_estimation_obs:</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> valid[dep_var].values</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(indep_vars) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Market-adjusted: intercept-only for variance</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> {</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>                id_col: firm,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">"alpha"</span>: y.mean(),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sigma"</span>: y.std(ddof<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">"variance"</span>: y.var(ddof<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nobs"</span>: nobs,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">"r_squared"</span>: <span class="fl">0.0</span>,</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">"_residuals"</span>: y <span class="op">-</span> y.mean(),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> sm.add_constant(valid[indep_vars].values)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>            res <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> {</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>                id_col: firm,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>                <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">"alpha"</span>: res.params[<span class="dv">0</span>],</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sigma"</span>: np.sqrt(res.mse_resid),</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">"variance"</span>: res.mse_resid,</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nobs"</span>: nobs,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>                <span class="st">"r_squared"</span>: res.rsquared <span class="cf">if</span> np.isfinite(res.rsquared) <span class="cf">else</span> np.nan,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>                <span class="st">"_residuals"</span>: res.resid,</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, var <span class="kw">in</span> <span class="bu">enumerate</span>(indep_vars):</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>                p[<span class="ss">f"beta_</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> res.params[j <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Skip degenerate firms (zero or near-zero variance)</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p[<span class="st">"sigma"</span>] <span class="op">&lt;</span> <span class="fl">1e-6</span>:</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>        params_list.append(p)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> params_list:</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"No firm-events passed minimum observation filter"</span>)</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    params_df <span class="op">=</span> pd.DataFrame(params_list)</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    n_total <span class="op">=</span> event_returns.groupby([id_col, <span class="st">"evtdate"</span>]).ngroups</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  Estimated </span><span class="sc">{</span><span class="bu">len</span>(params_df)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>n_total<span class="sc">}</span><span class="ss"> firm-events "</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"(mean R^2 = </span><span class="sc">{</span>params_df[<span class="st">'r_squared'</span>]<span class="sc">.</span>dropna()<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">)"</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-5-abnormal-return-computation" class="level3" data-number="40.3.8">
<h3 data-number="40.3.8" class="anchored" data-anchor-id="step-5-abnormal-return-computation"><span class="header-section-number">40.3.8</span> Step 5: Abnormal Return Computation</h3>
<p>Compute AR, CAR, BHAR, SAR, SCAR for each firm-event-date.</p>
<div id="abnormal-returns" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_abnormal_returns(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    event_returns, params, config, id_col<span class="op">=</span><span class="st">"symbol"</span>, date_col<span class="op">=</span><span class="st">"date"</span>, ret_col<span class="op">=</span><span class="st">"ret"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute abnormal returns and aggregate to CARs/BHARs.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">    daily_ar : pd.DataFrame - daily AR/SAR/CAR/BHAR per firm-event-date</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">    event_ar : pd.DataFrame - event-level CAR/BHAR/SCAR per firm-event</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    factor_map <span class="op">=</span> {</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: [],</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: [<span class="st">"mkt_excess"</span>],</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>],</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"umd"</span>],</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"rmw"</span>, <span class="st">"cma"</span>],</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    factor_cols <span class="op">=</span> factor_map[model]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to event window</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> event_returns[</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        (event_returns[date_col] <span class="op">&gt;=</span> event_returns[<span class="st">"evtwin_beg"</span>])</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (event_returns[date_col] <span class="op">&lt;=</span> event_returns[<span class="st">"evtwin_end"</span>])</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge params (drop residuals column for merge)</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    merge_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> params.columns <span class="cf">if</span> c <span class="op">!=</span> <span class="st">"_residuals"</span>]</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> evt.merge(params[merge_cols], on<span class="op">=</span>[id_col, <span class="st">"evtdate"</span>], how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expected returns</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model <span class="op">==</span> RiskModel.MARKET_ADJ:</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"expected_ret"</span>] <span class="op">=</span> evt.get(<span class="st">"mkt_excess"</span>, <span class="dv">0</span>) <span class="op">+</span> evt.get(<span class="st">"risk_free"</span>, <span class="dv">0</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[ret_col] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"expected_ret"</span>] <span class="op">=</span> evt[<span class="st">"alpha"</span>]</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> fc <span class="kw">in</span> factor_cols:</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            bcol <span class="op">=</span> <span class="ss">f"beta_</span><span class="sc">{</span>fc<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bcol <span class="kw">in</span> evt.columns:</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                evt[<span class="st">"expected_ret"</span>] <span class="op">+=</span> evt[bcol] <span class="op">*</span> evt[fc]</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model <span class="op">==</span> RiskModel.MARKET_MODEL:</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>            evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[ret_col] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>            evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[<span class="st">"ret_excess"</span>] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    evt[<span class="st">"SAR"</span>] <span class="op">=</span> evt[<span class="st">"AR"</span>] <span class="op">/</span> evt[<span class="st">"sigma"</span>]</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> evt.sort_values([id_col, <span class="st">"evtdate"</span>, date_col])</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute event time</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    all_dates <span class="op">=</span> <span class="bu">sorted</span>(event_returns[date_col].unique())</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    d2i <span class="op">=</span> {d: i <span class="cf">for</span> i, d <span class="kw">in</span> <span class="bu">enumerate</span>(all_dates)}</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    evt[<span class="st">"evttime"</span>] <span class="op">=</span> evt[date_col].<span class="bu">map</span>(d2i) <span class="op">-</span> evt[<span class="st">"evtdate"</span>].<span class="bu">map</span>(d2i)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cumulative measures per firm-event</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    daily_recs <span class="op">=</span> []</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    event_recs <span class="op">=</span> []</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (firm, evtdate), g <span class="kw">in</span> evt.groupby([id_col, <span class="st">"evtdate"</span>]):</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> g.sort_values(date_col).copy()</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        nd <span class="op">=</span> <span class="bu">len</span>(g)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"CAR"</span>] <span class="op">=</span> g[<span class="st">"AR"</span>].cumsum()</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"cum_ret"</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> g[ret_col]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"cum_expected"</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> g[<span class="st">"expected_ret"</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"BHAR"</span>] <span class="op">=</span> g[<span class="st">"cum_ret"</span>] <span class="op">-</span> g[<span class="st">"cum_expected"</span>]</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"SCAR"</span>] <span class="op">=</span> g[<span class="st">"CAR"</span>] <span class="op">/</span> (g[<span class="st">"sigma"</span>].iloc[<span class="dv">0</span>] <span class="op">*</span> np.sqrt(np.arange(<span class="dv">1</span>, nd <span class="op">+</span> <span class="dv">1</span>)))</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>        daily_recs.append(g)</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> g.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>        sigma <span class="op">=</span> g[<span class="st">"sigma"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>        nobs <span class="op">=</span> g[<span class="st">"nobs"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>        rec <span class="op">=</span> {</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>            id_col: firm,</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>            <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CAR"</span>: last[<span class="st">"CAR"</span>],</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BHAR"</span>: last[<span class="st">"BHAR"</span>],</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>            <span class="st">"cum_ret"</span>: last[<span class="st">"cum_ret"</span>],</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SCAR"</span>: last[<span class="st">"CAR"</span>] <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(nd)),</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>: sigma,</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">"variance"</span>: g[<span class="st">"variance"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nobs"</span>: nobs,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>            <span class="st">"n_event_days"</span>: nd,</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>            <span class="st">"alpha"</span>: g[<span class="st">"alpha"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pat_scale"</span>: (nobs <span class="op">-</span> <span class="dv">2</span>) <span class="op">/</span> (nobs <span class="op">-</span> <span class="dv">4</span>) <span class="cf">if</span> nobs <span class="op">&gt;</span> <span class="dv">4</span> <span class="cf">else</span> np.nan,</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pos_car"</span>: <span class="bu">int</span>(last[<span class="st">"CAR"</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> fc <span class="kw">in</span> factor_cols:</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>            bcol <span class="op">=</span> <span class="ss">f"beta_</span><span class="sc">{</span>fc<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bcol <span class="kw">in</span> g.columns:</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>                rec[bcol] <span class="op">=</span> g[bcol].iloc[<span class="dv">0</span>]</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"group"</span> <span class="kw">in</span> g.columns:</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>            rec[<span class="st">"group"</span>] <span class="op">=</span> g[<span class="st">"group"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>        event_recs.append(rec)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>    daily_ar <span class="op">=</span> pd.concat(daily_recs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>    event_ar <span class="op">=</span> pd.DataFrame(event_recs)</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(event_ar)<span class="sc">}</span><span class="ss"> firm-events | Mean CAR: </span><span class="sc">{</span>event_ar[<span class="st">'CAR'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss"> | "</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Mean BHAR: </span><span class="sc">{</span>event_ar[<span class="st">'BHAR'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss"> | "</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"% positive: </span><span class="sc">{</span>event_ar[<span class="st">'pos_car'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> daily_ar, event_ar</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-6-comprehensive-test-statistics" class="level3" data-number="40.3.9">
<h3 data-number="40.3.9" class="anchored" data-anchor-id="step-6-comprehensive-test-statistics"><span class="header-section-number">40.3.9</span> Step 6: Comprehensive Test Statistics</h3>
<p>Eight tests covering parametric, non-parametric, and cross-correlation-robust approaches.</p>
<div id="tests" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_test_statistics(event_ar, params<span class="op">=</span><span class="va">None</span>, group_col<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute comprehensive test statistics for abnormal returns.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Implements 8 tests with varying assumptions about variance,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    cross-dependence, and distributional form.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _stats(data, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> N <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        cars <span class="op">=</span> data[<span class="st">'CAR'</span>].values</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        bhars <span class="op">=</span> data[<span class="st">'BHAR'</span>].values</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        scars <span class="op">=</span> data[<span class="st">'SCAR'</span>].values</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> data[<span class="st">'pos_car'</span>].values</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        m_car, s_car <span class="op">=</span> np.mean(cars), np.std(cars, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        m_scar, s_scar <span class="op">=</span> np.mean(scars), np.std(scars, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> {<span class="st">'group'</span>: label <span class="kw">or</span> <span class="st">'All'</span>, <span class="st">'N'</span>: N,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>             <span class="st">'mean_CAR'</span>: m_car, <span class="st">'median_CAR'</span>: np.median(cars),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>             <span class="st">'std_CAR'</span>: s_car, <span class="st">'mean_BHAR'</span>: np.mean(bhars),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>             <span class="st">'pct_positive'</span>: np.mean(pos)}</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Cross-sectional t</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> m_car <span class="op">/</span> (s_car <span class="op">/</span> np.sqrt(N)) <span class="cf">if</span> s_car <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_CS'</span>] <span class="op">=</span> t1</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_CS'</span>] <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> stats.t.cdf(<span class="bu">abs</span>(t1), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t1) <span class="cf">else</span> np.nan</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Patell Z</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'pat_scale'</span> <span class="kw">in</span> data.columns:</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            ps <span class="op">=</span> data[<span class="st">'pat_scale'</span>].dropna().values</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            z2 <span class="op">=</span> np.<span class="bu">sum</span>(scars[:<span class="bu">len</span>(ps)]) <span class="op">/</span> np.sqrt(np.<span class="bu">sum</span>(ps)) <span class="cf">if</span> <span class="bu">len</span>(ps) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            z2 <span class="op">=</span> m_scar <span class="op">*</span> np.sqrt(N)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_Patell'</span>] <span class="op">=</span> z2</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_Patell'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.norm.cdf(<span class="bu">abs</span>(z2))) <span class="cf">if</span> np.isfinite(z2) <span class="cf">else</span> np.nan</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. BMP</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        t3 <span class="op">=</span> m_scar <span class="op">/</span> (s_scar <span class="op">/</span> np.sqrt(N)) <span class="cf">if</span> s_scar <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_BMP'</span>] <span class="op">=</span> t3</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_BMP'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t3), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t3) <span class="cf">else</span> np.nan</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Kolari-Pynn√∂nen</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        rbar <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> params <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="st">'_residuals'</span> <span class="kw">in</span> params.columns:</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            resids <span class="op">=</span> [row[<span class="st">'_residuals'</span>] <span class="cf">for</span> _, row <span class="kw">in</span> params.iterrows()</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> <span class="bu">isinstance</span>(row.get(<span class="st">'_residuals'</span>), np.ndarray)]</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(resids) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                ml <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> resids)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                aligned <span class="op">=</span> np.column_stack([x[:ml] <span class="cf">for</span> x <span class="kw">in</span> resids])</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>                cm <span class="op">=</span> np.corrcoef(aligned.T)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                np.fill_diagonal(cm, <span class="dv">0</span>)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>                rbar <span class="op">=</span> cm.<span class="bu">sum</span>() <span class="op">/</span> (<span class="bu">len</span>(resids) <span class="op">*</span> (<span class="bu">len</span>(resids)<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        adj <span class="op">=</span> np.sqrt(<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>(N<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>rbar)) <span class="cf">if</span> (<span class="dv">1</span><span class="op">+</span>(N<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>rbar) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        t4 <span class="op">=</span> t3 <span class="op">*</span> adj <span class="cf">if</span> np.isfinite(t3) <span class="cf">else</span> np.nan</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_KP'</span>] <span class="op">=</span> t4</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_KP'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t4), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t4) <span class="cf">else</span> np.nan</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'r_bar'</span>] <span class="op">=</span> rbar</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Generalized sign test</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        p_hat <span class="op">=</span> np.mean(pos)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        z5 <span class="op">=</span> (p_hat <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">/</span> np.sqrt(<span class="fl">0.25</span> <span class="op">/</span> N)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_GSign'</span>] <span class="op">=</span> z5</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_GSign'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.norm.cdf(<span class="bu">abs</span>(z5)))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 6. Sign test</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_Sign'</span>] <span class="op">=</span> z5  <span class="co"># Same formula with p0=0.5</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_Sign'</span>] <span class="op">=</span> r[<span class="st">'p_GSign'</span>]</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 7. Skewness-adjusted t</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s_scar <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>            zb <span class="op">=</span> m_scar <span class="op">/</span> s_scar</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>            gam <span class="op">=</span> stats.skew(scars)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>            t7 <span class="op">=</span> np.sqrt(N) <span class="op">*</span> (zb <span class="op">+</span> gam<span class="op">*</span>zb<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span> <span class="op">+</span> gam<span class="op">**</span><span class="dv">2</span><span class="op">*</span>zb<span class="op">**</span><span class="dv">3</span><span class="op">/</span><span class="dv">27</span> <span class="op">+</span> gam<span class="op">/</span>(<span class="dv">6</span><span class="op">*</span>N))</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'t_SkAdj'</span>] <span class="op">=</span> t7</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'p_SkAdj'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t7), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t7) <span class="cf">else</span> np.nan</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 8. Wilcoxon signed-rank</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>            w, pw <span class="op">=</span> stats.wilcoxon(cars, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'W_Wilcoxon'</span>] <span class="op">=</span> w</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'p_Wilcoxon'</span>] <span class="op">=</span> pw</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'W_Wilcoxon'</span>] <span class="op">=</span> r[<span class="st">'p_Wilcoxon'</span>] <span class="op">=</span> np.nan</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> [_stats(event_ar)]</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> group_col <span class="kw">and</span> group_col <span class="kw">in</span> event_ar.columns:</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gv, gd <span class="kw">in</span> event_ar.groupby(group_col):</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> _stats(gd, label<span class="op">=</span>gv)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s:</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>                results.append(s)</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame([r <span class="cf">for</span> r <span class="kw">in</span> results <span class="cf">if</span> r <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_daily_stats(daily_ar, id_col<span class="op">=</span><span class="st">'symbol'</span>):</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute test statistics at each event time t."""</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t, g <span class="kw">in</span> daily_ar.groupby(<span class="st">'evttime'</span>):</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> g[id_col].nunique()</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>        m_ar <span class="op">=</span> g[<span class="st">'AR'</span>].mean()</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>        s_ar <span class="op">=</span> g[<span class="st">'AR'</span>].std(ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>        t_ar <span class="op">=</span> m_ar <span class="op">/</span> (s_ar<span class="op">/</span>np.sqrt(n)) <span class="cf">if</span> s_ar <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">'evttime'</span>: t, <span class="st">'N'</span>: n, <span class="st">'mean_AR'</span>: m_ar,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'mean_CAR'</span>: g[<span class="st">'CAR'</span>].mean(), <span class="st">'mean_BHAR'</span>: g[<span class="st">'BHAR'</span>].mean(),</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'mean_cum_ret'</span>: g.get(<span class="st">'cum_ret'</span>, pd.Series()).mean(),</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'t_AR'</span>: t_ar})</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(rows).sort_values(<span class="st">'evttime'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-7-publication-ready-visualization" class="level3" data-number="40.3.10">
<h3 data-number="40.3.10" class="anchored" data-anchor-id="step-7-publication-ready-visualization"><span class="header-section-number">40.3.10</span> Step 7: Publication-Ready Visualization</h3>
<div id="visualization" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_event_study(daily_stats, title<span class="op">=</span><span class="st">"Cumulative Abnormal Returns Around Event Date"</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                     figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>), save_path<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Publication-ready event study plot with CAR, BHAR, and daily AR panels."""</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>figsize, height_ratios<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                              gridspec_kw<span class="op">=</span>{<span class="st">'hspace'</span>: <span class="fl">0.05</span>})</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> daily_stats.sort_values(<span class="st">'evttime'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ds[<span class="st">'evttime'</span>].values</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top: cumulative returns</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, ds[<span class="st">'mean_CAR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>, lw<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'Mean CAR'</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, ds[<span class="st">'mean_BHAR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#B2182B'</span>, lw<span class="op">=</span><span class="dv">2</span>, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean BHAR'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'mean_cum_ret'</span> <span class="kw">in</span> ds.columns:</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        ax.plot(t, ds[<span class="st">'mean_cum_ret'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#666'</span>, lw<span class="op">=</span><span class="fl">1.5</span>, ls<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Mean Cum. Return'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.8</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Cumulative Return (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([])</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom: daily AR bars</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#2166AC'</span> <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'#B2182B'</span> <span class="cf">for</span> v <span class="kw">in</span> ds[<span class="st">'mean_AR'</span>]]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    ax2.bar(t, ds[<span class="st">'mean_AR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.7</span>, width<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'t_AR'</span> <span class="kw">in</span> ds.columns:</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        sig <span class="op">=</span> np.<span class="bu">abs</span>(ds[<span class="st">'t_AR'</span>].values) <span class="op">&gt;</span> <span class="fl">1.96</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sig.<span class="bu">any</span>():</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>            ax2.scatter(t[sig], ds[<span class="st">'mean_AR'</span>].values[sig]<span class="op">*</span><span class="dv">100</span>, </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'gold'</span>, s<span class="op">=</span><span class="dv">40</span>, marker<span class="op">=</span><span class="st">'*'</span>, zorder<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="st">'p&lt;0.05'</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            ax2.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.8</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    ax2.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Event Time (Trading Periods)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Mean AR (%)'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a <span class="kw">in</span> axes:</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        a.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        a.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_path:</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        fig.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_car_distribution(event_ar, var<span class="op">=</span><span class="st">'CAR'</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>)):</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cross-sectional distribution of CARs with histogram and QQ plot."""</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>figsize)</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> event_ar[var].dropna() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    ax1.hist(data, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    ax1.axvline(data.mean(), color<span class="op">=</span><span class="st">'k'</span>, ls<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="ss">f'Mean=</span><span class="sc">{</span>data<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">%'</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    ax1.axvline(data.median(), color<span class="op">=</span><span class="st">'gray'</span>, ls<span class="op">=</span><span class="st">':'</span>, lw<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="ss">f'Median=</span><span class="sc">{</span>data<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">%'</span>)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="ss">f'</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> (%)'</span>)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f'Distribution of </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    ax1.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    ax1.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># QQ plot</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    (osm, osr), (slope, intercept, r) <span class="op">=</span> stats.probplot(data, dist<span class="op">=</span><span class="st">'norm'</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(osm, osr, alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>)</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    ax2.plot(osm, slope<span class="op">*</span>np.array(osm)<span class="op">+</span>intercept, <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Theoretical Quantiles'</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Sample Quantiles'</span>)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Q-Q Plot (Normal)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    ax2.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    ax2.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="the-master-pipeline" class="level3" data-number="40.3.11">
<h3 data-number="40.3.11" class="anchored" data-anchor-id="the-master-pipeline"><span class="header-section-number">40.3.11</span> The Master Pipeline</h3>
<p>Combine all components into one function:</p>
<div id="master" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_event_study(events, prices, factors, config,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                    id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'date'</span>, ret_col<span class="op">=</span><span class="st">'ret'</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                    event_date_col<span class="op">=</span><span class="st">'event_date'</span>, mkt_col<span class="op">=</span><span class="st">'mkt_excess'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                    rf_col<span class="op">=</span><span class="st">'risk_free'</span>, group_col<span class="op">=</span><span class="va">None</span>, verbose<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Run a complete event study from raw inputs to test statistics.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    This is the main entry point. Provide your events, price data,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    factor data, and configuration‚Äîget back everything you need.</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    events : pd.DataFrame</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Columns: [id_col, event_date_col], optional 'group'.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">    prices : pd.DataFrame</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Daily returns: [id_col, date_col, ret_col or 'ret_excess', rf_col].</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">    factors : pd.DataFrame</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Factor returns: [date_col, mkt_col, 'smb', 'hml', ...].</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">    config : EventStudyConfig</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">    dict with keys: 'config', 'daily_ar', 'event_ar', 'daily_stats',</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">        'test_stats', 'params'</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    config.validate()</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ïê‚ïê‚ïê Event Study: </span><span class="sc">{</span>config<span class="sc">.</span>risk_model<span class="sc">.</span>value<span class="sc">}</span><span class="ss"> model ‚ïê‚ïê‚ïê"</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Windows: estimation=</span><span class="sc">{</span>config<span class="sc">.</span>estimation_window<span class="sc">}</span><span class="ss">, "</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"gap=</span><span class="sc">{</span>config<span class="sc">.</span>gap<span class="sc">}</span><span class="ss">, event=(</span><span class="sc">{</span>config<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>config<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Min obs: </span><span class="sc">{</span>config<span class="sc">.</span>min_estimation_obs<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Trading calendar</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 1: Building trading calendar..."</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> pd.Series(<span class="bu">sorted</span>(prices[date_col].unique()))</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> build_trading_calendar(trading_dates, config)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(calendar)<span class="sc">}</span><span class="ss"> potential event dates</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Align events</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 2: Aligning events to trading calendar..."</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    aligned <span class="op">=</span> align_events(events, calendar, id_col, event_date_col)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(aligned)<span class="sc">}</span><span class="ss"> aligned events</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Extract returns</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 3: Extracting returns and merging factors..."</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    evt_rets <span class="op">=</span> extract_returns(aligned, prices, factors, config,</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>                               id_col, date_col, ret_col, mkt_col, rf_col)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Estimate model</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 4: Estimating risk model parameters..."</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> estimate_model(evt_rets, config, id_col, date_col, ret_col)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Compute abnormal returns</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 5: Computing abnormal returns..."</span>)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    daily_ar, event_ar <span class="op">=</span> compute_abnormal_returns(</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>        evt_rets, params, config, id_col, date_col, ret_col)</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Test statistics</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 6: Computing test statistics..."</span>)</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    test_stats <span class="op">=</span> compute_test_statistics(event_ar, params, group_col)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    daily_stats <span class="op">=</span> compute_daily_stats(daily_ar, id_col)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Done.</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê"</span>)</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>        cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>]</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>        avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> cols <span class="cf">if</span> c <span class="kw">in</span> test_stats.columns]</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(test_stats[avail].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'config'</span>: config,</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: params,</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'daily_ar'</span>: daily_ar,</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'event_ar'</span>: event_ar,</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'daily_stats'</span>: daily_stats,</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'test_stats'</span>: test_stats,</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'calendar'</span>: calendar,</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Master pipeline ready."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Master pipeline ready.</code></pre>
</div>
</div>
</section>
</section>
<section id="demonstration-with-simulated-data" class="level2" data-number="40.4">
<h2 data-number="40.4" class="anchored" data-anchor-id="demonstration-with-simulated-data"><span class="header-section-number">40.4</span> Demonstration with Simulated Data</h2>
<p>Since we are building a general-purpose framework (the actual event data will be supplied later), we demonstrate the full pipeline with <strong>realistic simulated data</strong>.</p>
<div id="simulation" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2024</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated trading calendar (Vietnamese market: ~245 days/year) ---</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.bdate_range(<span class="st">'2019-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'B'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Tet + national holidays (simplified)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>tet_holidays <span class="op">=</span> pd.to_datetime([</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019-02-04'</span>,<span class="st">'2019-02-05'</span>,<span class="st">'2019-02-06'</span>,<span class="st">'2019-02-07'</span>,<span class="st">'2019-02-08'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2020-01-23'</span>,<span class="st">'2020-01-24'</span>,<span class="st">'2020-01-27'</span>,<span class="st">'2020-01-28'</span>,<span class="st">'2020-01-29'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2021-02-10'</span>,<span class="st">'2021-02-11'</span>,<span class="st">'2021-02-12'</span>,<span class="st">'2021-02-15'</span>,<span class="st">'2021-02-16'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022-01-31'</span>,<span class="st">'2022-02-01'</span>,<span class="st">'2022-02-02'</span>,<span class="st">'2022-02-03'</span>,<span class="st">'2022-02-04'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2023-01-20'</span>,<span class="st">'2023-01-23'</span>,<span class="st">'2023-01-24'</span>,<span class="st">'2023-01-25'</span>,<span class="st">'2023-01-26'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> dates.difference(tet_holidays)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="bu">len</span>(dates)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated factors (realistic Vietnamese market parameters) ---</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>rf_daily <span class="op">=</span> <span class="fl">0.04</span> <span class="op">/</span> <span class="dv">252</span>  <span class="co"># ~4% annual risk-free</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>mkt_excess <span class="op">=</span> np.random.normal(<span class="fl">0.0003</span>, <span class="fl">0.012</span>, T)  <span class="co"># ~7.5% annual, ~19% vol</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>smb <span class="op">=</span> np.random.normal(<span class="fl">0.0001</span>, <span class="fl">0.006</span>, T)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>hml <span class="op">=</span> np.random.normal(<span class="fl">0.0001</span>, <span class="fl">0.005</span>, T)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>rmw <span class="op">=</span> np.random.normal(<span class="fl">0.00005</span>, <span class="fl">0.004</span>, T)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>cma <span class="op">=</span> np.random.normal(<span class="fl">0.00005</span>, <span class="fl">0.004</span>, T)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>factors_sim <span class="op">=</span> pd.DataFrame({</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: dates, <span class="st">'mkt_excess'</span>: mkt_excess, <span class="st">'smb'</span>: smb, <span class="st">'hml'</span>: hml,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmw'</span>: rmw, <span class="st">'cma'</span>: cma, <span class="st">'risk_free'</span>: rf_daily</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 100 simulated stocks ---</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>n_stocks <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>symbols <span class="op">=</span> [<span class="ss">f'SIM</span><span class="sc">{</span>i<span class="sc">:03d}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_stocks)]</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> np.random.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>, n_stocks)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.0002</span>, n_stocks)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>idio_vols <span class="op">=</span> np.random.uniform(<span class="fl">0.015</span>, <span class="fl">0.035</span>, n_stocks)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>price_rows <span class="op">=</span> []</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, sym <span class="kw">in</span> <span class="bu">enumerate</span>(symbols):</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    eps <span class="op">=</span> np.random.normal(<span class="dv">0</span>, idio_vols[i], T)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    rets <span class="op">=</span> alphas[i] <span class="op">+</span> betas[i] <span class="op">*</span> mkt_excess <span class="op">+</span> <span class="fl">0.3</span><span class="op">*</span>smb <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span>hml <span class="op">+</span> eps</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        price_rows.append({</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'symbol'</span>: sym, <span class="st">'date'</span>: dates[j], <span class="st">'ret'</span>: rets[j],</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ret_excess'</span>: rets[j] <span class="op">-</span> rf_daily,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'risk_free'</span>: rf_daily,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mktcap'</span>: np.random.uniform(<span class="dv">100</span>, <span class="dv">5000</span>),</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>prices_sim <span class="op">=</span> pd.DataFrame(price_rows)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated events: 50 random firm-dates with KNOWN positive AR ---</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>event_indices <span class="op">=</span> np.random.choice(<span class="bu">range</span>(<span class="dv">250</span>, T<span class="op">-</span><span class="dv">50</span>), <span class="dv">50</span>, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>event_firms <span class="op">=</span> np.random.choice(symbols, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>event_dates_sim <span class="op">=</span> [dates[i] <span class="cf">for</span> i <span class="kw">in</span> event_indices]</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Inject abnormal returns on event date (2% positive shock)</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> firm, edate <span class="kw">in</span> <span class="bu">zip</span>(event_firms, event_dates_sim):</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> (prices_sim[<span class="st">'symbol'</span>] <span class="op">==</span> firm) <span class="op">&amp;</span> (prices_sim[<span class="st">'date'</span>] <span class="op">==</span> edate)</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    prices_sim.loc[mask, <span class="st">'ret'</span>] <span class="op">+=</span> <span class="fl">0.02</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    prices_sim.loc[mask, <span class="st">'ret_excess'</span>] <span class="op">+=</span> <span class="fl">0.02</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>events_sim <span class="op">=</span> pd.DataFrame({</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'symbol'</span>: event_firms,</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event_date'</span>: event_dates_sim,</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'group'</span>: np.random.choice([<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">50</span>)</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Simulated data: </span><span class="sc">{</span>n_stocks<span class="sc">}</span><span class="ss"> stocks √ó </span><span class="sc">{</span>T<span class="sc">}</span><span class="ss"> days = </span><span class="sc">{</span><span class="bu">len</span>(prices_sim)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Events: </span><span class="sc">{</span><span class="bu">len</span>(events_sim)<span class="sc">}</span><span class="ss"> firm-event pairs"</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Injected abnormal return: +2% on event date"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simulated data: 100 stocks √ó 1279 days = 127,900 obs
Events: 50 firm-event pairs
Injected abnormal return: +2% on event date</code></pre>
</div>
</div>
<section id="running-the-full-pipeline" class="level3" data-number="40.4.1">
<h3 data-number="40.4.1" class="anchored" data-anchor-id="running-the-full-pipeline"><span class="header-section-number">40.4.1</span> Running the Full Pipeline</h3>
<div id="run-pipeline" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> EventStudyConfig(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> run_event_study(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_sim,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_sim,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_sim,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ïê‚ïê‚ïê Event Study: ff3 model ‚ïê‚ïê‚ïê
  Windows: estimation=150, gap=15, event=(-10,10)
  Min obs: 120

Step 1: Building trading calendar...
  1094 potential event dates

Step 2: Aligning events to trading calendar...
  50 aligned events

Step 3: Extracting returns and merging factors...
  Extracted 9,300 obs for 50 firm-events

Step 4: Estimating risk model parameters...
  Estimated 50/50 firm-events (mean R^2 = 0.2368)

Step 5: Computing abnormal returns...
  50 firm-events | Mean CAR: 0.033009 | Mean BHAR: 0.032498 | % positive: 60.0%

Step 6: Computing test statistics...
  Done.

‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê
group  N  mean_CAR  mean_BHAR  pct_positive     t_CS     p_CS    t_BMP    p_BMP     t_KP     p_KP
  All 50  0.033009   0.032498      0.600000 2.288362 0.026468 2.157106 0.035929 2.161291 0.035587
    1 20  0.030704   0.028326      0.650000 1.568676 0.133227 1.248382 0.227056 1.249320 0.226720
    2 30  0.034545   0.035280      0.566667 1.688848 0.101975 1.734699 0.093413 1.736689 0.093055</code></pre>
</div>
</div>
</section>
<section id="visualizing-results" class="level3" data-number="40.4.2">
<h3 data-number="40.4.2" class="anchored" data-anchor-id="visualizing-results"><span class="header-section-number">40.4.2</span> Visualizing Results</h3>
<div id="cell-fig-car-dynamics" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> plot_event_study(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    results[<span class="st">'daily_stats'</span>],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Event Study: FF3 Model ‚Äî Simulated Vietnamese Market"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-car-dynamics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-car-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="60_event_studies_files/figure-html/fig-car-dynamics-output-1.png" width="963" height="602" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-car-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.1: Dynamics of cumulative abnormal returns (CARs) and buy-and-hold abnormal returns (BHARs) around the event date. The positive jump at t=0 reflects the injected 2% abnormal return.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-car-distribution" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> plot_car_distribution(results[<span class="st">'event_ar'</span>], <span class="st">'CAR'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-car-distribution" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-car-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="60_event_studies_files/figure-html/fig-car-distribution-output-1.png" width="1142" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-car-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.2: Cross-sectional distribution of cumulative abnormal returns. The rightward shift from zero and positive skewness are consistent with the injected positive event effect.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="complete-test-statistics" class="level3" data-number="40.4.3">
<h3 data-number="40.4.3" class="anchored" data-anchor-id="complete-test-statistics"><span class="header-section-number">40.4.3</span> Complete Test Statistics</h3>
<div id="tbl-test-results" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-test-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.3: Event study test statistics for the full sample and by subgroup
</figcaption>
<div aria-describedby="tbl-test-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for display</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> results[<span class="st">'test_stats'</span>].copy()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select key columns</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'Z_Patell'</span>, <span class="st">'p_Patell'</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Z_GSign'</span>, <span class="st">'p_GSign'</span>, <span class="st">'t_SkAdj'</span>, <span class="st">'p_SkAdj'</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> ts.columns]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>display_df <span class="op">=</span> ts[avail].copy()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> display_df.columns:</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> [<span class="st">'N'</span>]:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].astype(<span class="bu">int</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c.startswith(<span class="st">'p_'</span>):</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="kw">in</span> [<span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'pct_positive'</span>:</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.1%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(display_df[c].iloc[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)):</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(display_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>group  N mean_CAR mean_BHAR pct_positive  t_CS   p_CS Z_Patell p_Patell t_BMP  p_BMP  t_KP   p_KP Z_GSign p_GSign t_SkAdj p_SkAdj
  All 50  3.3009%   3.2498%        60.0% 2.288 0.0265    1.832   0.0669 2.157 0.0359 2.161 0.0356   1.414  0.1573   2.074  0.0434
    1 20  3.0704%   2.8326%        65.0% 1.569 0.1332    1.020   0.3075 1.248 0.2271 1.249 0.2267   1.342  0.1797   1.103  0.2836
    2 30  3.4545%   3.5280%        56.7% 1.689 0.1020    1.532   0.1255 1.735 0.0934 1.737 0.0931   0.730  0.4652   1.727  0.0949</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="running-multiple-models-for-robustness" class="level3" data-number="40.4.4">
<h3 data-number="40.4.4" class="anchored" data-anchor-id="running-multiple-models-for-robustness"><span class="header-section-number">40.4.4</span> Running Multiple Models for Robustness</h3>
<p>A key best practice is to report results across multiple risk models. If conclusions are robust across models, this strengthens the findings:</p>
<div id="multi-model" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>models_to_run <span class="op">=</span> [</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market-Adjusted"</span>, RiskModel.MARKET_ADJ),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market Model"</span>, RiskModel.MARKET_MODEL),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 3"</span>, RiskModel.FF3),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 5"</span>, RiskModel.FF5),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>robustness <span class="op">=</span> []</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, mdl <span class="kw">in</span> models_to_run:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>mdl</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_sim, prices_sim, factors_sim, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    robustness.append({</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'t_KP'</span>, np.nan)<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>rob_df <span class="op">=</span> pd.DataFrame(robustness)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Robustness Across Risk Models:"</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rob_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Extracted 9,300 obs for 50 firm-events
  Estimated 50/50 firm-events (mean R^2 = 0.0000)
  50 firm-events | Mean CAR: 0.029672 | Mean BHAR: 0.026468 | % positive: 62.0%
  Extracted 9,300 obs for 50 firm-events
  Estimated 50/50 firm-events (mean R^2 = 0.2198)
  50 firm-events | Mean CAR: 0.033785 | Mean BHAR: 0.029974 | % positive: 62.0%
  Extracted 9,300 obs for 50 firm-events
  Estimated 50/50 firm-events (mean R^2 = 0.2368)
  50 firm-events | Mean CAR: 0.033009 | Mean BHAR: 0.032498 | % positive: 60.0%
  Extracted 9,300 obs for 50 firm-events
  Estimated 50/50 firm-events (mean R^2 = 0.2516)
  50 firm-events | Mean CAR: 0.036479 | Mean BHAR: 0.036000 | % positive: 64.0%
Robustness Across Risk Models:
          Model  N Mean CAR Mean BHAR % Positive t (CS) t (BMP) t (KP)
Market-Adjusted 50  2.9672%   2.6468%      62.0%   2.12    2.03   2.01
   Market Model 50  3.3785%   2.9974%      62.0%   2.37    2.26   2.28
  Fama-French 3 50  3.3009%   3.2498%      60.0%   2.29    2.16   2.16
  Fama-French 5 50  3.6479%   3.6000%      64.0%   2.51    2.36   2.41</code></pre>
</div>
</div>
</section>
</section>
<section id="how-to-use-this-framework-with-your-data" class="level2" data-number="40.5">
<h2 data-number="40.5" class="anchored" data-anchor-id="how-to-use-this-framework-with-your-data"><span class="header-section-number">40.5</span> How to Use This Framework with Your Data</h2>
<section id="required-data-format" class="level3" data-number="40.5.1">
<h3 data-number="40.5.1" class="anchored" data-anchor-id="required-data-format"><span class="header-section-number">40.5.1</span> Required Data Format</h3>
<p>To run the event study on real Vietnamese market data, prepare three inputs:</p>
<p><strong>1. Stock Returns</strong> (<code>prices</code> DataFrame):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>symbol</code></td>
<td>Stock ticker</td>
<td><code>'VNM'</code></td>
</tr>
<tr class="even">
<td><code>date</code></td>
<td>Trading date</td>
<td><code>2023-06-15</code></td>
</tr>
<tr class="odd">
<td><code>ret</code> or <code>ret_excess</code></td>
<td>Daily return (decimal)</td>
<td><code>0.0123</code></td>
</tr>
<tr class="even">
<td><code>risk_free</code></td>
<td>Daily risk-free rate</td>
<td><code>0.000159</code></td>
</tr>
</tbody>
</table>
<p><strong>2. Factor Returns</strong> (<code>factors</code> DataFrame):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>date</code></td>
<td>Trading date</td>
</tr>
<tr class="even">
<td><code>mkt_excess</code></td>
<td>Market excess return</td>
</tr>
<tr class="odd">
<td><code>smb</code></td>
<td>Size factor (FF3/FF5)</td>
</tr>
<tr class="even">
<td><code>hml</code></td>
<td>Value factor (FF3/FF5)</td>
</tr>
<tr class="odd">
<td><code>rmw</code></td>
<td>Profitability factor (FF5)</td>
</tr>
<tr class="even">
<td><code>cma</code></td>
<td>Investment factor (FF5)</td>
</tr>
<tr class="odd">
<td><code>risk_free</code></td>
<td>Risk-free rate</td>
</tr>
</tbody>
</table>
<p><strong>3. Event File</strong> (<code>events</code> DataFrame):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>symbol</code></td>
<td>Stock ticker</td>
<td><code>'VNM'</code></td>
</tr>
<tr class="even">
<td><code>event_date</code></td>
<td>Event date</td>
<td><code>2023-03-15</code></td>
</tr>
<tr class="odd">
<td><code>group</code></td>
<td>(Optional) subgroup</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
</section>
<section id="minimal-usage-example" class="level3" data-number="40.5.2">
<h3 data-number="40.5.2" class="anchored" data-anchor-id="minimal-usage-example"><span class="header-section-number">40.5.2</span> Minimal Usage Example</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> pd.read_csv(<span class="st">'prices_daily.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> pd.read_csv(<span class="st">'factors_ff3_daily.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.read_csv(<span class="st">'my_events.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'event_date'</span>])</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> EventStudyConfig(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">5</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Run</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> run_event_study(events, prices, factors, config)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Access outputs</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'test_stats'</span>]    <span class="co"># Test statistics</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'event_ar'</span>]      <span class="co"># Firm-level CARs/BHARs</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'daily_ar'</span>]      <span class="co"># Daily abnormal returns</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'daily_stats'</span>]   <span class="co"># Event-time aggregates</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>plot_event_study(results[<span class="st">'daily_stats'</span>], title<span class="op">=</span><span class="st">"My Event Study"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="demonstration-with-vietnamese-market-data" class="level2" data-number="40.6">
<h2 data-number="40.6" class="anchored" data-anchor-id="demonstration-with-vietnamese-market-data"><span class="header-section-number">40.6</span> Demonstration with Vietnamese Market Data</h2>
<p>We now demonstrate the full event study pipeline using actual Vietnamese stock market data. The datasets available are:</p>
<ul>
<li><code>prices_daily</code>: <code>symbol</code>, <code>date</code>, <code>ret_excess</code>, <code>mktcap</code>, <code>mktcap_lag</code>, <code>risk_free</code></li>
<li><code>prices_monthly</code>: same structure</li>
<li><code>factors_ff3_daily</code>: <code>date</code>, <code>smb</code>, <code>hml</code>, <code>mkt_excess</code>, <code>risk_free</code></li>
<li><code>factors_ff3_monthly</code> ‚Äî monthly frequency version</li>
<li><code>factors_ff5_daily</code>: <code>date</code>, <code>smb</code>, <code>hml</code>, <code>mkt_excess</code>, <code>risk_free</code>, <code>rmw</code>, <code>cma</code></li>
<li><code>factors_ff5_monthly</code></li>
</ul>
<p>Since our data provides <code>ret_excess</code> rather than raw returns, we recover raw returns as <span class="math inline">\(R_{it} = R^e_{it} + R_{f,t}\)</span>, and the market return as <span class="math inline">\(R_{m,t} = R^e_{m,t} + R_{f,t}\)</span>. The <code>extract_event_returns()</code> function handles this automatically.</p>
<section id="loading-the-data" class="level3" data-number="40.6.1">
<h3 data-number="40.6.1" class="anchored" data-anchor-id="loading-the-data"><span class="header-section-number">40.6.1</span> Loading the Data</h3>
<div id="load-data" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Recover raw returns ---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ret = ret_excess + risk_free</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">'ret'</span>] <span class="op">=</span> prices_daily[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices_daily[<span class="st">'risk_free'</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>prices_monthly[<span class="st">'ret'</span>] <span class="op">=</span> prices_monthly[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices_monthly[<span class="st">'risk_free'</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inspect the data ---</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VIETNAMESE MARKET DATA SUMMARY"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">prices_daily: </span><span class="sc">{</span>prices_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows, "</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_daily[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> stocks, "</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_daily[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>prices_daily[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"prices_monthly: </span><span class="sc">{</span>prices_monthly<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows, "</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_monthly[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> stocks"</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">factors_ff3_daily: </span><span class="sc">{</span>factors_ff3_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> trading days"</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">list</span>(factors_ff3_daily.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"factors_ff5_daily: </span><span class="sc">{</span>factors_ff5_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> trading days"</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">list</span>(factors_ff5_daily.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample daily returns:"</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prices_daily[[<span class="st">'symbol'</span>, <span class="st">'date'</span>, <span class="st">'ret_excess'</span>, <span class="st">'ret'</span>, <span class="st">'risk_free'</span>, <span class="st">'mktcap'</span>]]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      .head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample daily factors:"</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(factors_ff3_daily.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
VIETNAMESE MARKET DATA SUMMARY
======================================================================

prices_daily: 3,462,157 rows, 1459 stocks, 2010-01-05 to 2023-12-29
prices_monthly: 165,499 rows, 1457 stocks

factors_ff3_daily: 3,126 trading days
  Columns: ['date', 'smb', 'hml', 'mkt_excess', 'risk_free']
factors_ff5_daily: 3,126 trading days
  Columns: ['date', 'smb', 'hml', 'rmw', 'cma', 'mkt_excess', 'risk_free']

Sample daily returns:
symbol       date  ret_excess      ret  risk_free     mktcap
   A32 2018-10-24   -0.000159 0.000000   0.000159 176.120000
   A32 2018-10-25   -0.000159 0.000000   0.000159 176.120000
   A32 2018-10-26   -0.000159 0.000000   0.000159 176.120000
   A32 2018-10-29   -0.000159 0.000000   0.000159 176.120000
   A32 2018-10-30   -0.000159 0.000000   0.000159 176.120000

Sample daily factors:
      date       smb       hml  mkt_excess  risk_free
2011-07-01  0.008587  0.000967   -0.019862   0.000159
2011-07-04  0.005099 -0.001099   -0.000633   0.000159
2011-07-05 -0.009088  0.010152    0.013314   0.000159
2011-07-06  0.004875 -0.003918   -0.008045   0.000159
2011-07-07 -0.011239 -0.000584    0.003391   0.000159</code></pre>
</div>
</div>
</section>
<section id="creating-sample-events" class="level3" data-number="40.6.2">
<h3 data-number="40.6.2" class="anchored" data-anchor-id="creating-sample-events"><span class="header-section-number">40.6.2</span> Creating Sample Events</h3>
<p>For this demonstration, we create a sample event file. In practice, events would come from corporate announcements (earnings, M&amp;A, dividends), regulatory changes, or other information shocks. Here we select 50 large-cap Vietnamese stocks and assign random event dates from the most recent two years of data to illustrate the pipeline mechanics.</p>
<div id="create-events" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2024</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 50 largest stocks by median market cap</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>largest <span class="op">=</span> (prices_daily.groupby(<span class="st">'symbol'</span>)[<span class="st">'mktcap'</span>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>           .median()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>           .nlargest(<span class="dv">50</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>           .index.tolist())</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Date range for events: last 2 years of data, with buffer for windows</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> prices_daily[<span class="st">'date'</span>].sort_values().unique()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>n_dates <span class="op">=</span> <span class="bu">len</span>(date_range)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Events from the middle portion (need room for estimation + event windows)</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>event_eligible <span class="op">=</span> date_range[<span class="bu">int</span>(n_dates <span class="op">*</span> <span class="fl">0.3</span>):<span class="bu">int</span>(n_dates <span class="op">*</span> <span class="fl">0.85</span>)]</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 50 random firm-event pairs</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>event_firms <span class="op">=</span> np.random.choice(largest, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>event_dates <span class="op">=</span> np.random.choice(event_eligible, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>events_demo <span class="op">=</span> pd.DataFrame({</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'symbol'</span>: event_firms,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event_date'</span>: pd.to_datetime(event_dates),</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'group'</span>: np.random.choice([<span class="st">'Group_A'</span>, <span class="st">'Group_B'</span>], <span class="dv">50</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any duplicate firm-date pairs</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>events_demo <span class="op">=</span> events_demo.drop_duplicates(subset<span class="op">=</span>[<span class="st">'symbol'</span>, <span class="st">'event_date'</span>])</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample event file: </span><span class="sc">{</span><span class="bu">len</span>(events_demo)<span class="sc">}</span><span class="ss"> firm-event observations"</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique firms: </span><span class="sc">{</span>events_demo[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>events_demo[<span class="st">'event_date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to "</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>events_demo[<span class="st">'event_date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Group distribution:"</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(events_demo[<span class="st">'group'</span>].value_counts().to_string())</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First 10 events:"</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(events_demo.sort_values(<span class="st">'event_date'</span>).head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sample event file: 50 firm-event observations
Unique firms: 35
Date range: 2014-06-25 to 2021-10-29

Group distribution:
group
Group_B    26
Group_A    24

First 10 events:
symbol event_date   group
   MCH 2014-06-25 Group_B
   SIP 2014-10-23 Group_B
   VRE 2014-11-14 Group_B
   QNS 2014-12-25 Group_A
   FOX 2015-01-16 Group_B
   THD 2015-01-26 Group_A
   QNS 2015-02-12 Group_A
   HNG 2015-05-07 Group_B
   MML 2015-08-17 Group_B
   ACV 2015-10-15 Group_A</code></pre>
</div>
</div>
</section>
<section id="daily-event-study-fama-french-3-factor-model" class="level3" data-number="40.6.3">
<h3 data-number="40.6.3" class="anchored" data-anchor-id="daily-event-study-fama-french-3-factor-model"><span class="header-section-number">40.6.3</span> Daily Event Study: Fama-French 3-Factor Model</h3>
<div id="run-daily-ff3" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>config_ff3 <span class="op">=</span> EventStudyConfig(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>results_ff3 <span class="op">=</span> run_event_study(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_demo,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_daily,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_ff3_daily,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config_ff3,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ïê‚ïê‚ïê Event Study: ff3 model ‚ïê‚ïê‚ïê
  Windows: estimation=150, gap=15, event=(-10,10)
  Min obs: 120

Step 1: Building trading calendar...
  3308 potential event dates

Step 2: Aligning events to trading calendar...
  50 aligned events

Step 3: Extracting returns and merging factors...
  Extracted 5,421 obs for 30 firm-events

Step 4: Estimating risk model parameters...
  Estimated 26/30 firm-events (mean R^2 = 0.2245)

Step 5: Computing abnormal returns...
  26 firm-events | Mean CAR: 0.021513 | Mean BHAR: 0.024885 | % positive: 61.5%

Step 6: Computing test statistics...
  Done.

‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê
  group  N  mean_CAR  mean_BHAR  pct_positive     t_CS     p_CS    t_BMP    p_BMP     t_KP     p_KP
    All 26  0.021513   0.024885      0.615385 0.774999 0.445609 0.726797 0.474101 0.699973 0.490407
Group_A 13  0.008601   0.006783      0.538462 0.211606 0.835966 0.577574 0.574229 0.567041 0.581138
Group_B 13  0.034425   0.042987      0.692308 0.879892 0.396197 0.437902 0.669236 0.429917 0.674875</code></pre>
</div>
</div>
</section>
<section id="visualizing-daily-results" class="level3" data-number="40.6.4">
<h3 data-number="40.6.4" class="anchored" data-anchor-id="visualizing-daily-results"><span class="header-section-number">40.6.4</span> Visualizing Daily Results</h3>
<div id="cell-fig-daily-car" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> plot_event_study(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    results_ff3[<span class="st">'daily_stats'</span>],</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Event Study: Fama-French 3-Factor Model ‚Äî Vietnamese Market (Daily)"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-daily-car" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daily-car-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="60_event_studies_files/figure-html/fig-daily-car-output-1.png" width="951" height="602" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daily-car-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.3: Cumulative abnormal returns around event dates for Vietnamese stocks using the Fama-French 3-factor model. The event window spans [-10, +10] trading days.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-daily-dist" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> plot_car_distribution(results_ff3[<span class="st">'event_ar'</span>], <span class="st">'CAR'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-daily-dist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daily-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="60_event_studies_files/figure-html/fig-daily-dist-output-1.png" width="1142" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daily-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.4: Cross-sectional distribution of cumulative abnormal returns (CARs) across firm-events. The histogram and Q-Q plot assess normality assumptions underlying parametric tests.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="complete-test-statistics-daily" class="level3" data-number="40.6.5">
<h3 data-number="40.6.5" class="anchored" data-anchor-id="complete-test-statistics-daily"><span class="header-section-number">40.6.5</span> Complete Test Statistics (Daily)</h3>
<div id="tbl-daily-tests" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="25">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-daily-tests-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.4: Event study test statistics for the full sample and by subgroup ‚Äî Daily frequency, FF3 model
</figcaption>
<div aria-describedby="tbl-daily-tests-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> results_ff3[<span class="st">'test_stats'</span>].copy()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'median_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'Z_Patell'</span>, <span class="st">'p_Patell'</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Z_GSign'</span>, <span class="st">'p_GSign'</span>, <span class="st">'t_SkAdj'</span>, <span class="st">'p_SkAdj'</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'W_Wilcoxon'</span>, <span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> ts.columns]</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>display_df <span class="op">=</span> ts[avail].copy()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> display_df.columns:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> [<span class="st">'N'</span>]:</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].astype(<span class="bu">int</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'group'</span>:</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c.startswith(<span class="st">'p_'</span>):</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="kw">in</span> [<span class="st">'mean_CAR'</span>, <span class="st">'median_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'pct_positive'</span>:</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.1%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(display_df[c].iloc[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)):</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(display_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group  N mean_CAR median_CAR mean_BHAR pct_positive  t_CS   p_CS Z_Patell p_Patell t_BMP  p_BMP  t_KP   p_KP Z_GSign p_GSign t_SkAdj p_SkAdj W_Wilcoxon p_Wilcoxon
    All 26  2.1513%    1.5701%   2.4885%        61.5% 0.775 0.4456    0.961   0.3364 0.727 0.4741 0.700 0.4904   1.177  0.2393   0.738  0.4676    158.000     0.6710
Group_A 13  0.8601%    2.5330%   0.6783%        53.8% 0.212 0.8360    0.739   0.4596 0.578 0.5742 0.567 0.5811   0.277  0.7815   0.597  0.5618     45.000     1.0000
Group_B 13  3.4425%    1.4169%   4.2987%        69.2% 0.880 0.3962    0.620   0.5352 0.438 0.6692 0.430 0.6749   1.387  0.1655   0.444  0.6647     35.000     0.4973</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="robustness-multiple-risk-models-daily" class="level3" data-number="40.6.6">
<h3 data-number="40.6.6" class="anchored" data-anchor-id="robustness-multiple-risk-models-daily"><span class="header-section-number">40.6.6</span> Robustness: Multiple Risk Models (Daily)</h3>
<div id="tbl-robustness-daily" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="26">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-robustness-daily-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.5: Robustness of event study results across risk models ‚Äî Daily frequency
</figcaption>
<div aria-describedby="tbl-robustness-daily-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>models_daily <span class="op">=</span> [</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market-Adjusted"</span>,  RiskModel.MARKET_ADJ,    factors_ff3_daily),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market Model"</span>,     RiskModel.MARKET_MODEL,   factors_ff3_daily),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 3"</span>,    RiskModel.FF3,            factors_ff3_daily),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 5"</span>,    RiskModel.FF5,            factors_ff5_daily),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>robustness_daily <span class="op">=</span> []</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, mdl, facs <span class="kw">in</span> models_daily:</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>mdl</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_demo, prices_daily, facs, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    robustness_daily.append({</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Median CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'median_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_CS'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'t_KP'</span>, np.nan)<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'p_KP'</span>, np.nan)<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>rob_daily_df <span class="op">=</span> pd.DataFrame(robustness_daily)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Robustness Across Risk Models (Daily Frequency)"</span>)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rob_daily_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Extracted 5,421 obs for 30 firm-events
  Estimated 28/30 firm-events (mean R^2 = 0.0000)
  28 firm-events | Mean CAR: 0.035338 | Mean BHAR: 0.036936 | % positive: 50.0%
  Extracted 5,421 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.1960)
  26 firm-events | Mean CAR: 0.032107 | Mean BHAR: 0.033221 | % positive: 61.5%
  Extracted 5,421 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2245)
  26 firm-events | Mean CAR: 0.021513 | Mean BHAR: 0.024885 | % positive: 61.5%
  Extracted 5,421 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2675)
  26 firm-events | Mean CAR: 0.025684 | Mean BHAR: 0.028399 | % positive: 57.7%
Robustness Across Risk Models (Daily Frequency)
====================================================================================================
          Model  N Mean CAR Median CAR Mean BHAR % Positive t (CS) p (CS) t (BMP) p (BMP) t (KP) p (KP)
Market-Adjusted 28  3.5338%    0.2610%   3.6936%      50.0%  1.390 0.1758   1.103  0.2798  1.062 0.2975
   Market Model 26  3.2107%    0.6925%   3.3221%      61.5%  1.198 0.2422   1.146  0.2625  1.107 0.2789
  Fama-French 3 26  2.1513%    1.5701%   2.4885%      61.5%  0.775 0.4456   0.727  0.4741  0.700 0.4904
  Fama-French 5 26  2.5684%    2.3619%   2.8399%      57.7%  0.968 0.3422   0.987  0.3332  0.962 0.3451</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="robustness-multiple-event-windows" class="level3" data-number="40.6.7">
<h3 data-number="40.6.7" class="anchored" data-anchor-id="robustness-multiple-event-windows"><span class="header-section-number">40.6.7</span> Robustness: Multiple Event Windows</h3>
<p>A key practice is to examine sensitivity to the event window specification:</p>
<div id="tbl-robustness-windows" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="27">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-robustness-windows-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.6: Sensitivity of results to event window specification
</figcaption>
<div aria-describedby="tbl-robustness-windows-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>windows <span class="op">=</span> [</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-1, +1)"</span>,  <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-3, +3)"</span>,  <span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-5, +5)"</span>,  <span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-10, +10)"</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-1, +5)"</span>,  <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-5, +1)"</span>,  <span class="op">-</span><span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(0, 0)"</span>,     <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>window_results <span class="op">=</span> []</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, ws, we <span class="kw">in</span> windows:</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=</span>ws, event_window_end<span class="op">=</span>we,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_demo, prices_daily, factors_ff3_daily, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    window_results.append({</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Window'</span>: label,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Days'</span>: we <span class="op">-</span> ws <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>win_df <span class="op">=</span> pd.DataFrame(window_results)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sensitivity to Event Window Specification (FF3 Model)"</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(win_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Extracted 4,899 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2147)
  26 firm-events | Mean CAR: 0.004074 | Mean BHAR: 0.004648 | % positive: 50.0%
  Extracted 5,015 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2155)
  26 firm-events | Mean CAR: 0.003761 | Mean BHAR: 0.004327 | % positive: 42.3%
  Extracted 5,131 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2217)
  26 firm-events | Mean CAR: -0.001133 | Mean BHAR: 0.001027 | % positive: 42.3%
  Extracted 5,421 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2245)
  26 firm-events | Mean CAR: 0.021513 | Mean BHAR: 0.024885 | % positive: 61.5%
  Extracted 5,019 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2147)
  26 firm-events | Mean CAR: -0.005096 | Mean BHAR: -0.005148 | % positive: 42.3%
  Extracted 5,011 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2217)
  26 firm-events | Mean CAR: 0.008600 | Mean BHAR: 0.010441 | % positive: 46.2%
  Extracted 4,841 obs for 30 firm-events
  Estimated 26/30 firm-events (mean R^2 = 0.2150)
  26 firm-events | Mean CAR: 0.000344 | Mean BHAR: 0.000502 | % positive: 46.2%
Sensitivity to Event Window Specification (FF3 Model)
==========================================================================================
    Window  Days  N Mean CAR Mean BHAR % Positive t (CS) t (BMP) p (BMP)
  (-1, +1)     3 26  0.4074%   0.4648%      50.0%  0.456   0.601  0.5535
  (-3, +3)     7 26  0.3761%   0.4327%      42.3%  0.198   0.361  0.7211
  (-5, +5)    11 26 -0.1133%   0.1027%      42.3% -0.049   0.030  0.9761
(-10, +10)    21 26  2.1513%   2.4885%      61.5%  0.775   0.727  0.4741
  (-1, +5)     7 26 -0.5096%  -0.5148%      42.3% -0.385  -0.068  0.9460
  (-5, +1)     7 26  0.8600%   1.0441%      46.2%  0.439   0.429  0.6715
    (0, 0)     1 26  0.0344%   0.0502%      46.2%  0.064  -0.020  0.9840</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="monthly-event-study-fama-french-3-factor-model" class="level3" data-number="40.6.8">
<h3 data-number="40.6.8" class="anchored" data-anchor-id="monthly-event-study-fama-french-3-factor-model"><span class="header-section-number">40.6.8</span> Monthly Event Study: Fama-French 3-Factor Model</h3>
<p>For longer-horizon studies, monthly frequency is appropriate. Note that the estimation window is specified in months rather than days:</p>
<div id="run-monthly-ff3" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create monthly events aligned to the monthly data</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Map daily event dates to the corresponding month-end</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_demo.copy()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>events_monthly[<span class="st">'event_date'</span>] <span class="op">=</span> events_monthly[<span class="st">'event_date'</span>].dt.to_period(<span class="st">'M'</span>).dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use month-end dates from monthly prices</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>monthly_dates <span class="op">=</span> prices_monthly[<span class="st">'date'</span>].sort_values().unique()</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter events to dates present in monthly data</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_monthly[events_monthly[<span class="st">'event_date'</span>].isin(monthly_dates)]</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_monthly.drop_duplicates(subset<span class="op">=</span>[<span class="st">'symbol'</span>, <span class="st">'event_date'</span>])</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>config_monthly <span class="op">=</span> EventStudyConfig(</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">36</span>,     <span class="co"># 36 months</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">3</span>,    <span class="co"># 3 months before</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">3</span>,       <span class="co"># 3 months after</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">3</span>,                    <span class="co"># 3-month gap</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">24</span>,    <span class="co"># At least 24 months</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(events_monthly) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    results_monthly <span class="op">=</span> run_event_study(</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        events<span class="op">=</span>events_monthly,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>        prices<span class="op">=</span>prices_monthly,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>        factors<span class="op">=</span>factors_ff3_monthly,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>config_monthly,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>        group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Monthly Test Statistics ---"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    ts_m <span class="op">=</span> results_monthly[<span class="st">'test_stats'</span>]</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    mcols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>             <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>]</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    mavail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> mcols <span class="cf">if</span> c <span class="kw">in</span> ts_m.columns]</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ts_m[mavail].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No monthly events could be aligned. Skipping monthly study."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ïê‚ïê‚ïê Event Study: ff3 model ‚ïê‚ïê‚ïê
  Windows: estimation=36, gap=3, event=(-3,3)
  Min obs: 24

Step 1: Building trading calendar...
  122 potential event dates

Step 2: Aligning events to trading calendar...
  50 aligned events

Step 3: Extracting returns and merging factors...
  Extracted 1,036 obs for 33 firm-events

Step 4: Estimating risk model parameters...
  Estimated 18/33 firm-events (mean R^2 = 0.3218)

Step 5: Computing abnormal returns...
  18 firm-events | Mean CAR: -0.005257 | Mean BHAR: -0.014576 | % positive: 55.6%

Step 6: Computing test statistics...
  Done.

‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê
  group  N  mean_CAR  mean_BHAR  pct_positive      t_CS     p_CS     t_BMP    p_BMP      t_KP     p_KP
    All 18 -0.005257  -0.014576      0.555556 -0.081058 0.936342 -0.249547 0.805928 -0.320212 0.752709
Group_A  7 -0.141756  -0.135084      0.428571 -1.102110 0.312648 -1.357452 0.223472 -1.462577 0.193905
Group_B 11  0.081606   0.062111      0.636364  1.390317 0.194599  1.177372 0.266309  1.342593 0.209085

--- Monthly Test Statistics ---
  group  N  mean_CAR  mean_BHAR  pct_positive      t_CS     p_CS     t_BMP    p_BMP
    All 18 -0.005257  -0.014576      0.555556 -0.081058 0.936342 -0.249547 0.805928
Group_A  7 -0.141756  -0.135084      0.428571 -1.102110 0.312648 -1.357452 0.223472
Group_B 11  0.081606   0.062111      0.636364  1.390317 0.194599  1.177372 0.266309</code></pre>
</div>
</div>
<div id="cell-fig-monthly-car" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(events_monthly) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="st">'daily_stats'</span> <span class="kw">in</span> results_monthly:</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    fig3 <span class="op">=</span> plot_event_study(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        results_monthly[<span class="st">'daily_stats'</span>],</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Event Study: FF3 Model ‚Äî Vietnamese Market (Monthly)"</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-monthly-car" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-monthly-car-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="60_event_studies_files/figure-html/fig-monthly-car-output-1.png" width="962" height="602" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-monthly-car-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.5: Monthly cumulative abnormal returns around event dates. Wider windows capture slower information incorporation typical of emerging markets.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="daily-event-study-fama-french-5-factor-model" class="level3" data-number="40.6.9">
<h3 data-number="40.6.9" class="anchored" data-anchor-id="daily-event-study-fama-french-5-factor-model"><span class="header-section-number">40.6.9</span> Daily Event Study: Fama-French 5-Factor Model</h3>
<div id="run-daily-ff5" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>config_ff5 <span class="op">=</span> EventStudyConfig(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF5</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>results_ff5 <span class="op">=</span> run_event_study(</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_demo,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_daily,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_ff5_daily,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config_ff5,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ïê‚ïê‚ïê Event Study: ff5 model ‚ïê‚ïê‚ïê
  Windows: estimation=150, gap=15, event=(-10,10)
  Min obs: 120

Step 1: Building trading calendar...
  3308 potential event dates

Step 2: Aligning events to trading calendar...
  50 aligned events

Step 3: Extracting returns and merging factors...
  Extracted 5,421 obs for 30 firm-events

Step 4: Estimating risk model parameters...
  Estimated 26/30 firm-events (mean R^2 = 0.2675)

Step 5: Computing abnormal returns...
  26 firm-events | Mean CAR: 0.025684 | Mean BHAR: 0.028399 | % positive: 57.7%

Step 6: Computing test statistics...
  Done.

‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê
  group  N  mean_CAR  mean_BHAR  pct_positive     t_CS     p_CS    t_BMP    p_BMP     t_KP     p_KP
    All 26  0.025684   0.028399      0.576923 0.968332 0.342154 0.986788 0.333201 0.962252 0.345139
Group_A 13  0.015352   0.013489      0.461538 0.393655 0.700741 0.786232 0.446980 0.776663 0.452395
Group_B 13  0.036016   0.043309      0.692308 0.965100 0.353542 0.585915 0.568789 0.578785 0.573438</code></pre>
</div>
</div>
</section>
<section id="comparing-ff3-vs-ff5-estimation-quality" class="level3" data-number="40.6.10">
<h3 data-number="40.6.10" class="anchored" data-anchor-id="comparing-ff3-vs-ff5-estimation-quality"><span class="header-section-number">40.6.10</span> Comparing FF3 vs FF5 Estimation Quality</h3>
<div id="tbl-model-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="31">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.7: Comparison of estimation quality between FF3 and FF5 models
</figcaption>
<div aria-describedby="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>params_ff3 <span class="op">=</span> results_ff3[<span class="st">'params'</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>params_ff5 <span class="op">=</span> results_ff5[<span class="st">'params'</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model Estimation Diagnostics"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'Metric'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'FF3'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'FF5'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">54</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Firm-events estimated'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(params_ff3)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(params_ff5)<span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean R^2'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Median R^2'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'r_squared'</span>]<span class="sc">.</span>median()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'r_squared'</span>]<span class="sc">.</span>median()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean œÉ(Œµ)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'sigma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'sigma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss">"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean |Œ±|'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'alpha'</span>]<span class="sc">.</span><span class="bu">abs</span>()<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'alpha'</span>]<span class="sc">.</span><span class="bu">abs</span>()<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss">"</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(MKT)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_mkt_excess'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_mkt_excess'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_smb'</span> <span class="kw">in</span> params_ff3.columns:</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(SMB)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_smb'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_smb'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_hml'</span> <span class="kw">in</span> params_ff3.columns:</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(HML)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_hml'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_hml'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_rmw'</span> <span class="kw">in</span> params_ff5.columns:</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(RMW)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'‚Äî'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_rmw'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_cma'</span> <span class="kw">in</span> params_ff5.columns:</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(CMA)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'‚Äî'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_cma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Estimation Diagnostics
============================================================

Metric                                  FF3          FF5
------------------------------------------------------
Firm-events estimated                    26           26
Mean R^2                             0.2245       0.2675
Median R^2                           0.1943       0.2692
Mean œÉ(Œµ)                          0.021753     0.021351
Mean |Œ±|                           0.001022     0.001130
Mean Œ≤(MKT)                          0.8867       0.9721
Mean Œ≤(SMB)                         -0.0434       0.0265
Mean Œ≤(HML)                          0.2489       0.1493
Mean Œ≤(RMW)                               ‚Äî      -0.0934
Mean Œ≤(CMA)                               ‚Äî       0.1070</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="event-level-detail" class="level3" data-number="40.6.11">
<h3 data-number="40.6.11" class="anchored" data-anchor-id="event-level-detail"><span class="header-section-number">40.6.11</span> Event-Level Detail</h3>
<div id="tbl-event-detail" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="32">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-event-detail-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.8: Event-level detail: CARs and BHARs for each firm-event (FF3 model)
</figcaption>
<div aria-describedby="tbl-event-detail-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>detail <span class="op">=</span> results_ff3[<span class="st">'event_ar'</span>].copy()</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>detail_cols <span class="op">=</span> [<span class="st">'symbol'</span>, <span class="st">'evtdate'</span>, <span class="st">'CAR'</span>, <span class="st">'BHAR'</span>, <span class="st">'SCAR'</span>, <span class="st">'sigma'</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">'nobs'</span>, <span class="st">'alpha'</span>, <span class="st">'beta_mkt_excess'</span>]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>detail_avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> detail_cols <span class="cf">if</span> c <span class="kw">in</span> detail.columns]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>detail_show <span class="op">=</span> detail[detail_avail].copy()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'CAR'</span>] <span class="op">=</span> detail_show[<span class="st">'CAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'BHAR'</span>] <span class="op">=</span> detail_show[<span class="st">'BHAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'SCAR'</span>] <span class="op">=</span> detail_show[<span class="st">'SCAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Event-Level Results (first 20 firm-events)"</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(detail_show.head(<span class="dv">20</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Event-Level Results (first 20 firm-events)
====================================================================================================
symbol    evtdate       CAR      BHAR   SCAR    sigma  nobs     alpha  beta_mkt_excess
   BVH 2016-10-20 -12.6456% -11.6522% -1.603 0.017219   150  0.001193         1.449182
   DHG 2016-01-25  16.1151%  17.1149%  2.273 0.015472   150 -0.000224         0.754245
   DNH 2019-10-14   1.7233%   1.8068%  0.104 0.036035   150 -0.000781         1.861996
   DPM 2020-07-30  -5.9576%  -6.2025% -0.545 0.023873   150  0.001279         0.313932
   FOX 2021-01-13   2.7478%   2.9194%  0.329 0.018243   150 -0.000696         0.148058
   GAS 2020-02-11   0.5371%   0.7801%  0.100 0.011694   150  0.000501         1.851155
   GEX 2020-08-20  11.9985%  13.5843%  1.197 0.021883   150  0.000944         1.583418
   IDC 2018-10-01   1.3889%   0.5651%  0.094 0.032120   150 -0.000674         0.809305
   MML 2021-10-29 -12.0139% -12.3759% -1.141 0.022985   150  0.002976         0.260588
   MSN 2015-10-23  -5.7205%  -5.5645% -0.718 0.017375   150  0.001177         0.453951
   PGV 2019-06-26  -7.5892%  -9.1366% -0.359 0.046165   150  0.000502         0.151377
   PLX 2020-01-07   2.5330%   2.7847%  0.423 0.013067   150 -0.000176         0.917578
   PLX 2020-06-01  -6.1517%  -6.0085% -0.739 0.018168   150 -0.000465         1.815178
   POW 2020-12-23   7.7751%   9.1225%  1.130 0.015014   150 -0.000575         0.774423
   PVD 2020-05-25   4.8827%   5.6674%  0.510 0.020875   150 -0.001522         1.316102
   PVS 2017-08-07   2.1360%   2.1918%  0.297 0.015715   150 -0.000341         1.136273
   QNS 2018-01-18   4.3001%   3.4011%  0.530 0.017703   150 -0.003716         0.128328
   SAB 2017-08-24   6.0347%   6.7732%  0.748 0.017614   150  0.003284         2.123751
   SNZ 2019-03-12  34.5230%  33.1105%  2.145 0.035121   150  0.000235        -1.015554
   VCI 2020-01-20  -3.3191%  -2.9072% -0.458 0.015797   150  0.000335        -0.086268</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="daily-abnormal-return-dynamics" class="level3" data-number="40.6.12">
<h3 data-number="40.6.12" class="anchored" data-anchor-id="daily-abnormal-return-dynamics"><span class="header-section-number">40.6.12</span> Daily Abnormal Return Dynamics</h3>
<div id="tbl-daily-dynamics" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="33">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-daily-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40.9: Daily dynamics of mean abnormal returns and test statistics within the event window
</figcaption>
<div aria-describedby="tbl-daily-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> results_ff3[<span class="st">'daily_stats'</span>].copy()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ds_cols <span class="op">=</span> [<span class="st">'evttime'</span>, <span class="st">'N'</span>, <span class="st">'mean_AR'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'t_AR_CS'</span>, <span class="st">'t_AR_BMP'</span>]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ds_avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> ds_cols <span class="cf">if</span> c <span class="kw">in</span> ds.columns]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ds_show <span class="op">=</span> ds[ds_avail].copy()</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'mean_AR'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> ds_show.columns:</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        ds_show[c] <span class="op">=</span> ds_show[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'t_AR_CS'</span>, <span class="st">'t_AR_BMP'</span>]:</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> ds_show.columns:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        ds_show[c] <span class="op">=</span> ds_show[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Daily Event-Window Dynamics (FF3 Model)"</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds_show.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daily Event-Window Dynamics (FF3 Model)
================================================================================
 evttime  N  mean_AR mean_CAR mean_BHAR
     -10 23  0.3571%  0.3571%   0.3729%
      -9 23  0.0337%  0.3907%   0.4209%
      -8 23 -0.1581%  0.2326%   0.2766%
      -7 23  0.3691%  0.6018%   0.6581%
      -6 23  1.3416%  1.9433%   2.0278%
      -5 23  0.1509%  2.0942%   2.2313%
      -4 23  0.5512%  2.6454%   2.9187%
      -3 23 -0.4641%  2.1814%   2.4297%
      -2 23  0.2412%  2.4225%   2.8028%
      -1 23  0.5660%  2.9885%   3.3240%
       0 23 -0.0281%  2.9604%   3.4926%
       1 23 -0.2564%  2.7040%   3.1039%
       2 23 -0.4421%  2.2619%   2.5764%
       3 23  0.6337%  2.8956%   3.4659%
       4 23 -0.8432%  2.0524%   2.4738%
       5 23 -0.4174%  1.6350%   2.1339%
       6 23 -0.2272%  1.4078%   1.8085%
       7 23 -0.2085%  1.1993%   1.6819%
       8 23  0.0893%  1.2886%   1.8609%
       9 23  0.3307%  1.6193%   2.1658%
      10 23  0.5320%  2.1513%   2.4885%</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="summary-of-key-findings" class="level3" data-number="40.6.13">
<h3 data-number="40.6.13" class="anchored" data-anchor-id="summary-of-key-findings"><span class="header-section-number">40.6.13</span> Summary of Key Findings</h3>
<div id="summary" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EVENT STUDY RESULTS SUMMARY"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>ff3_all <span class="op">=</span> results_ff3[<span class="st">'test_stats'</span>][results_ff3[<span class="st">'test_stats'</span>][<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample: </span><span class="sc">{</span><span class="bu">int</span>(ff3_all[<span class="st">'N'</span>])<span class="sc">}</span><span class="ss"> firm-event observations"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Frequency: Daily"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Primary Model: Fama-French 3-Factor"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimation Window: </span><span class="sc">{</span>config_ff3<span class="sc">.</span>estimation_window<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event Window: (</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Gap: </span><span class="sc">{</span>config_ff3<span class="sc">.</span>gap<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Abnormal Return Measures ---"</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean CAR(</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">): "</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>ff3_all[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median CAR: </span><span class="sc">{</span>ff3_all[<span class="st">'median_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean BHAR: </span><span class="sc">{</span>ff3_all[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fraction positive CARs: </span><span class="sc">{</span>ff3_all[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Statistical Significance ---"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cross-Sectional t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_CS'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Patell Z: </span><span class="sc">{</span>ff3_all[<span class="st">'Z_Patell'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_Patell'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"BMP t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kolari-Pynn√∂nen t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_KP'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_KP'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Generalized Sign Z: </span><span class="sc">{</span>ff3_all[<span class="st">'Z_GSign'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_GSign'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>sig_005 <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'p_CS'</span>,<span class="st">'p_Patell'</span>,<span class="st">'p_BMP'</span>,<span class="st">'p_KP'</span>,<span class="st">'p_GSign'</span>,<span class="st">'p_SkAdj'</span>,<span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> k <span class="kw">in</span> ff3_all <span class="kw">and</span> pd.notna(ff3_all[k]) <span class="kw">and</span> ff3_all[k] <span class="op">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>total_tests <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'p_CS'</span>,<span class="st">'p_Patell'</span>,<span class="st">'p_BMP'</span>,<span class="st">'p_KP'</span>,<span class="st">'p_GSign'</span>,<span class="st">'p_SkAdj'</span>,<span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> k <span class="kw">in</span> ff3_all <span class="kw">and</span> pd.notna(ff3_all[k]))</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>sig_005<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total_tests<span class="sc">}</span><span class="ss"> tests significant at 5% level"</span>)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Robustness note</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Robustness: Results checked across </span><span class="sc">{</span><span class="bu">len</span>(models_daily)<span class="sc">}</span><span class="ss"> risk models "</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"and </span><span class="sc">{</span><span class="bu">len</span>(windows)<span class="sc">}</span><span class="ss"> event windows"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EVENT STUDY RESULTS SUMMARY
======================================================================

Sample: 26 firm-event observations
Frequency: Daily
Primary Model: Fama-French 3-Factor
Estimation Window: 150 trading days
Event Window: (-10, 10)
Gap: 15 trading days

--- Abnormal Return Measures ---
Mean CAR(-10,10): 2.1513%
Median CAR: 1.5701%
Mean BHAR: 2.4885%
Fraction positive CARs: 61.5%

--- Statistical Significance ---
Cross-Sectional t: 0.775 (p = 0.4456)
Patell Z: 0.961 (p = 0.3364)
BMP t: 0.727 (p = 0.4741)
Kolari-Pynn√∂nen t: 0.700 (p = 0.4904)
Generalized Sign Z: 1.177 (p = 0.2393)

0/7 tests significant at 5% level

Robustness: Results checked across 4 risk models and 7 event windows</code></pre>
</div>
</div>
</section>
</section>
<section id="practical-recommendations" class="level2" data-number="40.7">
<h2 data-number="40.7" class="anchored" data-anchor-id="practical-recommendations"><span class="header-section-number">40.7</span> Practical Recommendations</h2>
<p>Based on the literature and our implementation experience:</p>
<ol type="1">
<li><p><strong>Estimation window</strong>: Use 150 trading days (~7 months) for daily studies. This balances parameter precision against structural breaks. For monthly studies, 60 months is standard <span class="citation" data-cites="kothari2007econometrics">(<a href="references.html#ref-kothari2007econometrics" role="doc-biblioref">Kothari and Warner 2007</a>)</span>.</p></li>
<li><p><strong>Gap</strong>: 15 trading days is standard. Increase to 30 if information leakage is a concern.</p></li>
<li><p><strong>Event window</strong>: Start with (-1, +1) for short-window tests, then expand to (-5, +5) and (-10, +10) for robustness. Report all windows.</p></li>
<li><p><strong>Model choice</strong>: Always report market model as the baseline. Add FF3 or FF5 for robustness. For Vietnam, local factors are preferable to global factors.</p></li>
<li><p><strong>Test statistics</strong>: Report at minimum: cross-sectional t (for ease of interpretation), BMP (robust to event-induced variance), and one non-parametric test (sign or Wilcoxon). Report Kolari-Pynn√∂nen if events cluster in calendar time.</p></li>
<li><p><strong>Thin trading</strong>: For Vietnamese small-caps, consider <span class="citation" data-cites="dimson1979risk">Dimson (<a href="references.html#ref-dimson1979risk" role="doc-biblioref">1979</a>)</span> with 1 lead/lag or increase <code>min_estimation_obs</code> to filter out illiquid stocks.</p></li>
<li><p><strong>Multiple testing</strong>: If testing multiple event windows or subgroups, apply Bonferroni or Holm corrections to control family-wise error rate.</p></li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-aharony1980quarterly" class="csl-entry" role="listitem">
Aharony, Joseph, and Itzhak Swary. 1980. <span>‚ÄúQuarterly Dividend and Earnings Announcements and Stockholders‚Äô Returns: An Empirical Analysis.‚Äù</span> <em>The Journal of Finance</em> 35 (1): 1‚Äì12.
</div>
<div id="ref-andrade2001new" class="csl-entry" role="listitem">
Andrade, Gregor, Mark Mitchell, and Erik Stafford. 2001. <span>‚ÄúNew Evidence and Perspectives on Mergers.‚Äù</span> <em>Journal of Economic Perspectives</em> 15 (2): 103‚Äì20.
</div>
<div id="ref-ball2013empirical" class="csl-entry" role="listitem">
Ball, Ray, and Philip Brown. 2013. <span>‚ÄúAn Empirical Evaluation of Accounting Income Numbers.‚Äù</span> In <em>Financial Accounting and Equity Markets</em>, 27‚Äì46. Routledge.
</div>
<div id="ref-barber1997detecting" class="csl-entry" role="listitem">
Barber, Brad M, and John D Lyon. 1997. <span>‚ÄúDetecting Long-Run Abnormal Stock Returns: The Empirical Power and Specification of Test Statistics.‚Äù</span> <em>Journal of Financial Economics</em> 43 (3): 341‚Äì72.
</div>
<div id="ref-bernard1989post" class="csl-entry" role="listitem">
Bernard, Victor L, and Jacob K Thomas. 1989. <span>‚ÄúPost-Earnings-Announcement Drift: Delayed Price Response or Risk Premium?‚Äù</span> <em>Journal of Accounting Research</em> 27: 1‚Äì36.
</div>
<div id="ref-bhattacharya2000event" class="csl-entry" role="listitem">
Bhattacharya, Utpal, Hazem Daouk, Brian Jorgenson, and Carl-Heinrich Kehr. 2000. <span>‚ÄúWhen an Event Is Not an Event: The Curious Case of an Emerging Market.‚Äù</span> <em>Journal of Financial Economics</em> 55 (1): 69‚Äì101.
</div>
<div id="ref-binder1998event" class="csl-entry" role="listitem">
Binder, John. 1998. <span>‚ÄúThe Event Study Methodology Since 1969.‚Äù</span> <em>Review of Quantitative Finance and Accounting</em> 11 (2): 111‚Äì37.
</div>
<div id="ref-boehmer1991event" class="csl-entry" role="listitem">
Boehmer, Ekkehart, Jim Masumeci, and Annette B Poulsen. 1991. <span>‚ÄúEvent-Study Methodology Under Conditions of Event-Induced Variance.‚Äù</span> <em>Journal of Financial Economics</em> 30 (2): 253‚Äì72.
</div>
<div id="ref-brown1980measuring" class="csl-entry" role="listitem">
Brown, Stephen J, and Jerold B Warner. 1980. <span>‚ÄúMeasuring Security Price Performance.‚Äù</span> <em>Journal of Financial Economics</em> 8 (3): 205‚Äì58.
</div>
<div id="ref-brown1985using" class="csl-entry" role="listitem">
‚Äî‚Äî‚Äî. 1985. <span>‚ÄúUsing Daily Stock Returns: The Case of Event Studies.‚Äù</span> <em>Journal of Financial Economics</em> 14 (1): 3‚Äì31.
</div>
<div id="ref-campbell1998econometrics" class="csl-entry" role="listitem">
Campbell, John Y, Andrew W Lo, A Craig MacKinlay, and Robert F Whitelaw. 1998. <span>‚ÄúThe Econometrics of Financial Markets.‚Äù</span> <em>Macroeconomic Dynamics</em> 2 (4): 559‚Äì62.
</div>
<div id="ref-Carhart1997" class="csl-entry" role="listitem">
Carhart, Mark M. 1997. <span>‚Äú<span class="nocase">On persistence in mutual fund performance</span>.‚Äù</span> <em><span>The Journal of Finance</span></em> 52 (1): 57‚Äì82. <a href="https://doi.org/10.1111/j.1540-6261.1997.tb03808.x">https://doi.org/10.1111/j.1540-6261.1997.tb03808.x</a>.
</div>
<div id="ref-corrado1989nonparametric" class="csl-entry" role="listitem">
Corrado, Charles J. 1989. <span>‚ÄúA Nonparametric Test for Abnormal Security-Price Performance in Event Studies.‚Äù</span> <em>Journal of Financial Economics</em> 23 (2): 385‚Äì95.
</div>
<div id="ref-cowan1992nonparametric" class="csl-entry" role="listitem">
Cowan, Arnold Richard. 1992. <span>‚ÄúNonparametric Event Study Tests.‚Äù</span> <em>Review of Quantitative Finance and Accounting</em> 2 (4): 343‚Äì58.
</div>
<div id="ref-dimson1979risk" class="csl-entry" role="listitem">
Dimson, Elroy. 1979. <span>‚ÄúRisk Measurement When Shares Are Subject to Infrequent Trading.‚Äù</span> <em>Journal of Financial Economics</em> 7 (2): 197‚Äì226.
</div>
<div id="ref-fama1998market" class="csl-entry" role="listitem">
Fama, Eugene F. 1998. <span>‚ÄúMarket Efficiency, Long-Term Returns, and Behavioral Finance.‚Äù</span> <em>Journal of Financial Economics</em> 49 (3): 283‚Äì306.
</div>
<div id="ref-fama1969adjustment" class="csl-entry" role="listitem">
Fama, Eugene F, Lawrence Fisher, Michael C Jensen, and Richard Roll. 1969. <span>‚ÄúThe Adjustment of Stock Prices to New Information.‚Äù</span> <em>International Economic Review</em> 10 (1): 1‚Äì21.
</div>
<div id="ref-Fama1993" class="csl-entry" role="listitem">
Fama, Eugene F., and Kenneth R. French. 1993. <span>‚Äú<span class="nocase">Common risk factors in the returns on stocks and bonds</span>.‚Äù</span> <em><span>Journal of Financial Economics</span></em> 33 (1): 3‚Äì56. <a href="https://doi.org/10.1016/0304-405X(93)90023-5">https://doi.org/10.1016/0304-405X(93)90023-5</a>.
</div>
<div id="ref-FamaFrench2015" class="csl-entry" role="listitem">
‚Äî‚Äî‚Äî. 2015. <span>‚ÄúA Five-Factor Asset Pricing Model.‚Äù</span> <em>Journal of Financial Economics</em> 116 (1): 1‚Äì22. <a href="https://doi.org/10.1016/j.jfineco.2014.10.010">https://doi.org/10.1016/j.jfineco.2014.10.010</a>.
</div>
<div id="ref-flannery2002macroeconomic" class="csl-entry" role="listitem">
Flannery, Mark J, and Aris A Protopapadakis. 2002. <span>‚ÄúMacroeconomic Factors Do Influence Aggregate Stock Returns.‚Äù</span> <em>The Review of Financial Studies</em> 15 (3): 751‚Äì82.
</div>
<div id="ref-griffin2010market" class="csl-entry" role="listitem">
Griffin, John M, Patrick J Kelly, and Federico Nardari. 2010. <span>‚ÄúDo Market Efficiency Measures Yield Correct Inferences? A Comparison of Developed and Emerging Markets.‚Äù</span> <em>The Review of Financial Studies</em> 23 (8): 3225‚Äì77.
</div>
<div id="ref-hall1992removal" class="csl-entry" role="listitem">
Hall, Peter. 1992. <span>‚ÄúOn the Removal of Skewness by Transformation.‚Äù</span> <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 54 (1): 221‚Äì28.
</div>
<div id="ref-jensen1983market" class="csl-entry" role="listitem">
Jensen, Michael C, and Richard S Ruback. 1983. <span>‚ÄúThe Market for Corporate Control: The Scientific Evidence.‚Äù</span> <em>Journal of Financial Economics</em> 11 (1-4): 5‚Äì50.
</div>
<div id="ref-kolari2010event" class="csl-entry" role="listitem">
Kolari, James W, and Seppo Pynn√∂nen. 2010. <span>‚ÄúEvent Study Testing with Cross-Sectional Correlation of Abnormal Returns.‚Äù</span> <em>The Review of Financial Studies</em> 23 (11): 3996‚Äì4025.
</div>
<div id="ref-kothari2007econometrics" class="csl-entry" role="listitem">
Kothari, Sagar P, and Jerold B Warner. 2007. <span>‚ÄúEconometrics of Event Studies.‚Äù</span> In <em>Handbook of Empirical Corporate Finance</em>, 3‚Äì36. Elsevier.
</div>
<div id="ref-mackinlay1997event" class="csl-entry" role="listitem">
MacKinlay, A Craig. 1997. <span>‚ÄúEvent Studies in Economics and Finance.‚Äù</span> <em>Journal of Economic Literature</em> 35 (1): 13‚Äì39.
</div>
<div id="ref-mitchell1993role" class="csl-entry" role="listitem">
Mitchell, Mark L, and Jeffry M Netter. 1993. <span>‚ÄúThe Role of Financial Economics in Securities Fraud Cases: Applications at the Securities and Exchange Commission.‚Äù</span> <em>Bus. Law.</em> 49: 545.
</div>
<div id="ref-mitchell2000managerial" class="csl-entry" role="listitem">
Mitchell, Mark L, and Erik Stafford. 2000. <span>‚ÄúManagerial Decisions and Long-Term Stock Price Performance.‚Äù</span> <em>The Journal of Business</em> 73 (3): 287‚Äì329.
</div>
<div id="ref-patell1976corporate" class="csl-entry" role="listitem">
Patell, James M. 1976. <span>‚ÄúCorporate Forecasts of Earnings Per Share and Stock Price Behavior: Empirical Test.‚Äù</span> <em>Journal of Accounting Research</em>, 246‚Äì76.
</div>
<div id="ref-scholes1977estimating" class="csl-entry" role="listitem">
Scholes, Myron, and Joseph Williams. 1977. <span>‚ÄúEstimating Betas from Nonsynchronous Data.‚Äù</span> <em>Journal of Financial Economics</em> 5 (3): 309‚Äì27.
</div>
<div id="ref-schwert1981using" class="csl-entry" role="listitem">
Schwert, G William. 1981. <span>‚ÄúUsing Financial Data to Measure Effects of Regulation.‚Äù</span> <em>The Journal of Law and Economics</em> 24 (1): 121‚Äì58.
</div>
<div id="ref-Sharpe1964" class="csl-entry" role="listitem">
Sharpe, William F. 1964. <span>‚Äú<span class="nocase">Capital asset prices: A theory of market equilibrium under conditions of risk </span>.‚Äù</span> <em><span>The Journal of Finance</span></em> 19 (3): 425‚Äì42. <a href="https://doi.org/10.1111/j.1540-6261.1964.tb02865.x">https://doi.org/10.1111/j.1540-6261.1964.tb02865.x</a>.
</div>
<div id="ref-warner1988stock" class="csl-entry" role="listitem">
Warner, Jerold B, Ross L Watts, and Karen H Wruck. 1988. <span>‚ÄúStock Prices and Top Management Changes.‚Äù</span> <em>Journal of Financial Economics</em> 20: 461‚Äì92.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "¬© " + year;
});
</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LG91D0C6RB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LG91D0C6RB');
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mikenguyen13\.github\.io\/tidy_finance_vn_vi\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./57_exchange_rate.html" class="pagination-link" aria-label="Exchange Rate Dynamics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Exchange Rate Dynamics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./61_tail_risk_extreme_events.html" class="pagination-link" aria-label="Tail Risk and Extreme Events">
        <span class="nav-page-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Tail Risk and Extreme Events</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Event Studies in Finance</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>Event studies constitute one of the most enduring and widely deployed empirical methodologies in financial economics. At their core, event studies measure the impact of a specific event on the value of a firm by examining **abnormal security returns** around the time the event occurs. The methodology rests on a simple premise: if capital markets are informationally efficient, the effect of an event will be reflected immediately in security prices, and any deviation from "normal" expected returns can be attributed to the event itself.</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>Since the pioneering work of @fama1969adjustment, who studied how stock prices adjust to new information around stock splits, event studies have become a cornerstone of empirical research across finance, accounting, economics, and law. @ball2013empirical demonstrated that accounting earnings announcements convey information to the market, a finding that launched decades of research in accounting and disclosure. The methodology has since been refined through contributions by @brown1980measuring and @brown1985using, who established the statistical properties of event study methods, and @mackinlay1997event codified best practices that remain standard today.</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>The breadth of applications is remarkable. Event studies have been used to examine the wealth effects of mergers and acquisitions <span class="co">[</span><span class="ot">@jensen1983market; @andrade2001new</span><span class="co">]</span>, earnings announcements <span class="co">[</span><span class="ot">@bernard1989post</span><span class="co">]</span>, dividend changes <span class="co">[</span><span class="ot">@aharony1980quarterly</span><span class="co">]</span>, regulatory changes <span class="co">[</span><span class="ot">@schwert1981using</span><span class="co">]</span>, executive turnover <span class="co">[</span><span class="ot">@warner1988stock</span><span class="co">]</span>, and macroeconomic announcements <span class="co">[</span><span class="ot">@flannery2002macroeconomic</span><span class="co">]</span>. In law and economics, event studies serve as the primary tool for measuring damages in securities fraud litigation <span class="co">[</span><span class="ot">@mitchell1993role</span><span class="co">]</span> and assessing the impact of regulatory interventions <span class="co">[</span><span class="ot">@binder1998event</span><span class="co">]</span>. @kothari2007econometrics documented over 500 published event studies in the top five finance journals alone between 1974 and 2000.</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Event Studies Matter</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>The enduring popularity of event studies stems from several compelling properties:</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Direct measurement of economic significance.** Unlike regression-based approaches that estimate associations, event studies directly quantify the dollar impact of events on firm value. A cumulative abnormal return (CAR) of 3% for a firm with \$10 billion market capitalization translates to \$300 million in wealth creation, which is a tangible, economically meaningful magnitude.</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Minimal maintained assumptions.** The methodology requires only semi-strong market efficiency (i.e., prices reflect publicly available information), a weaker assumption than many alternatives.</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Statistical power.** Daily event studies have remarkable power to detect abnormal performance, even with modest sample sizes. @brown1985using demonstrated that the market model detects abnormal returns of 1% or more with high reliability using samples as small as 20 securities.</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Versatility.** The basic framework accommodates events that are firm-specific or market-wide, anticipated or surprising, and can be adapted to various asset classes and market structures.</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Literature Review and Methodological Evolution</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Classical Framework (1969-1985)</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>The modern event study traces its origins to @fama1969adjustment, hereafter FFJR, who examined monthly stock returns around 940 stock splits between 1927 and 1959. Their key innovation was the use of the **market model** to decompose returns into expected (normal) and unexpected (abnormal) components.</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>@ball2013empirical independently developed a similar approach to study earnings announcements, establishing the information content of accounting data. It was a finding with profound implications for both the efficient markets hypothesis and the relevance of financial reporting.</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>@brown1980measuring provided the first systematic analysis of event study methodology using simulation. Their study of monthly data established several important results: (i) the simple market model performs at least as well as more complex models, (ii) value-weighted market indices can lead to misspecification when the sample is tilted toward smaller firms, and (iii) the standard cross-sectional test has well-specified size under the null hypothesis. Their follow-up study <span class="co">[</span><span class="ot">@brown1985using</span><span class="co">]</span> extended the analysis to daily data, documenting the importance of non-normality in daily returns and the increased power of daily versus monthly studies.</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="fu">### Risk Model Refinements (1992-2015)</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>The advent of the **Fama-French three-factor model** <span class="co">[</span><span class="ot">@Fama1993</span><span class="co">]</span> represented a major advance in modeling expected returns. Adding size (SMB) and value (HML) factors to the market model improved the cross-sectional fit of expected returns considerably. @Carhart1997 augmented this with a momentum factor (UMD), yielding the four-factor model that became standard in event studies through the 2000s. @FamaFrench2015 subsequently introduced profitability (RMW) and investment (CMA) factors in their five-factor model.</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>The choice of risk model matters for event studies primarily in **long-horizon settings**. @kothari2007econometrics showed that for short-window studies (3-5 days), the market model and multi-factor models produce virtually identical results because the incremental factors explain very little daily return variation for individual firms. However, for event windows exceeding 20 trading days, model choice can materially affect inferences.</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="fu">### Testing for Abnormal Returns (1976-2010)</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>The statistical testing of abnormal returns has evolved considerably:</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Test <span class="pp">|</span> Year <span class="pp">|</span> Key Property <span class="pp">|</span> Reference <span class="pp">|</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------|------------------|-------------------|------------------|</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Patell Z** <span class="pp">|</span> 1976 <span class="pp">|</span> Standardizes by estimation-period $\sigma$; weights firms inversely by volatility <span class="pp">|</span> @patell1976corporate <span class="pp">|</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Cross-Sectional** $t$ <span class="pp">|</span> 1980 <span class="pp">|</span> Allows event-induced variance change <span class="pp">|</span> @brown1980measuring <span class="pp">|</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **BMP** <span class="pp">|</span> 1991 <span class="pp">|</span> Robust to event-induced variance <span class="pp">|</span> @boehmer1991event <span class="pp">|</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Corrado Rank** <span class="pp">|</span> 1989 <span class="pp">|</span> Non-parametric; robust to non-normality <span class="pp">|</span> @corrado1989nonparametric <span class="pp">|</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Generalized Sign** <span class="pp">|</span> 1992 <span class="pp">|</span> Non-parametric; uses estimation-window baseline <span class="pp">|</span> @cowan1992nonparametric <span class="pp">|</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Kolari-Pynn√∂nen** <span class="pp">|</span> 2010 <span class="pp">|</span> Accounts for cross-sectional dependence <span class="pp">|</span> @kolari2010event <span class="pp">|</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Skewness-Adjusted** <span class="pp">|</span> 1992 <span class="pp">|</span> Corrects for BHAR skewness <span class="pp">|</span> @hall1992removal <span class="pp">|</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>: Summary of major event study test statistics {#tbl-tests}</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="fu">### CARs versus BHARs</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>Cumulative abnormal returns (CARs) sum daily abnormal returns, while buy-and-hold abnormal returns (BHARs) compound returns and subtract the compounded benchmark. @barber1997detecting demonstrated that BHARs better capture the actual investor experience, since investors earn compound, not cumulative, returns. However, @fama1998market and @mitchell2000managerial showed that BHARs exhibit severe cross-sectional dependence and positive skewness. For **short event windows** (under 10 days), the difference between CARs and BHARs is negligible. For longer windows, both should be reported.</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a><span class="fu">### Emerging Market Considerations</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>Event studies in emerging markets face distinct challenges:</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Thin trading.** Many emerging market securities trade infrequently, inducing bias in market model beta estimates. @scholes1977estimating and @dimson1979risk proposed corrections using leading and lagging market returns.</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Factor availability.** While Fama-French factors are readily available for developed markets, emerging market factors must often be constructed locally.</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Market microstructure.** Price limits ($\pm$ 7% on HOSE, $\pm$ 10% on HNX, $\pm$ 15% on UPCOM in Vietnam), T+2 settlement, and the absence of short-selling affect the speed of price adjustment. Researchers should consider wider event windows to accommodate slower information incorporation <span class="co">[</span><span class="ot">@bhattacharya2000event; @griffin2010market</span><span class="co">]</span>.</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mathematical Framework</span></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>This section presents the complete mathematical specification of the event study methodology. We follow the notation conventions of @campbell1998econometrics and @kothari2007econometrics.</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Timeline and Windows</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>The event study timeline is defined relative to the event date, denoted $\tau = 0$. All dates are measured in **trading days**:</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>\underbrace{T_0 + 1, \ldots, T_1}_{\text{Estimation Window (L‚ÇÅ days)}} \quad \underbrace{\quad}_{\text{Gap (G days)}} \quad \underbrace{\tau_1, \ldots, 0, \ldots, \tau_2}_{\text{Event Window (L‚ÇÇ days)}}</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Estimation window**: $L_1$ trading days over which the risk model parameters are estimated</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Gap**: $G$ trading days separating estimation and event windows, preventing contamination by pre-event information leakage</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Event window**: $L_2 = \tau_2 - \tau_1 + 1$ trading days centered around the event date</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>For example, with $L_1 = 150$, $G = 15$, $\tau_1 = -10$, $\tau_2 = +10$: the estimation window covers trading days $<span class="co">[</span><span class="ot">-175, -25</span><span class="co">]</span>$ relative to the event, and the event window covers $<span class="co">[</span><span class="ot">-10, +10</span><span class="co">]</span>$.</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normal Return Models</span></span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>Let $R_{it}$ denote the return on security $i$ on trading day $t$, $R_{ft}$ the risk-free rate, and $R_{mt}$ the market return. We implement six models:</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>**Model 0: Market-Adjusted Returns.** Assumes $\beta_i = 1$ and $\alpha_i = 0$ for all firms:</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>AR_{it}^{MA} = R_{it} - R_{mt}</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>**Model 1: Market Model** <span class="co">[</span><span class="ot">@Sharpe1964</span><span class="co">]</span>:</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>R_{it} = \alpha_i + \beta_i R_{mt} + \varepsilon_{it}, \quad E<span class="co">[</span><span class="ot">\varepsilon_{it}</span><span class="co">]</span> = 0, \quad \text{Var}<span class="co">[</span><span class="ot">\varepsilon_{it}</span><span class="co">]</span> = \sigma^2_{\varepsilon_i}</span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>AR_{it}^{MM} = R_{it} - \hat{\alpha}_i - \hat{\beta}_i R_{mt}</span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>**Model 2: Fama-French Three-Factor** <span class="co">[</span><span class="ot">@Fama1993</span><span class="co">]</span>:</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a>R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \varepsilon_{it}</span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>**Model 3: Carhart Four-Factor** <span class="co">[</span><span class="ot">@Carhart1997</span><span class="co">]</span>:</span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \beta_{i,4} \cdot UMD_t + \varepsilon_{it}</span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>**Model 4: Fama-French Five-Factor** <span class="co">[</span><span class="ot">@FamaFrench2015</span><span class="co">]</span>:</span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>R_{it} - R_{ft} = \alpha_i + \beta_{i,1}(R_{mt} - R_{ft}) + \beta_{i,2} \cdot SMB_t + \beta_{i,3} \cdot HML_t + \beta_{i,4} \cdot RMW_t + \beta_{i,5} \cdot CMA_t + \varepsilon_{it}</span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a>**Model 5: User-Specified Factor Model:**</span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a>R_{it} - R_{ft} = \alpha_i + \sum_{k=1}^{K} \beta_{i,k} F_{k,t} + \varepsilon_{it}</span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aggregation: CARs and BHARs</span></span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a>**Cumulative Abnormal Returns** sum daily abnormal returns:</span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a>CAR_i(\tau_1, \tau_2) = \sum_{t=\tau_1}^{\tau_2} AR_{it}, \qquad \overline{CAR}(\tau_1, \tau_2) = \frac{1}{N} \sum_{i=1}^{N} CAR_i(\tau_1, \tau_2)</span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a>**Buy-and-Hold Abnormal Returns** compound returns:</span>
<span id="cb55-142"><a href="#cb55-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-143"><a href="#cb55-143" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a>BHAR_i(\tau_1, \tau_2) = \prod_{t=\tau_1}^{\tau_2}(1 + R_{it}) - \prod_{t=\tau_1}^{\tau_2}(1 + \hat{E}<span class="co">[</span><span class="ot">R_{it}</span><span class="co">]</span>)</span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Standardized Returns</span></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a>The **standardized abnormal return** for firm $i$ on day $t$ is:</span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-151"><a href="#cb55-151" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-152"><a href="#cb55-152" aria-hidden="true" tabindex="-1"></a>SAR_{it} = \frac{AR_{it}}{\hat{\sigma}_{\varepsilon_i}}</span>
<span id="cb55-153"><a href="#cb55-153" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a>The **standardized cumulative abnormal return** is:</span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a>SCAR_i(\tau_1, \tau_2) = \frac{CAR_i(\tau_1, \tau_2)}{\hat{\sigma}_{\varepsilon_i} \sqrt{L_2}}</span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-161"><a href="#cb55-161" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test Statistics</span></span>
<span id="cb55-162"><a href="#cb55-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a>Let $N$ denote the number of firm-event observations.</span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a>**Test 1: Cross-Sectional** $t$-Test. Allows event-induced variance; assumes cross-sectional independence:</span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-167"><a href="#cb55-167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-168"><a href="#cb55-168" aria-hidden="true" tabindex="-1"></a>t_{CS} = \frac{\overline{CAR}}{s_{CAR}/\sqrt{N}}, \quad s_{CAR} = \sqrt{\frac{1}{N-1}\sum_{i=1}^{N}(CAR_i - \overline{CAR})^2}</span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-170"><a href="#cb55-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-171"><a href="#cb55-171" aria-hidden="true" tabindex="-1"></a>**Test 2: Patell Z-Test** <span class="co">[</span><span class="ot">@patell1976corporate</span><span class="co">]</span>. Weights firms inversely by volatility:</span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-174"><a href="#cb55-174" aria-hidden="true" tabindex="-1"></a>Z_{Patell} = \frac{\sum_{i=1}^{N} SCAR_i}{\sqrt{\sum_{i=1}^{N} \frac{K_i - 2}{K_i - 4}}}</span>
<span id="cb55-175"><a href="#cb55-175" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a>**Test 3: BMP Test** <span class="co">[</span><span class="ot">@boehmer1991event</span><span class="co">]</span>. Robust to event-induced variance:</span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a>t_{BMP} = \frac{\overline{SCAR}}{s_{SCAR}/\sqrt{N}}</span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-182"><a href="#cb55-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-183"><a href="#cb55-183" aria-hidden="true" tabindex="-1"></a>**Test 4: Kolari-Pynn√∂nen Adjusted BMP** <span class="co">[</span><span class="ot">@kolari2010event</span><span class="co">]</span>. Accounts for cross-sectional dependence:</span>
<span id="cb55-184"><a href="#cb55-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a>t_{KP} = t_{BMP} \times \sqrt{\frac{1}{1 + (N-1)\bar{r}}}</span>
<span id="cb55-187"><a href="#cb55-187" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-188"><a href="#cb55-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a>where $\bar{r}$ is the mean pairwise cross-correlation of estimation-period residuals.</span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-191"><a href="#cb55-191" aria-hidden="true" tabindex="-1"></a>**Test 5: Generalized Sign Test** <span class="co">[</span><span class="ot">@cowan1992nonparametric</span><span class="co">]</span>:</span>
<span id="cb55-192"><a href="#cb55-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-194"><a href="#cb55-194" aria-hidden="true" tabindex="-1"></a>Z_{GSign} = \frac{\hat{p} - \hat{p}_0}{\sqrt{\hat{p}_0(1-\hat{p}_0)/N}}</span>
<span id="cb55-195"><a href="#cb55-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a>**Test 6: Sign Test:**</span>
<span id="cb55-198"><a href="#cb55-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-199"><a href="#cb55-199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a>Z_{Sign} = \frac{N^{+} - 0.5N}{\sqrt{0.25N}}</span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a>**Test 7: Skewness-Adjusted** $t$-Test <span class="co">[</span><span class="ot">@hall1992removal</span><span class="co">]</span>:</span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-206"><a href="#cb55-206" aria-hidden="true" tabindex="-1"></a>t_{SA} = \sqrt{N}\left(\bar{z} + \frac{1}{3}\hat{\gamma}\bar{z}^2 + \frac{1}{27}\hat{\gamma}^2\bar{z}^3 + \frac{1}{6N}\hat{\gamma}\right)</span>
<span id="cb55-207"><a href="#cb55-207" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-208"><a href="#cb55-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a>**Test 8: Wilcoxon Signed-Rank Test:** A non-parametric test of whether the median CAR differs from zero.</span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a>The table below summarizes the assumptions of each test:</span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Test <span class="pp">|</span> Event-Induced Variance <span class="pp">|</span> Cross-Sectional Independence <span class="pp">|</span> Normality <span class="pp">|</span></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------|:----------------:|:----------------:|:----------------:|</span></span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Cross-Sectional $t$ <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Assumes <span class="pp">|</span></span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Patell Z <span class="pp">|</span> Assumes no change <span class="pp">|</span> Assumes <span class="pp">|</span> Assumes <span class="pp">|</span></span>
<span id="cb55-217"><a href="#cb55-217" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> BMP <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Assumes <span class="pp">|</span></span>
<span id="cb55-218"><a href="#cb55-218" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Kolari-Pynn√∂nen <span class="pp">|</span> Robust <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span></span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Generalized Sign <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Robust <span class="pp">|</span></span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Corrado Rank <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Robust <span class="pp">|</span></span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Skewness-Adjusted <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Partially <span class="pp">|</span></span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Wilcoxon <span class="pp">|</span> Robust <span class="pp">|</span> Assumes <span class="pp">|</span> Robust <span class="pp">|</span></span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a>: Assumption requirements for event study test statistics {#tbl-test-assumptions}</span>
<span id="cb55-225"><a href="#cb55-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-226"><a href="#cb55-226" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python Implementation</span></span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a><span class="fu">### Design Philosophy</span></span>
<span id="cb55-229"><a href="#cb55-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-230"><a href="#cb55-230" aria-hidden="true" tabindex="-1"></a>Our implementation follows these principles:</span>
<span id="cb55-231"><a href="#cb55-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-232"><a href="#cb55-232" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Modularity**: Each component (calendar, estimation, AR computation, testing) is a separate function.</span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Vectorization**: All operations use pandas/numpy for performance on large datasets.</span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Configurability**: All parameters are user-configurable via a dataclass.</span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Transparency**: Intermediate outputs are preserved for inspection.</span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Production-ready**: Comprehensive input validation, missing data handling, and edge cases.</span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup and Imports</span></span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Import required libraries"</span></span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass, field</span>
<span id="cb55-251"><a href="#cb55-251" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional, List, Tuple</span>
<span id="cb55-252"><a href="#cb55-252" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb55-253"><a href="#cb55-253" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All libraries loaded."</span>)</span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-264"><a href="#cb55-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-265"><a href="#cb55-265" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb55-266"><a href="#cb55-266" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb55-267"><a href="#cb55-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-268"><a href="#cb55-268" aria-hidden="true" tabindex="-1"></a>tidy_finance <span class="op">=</span> sqlite3.<span class="ex">connect</span>(database<span class="op">=</span><span class="st">"data/tidy_finance_python.sqlite"</span>)</span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a>factors_ff3_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff3_daily"</span>,</span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a>factors_ff5_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff5_daily"</span>,</span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a>factors_ff3_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-283"><a href="#cb55-283" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff3_monthly"</span>,</span>
<span id="cb55-284"><a href="#cb55-284" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a>factors_ff5_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"SELECT * FROM factors_ff5_monthly"</span>,</span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-294"><a href="#cb55-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, ret_excess, mktcap, mktcap_lag, risk_free</span></span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_monthly</span></span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>{<span class="st">"date"</span>}</span>
<span id="cb55-305"><a href="#cb55-305" aria-hidden="true" tabindex="-1"></a>).dropna()</span>
<span id="cb55-306"><a href="#cb55-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, ret_excess, mktcap, mktcap_lag, risk_free</span></span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_daily</span></span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>{<span class="st">"date"</span>}</span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a>).dropna()</span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-316"><a href="#cb55-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-317"><a href="#cb55-317" aria-hidden="true" tabindex="-1"></a><span class="fu">### Configuration</span></span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: config</span></span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Event study configuration"</span></span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RiskModel(Enum):</span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Supported risk models for expected return computation."""</span></span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a>    MARKET_ADJ <span class="op">=</span> <span class="st">"market_adjusted"</span></span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a>    MARKET_MODEL <span class="op">=</span> <span class="st">"market_model"</span></span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a>    FF3 <span class="op">=</span> <span class="st">"ff3"</span></span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a>    CARHART <span class="op">=</span> <span class="st">"carhart"</span></span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a>    FF5 <span class="op">=</span> <span class="st">"ff5"</span></span>
<span id="cb55-332"><a href="#cb55-332" aria-hidden="true" tabindex="-1"></a>    CUSTOM <span class="op">=</span> <span class="st">"custom"</span></span>
<span id="cb55-333"><a href="#cb55-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventStudyConfig:</span>
<span id="cb55-336"><a href="#cb55-336" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Complete configuration for an event study.</span></span>
<span id="cb55-337"><a href="#cb55-337" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a><span class="co">    estimation_window : int</span></span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a><span class="co">        Length of estimation period in trading days. Brown and Warner (1985)</span></span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a><span class="co">        suggest ‚â•100 days; MacKinlay (1997) recommends 120 as standard.</span></span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a><span class="co">    event_window_start : int</span></span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a><span class="co">        Start of event window relative to event date (e.g., -10).</span></span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a><span class="co">    event_window_end : int</span></span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a><span class="co">        End of event window relative to event date (e.g., +10).</span></span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a><span class="co">    gap : int</span></span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a><span class="co">        Trading days between estimation and event windows. Prevents</span></span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a><span class="co">        contamination from pre-event information leakage.</span></span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a><span class="co">    min_estimation_obs : int</span></span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a><span class="co">        Minimum non-missing returns required in estimation period.</span></span>
<span id="cb55-352"><a href="#cb55-352" aria-hidden="true" tabindex="-1"></a><span class="co">    risk_model : RiskModel</span></span>
<span id="cb55-353"><a href="#cb55-353" aria-hidden="true" tabindex="-1"></a><span class="co">        Risk model for computing expected returns.</span></span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a><span class="co">    custom_factors : list</span></span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a><span class="co">        Column names for user-specified factors (CUSTOM model only).</span></span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a><span class="co">    thin_trading_adj : str or None</span></span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a><span class="co">        None, 'scholes_williams', or 'dimson'.</span></span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a><span class="co">    dimson_lags : int</span></span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of leads/lags for Dimson (1979) correction.</span></span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a>    estimation_window: <span class="bu">int</span> <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a>    event_window_start: <span class="bu">int</span> <span class="op">=</span> <span class="op">-</span><span class="dv">10</span></span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>    event_window_end: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a>    gap: <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb55-365"><a href="#cb55-365" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs: <span class="bu">int</span> <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb55-366"><a href="#cb55-366" aria-hidden="true" tabindex="-1"></a>    risk_model: RiskModel <span class="op">=</span> RiskModel.MARKET_MODEL</span>
<span id="cb55-367"><a href="#cb55-367" aria-hidden="true" tabindex="-1"></a>    custom_factors: List[<span class="bu">str</span>] <span class="op">=</span> field(default_factory<span class="op">=</span><span class="bu">list</span>)</span>
<span id="cb55-368"><a href="#cb55-368" aria-hidden="true" tabindex="-1"></a>    thin_trading_adj: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a>    dimson_lags: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> event_window_length(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.event_window_end <span class="op">-</span> <span class="va">self</span>.event_window_start <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate(<span class="va">self</span>):</span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.estimation_window <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.event_window_start <span class="op">&lt;=</span> <span class="va">self</span>.event_window_end</span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.gap <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="va">self</span>.min_estimation_obs <span class="op">&lt;=</span> <span class="va">self</span>.estimation_window</span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.risk_model <span class="op">==</span> RiskModel.CUSTOM:</span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="bu">len</span>(<span class="va">self</span>.custom_factors) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate</span></span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a>config_demo <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a>config_demo.validate()</span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event window length: </span><span class="sc">{</span>config_demo<span class="sc">.</span>event_window_length<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model: </span><span class="sc">{</span>config_demo<span class="sc">.</span>risk_model<span class="sc">.</span>value<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Trading Calendar Construction</span></span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>A correct trading calendar is fundamental. It maps any event date to the exact calendar dates for the start/end of estimation and event windows, accounting for weekends, holidays, and non-trading days.</span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-400"><a href="#cb55-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-401"><a href="#cb55-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calendar</span></span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Build trading calendar"</span></span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_trading_calendar(trading_dates, config):</span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Build a trading calendar mapping event dates to window boundaries.</span></span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a><span class="co">    For each potential event date, identifies the calendar dates for the</span></span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a><span class="co">    start/end of the estimation period and event window using only actual</span></span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a><span class="co">    trading days.</span></span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb55-413"><a href="#cb55-413" aria-hidden="true" tabindex="-1"></a><span class="co">    trading_dates : array-like</span></span>
<span id="cb55-414"><a href="#cb55-414" aria-hidden="true" tabindex="-1"></a><span class="co">        Sorted unique trading dates in the market.</span></span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a><span class="co">    config : EventStudyConfig</span></span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame with columns: estper_beg, estper_end, evtwin_beg,</span></span>
<span id="cb55-420"><a href="#cb55-420" aria-hidden="true" tabindex="-1"></a><span class="co">        evtdate, evtwin_end, cal_index</span></span>
<span id="cb55-421"><a href="#cb55-421" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-422"><a href="#cb55-422" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> pd.Series(<span class="bu">sorted</span>(pd.to_datetime(trading_dates).unique()))</span>
<span id="cb55-423"><a href="#cb55-423" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(dates)</span>
<span id="cb55-424"><a href="#cb55-424" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-425"><a href="#cb55-425" aria-hidden="true" tabindex="-1"></a>    L1 <span class="op">=</span> config.estimation_window</span>
<span id="cb55-426"><a href="#cb55-426" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> config.gap</span>
<span id="cb55-427"><a href="#cb55-427" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> config.event_window_start</span>
<span id="cb55-428"><a href="#cb55-428" aria-hidden="true" tabindex="-1"></a>    L2 <span class="op">=</span> config.event_window_length</span>
<span id="cb55-429"><a href="#cb55-429" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-430"><a href="#cb55-430" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Offsets (FIRSTOBS logic)</span></span>
<span id="cb55-431"><a href="#cb55-431" aria-hidden="true" tabindex="-1"></a>    o0 <span class="op">=</span> <span class="dv">0</span>                      <span class="co"># estper_beg</span></span>
<span id="cb55-432"><a href="#cb55-432" aria-hidden="true" tabindex="-1"></a>    o1 <span class="op">=</span> L1 <span class="op">-</span> <span class="dv">1</span>                 <span class="co"># estper_end</span></span>
<span id="cb55-433"><a href="#cb55-433" aria-hidden="true" tabindex="-1"></a>    o2 <span class="op">=</span> L1 <span class="op">+</span> G                 <span class="co"># evtwin_beg</span></span>
<span id="cb55-434"><a href="#cb55-434" aria-hidden="true" tabindex="-1"></a>    o3 <span class="op">=</span> L1 <span class="op">+</span> G <span class="op">-</span> s             <span class="co"># evtdate</span></span>
<span id="cb55-435"><a href="#cb55-435" aria-hidden="true" tabindex="-1"></a>    o4 <span class="op">=</span> L1 <span class="op">+</span> G <span class="op">+</span> L2 <span class="op">-</span> <span class="dv">1</span>        <span class="co"># evtwin_end</span></span>
<span id="cb55-436"><a href="#cb55-436" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-437"><a href="#cb55-437" aria-hidden="true" tabindex="-1"></a>    max_offset <span class="op">=</span> o4</span>
<span id="cb55-438"><a href="#cb55-438" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> n <span class="op">-</span> max_offset</span>
<span id="cb55-439"><a href="#cb55-439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> valid <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb55-440"><a href="#cb55-440" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Need ‚â•</span><span class="sc">{</span>max_offset<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> trading dates, have </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-441"><a href="#cb55-441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-442"><a href="#cb55-442" aria-hidden="true" tabindex="-1"></a>    cal <span class="op">=</span> pd.DataFrame({</span>
<span id="cb55-443"><a href="#cb55-443" aria-hidden="true" tabindex="-1"></a>        <span class="st">'estper_beg'</span>: dates.iloc[o0:o0<span class="op">+</span>valid].values,</span>
<span id="cb55-444"><a href="#cb55-444" aria-hidden="true" tabindex="-1"></a>        <span class="st">'estper_end'</span>: dates.iloc[o1:o1<span class="op">+</span>valid].values,</span>
<span id="cb55-445"><a href="#cb55-445" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtwin_beg'</span>: dates.iloc[o2:o2<span class="op">+</span>valid].values,</span>
<span id="cb55-446"><a href="#cb55-446" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtdate'</span>:    dates.iloc[o3:o3<span class="op">+</span>valid].values,</span>
<span id="cb55-447"><a href="#cb55-447" aria-hidden="true" tabindex="-1"></a>        <span class="st">'evtwin_end'</span>: dates.iloc[o4:o4<span class="op">+</span>valid].values,</span>
<span id="cb55-448"><a href="#cb55-448" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb55-449"><a href="#cb55-449" aria-hidden="true" tabindex="-1"></a>    cal[<span class="st">'cal_index'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(cal)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb55-450"><a href="#cb55-450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-451"><a href="#cb55-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate window lengths using a sample row</span></span>
<span id="cb55-452"><a href="#cb55-452" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">min</span>(<span class="dv">10</span>, <span class="bu">len</span>(cal)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb55-453"><a href="#cb55-453" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> cal.iloc[idx]</span>
<span id="cb55-454"><a href="#cb55-454" aria-hidden="true" tabindex="-1"></a>    est_n <span class="op">=</span> dates[(dates <span class="op">&gt;=</span> row[<span class="st">'estper_beg'</span>]) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> row[<span class="st">'estper_end'</span>])].shape[<span class="dv">0</span>]</span>
<span id="cb55-455"><a href="#cb55-455" aria-hidden="true" tabindex="-1"></a>    evt_n <span class="op">=</span> dates[(dates <span class="op">&gt;=</span> row[<span class="st">'evtwin_beg'</span>]) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> row[<span class="st">'evtwin_end'</span>])].shape[<span class="dv">0</span>]</span>
<span id="cb55-456"><a href="#cb55-456" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> est_n <span class="op">==</span> L1, <span class="ss">f"Estimation window: </span><span class="sc">{</span>est_n<span class="sc">}</span><span class="ss"> ‚â† </span><span class="sc">{</span>L1<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb55-457"><a href="#cb55-457" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> evt_n <span class="op">==</span> L2, <span class="ss">f"Event window: </span><span class="sc">{</span>evt_n<span class="sc">}</span><span class="ss"> ‚â† </span><span class="sc">{</span>L2<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb55-458"><a href="#cb55-458" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-459"><a href="#cb55-459" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cal</span>
<span id="cb55-460"><a href="#cb55-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-461"><a href="#cb55-461" aria-hidden="true" tabindex="-1"></a><span class="co"># Demo</span></span>
<span id="cb55-462"><a href="#cb55-462" aria-hidden="true" tabindex="-1"></a>demo_dates <span class="op">=</span> pd.bdate_range(<span class="st">'2018-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'B'</span>)</span>
<span id="cb55-463"><a href="#cb55-463" aria-hidden="true" tabindex="-1"></a>demo_cal <span class="op">=</span> build_trading_calendar(demo_dates, config_demo)</span>
<span id="cb55-464"><a href="#cb55-464" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Calendar: </span><span class="sc">{</span><span class="bu">len</span>(demo_cal)<span class="sc">}</span><span class="ss"> potential event dates"</span>)</span>
<span id="cb55-465"><a href="#cb55-465" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(demo_cal.head(<span class="dv">3</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-466"><a href="#cb55-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-467"><a href="#cb55-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-468"><a href="#cb55-468" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Event Date Alignment</span></span>
<span id="cb55-469"><a href="#cb55-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-470"><a href="#cb55-470" aria-hidden="true" tabindex="-1"></a>When an event occurs on a non-trading day, align to the **next** available trading day.</span>
<span id="cb55-471"><a href="#cb55-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-474"><a href="#cb55-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-475"><a href="#cb55-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: alignment</span></span>
<span id="cb55-476"><a href="#cb55-476" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Align events to trading calendar"</span></span>
<span id="cb55-477"><a href="#cb55-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-478"><a href="#cb55-478" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> align_events(events, calendar, id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'event_date'</span>):</span>
<span id="cb55-479"><a href="#cb55-479" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Align event dates to trading calendar.</span></span>
<span id="cb55-480"><a href="#cb55-480" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-481"><a href="#cb55-481" aria-hidden="true" tabindex="-1"></a><span class="co">    Non-trading-day events are shifted forward to the next trading day.</span></span>
<span id="cb55-482"><a href="#cb55-482" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-483"><a href="#cb55-483" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb55-484"><a href="#cb55-484" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb55-485"><a href="#cb55-485" aria-hidden="true" tabindex="-1"></a><span class="co">    events : pd.DataFrame with [id_col, date_col] and optional 'group'</span></span>
<span id="cb55-486"><a href="#cb55-486" aria-hidden="true" tabindex="-1"></a><span class="co">    calendar : pd.DataFrame from build_trading_calendar()</span></span>
<span id="cb55-487"><a href="#cb55-487" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-488"><a href="#cb55-488" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb55-489"><a href="#cb55-489" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb55-490"><a href="#cb55-490" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame with window boundaries for each firm-event</span></span>
<span id="cb55-491"><a href="#cb55-491" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-492"><a href="#cb55-492" aria-hidden="true" tabindex="-1"></a>    events <span class="op">=</span> events.copy()</span>
<span id="cb55-493"><a href="#cb55-493" aria-hidden="true" tabindex="-1"></a>    events[date_col] <span class="op">=</span> pd.to_datetime(events[date_col])</span>
<span id="cb55-494"><a href="#cb55-494" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-495"><a href="#cb55-495" aria-hidden="true" tabindex="-1"></a>    cal_dates <span class="op">=</span> calendar[[<span class="st">'evtdate'</span>]].drop_duplicates().sort_values(<span class="st">'evtdate'</span>)</span>
<span id="cb55-496"><a href="#cb55-496" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-497"><a href="#cb55-497" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> pd.merge_asof(</span>
<span id="cb55-498"><a href="#cb55-498" aria-hidden="true" tabindex="-1"></a>        events.sort_values(date_col),</span>
<span id="cb55-499"><a href="#cb55-499" aria-hidden="true" tabindex="-1"></a>        cal_dates.rename(columns<span class="op">=</span>{<span class="st">'evtdate'</span>: <span class="st">'aligned_date'</span>}),</span>
<span id="cb55-500"><a href="#cb55-500" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>date_col, right_on<span class="op">=</span><span class="st">'aligned_date'</span>,</span>
<span id="cb55-501"><a href="#cb55-501" aria-hidden="true" tabindex="-1"></a>        direction<span class="op">=</span><span class="st">'forward'</span></span>
<span id="cb55-502"><a href="#cb55-502" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-503"><a href="#cb55-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-504"><a href="#cb55-504" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> merged.merge(calendar, left_on<span class="op">=</span><span class="st">'aligned_date'</span>, right_on<span class="op">=</span><span class="st">'evtdate'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb55-505"><a href="#cb55-505" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-506"><a href="#cb55-506" aria-hidden="true" tabindex="-1"></a>    shifted <span class="op">=</span> (result[date_col] <span class="op">!=</span> result[<span class="st">'evtdate'</span>]).<span class="bu">sum</span>()</span>
<span id="cb55-507"><a href="#cb55-507" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shifted <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb55-508"><a href="#cb55-508" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>shifted<span class="sc">}</span><span class="ss"> event(s) shifted to next trading day"</span>)</span>
<span id="cb55-509"><a href="#cb55-509" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-510"><a href="#cb55-510" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.rename(columns<span class="op">=</span>{date_col: <span class="st">'original_date'</span>})</span>
<span id="cb55-511"><a href="#cb55-511" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.drop_duplicates(subset<span class="op">=</span>[id_col, <span class="st">'evtdate'</span>])</span>
<span id="cb55-512"><a href="#cb55-512" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-513"><a href="#cb55-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb55-514"><a href="#cb55-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-515"><a href="#cb55-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-516"><a href="#cb55-516" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Data Extraction and Factor Merging</span></span>
<span id="cb55-517"><a href="#cb55-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-518"><a href="#cb55-518" aria-hidden="true" tabindex="-1"></a>Extract returns for each security-event across the full estimation + event window and merge risk factors.</span>
<span id="cb55-519"><a href="#cb55-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-522"><a href="#cb55-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-523"><a href="#cb55-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extraction</span></span>
<span id="cb55-524"><a href="#cb55-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Extract returns and merge factors"</span></span>
<span id="cb55-525"><a href="#cb55-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-526"><a href="#cb55-526" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_returns(aligned_events, prices, factors, config,</span>
<span id="cb55-527"><a href="#cb55-527" aria-hidden="true" tabindex="-1"></a>                    id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'date'</span>, ret_col<span class="op">=</span><span class="st">'ret'</span>,</span>
<span id="cb55-528"><a href="#cb55-528" aria-hidden="true" tabindex="-1"></a>                    mkt_col<span class="op">=</span><span class="st">'mkt_excess'</span>, rf_col<span class="op">=</span><span class="st">'risk_free'</span>):</span>
<span id="cb55-529"><a href="#cb55-529" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extract stock returns and merge risk factors for each event.</span></span>
<span id="cb55-530"><a href="#cb55-530" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-531"><a href="#cb55-531" aria-hidden="true" tabindex="-1"></a><span class="co">    For each security-event, retrieves daily returns from estper_beg</span></span>
<span id="cb55-532"><a href="#cb55-532" aria-hidden="true" tabindex="-1"></a><span class="co">    through evtwin_end and merges appropriate risk factors.</span></span>
<span id="cb55-533"><a href="#cb55-533" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-534"><a href="#cb55-534" aria-hidden="true" tabindex="-1"></a>    prices <span class="op">=</span> prices.copy()</span>
<span id="cb55-535"><a href="#cb55-535" aria-hidden="true" tabindex="-1"></a>    factors <span class="op">=</span> factors.copy()</span>
<span id="cb55-536"><a href="#cb55-536" aria-hidden="true" tabindex="-1"></a>    prices[date_col] <span class="op">=</span> pd.to_datetime(prices[date_col])</span>
<span id="cb55-537"><a href="#cb55-537" aria-hidden="true" tabindex="-1"></a>    factors[date_col] <span class="op">=</span> pd.to_datetime(factors[date_col])</span>
<span id="cb55-538"><a href="#cb55-538" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-539"><a href="#cb55-539" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recover raw return from excess return if needed</span></span>
<span id="cb55-540"><a href="#cb55-540" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ret_col <span class="kw">not</span> <span class="kw">in</span> prices.columns <span class="kw">and</span> <span class="st">'ret_excess'</span> <span class="kw">in</span> prices.columns:</span>
<span id="cb55-541"><a href="#cb55-541" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rf_col <span class="kw">in</span> factors.columns:</span>
<span id="cb55-542"><a href="#cb55-542" aria-hidden="true" tabindex="-1"></a>            prices <span class="op">=</span> prices.merge(factors[[date_col, rf_col]].drop_duplicates(),</span>
<span id="cb55-543"><a href="#cb55-543" aria-hidden="true" tabindex="-1"></a>                                  on<span class="op">=</span>date_col, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb55-544"><a href="#cb55-544" aria-hidden="true" tabindex="-1"></a>        prices[ret_col] <span class="op">=</span> prices[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices[rf_col]</span>
<span id="cb55-545"><a href="#cb55-545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-546"><a href="#cb55-546" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Factor columns based on model</span></span>
<span id="cb55-547"><a href="#cb55-547" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb55-548"><a href="#cb55-548" aria-hidden="true" tabindex="-1"></a>    fac_cols <span class="op">=</span> [mkt_col] <span class="cf">if</span> mkt_col <span class="kw">in</span> factors.columns <span class="cf">else</span> []</span>
<span id="cb55-549"><a href="#cb55-549" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rf_col <span class="kw">in</span> factors.columns:</span>
<span id="cb55-550"><a href="#cb55-550" aria-hidden="true" tabindex="-1"></a>        fac_cols.append(rf_col)</span>
<span id="cb55-551"><a href="#cb55-551" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-552"><a href="#cb55-552" aria-hidden="true" tabindex="-1"></a>    model_factors <span class="op">=</span> {</span>
<span id="cb55-553"><a href="#cb55-553" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">'smb'</span>, <span class="st">'hml'</span>],</span>
<span id="cb55-554"><a href="#cb55-554" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'umd'</span>],</span>
<span id="cb55-555"><a href="#cb55-555" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">'smb'</span>, <span class="st">'hml'</span>, <span class="st">'rmw'</span>, <span class="st">'cma'</span>],</span>
<span id="cb55-556"><a href="#cb55-556" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb55-557"><a href="#cb55-557" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-558"><a href="#cb55-558" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> model_factors.get(model, []):</span>
<span id="cb55-559"><a href="#cb55-559" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> f <span class="kw">in</span> factors.columns:</span>
<span id="cb55-560"><a href="#cb55-560" aria-hidden="true" tabindex="-1"></a>            fac_cols.append(f)</span>
<span id="cb55-561"><a href="#cb55-561" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-562"><a href="#cb55-562" aria-hidden="true" tabindex="-1"></a>    fac_cols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>([date_col] <span class="op">+</span> fac_cols))</span>
<span id="cb55-563"><a href="#cb55-563" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-564"><a href="#cb55-564" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorized merge approach: join events with prices on id + date range</span></span>
<span id="cb55-565"><a href="#cb55-565" aria-hidden="true" tabindex="-1"></a>    frames <span class="op">=</span> []</span>
<span id="cb55-566"><a href="#cb55-566" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, evt <span class="kw">in</span> aligned_events.iterrows():</span>
<span id="cb55-567"><a href="#cb55-567" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> ((prices[id_col] <span class="op">==</span> evt[id_col]) <span class="op">&amp;</span></span>
<span id="cb55-568"><a href="#cb55-568" aria-hidden="true" tabindex="-1"></a>                (prices[date_col] <span class="op">&gt;=</span> evt[<span class="st">'estper_beg'</span>]) <span class="op">&amp;</span></span>
<span id="cb55-569"><a href="#cb55-569" aria-hidden="true" tabindex="-1"></a>                (prices[date_col] <span class="op">&lt;=</span> evt[<span class="st">'evtwin_end'</span>]))</span>
<span id="cb55-570"><a href="#cb55-570" aria-hidden="true" tabindex="-1"></a>        fd <span class="op">=</span> prices.loc[mask, [id_col, date_col, ret_col]].copy()</span>
<span id="cb55-571"><a href="#cb55-571" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(fd) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb55-572"><a href="#cb55-572" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb55-573"><a href="#cb55-573" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtdate'</span>] <span class="op">=</span> evt[<span class="st">'evtdate'</span>]</span>
<span id="cb55-574"><a href="#cb55-574" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'estper_beg'</span>] <span class="op">=</span> evt[<span class="st">'estper_beg'</span>]</span>
<span id="cb55-575"><a href="#cb55-575" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'estper_end'</span>] <span class="op">=</span> evt[<span class="st">'estper_end'</span>]</span>
<span id="cb55-576"><a href="#cb55-576" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtwin_beg'</span>] <span class="op">=</span> evt[<span class="st">'evtwin_beg'</span>]</span>
<span id="cb55-577"><a href="#cb55-577" aria-hidden="true" tabindex="-1"></a>        fd[<span class="st">'evtwin_end'</span>] <span class="op">=</span> evt[<span class="st">'evtwin_end'</span>]</span>
<span id="cb55-578"><a href="#cb55-578" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'group'</span> <span class="kw">in</span> evt.index:</span>
<span id="cb55-579"><a href="#cb55-579" aria-hidden="true" tabindex="-1"></a>            fd[<span class="st">'group'</span>] <span class="op">=</span> evt[<span class="st">'group'</span>]</span>
<span id="cb55-580"><a href="#cb55-580" aria-hidden="true" tabindex="-1"></a>        frames.append(fd)</span>
<span id="cb55-581"><a href="#cb55-581" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-582"><a href="#cb55-582" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> frames:</span>
<span id="cb55-583"><a href="#cb55-583" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"No return data found for any events"</span>)</span>
<span id="cb55-584"><a href="#cb55-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-585"><a href="#cb55-585" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.concat(frames, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-586"><a href="#cb55-586" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.merge(factors[fac_cols].drop_duplicates(), on<span class="op">=</span>date_col, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb55-587"><a href="#cb55-587" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-588"><a href="#cb55-588" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Excess and market-adjusted returns</span></span>
<span id="cb55-589"><a href="#cb55-589" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rf_col <span class="kw">in</span> result.columns:</span>
<span id="cb55-590"><a href="#cb55-590" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_excess'</span>] <span class="op">=</span> result[ret_col] <span class="op">-</span> result[rf_col]</span>
<span id="cb55-591"><a href="#cb55-591" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb55-592"><a href="#cb55-592" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_excess'</span>] <span class="op">=</span> result[ret_col]</span>
<span id="cb55-593"><a href="#cb55-593" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mkt_col <span class="kw">in</span> result.columns:</span>
<span id="cb55-594"><a href="#cb55-594" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">'ret_mktadj'</span>] <span class="op">=</span> result[<span class="st">'ret_excess'</span>] <span class="op">-</span> result[mkt_col]</span>
<span id="cb55-595"><a href="#cb55-595" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-596"><a href="#cb55-596" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result.sort_values([id_col, <span class="st">'evtdate'</span>, date_col]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-597"><a href="#cb55-597" aria-hidden="true" tabindex="-1"></a>    n_evts <span class="op">=</span> result.groupby([id_col, <span class="st">'evtdate'</span>]).ngroups</span>
<span id="cb55-598"><a href="#cb55-598" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Extracted </span><span class="sc">{</span><span class="bu">len</span>(result)<span class="sc">:,}</span><span class="ss"> obs for </span><span class="sc">{</span>n_evts<span class="sc">}</span><span class="ss"> firm-events"</span>)</span>
<span id="cb55-599"><a href="#cb55-599" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb55-600"><a href="#cb55-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-601"><a href="#cb55-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-602"><a href="#cb55-602" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Risk Model Estimation</span></span>
<span id="cb55-603"><a href="#cb55-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-604"><a href="#cb55-604" aria-hidden="true" tabindex="-1"></a>Estimate risk model parameters over the estimation window.</span>
<span id="cb55-605"><a href="#cb55-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-608"><a href="#cb55-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-609"><a href="#cb55-609" aria-hidden="true" tabindex="-1"></a><span class="co"># | label: estimation</span></span>
<span id="cb55-610"><a href="#cb55-610" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-summary: "Risk model estimation"</span></span>
<span id="cb55-611"><a href="#cb55-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-612"><a href="#cb55-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-613"><a href="#cb55-613" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_model(</span>
<span id="cb55-614"><a href="#cb55-614" aria-hidden="true" tabindex="-1"></a>    event_returns, config, id_col<span class="op">=</span><span class="st">"symbol"</span>, date_col<span class="op">=</span><span class="st">"date"</span>, ret_col<span class="op">=</span><span class="st">"ret"</span></span>
<span id="cb55-615"><a href="#cb55-615" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb55-616"><a href="#cb55-616" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate risk model parameters for each firm-event.</span></span>
<span id="cb55-617"><a href="#cb55-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-618"><a href="#cb55-618" aria-hidden="true" tabindex="-1"></a><span class="co">    Runs OLS over the estimation window. Returns alpha, betas, sigma,</span></span>
<span id="cb55-619"><a href="#cb55-619" aria-hidden="true" tabindex="-1"></a><span class="co">    R^2, nobs, and residuals for cross-correlation computation.</span></span>
<span id="cb55-620"><a href="#cb55-620" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-621"><a href="#cb55-621" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb55-622"><a href="#cb55-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-623"><a href="#cb55-623" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define regression specification</span></span>
<span id="cb55-624"><a href="#cb55-624" aria-hidden="true" tabindex="-1"></a>    dep_var_map <span class="op">=</span> {</span>
<span id="cb55-625"><a href="#cb55-625" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: <span class="st">"ret_mktadj"</span>,</span>
<span id="cb55-626"><a href="#cb55-626" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: ret_col,</span>
<span id="cb55-627"><a href="#cb55-627" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: <span class="st">"ret_excess"</span>,</span>
<span id="cb55-628"><a href="#cb55-628" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: <span class="st">"ret_excess"</span>,</span>
<span id="cb55-629"><a href="#cb55-629" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: <span class="st">"ret_excess"</span>,</span>
<span id="cb55-630"><a href="#cb55-630" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: <span class="st">"ret_excess"</span>,</span>
<span id="cb55-631"><a href="#cb55-631" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-632"><a href="#cb55-632" aria-hidden="true" tabindex="-1"></a>    indep_var_map <span class="op">=</span> {</span>
<span id="cb55-633"><a href="#cb55-633" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: [],</span>
<span id="cb55-634"><a href="#cb55-634" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: [<span class="st">"mkt_excess"</span>],</span>
<span id="cb55-635"><a href="#cb55-635" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>],</span>
<span id="cb55-636"><a href="#cb55-636" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"umd"</span>],</span>
<span id="cb55-637"><a href="#cb55-637" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"rmw"</span>, <span class="st">"cma"</span>],</span>
<span id="cb55-638"><a href="#cb55-638" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb55-639"><a href="#cb55-639" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-640"><a href="#cb55-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-641"><a href="#cb55-641" aria-hidden="true" tabindex="-1"></a>    dep_var <span class="op">=</span> dep_var_map[model]</span>
<span id="cb55-642"><a href="#cb55-642" aria-hidden="true" tabindex="-1"></a>    indep_vars <span class="op">=</span> indep_var_map[model]</span>
<span id="cb55-643"><a href="#cb55-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-644"><a href="#cb55-644" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> event_returns[</span>
<span id="cb55-645"><a href="#cb55-645" aria-hidden="true" tabindex="-1"></a>        (event_returns[date_col] <span class="op">&gt;=</span> event_returns[<span class="st">"estper_beg"</span>])</span>
<span id="cb55-646"><a href="#cb55-646" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (event_returns[date_col] <span class="op">&lt;=</span> event_returns[<span class="st">"estper_end"</span>])</span>
<span id="cb55-647"><a href="#cb55-647" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb55-648"><a href="#cb55-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-649"><a href="#cb55-649" aria-hidden="true" tabindex="-1"></a>    params_list <span class="op">=</span> []</span>
<span id="cb55-650"><a href="#cb55-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-651"><a href="#cb55-651" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (firm, evtdate), grp <span class="kw">in</span> est.groupby([id_col, <span class="st">"evtdate"</span>]):</span>
<span id="cb55-652"><a href="#cb55-652" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> grp.dropna(subset<span class="op">=</span>[dep_var] <span class="op">+</span> indep_vars)</span>
<span id="cb55-653"><a href="#cb55-653" aria-hidden="true" tabindex="-1"></a>        nobs <span class="op">=</span> <span class="bu">len</span>(valid)</span>
<span id="cb55-654"><a href="#cb55-654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nobs <span class="op">&lt;</span> config.min_estimation_obs:</span>
<span id="cb55-655"><a href="#cb55-655" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb55-656"><a href="#cb55-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-657"><a href="#cb55-657" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> valid[dep_var].values</span>
<span id="cb55-658"><a href="#cb55-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-659"><a href="#cb55-659" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(indep_vars) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb55-660"><a href="#cb55-660" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Market-adjusted: intercept-only for variance</span></span>
<span id="cb55-661"><a href="#cb55-661" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> {</span>
<span id="cb55-662"><a href="#cb55-662" aria-hidden="true" tabindex="-1"></a>                id_col: firm,</span>
<span id="cb55-663"><a href="#cb55-663" aria-hidden="true" tabindex="-1"></a>                <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb55-664"><a href="#cb55-664" aria-hidden="true" tabindex="-1"></a>                <span class="st">"alpha"</span>: y.mean(),</span>
<span id="cb55-665"><a href="#cb55-665" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sigma"</span>: y.std(ddof<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb55-666"><a href="#cb55-666" aria-hidden="true" tabindex="-1"></a>                <span class="st">"variance"</span>: y.var(ddof<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb55-667"><a href="#cb55-667" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nobs"</span>: nobs,</span>
<span id="cb55-668"><a href="#cb55-668" aria-hidden="true" tabindex="-1"></a>                <span class="st">"r_squared"</span>: <span class="fl">0.0</span>,</span>
<span id="cb55-669"><a href="#cb55-669" aria-hidden="true" tabindex="-1"></a>                <span class="st">"_residuals"</span>: y <span class="op">-</span> y.mean(),</span>
<span id="cb55-670"><a href="#cb55-670" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb55-671"><a href="#cb55-671" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb55-672"><a href="#cb55-672" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> sm.add_constant(valid[indep_vars].values)</span>
<span id="cb55-673"><a href="#cb55-673" aria-hidden="true" tabindex="-1"></a>            res <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb55-674"><a href="#cb55-674" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> {</span>
<span id="cb55-675"><a href="#cb55-675" aria-hidden="true" tabindex="-1"></a>                id_col: firm,</span>
<span id="cb55-676"><a href="#cb55-676" aria-hidden="true" tabindex="-1"></a>                <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb55-677"><a href="#cb55-677" aria-hidden="true" tabindex="-1"></a>                <span class="st">"alpha"</span>: res.params[<span class="dv">0</span>],</span>
<span id="cb55-678"><a href="#cb55-678" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sigma"</span>: np.sqrt(res.mse_resid),</span>
<span id="cb55-679"><a href="#cb55-679" aria-hidden="true" tabindex="-1"></a>                <span class="st">"variance"</span>: res.mse_resid,</span>
<span id="cb55-680"><a href="#cb55-680" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nobs"</span>: nobs,</span>
<span id="cb55-681"><a href="#cb55-681" aria-hidden="true" tabindex="-1"></a>                <span class="st">"r_squared"</span>: res.rsquared <span class="cf">if</span> np.isfinite(res.rsquared) <span class="cf">else</span> np.nan,</span>
<span id="cb55-682"><a href="#cb55-682" aria-hidden="true" tabindex="-1"></a>                <span class="st">"_residuals"</span>: res.resid,</span>
<span id="cb55-683"><a href="#cb55-683" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb55-684"><a href="#cb55-684" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, var <span class="kw">in</span> <span class="bu">enumerate</span>(indep_vars):</span>
<span id="cb55-685"><a href="#cb55-685" aria-hidden="true" tabindex="-1"></a>                p[<span class="ss">f"beta_</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> res.params[j <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb55-686"><a href="#cb55-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-687"><a href="#cb55-687" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Skip degenerate firms (zero or near-zero variance)</span></span>
<span id="cb55-688"><a href="#cb55-688" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p[<span class="st">"sigma"</span>] <span class="op">&lt;</span> <span class="fl">1e-6</span>:</span>
<span id="cb55-689"><a href="#cb55-689" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb55-690"><a href="#cb55-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-691"><a href="#cb55-691" aria-hidden="true" tabindex="-1"></a>        params_list.append(p)</span>
<span id="cb55-692"><a href="#cb55-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-693"><a href="#cb55-693" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> params_list:</span>
<span id="cb55-694"><a href="#cb55-694" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"No firm-events passed minimum observation filter"</span>)</span>
<span id="cb55-695"><a href="#cb55-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-696"><a href="#cb55-696" aria-hidden="true" tabindex="-1"></a>    params_df <span class="op">=</span> pd.DataFrame(params_list)</span>
<span id="cb55-697"><a href="#cb55-697" aria-hidden="true" tabindex="-1"></a>    n_total <span class="op">=</span> event_returns.groupby([id_col, <span class="st">"evtdate"</span>]).ngroups</span>
<span id="cb55-698"><a href="#cb55-698" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb55-699"><a href="#cb55-699" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  Estimated </span><span class="sc">{</span><span class="bu">len</span>(params_df)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>n_total<span class="sc">}</span><span class="ss"> firm-events "</span></span>
<span id="cb55-700"><a href="#cb55-700" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"(mean R^2 = </span><span class="sc">{</span>params_df[<span class="st">'r_squared'</span>]<span class="sc">.</span>dropna()<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">)"</span></span>
<span id="cb55-701"><a href="#cb55-701" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-702"><a href="#cb55-702" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params_df</span>
<span id="cb55-703"><a href="#cb55-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-704"><a href="#cb55-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-705"><a href="#cb55-705" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Abnormal Return Computation</span></span>
<span id="cb55-706"><a href="#cb55-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-707"><a href="#cb55-707" aria-hidden="true" tabindex="-1"></a>Compute AR, CAR, BHAR, SAR, SCAR for each firm-event-date.</span>
<span id="cb55-708"><a href="#cb55-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-711"><a href="#cb55-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-712"><a href="#cb55-712" aria-hidden="true" tabindex="-1"></a><span class="co"># | label: abnormal-returns</span></span>
<span id="cb55-713"><a href="#cb55-713" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-summary: "Compute abnormal returns, CARs, BHARs"</span></span>
<span id="cb55-714"><a href="#cb55-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-715"><a href="#cb55-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-716"><a href="#cb55-716" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_abnormal_returns(</span>
<span id="cb55-717"><a href="#cb55-717" aria-hidden="true" tabindex="-1"></a>    event_returns, params, config, id_col<span class="op">=</span><span class="st">"symbol"</span>, date_col<span class="op">=</span><span class="st">"date"</span>, ret_col<span class="op">=</span><span class="st">"ret"</span></span>
<span id="cb55-718"><a href="#cb55-718" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb55-719"><a href="#cb55-719" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute abnormal returns and aggregate to CARs/BHARs.</span></span>
<span id="cb55-720"><a href="#cb55-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-721"><a href="#cb55-721" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb55-722"><a href="#cb55-722" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb55-723"><a href="#cb55-723" aria-hidden="true" tabindex="-1"></a><span class="co">    daily_ar : pd.DataFrame - daily AR/SAR/CAR/BHAR per firm-event-date</span></span>
<span id="cb55-724"><a href="#cb55-724" aria-hidden="true" tabindex="-1"></a><span class="co">    event_ar : pd.DataFrame - event-level CAR/BHAR/SCAR per firm-event</span></span>
<span id="cb55-725"><a href="#cb55-725" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-726"><a href="#cb55-726" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> config.risk_model</span>
<span id="cb55-727"><a href="#cb55-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-728"><a href="#cb55-728" aria-hidden="true" tabindex="-1"></a>    factor_map <span class="op">=</span> {</span>
<span id="cb55-729"><a href="#cb55-729" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_ADJ: [],</span>
<span id="cb55-730"><a href="#cb55-730" aria-hidden="true" tabindex="-1"></a>        RiskModel.MARKET_MODEL: [<span class="st">"mkt_excess"</span>],</span>
<span id="cb55-731"><a href="#cb55-731" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF3: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>],</span>
<span id="cb55-732"><a href="#cb55-732" aria-hidden="true" tabindex="-1"></a>        RiskModel.CARHART: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"umd"</span>],</span>
<span id="cb55-733"><a href="#cb55-733" aria-hidden="true" tabindex="-1"></a>        RiskModel.FF5: [<span class="st">"mkt_excess"</span>, <span class="st">"smb"</span>, <span class="st">"hml"</span>, <span class="st">"rmw"</span>, <span class="st">"cma"</span>],</span>
<span id="cb55-734"><a href="#cb55-734" aria-hidden="true" tabindex="-1"></a>        RiskModel.CUSTOM: config.custom_factors,</span>
<span id="cb55-735"><a href="#cb55-735" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-736"><a href="#cb55-736" aria-hidden="true" tabindex="-1"></a>    factor_cols <span class="op">=</span> factor_map[model]</span>
<span id="cb55-737"><a href="#cb55-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-738"><a href="#cb55-738" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to event window</span></span>
<span id="cb55-739"><a href="#cb55-739" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> event_returns[</span>
<span id="cb55-740"><a href="#cb55-740" aria-hidden="true" tabindex="-1"></a>        (event_returns[date_col] <span class="op">&gt;=</span> event_returns[<span class="st">"evtwin_beg"</span>])</span>
<span id="cb55-741"><a href="#cb55-741" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (event_returns[date_col] <span class="op">&lt;=</span> event_returns[<span class="st">"evtwin_end"</span>])</span>
<span id="cb55-742"><a href="#cb55-742" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb55-743"><a href="#cb55-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-744"><a href="#cb55-744" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge params (drop residuals column for merge)</span></span>
<span id="cb55-745"><a href="#cb55-745" aria-hidden="true" tabindex="-1"></a>    merge_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> params.columns <span class="cf">if</span> c <span class="op">!=</span> <span class="st">"_residuals"</span>]</span>
<span id="cb55-746"><a href="#cb55-746" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> evt.merge(params[merge_cols], on<span class="op">=</span>[id_col, <span class="st">"evtdate"</span>], how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb55-747"><a href="#cb55-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-748"><a href="#cb55-748" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expected returns</span></span>
<span id="cb55-749"><a href="#cb55-749" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model <span class="op">==</span> RiskModel.MARKET_ADJ:</span>
<span id="cb55-750"><a href="#cb55-750" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"expected_ret"</span>] <span class="op">=</span> evt.get(<span class="st">"mkt_excess"</span>, <span class="dv">0</span>) <span class="op">+</span> evt.get(<span class="st">"risk_free"</span>, <span class="dv">0</span>)</span>
<span id="cb55-751"><a href="#cb55-751" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[ret_col] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb55-752"><a href="#cb55-752" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb55-753"><a href="#cb55-753" aria-hidden="true" tabindex="-1"></a>        evt[<span class="st">"expected_ret"</span>] <span class="op">=</span> evt[<span class="st">"alpha"</span>]</span>
<span id="cb55-754"><a href="#cb55-754" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> fc <span class="kw">in</span> factor_cols:</span>
<span id="cb55-755"><a href="#cb55-755" aria-hidden="true" tabindex="-1"></a>            bcol <span class="op">=</span> <span class="ss">f"beta_</span><span class="sc">{</span>fc<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb55-756"><a href="#cb55-756" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bcol <span class="kw">in</span> evt.columns:</span>
<span id="cb55-757"><a href="#cb55-757" aria-hidden="true" tabindex="-1"></a>                evt[<span class="st">"expected_ret"</span>] <span class="op">+=</span> evt[bcol] <span class="op">*</span> evt[fc]</span>
<span id="cb55-758"><a href="#cb55-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-759"><a href="#cb55-759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model <span class="op">==</span> RiskModel.MARKET_MODEL:</span>
<span id="cb55-760"><a href="#cb55-760" aria-hidden="true" tabindex="-1"></a>            evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[ret_col] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb55-761"><a href="#cb55-761" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb55-762"><a href="#cb55-762" aria-hidden="true" tabindex="-1"></a>            evt[<span class="st">"AR"</span>] <span class="op">=</span> evt[<span class="st">"ret_excess"</span>] <span class="op">-</span> evt[<span class="st">"expected_ret"</span>]</span>
<span id="cb55-763"><a href="#cb55-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-764"><a href="#cb55-764" aria-hidden="true" tabindex="-1"></a>    evt[<span class="st">"SAR"</span>] <span class="op">=</span> evt[<span class="st">"AR"</span>] <span class="op">/</span> evt[<span class="st">"sigma"</span>]</span>
<span id="cb55-765"><a href="#cb55-765" aria-hidden="true" tabindex="-1"></a>    evt <span class="op">=</span> evt.sort_values([id_col, <span class="st">"evtdate"</span>, date_col])</span>
<span id="cb55-766"><a href="#cb55-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-767"><a href="#cb55-767" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute event time</span></span>
<span id="cb55-768"><a href="#cb55-768" aria-hidden="true" tabindex="-1"></a>    all_dates <span class="op">=</span> <span class="bu">sorted</span>(event_returns[date_col].unique())</span>
<span id="cb55-769"><a href="#cb55-769" aria-hidden="true" tabindex="-1"></a>    d2i <span class="op">=</span> {d: i <span class="cf">for</span> i, d <span class="kw">in</span> <span class="bu">enumerate</span>(all_dates)}</span>
<span id="cb55-770"><a href="#cb55-770" aria-hidden="true" tabindex="-1"></a>    evt[<span class="st">"evttime"</span>] <span class="op">=</span> evt[date_col].<span class="bu">map</span>(d2i) <span class="op">-</span> evt[<span class="st">"evtdate"</span>].<span class="bu">map</span>(d2i)</span>
<span id="cb55-771"><a href="#cb55-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cumulative measures per firm-event</span></span>
<span id="cb55-773"><a href="#cb55-773" aria-hidden="true" tabindex="-1"></a>    daily_recs <span class="op">=</span> []</span>
<span id="cb55-774"><a href="#cb55-774" aria-hidden="true" tabindex="-1"></a>    event_recs <span class="op">=</span> []</span>
<span id="cb55-775"><a href="#cb55-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-776"><a href="#cb55-776" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (firm, evtdate), g <span class="kw">in</span> evt.groupby([id_col, <span class="st">"evtdate"</span>]):</span>
<span id="cb55-777"><a href="#cb55-777" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> g.sort_values(date_col).copy()</span>
<span id="cb55-778"><a href="#cb55-778" aria-hidden="true" tabindex="-1"></a>        nd <span class="op">=</span> <span class="bu">len</span>(g)</span>
<span id="cb55-779"><a href="#cb55-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-780"><a href="#cb55-780" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"CAR"</span>] <span class="op">=</span> g[<span class="st">"AR"</span>].cumsum()</span>
<span id="cb55-781"><a href="#cb55-781" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"cum_ret"</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> g[ret_col]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb55-782"><a href="#cb55-782" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"cum_expected"</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> g[<span class="st">"expected_ret"</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb55-783"><a href="#cb55-783" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"BHAR"</span>] <span class="op">=</span> g[<span class="st">"cum_ret"</span>] <span class="op">-</span> g[<span class="st">"cum_expected"</span>]</span>
<span id="cb55-784"><a href="#cb55-784" aria-hidden="true" tabindex="-1"></a>        g[<span class="st">"SCAR"</span>] <span class="op">=</span> g[<span class="st">"CAR"</span>] <span class="op">/</span> (g[<span class="st">"sigma"</span>].iloc[<span class="dv">0</span>] <span class="op">*</span> np.sqrt(np.arange(<span class="dv">1</span>, nd <span class="op">+</span> <span class="dv">1</span>)))</span>
<span id="cb55-785"><a href="#cb55-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-786"><a href="#cb55-786" aria-hidden="true" tabindex="-1"></a>        daily_recs.append(g)</span>
<span id="cb55-787"><a href="#cb55-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-788"><a href="#cb55-788" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> g.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb55-789"><a href="#cb55-789" aria-hidden="true" tabindex="-1"></a>        sigma <span class="op">=</span> g[<span class="st">"sigma"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-790"><a href="#cb55-790" aria-hidden="true" tabindex="-1"></a>        nobs <span class="op">=</span> g[<span class="st">"nobs"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-791"><a href="#cb55-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-792"><a href="#cb55-792" aria-hidden="true" tabindex="-1"></a>        rec <span class="op">=</span> {</span>
<span id="cb55-793"><a href="#cb55-793" aria-hidden="true" tabindex="-1"></a>            id_col: firm,</span>
<span id="cb55-794"><a href="#cb55-794" aria-hidden="true" tabindex="-1"></a>            <span class="st">"evtdate"</span>: evtdate,</span>
<span id="cb55-795"><a href="#cb55-795" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CAR"</span>: last[<span class="st">"CAR"</span>],</span>
<span id="cb55-796"><a href="#cb55-796" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BHAR"</span>: last[<span class="st">"BHAR"</span>],</span>
<span id="cb55-797"><a href="#cb55-797" aria-hidden="true" tabindex="-1"></a>            <span class="st">"cum_ret"</span>: last[<span class="st">"cum_ret"</span>],</span>
<span id="cb55-798"><a href="#cb55-798" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SCAR"</span>: last[<span class="st">"CAR"</span>] <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(nd)),</span>
<span id="cb55-799"><a href="#cb55-799" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>: sigma,</span>
<span id="cb55-800"><a href="#cb55-800" aria-hidden="true" tabindex="-1"></a>            <span class="st">"variance"</span>: g[<span class="st">"variance"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb55-801"><a href="#cb55-801" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nobs"</span>: nobs,</span>
<span id="cb55-802"><a href="#cb55-802" aria-hidden="true" tabindex="-1"></a>            <span class="st">"n_event_days"</span>: nd,</span>
<span id="cb55-803"><a href="#cb55-803" aria-hidden="true" tabindex="-1"></a>            <span class="st">"alpha"</span>: g[<span class="st">"alpha"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb55-804"><a href="#cb55-804" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pat_scale"</span>: (nobs <span class="op">-</span> <span class="dv">2</span>) <span class="op">/</span> (nobs <span class="op">-</span> <span class="dv">4</span>) <span class="cf">if</span> nobs <span class="op">&gt;</span> <span class="dv">4</span> <span class="cf">else</span> np.nan,</span>
<span id="cb55-805"><a href="#cb55-805" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pos_car"</span>: <span class="bu">int</span>(last[<span class="st">"CAR"</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb55-806"><a href="#cb55-806" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb55-807"><a href="#cb55-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-808"><a href="#cb55-808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> fc <span class="kw">in</span> factor_cols:</span>
<span id="cb55-809"><a href="#cb55-809" aria-hidden="true" tabindex="-1"></a>            bcol <span class="op">=</span> <span class="ss">f"beta_</span><span class="sc">{</span>fc<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb55-810"><a href="#cb55-810" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bcol <span class="kw">in</span> g.columns:</span>
<span id="cb55-811"><a href="#cb55-811" aria-hidden="true" tabindex="-1"></a>                rec[bcol] <span class="op">=</span> g[bcol].iloc[<span class="dv">0</span>]</span>
<span id="cb55-812"><a href="#cb55-812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"group"</span> <span class="kw">in</span> g.columns:</span>
<span id="cb55-813"><a href="#cb55-813" aria-hidden="true" tabindex="-1"></a>            rec[<span class="st">"group"</span>] <span class="op">=</span> g[<span class="st">"group"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-814"><a href="#cb55-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-815"><a href="#cb55-815" aria-hidden="true" tabindex="-1"></a>        event_recs.append(rec)</span>
<span id="cb55-816"><a href="#cb55-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-817"><a href="#cb55-817" aria-hidden="true" tabindex="-1"></a>    daily_ar <span class="op">=</span> pd.concat(daily_recs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-818"><a href="#cb55-818" aria-hidden="true" tabindex="-1"></a>    event_ar <span class="op">=</span> pd.DataFrame(event_recs)</span>
<span id="cb55-819"><a href="#cb55-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-820"><a href="#cb55-820" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb55-821"><a href="#cb55-821" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(event_ar)<span class="sc">}</span><span class="ss"> firm-events | Mean CAR: </span><span class="sc">{</span>event_ar[<span class="st">'CAR'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss"> | "</span></span>
<span id="cb55-822"><a href="#cb55-822" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Mean BHAR: </span><span class="sc">{</span>event_ar[<span class="st">'BHAR'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss"> | "</span></span>
<span id="cb55-823"><a href="#cb55-823" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"% positive: </span><span class="sc">{</span>event_ar[<span class="st">'pos_car'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span></span>
<span id="cb55-824"><a href="#cb55-824" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-825"><a href="#cb55-825" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> daily_ar, event_ar</span>
<span id="cb55-826"><a href="#cb55-826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-827"><a href="#cb55-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-828"><a href="#cb55-828" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 6: Comprehensive Test Statistics</span></span>
<span id="cb55-829"><a href="#cb55-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-830"><a href="#cb55-830" aria-hidden="true" tabindex="-1"></a>Eight tests covering parametric, non-parametric, and cross-correlation-robust approaches.</span>
<span id="cb55-831"><a href="#cb55-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-834"><a href="#cb55-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-835"><a href="#cb55-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tests</span></span>
<span id="cb55-836"><a href="#cb55-836" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Eight test statistics"</span></span>
<span id="cb55-837"><a href="#cb55-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-838"><a href="#cb55-838" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_test_statistics(event_ar, params<span class="op">=</span><span class="va">None</span>, group_col<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb55-839"><a href="#cb55-839" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute comprehensive test statistics for abnormal returns.</span></span>
<span id="cb55-840"><a href="#cb55-840" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-841"><a href="#cb55-841" aria-hidden="true" tabindex="-1"></a><span class="co">    Implements 8 tests with varying assumptions about variance,</span></span>
<span id="cb55-842"><a href="#cb55-842" aria-hidden="true" tabindex="-1"></a><span class="co">    cross-dependence, and distributional form.</span></span>
<span id="cb55-843"><a href="#cb55-843" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-844"><a href="#cb55-844" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _stats(data, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb55-845"><a href="#cb55-845" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb55-846"><a href="#cb55-846" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> N <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb55-847"><a href="#cb55-847" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb55-848"><a href="#cb55-848" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-849"><a href="#cb55-849" aria-hidden="true" tabindex="-1"></a>        cars <span class="op">=</span> data[<span class="st">'CAR'</span>].values</span>
<span id="cb55-850"><a href="#cb55-850" aria-hidden="true" tabindex="-1"></a>        bhars <span class="op">=</span> data[<span class="st">'BHAR'</span>].values</span>
<span id="cb55-851"><a href="#cb55-851" aria-hidden="true" tabindex="-1"></a>        scars <span class="op">=</span> data[<span class="st">'SCAR'</span>].values</span>
<span id="cb55-852"><a href="#cb55-852" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> data[<span class="st">'pos_car'</span>].values</span>
<span id="cb55-853"><a href="#cb55-853" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-854"><a href="#cb55-854" aria-hidden="true" tabindex="-1"></a>        m_car, s_car <span class="op">=</span> np.mean(cars), np.std(cars, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-855"><a href="#cb55-855" aria-hidden="true" tabindex="-1"></a>        m_scar, s_scar <span class="op">=</span> np.mean(scars), np.std(scars, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-856"><a href="#cb55-856" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-857"><a href="#cb55-857" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> {<span class="st">'group'</span>: label <span class="kw">or</span> <span class="st">'All'</span>, <span class="st">'N'</span>: N,</span>
<span id="cb55-858"><a href="#cb55-858" aria-hidden="true" tabindex="-1"></a>             <span class="st">'mean_CAR'</span>: m_car, <span class="st">'median_CAR'</span>: np.median(cars),</span>
<span id="cb55-859"><a href="#cb55-859" aria-hidden="true" tabindex="-1"></a>             <span class="st">'std_CAR'</span>: s_car, <span class="st">'mean_BHAR'</span>: np.mean(bhars),</span>
<span id="cb55-860"><a href="#cb55-860" aria-hidden="true" tabindex="-1"></a>             <span class="st">'pct_positive'</span>: np.mean(pos)}</span>
<span id="cb55-861"><a href="#cb55-861" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-862"><a href="#cb55-862" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Cross-sectional t</span></span>
<span id="cb55-863"><a href="#cb55-863" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> m_car <span class="op">/</span> (s_car <span class="op">/</span> np.sqrt(N)) <span class="cf">if</span> s_car <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb55-864"><a href="#cb55-864" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_CS'</span>] <span class="op">=</span> t1</span>
<span id="cb55-865"><a href="#cb55-865" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_CS'</span>] <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> stats.t.cdf(<span class="bu">abs</span>(t1), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t1) <span class="cf">else</span> np.nan</span>
<span id="cb55-866"><a href="#cb55-866" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-867"><a href="#cb55-867" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Patell Z</span></span>
<span id="cb55-868"><a href="#cb55-868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'pat_scale'</span> <span class="kw">in</span> data.columns:</span>
<span id="cb55-869"><a href="#cb55-869" aria-hidden="true" tabindex="-1"></a>            ps <span class="op">=</span> data[<span class="st">'pat_scale'</span>].dropna().values</span>
<span id="cb55-870"><a href="#cb55-870" aria-hidden="true" tabindex="-1"></a>            z2 <span class="op">=</span> np.<span class="bu">sum</span>(scars[:<span class="bu">len</span>(ps)]) <span class="op">/</span> np.sqrt(np.<span class="bu">sum</span>(ps)) <span class="cf">if</span> <span class="bu">len</span>(ps) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb55-871"><a href="#cb55-871" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb55-872"><a href="#cb55-872" aria-hidden="true" tabindex="-1"></a>            z2 <span class="op">=</span> m_scar <span class="op">*</span> np.sqrt(N)</span>
<span id="cb55-873"><a href="#cb55-873" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_Patell'</span>] <span class="op">=</span> z2</span>
<span id="cb55-874"><a href="#cb55-874" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_Patell'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.norm.cdf(<span class="bu">abs</span>(z2))) <span class="cf">if</span> np.isfinite(z2) <span class="cf">else</span> np.nan</span>
<span id="cb55-875"><a href="#cb55-875" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-876"><a href="#cb55-876" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. BMP</span></span>
<span id="cb55-877"><a href="#cb55-877" aria-hidden="true" tabindex="-1"></a>        t3 <span class="op">=</span> m_scar <span class="op">/</span> (s_scar <span class="op">/</span> np.sqrt(N)) <span class="cf">if</span> s_scar <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb55-878"><a href="#cb55-878" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_BMP'</span>] <span class="op">=</span> t3</span>
<span id="cb55-879"><a href="#cb55-879" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_BMP'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t3), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t3) <span class="cf">else</span> np.nan</span>
<span id="cb55-880"><a href="#cb55-880" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-881"><a href="#cb55-881" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Kolari-Pynn√∂nen</span></span>
<span id="cb55-882"><a href="#cb55-882" aria-hidden="true" tabindex="-1"></a>        rbar <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb55-883"><a href="#cb55-883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> params <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="st">'_residuals'</span> <span class="kw">in</span> params.columns:</span>
<span id="cb55-884"><a href="#cb55-884" aria-hidden="true" tabindex="-1"></a>            resids <span class="op">=</span> [row[<span class="st">'_residuals'</span>] <span class="cf">for</span> _, row <span class="kw">in</span> params.iterrows()</span>
<span id="cb55-885"><a href="#cb55-885" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> <span class="bu">isinstance</span>(row.get(<span class="st">'_residuals'</span>), np.ndarray)]</span>
<span id="cb55-886"><a href="#cb55-886" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(resids) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb55-887"><a href="#cb55-887" aria-hidden="true" tabindex="-1"></a>                ml <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> resids)</span>
<span id="cb55-888"><a href="#cb55-888" aria-hidden="true" tabindex="-1"></a>                aligned <span class="op">=</span> np.column_stack([x[:ml] <span class="cf">for</span> x <span class="kw">in</span> resids])</span>
<span id="cb55-889"><a href="#cb55-889" aria-hidden="true" tabindex="-1"></a>                cm <span class="op">=</span> np.corrcoef(aligned.T)</span>
<span id="cb55-890"><a href="#cb55-890" aria-hidden="true" tabindex="-1"></a>                np.fill_diagonal(cm, <span class="dv">0</span>)</span>
<span id="cb55-891"><a href="#cb55-891" aria-hidden="true" tabindex="-1"></a>                rbar <span class="op">=</span> cm.<span class="bu">sum</span>() <span class="op">/</span> (<span class="bu">len</span>(resids) <span class="op">*</span> (<span class="bu">len</span>(resids)<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb55-892"><a href="#cb55-892" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-893"><a href="#cb55-893" aria-hidden="true" tabindex="-1"></a>        adj <span class="op">=</span> np.sqrt(<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>(N<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>rbar)) <span class="cf">if</span> (<span class="dv">1</span><span class="op">+</span>(N<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>rbar) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb55-894"><a href="#cb55-894" aria-hidden="true" tabindex="-1"></a>        t4 <span class="op">=</span> t3 <span class="op">*</span> adj <span class="cf">if</span> np.isfinite(t3) <span class="cf">else</span> np.nan</span>
<span id="cb55-895"><a href="#cb55-895" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'t_KP'</span>] <span class="op">=</span> t4</span>
<span id="cb55-896"><a href="#cb55-896" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_KP'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t4), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t4) <span class="cf">else</span> np.nan</span>
<span id="cb55-897"><a href="#cb55-897" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'r_bar'</span>] <span class="op">=</span> rbar</span>
<span id="cb55-898"><a href="#cb55-898" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-899"><a href="#cb55-899" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Generalized sign test</span></span>
<span id="cb55-900"><a href="#cb55-900" aria-hidden="true" tabindex="-1"></a>        p_hat <span class="op">=</span> np.mean(pos)</span>
<span id="cb55-901"><a href="#cb55-901" aria-hidden="true" tabindex="-1"></a>        z5 <span class="op">=</span> (p_hat <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">/</span> np.sqrt(<span class="fl">0.25</span> <span class="op">/</span> N)</span>
<span id="cb55-902"><a href="#cb55-902" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_GSign'</span>] <span class="op">=</span> z5</span>
<span id="cb55-903"><a href="#cb55-903" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_GSign'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.norm.cdf(<span class="bu">abs</span>(z5)))</span>
<span id="cb55-904"><a href="#cb55-904" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-905"><a href="#cb55-905" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 6. Sign test</span></span>
<span id="cb55-906"><a href="#cb55-906" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'Z_Sign'</span>] <span class="op">=</span> z5  <span class="co"># Same formula with p0=0.5</span></span>
<span id="cb55-907"><a href="#cb55-907" aria-hidden="true" tabindex="-1"></a>        r[<span class="st">'p_Sign'</span>] <span class="op">=</span> r[<span class="st">'p_GSign'</span>]</span>
<span id="cb55-908"><a href="#cb55-908" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-909"><a href="#cb55-909" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 7. Skewness-adjusted t</span></span>
<span id="cb55-910"><a href="#cb55-910" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s_scar <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb55-911"><a href="#cb55-911" aria-hidden="true" tabindex="-1"></a>            zb <span class="op">=</span> m_scar <span class="op">/</span> s_scar</span>
<span id="cb55-912"><a href="#cb55-912" aria-hidden="true" tabindex="-1"></a>            gam <span class="op">=</span> stats.skew(scars)</span>
<span id="cb55-913"><a href="#cb55-913" aria-hidden="true" tabindex="-1"></a>            t7 <span class="op">=</span> np.sqrt(N) <span class="op">*</span> (zb <span class="op">+</span> gam<span class="op">*</span>zb<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span> <span class="op">+</span> gam<span class="op">**</span><span class="dv">2</span><span class="op">*</span>zb<span class="op">**</span><span class="dv">3</span><span class="op">/</span><span class="dv">27</span> <span class="op">+</span> gam<span class="op">/</span>(<span class="dv">6</span><span class="op">*</span>N))</span>
<span id="cb55-914"><a href="#cb55-914" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'t_SkAdj'</span>] <span class="op">=</span> t7</span>
<span id="cb55-915"><a href="#cb55-915" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'p_SkAdj'</span>] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>stats.t.cdf(<span class="bu">abs</span>(t7), N<span class="op">-</span><span class="dv">1</span>)) <span class="cf">if</span> np.isfinite(t7) <span class="cf">else</span> np.nan</span>
<span id="cb55-916"><a href="#cb55-916" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-917"><a href="#cb55-917" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 8. Wilcoxon signed-rank</span></span>
<span id="cb55-918"><a href="#cb55-918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb55-919"><a href="#cb55-919" aria-hidden="true" tabindex="-1"></a>            w, pw <span class="op">=</span> stats.wilcoxon(cars, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb55-920"><a href="#cb55-920" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'W_Wilcoxon'</span>] <span class="op">=</span> w</span>
<span id="cb55-921"><a href="#cb55-921" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'p_Wilcoxon'</span>] <span class="op">=</span> pw</span>
<span id="cb55-922"><a href="#cb55-922" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb55-923"><a href="#cb55-923" aria-hidden="true" tabindex="-1"></a>            r[<span class="st">'W_Wilcoxon'</span>] <span class="op">=</span> r[<span class="st">'p_Wilcoxon'</span>] <span class="op">=</span> np.nan</span>
<span id="cb55-924"><a href="#cb55-924" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-925"><a href="#cb55-925" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r</span>
<span id="cb55-926"><a href="#cb55-926" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-927"><a href="#cb55-927" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> [_stats(event_ar)]</span>
<span id="cb55-928"><a href="#cb55-928" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> group_col <span class="kw">and</span> group_col <span class="kw">in</span> event_ar.columns:</span>
<span id="cb55-929"><a href="#cb55-929" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gv, gd <span class="kw">in</span> event_ar.groupby(group_col):</span>
<span id="cb55-930"><a href="#cb55-930" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> _stats(gd, label<span class="op">=</span>gv)</span>
<span id="cb55-931"><a href="#cb55-931" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s:</span>
<span id="cb55-932"><a href="#cb55-932" aria-hidden="true" tabindex="-1"></a>                results.append(s)</span>
<span id="cb55-933"><a href="#cb55-933" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-934"><a href="#cb55-934" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame([r <span class="cf">for</span> r <span class="kw">in</span> results <span class="cf">if</span> r <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb55-935"><a href="#cb55-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-936"><a href="#cb55-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-937"><a href="#cb55-937" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_daily_stats(daily_ar, id_col<span class="op">=</span><span class="st">'symbol'</span>):</span>
<span id="cb55-938"><a href="#cb55-938" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute test statistics at each event time t."""</span></span>
<span id="cb55-939"><a href="#cb55-939" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb55-940"><a href="#cb55-940" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t, g <span class="kw">in</span> daily_ar.groupby(<span class="st">'evttime'</span>):</span>
<span id="cb55-941"><a href="#cb55-941" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> g[id_col].nunique()</span>
<span id="cb55-942"><a href="#cb55-942" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb55-943"><a href="#cb55-943" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb55-944"><a href="#cb55-944" aria-hidden="true" tabindex="-1"></a>        m_ar <span class="op">=</span> g[<span class="st">'AR'</span>].mean()</span>
<span id="cb55-945"><a href="#cb55-945" aria-hidden="true" tabindex="-1"></a>        s_ar <span class="op">=</span> g[<span class="st">'AR'</span>].std(ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-946"><a href="#cb55-946" aria-hidden="true" tabindex="-1"></a>        t_ar <span class="op">=</span> m_ar <span class="op">/</span> (s_ar<span class="op">/</span>np.sqrt(n)) <span class="cf">if</span> s_ar <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb55-947"><a href="#cb55-947" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">'evttime'</span>: t, <span class="st">'N'</span>: n, <span class="st">'mean_AR'</span>: m_ar,</span>
<span id="cb55-948"><a href="#cb55-948" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'mean_CAR'</span>: g[<span class="st">'CAR'</span>].mean(), <span class="st">'mean_BHAR'</span>: g[<span class="st">'BHAR'</span>].mean(),</span>
<span id="cb55-949"><a href="#cb55-949" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'mean_cum_ret'</span>: g.get(<span class="st">'cum_ret'</span>, pd.Series()).mean(),</span>
<span id="cb55-950"><a href="#cb55-950" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'t_AR'</span>: t_ar})</span>
<span id="cb55-951"><a href="#cb55-951" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(rows).sort_values(<span class="st">'evttime'</span>)</span>
<span id="cb55-952"><a href="#cb55-952" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-953"><a href="#cb55-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-954"><a href="#cb55-954" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 7: Publication-Ready Visualization</span></span>
<span id="cb55-955"><a href="#cb55-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-958"><a href="#cb55-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-959"><a href="#cb55-959" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: visualization</span></span>
<span id="cb55-960"><a href="#cb55-960" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Event study plots"</span></span>
<span id="cb55-961"><a href="#cb55-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-962"><a href="#cb55-962" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_event_study(daily_stats, title<span class="op">=</span><span class="st">"Cumulative Abnormal Returns Around Event Date"</span>,</span>
<span id="cb55-963"><a href="#cb55-963" aria-hidden="true" tabindex="-1"></a>                     figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>), save_path<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb55-964"><a href="#cb55-964" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Publication-ready event study plot with CAR, BHAR, and daily AR panels."""</span></span>
<span id="cb55-965"><a href="#cb55-965" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>figsize, height_ratios<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb55-966"><a href="#cb55-966" aria-hidden="true" tabindex="-1"></a>                              gridspec_kw<span class="op">=</span>{<span class="st">'hspace'</span>: <span class="fl">0.05</span>})</span>
<span id="cb55-967"><a href="#cb55-967" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> daily_stats.sort_values(<span class="st">'evttime'</span>)</span>
<span id="cb55-968"><a href="#cb55-968" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ds[<span class="st">'evttime'</span>].values</span>
<span id="cb55-969"><a href="#cb55-969" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-970"><a href="#cb55-970" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top: cumulative returns</span></span>
<span id="cb55-971"><a href="#cb55-971" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb55-972"><a href="#cb55-972" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, ds[<span class="st">'mean_CAR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>, lw<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'Mean CAR'</span>)</span>
<span id="cb55-973"><a href="#cb55-973" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, ds[<span class="st">'mean_BHAR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#B2182B'</span>, lw<span class="op">=</span><span class="dv">2</span>, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean BHAR'</span>)</span>
<span id="cb55-974"><a href="#cb55-974" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'mean_cum_ret'</span> <span class="kw">in</span> ds.columns:</span>
<span id="cb55-975"><a href="#cb55-975" aria-hidden="true" tabindex="-1"></a>        ax.plot(t, ds[<span class="st">'mean_cum_ret'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'#666'</span>, lw<span class="op">=</span><span class="fl">1.5</span>, ls<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb55-976"><a href="#cb55-976" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Mean Cum. Return'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb55-977"><a href="#cb55-977" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.8</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb55-978"><a href="#cb55-978" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb55-979"><a href="#cb55-979" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Cumulative Return (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb55-980"><a href="#cb55-980" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb55-981"><a href="#cb55-981" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb55-982"><a href="#cb55-982" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb55-983"><a href="#cb55-983" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([])</span>
<span id="cb55-984"><a href="#cb55-984" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-985"><a href="#cb55-985" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom: daily AR bars</span></span>
<span id="cb55-986"><a href="#cb55-986" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb55-987"><a href="#cb55-987" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#2166AC'</span> <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'#B2182B'</span> <span class="cf">for</span> v <span class="kw">in</span> ds[<span class="st">'mean_AR'</span>]]</span>
<span id="cb55-988"><a href="#cb55-988" aria-hidden="true" tabindex="-1"></a>    ax2.bar(t, ds[<span class="st">'mean_AR'</span>]<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.7</span>, width<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb55-989"><a href="#cb55-989" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'t_AR'</span> <span class="kw">in</span> ds.columns:</span>
<span id="cb55-990"><a href="#cb55-990" aria-hidden="true" tabindex="-1"></a>        sig <span class="op">=</span> np.<span class="bu">abs</span>(ds[<span class="st">'t_AR'</span>].values) <span class="op">&gt;</span> <span class="fl">1.96</span></span>
<span id="cb55-991"><a href="#cb55-991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sig.<span class="bu">any</span>():</span>
<span id="cb55-992"><a href="#cb55-992" aria-hidden="true" tabindex="-1"></a>            ax2.scatter(t[sig], ds[<span class="st">'mean_AR'</span>].values[sig]<span class="op">*</span><span class="dv">100</span>, </span>
<span id="cb55-993"><a href="#cb55-993" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'gold'</span>, s<span class="op">=</span><span class="dv">40</span>, marker<span class="op">=</span><span class="st">'*'</span>, zorder<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="st">'p&lt;0.05'</span>)</span>
<span id="cb55-994"><a href="#cb55-994" aria-hidden="true" tabindex="-1"></a>            ax2.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb55-995"><a href="#cb55-995" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.8</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb55-996"><a href="#cb55-996" aria-hidden="true" tabindex="-1"></a>    ax2.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb55-997"><a href="#cb55-997" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Event Time (Trading Periods)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb55-998"><a href="#cb55-998" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Mean AR (%)'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb55-999"><a href="#cb55-999" aria-hidden="true" tabindex="-1"></a>    ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb55-1000"><a href="#cb55-1000" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1001"><a href="#cb55-1001" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a <span class="kw">in</span> axes:</span>
<span id="cb55-1002"><a href="#cb55-1002" aria-hidden="true" tabindex="-1"></a>        a.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1003"><a href="#cb55-1003" aria-hidden="true" tabindex="-1"></a>        a.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1004"><a href="#cb55-1004" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb55-1005"><a href="#cb55-1005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_path:</span>
<span id="cb55-1006"><a href="#cb55-1006" aria-hidden="true" tabindex="-1"></a>        fig.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb55-1007"><a href="#cb55-1007" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb55-1008"><a href="#cb55-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1009"><a href="#cb55-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1010"><a href="#cb55-1010" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_car_distribution(event_ar, var<span class="op">=</span><span class="st">'CAR'</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>)):</span>
<span id="cb55-1011"><a href="#cb55-1011" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cross-sectional distribution of CARs with histogram and QQ plot."""</span></span>
<span id="cb55-1012"><a href="#cb55-1012" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>figsize)</span>
<span id="cb55-1013"><a href="#cb55-1013" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> event_ar[var].dropna() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb55-1014"><a href="#cb55-1014" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1015"><a href="#cb55-1015" aria-hidden="true" tabindex="-1"></a>    ax1.hist(data, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb55-1016"><a href="#cb55-1016" aria-hidden="true" tabindex="-1"></a>    ax1.axvline(data.mean(), color<span class="op">=</span><span class="st">'k'</span>, ls<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb55-1017"><a href="#cb55-1017" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="ss">f'Mean=</span><span class="sc">{</span>data<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">%'</span>)</span>
<span id="cb55-1018"><a href="#cb55-1018" aria-hidden="true" tabindex="-1"></a>    ax1.axvline(data.median(), color<span class="op">=</span><span class="st">'gray'</span>, ls<span class="op">=</span><span class="st">':'</span>, lw<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb55-1019"><a href="#cb55-1019" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="ss">f'Median=</span><span class="sc">{</span>data<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">%'</span>)</span>
<span id="cb55-1020"><a href="#cb55-1020" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="ss">f'</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> (%)'</span>)</span>
<span id="cb55-1021"><a href="#cb55-1021" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb55-1022"><a href="#cb55-1022" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f'Distribution of </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb55-1023"><a href="#cb55-1023" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb55-1024"><a href="#cb55-1024" aria-hidden="true" tabindex="-1"></a>    ax1.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1025"><a href="#cb55-1025" aria-hidden="true" tabindex="-1"></a>    ax1.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1026"><a href="#cb55-1026" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1027"><a href="#cb55-1027" aria-hidden="true" tabindex="-1"></a>    <span class="co"># QQ plot</span></span>
<span id="cb55-1028"><a href="#cb55-1028" aria-hidden="true" tabindex="-1"></a>    (osm, osr), (slope, intercept, r) <span class="op">=</span> stats.probplot(data, dist<span class="op">=</span><span class="st">'norm'</span>)</span>
<span id="cb55-1029"><a href="#cb55-1029" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(osm, osr, alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'#2166AC'</span>)</span>
<span id="cb55-1030"><a href="#cb55-1030" aria-hidden="true" tabindex="-1"></a>    ax2.plot(osm, slope<span class="op">*</span>np.array(osm)<span class="op">+</span>intercept, <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-1031"><a href="#cb55-1031" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Theoretical Quantiles'</span>)</span>
<span id="cb55-1032"><a href="#cb55-1032" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Sample Quantiles'</span>)</span>
<span id="cb55-1033"><a href="#cb55-1033" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Q-Q Plot (Normal)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb55-1034"><a href="#cb55-1034" aria-hidden="true" tabindex="-1"></a>    ax2.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1035"><a href="#cb55-1035" aria-hidden="true" tabindex="-1"></a>    ax2.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb55-1036"><a href="#cb55-1036" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1037"><a href="#cb55-1037" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb55-1038"><a href="#cb55-1038" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb55-1039"><a href="#cb55-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1040"><a href="#cb55-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1041"><a href="#cb55-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Master Pipeline</span></span>
<span id="cb55-1042"><a href="#cb55-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1043"><a href="#cb55-1043" aria-hidden="true" tabindex="-1"></a>Combine all components into one function:</span>
<span id="cb55-1044"><a href="#cb55-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1047"><a href="#cb55-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1048"><a href="#cb55-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: master</span></span>
<span id="cb55-1049"><a href="#cb55-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Complete event study pipeline"</span></span>
<span id="cb55-1050"><a href="#cb55-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1051"><a href="#cb55-1051" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_event_study(events, prices, factors, config,</span>
<span id="cb55-1052"><a href="#cb55-1052" aria-hidden="true" tabindex="-1"></a>                    id_col<span class="op">=</span><span class="st">'symbol'</span>, date_col<span class="op">=</span><span class="st">'date'</span>, ret_col<span class="op">=</span><span class="st">'ret'</span>,</span>
<span id="cb55-1053"><a href="#cb55-1053" aria-hidden="true" tabindex="-1"></a>                    event_date_col<span class="op">=</span><span class="st">'event_date'</span>, mkt_col<span class="op">=</span><span class="st">'mkt_excess'</span>,</span>
<span id="cb55-1054"><a href="#cb55-1054" aria-hidden="true" tabindex="-1"></a>                    rf_col<span class="op">=</span><span class="st">'risk_free'</span>, group_col<span class="op">=</span><span class="va">None</span>, verbose<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb55-1055"><a href="#cb55-1055" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Run a complete event study from raw inputs to test statistics.</span></span>
<span id="cb55-1056"><a href="#cb55-1056" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-1057"><a href="#cb55-1057" aria-hidden="true" tabindex="-1"></a><span class="co">    This is the main entry point. Provide your events, price data,</span></span>
<span id="cb55-1058"><a href="#cb55-1058" aria-hidden="true" tabindex="-1"></a><span class="co">    factor data, and configuration‚Äîget back everything you need.</span></span>
<span id="cb55-1059"><a href="#cb55-1059" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-1060"><a href="#cb55-1060" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb55-1061"><a href="#cb55-1061" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb55-1062"><a href="#cb55-1062" aria-hidden="true" tabindex="-1"></a><span class="co">    events : pd.DataFrame</span></span>
<span id="cb55-1063"><a href="#cb55-1063" aria-hidden="true" tabindex="-1"></a><span class="co">        Columns: [id_col, event_date_col], optional 'group'.</span></span>
<span id="cb55-1064"><a href="#cb55-1064" aria-hidden="true" tabindex="-1"></a><span class="co">    prices : pd.DataFrame</span></span>
<span id="cb55-1065"><a href="#cb55-1065" aria-hidden="true" tabindex="-1"></a><span class="co">        Daily returns: [id_col, date_col, ret_col or 'ret_excess', rf_col].</span></span>
<span id="cb55-1066"><a href="#cb55-1066" aria-hidden="true" tabindex="-1"></a><span class="co">    factors : pd.DataFrame</span></span>
<span id="cb55-1067"><a href="#cb55-1067" aria-hidden="true" tabindex="-1"></a><span class="co">        Factor returns: [date_col, mkt_col, 'smb', 'hml', ...].</span></span>
<span id="cb55-1068"><a href="#cb55-1068" aria-hidden="true" tabindex="-1"></a><span class="co">    config : EventStudyConfig</span></span>
<span id="cb55-1069"><a href="#cb55-1069" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb55-1070"><a href="#cb55-1070" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb55-1071"><a href="#cb55-1071" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb55-1072"><a href="#cb55-1072" aria-hidden="true" tabindex="-1"></a><span class="co">    dict with keys: 'config', 'daily_ar', 'event_ar', 'daily_stats',</span></span>
<span id="cb55-1073"><a href="#cb55-1073" aria-hidden="true" tabindex="-1"></a><span class="co">        'test_stats', 'params'</span></span>
<span id="cb55-1074"><a href="#cb55-1074" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb55-1075"><a href="#cb55-1075" aria-hidden="true" tabindex="-1"></a>    config.validate()</span>
<span id="cb55-1076"><a href="#cb55-1076" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1077"><a href="#cb55-1077" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb55-1078"><a href="#cb55-1078" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ïê‚ïê‚ïê Event Study: </span><span class="sc">{</span>config<span class="sc">.</span>risk_model<span class="sc">.</span>value<span class="sc">}</span><span class="ss"> model ‚ïê‚ïê‚ïê"</span>)</span>
<span id="cb55-1079"><a href="#cb55-1079" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Windows: estimation=</span><span class="sc">{</span>config<span class="sc">.</span>estimation_window<span class="sc">}</span><span class="ss">, "</span></span>
<span id="cb55-1080"><a href="#cb55-1080" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"gap=</span><span class="sc">{</span>config<span class="sc">.</span>gap<span class="sc">}</span><span class="ss">, event=(</span><span class="sc">{</span>config<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>config<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb55-1081"><a href="#cb55-1081" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Min obs: </span><span class="sc">{</span>config<span class="sc">.</span>min_estimation_obs<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb55-1082"><a href="#cb55-1082" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1083"><a href="#cb55-1083" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Trading calendar</span></span>
<span id="cb55-1084"><a href="#cb55-1084" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 1: Building trading calendar..."</span>)</span>
<span id="cb55-1085"><a href="#cb55-1085" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> pd.Series(<span class="bu">sorted</span>(prices[date_col].unique()))</span>
<span id="cb55-1086"><a href="#cb55-1086" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> build_trading_calendar(trading_dates, config)</span>
<span id="cb55-1087"><a href="#cb55-1087" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(calendar)<span class="sc">}</span><span class="ss"> potential event dates</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb55-1088"><a href="#cb55-1088" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1089"><a href="#cb55-1089" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Align events</span></span>
<span id="cb55-1090"><a href="#cb55-1090" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 2: Aligning events to trading calendar..."</span>)</span>
<span id="cb55-1091"><a href="#cb55-1091" aria-hidden="true" tabindex="-1"></a>    aligned <span class="op">=</span> align_events(events, calendar, id_col, event_date_col)</span>
<span id="cb55-1092"><a href="#cb55-1092" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(aligned)<span class="sc">}</span><span class="ss"> aligned events</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb55-1093"><a href="#cb55-1093" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1094"><a href="#cb55-1094" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Extract returns</span></span>
<span id="cb55-1095"><a href="#cb55-1095" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 3: Extracting returns and merging factors..."</span>)</span>
<span id="cb55-1096"><a href="#cb55-1096" aria-hidden="true" tabindex="-1"></a>    evt_rets <span class="op">=</span> extract_returns(aligned, prices, factors, config,</span>
<span id="cb55-1097"><a href="#cb55-1097" aria-hidden="true" tabindex="-1"></a>                               id_col, date_col, ret_col, mkt_col, rf_col)</span>
<span id="cb55-1098"><a href="#cb55-1098" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb55-1099"><a href="#cb55-1099" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1100"><a href="#cb55-1100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Estimate model</span></span>
<span id="cb55-1101"><a href="#cb55-1101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 4: Estimating risk model parameters..."</span>)</span>
<span id="cb55-1102"><a href="#cb55-1102" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> estimate_model(evt_rets, config, id_col, date_col, ret_col)</span>
<span id="cb55-1103"><a href="#cb55-1103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb55-1104"><a href="#cb55-1104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1105"><a href="#cb55-1105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Compute abnormal returns</span></span>
<span id="cb55-1106"><a href="#cb55-1106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 5: Computing abnormal returns..."</span>)</span>
<span id="cb55-1107"><a href="#cb55-1107" aria-hidden="true" tabindex="-1"></a>    daily_ar, event_ar <span class="op">=</span> compute_abnormal_returns(</span>
<span id="cb55-1108"><a href="#cb55-1108" aria-hidden="true" tabindex="-1"></a>        evt_rets, params, config, id_col, date_col, ret_col)</span>
<span id="cb55-1109"><a href="#cb55-1109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>()</span>
<span id="cb55-1110"><a href="#cb55-1110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1111"><a href="#cb55-1111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Test statistics</span></span>
<span id="cb55-1112"><a href="#cb55-1112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">"Step 6: Computing test statistics..."</span>)</span>
<span id="cb55-1113"><a href="#cb55-1113" aria-hidden="true" tabindex="-1"></a>    test_stats <span class="op">=</span> compute_test_statistics(event_ar, params, group_col)</span>
<span id="cb55-1114"><a href="#cb55-1114" aria-hidden="true" tabindex="-1"></a>    daily_stats <span class="op">=</span> compute_daily_stats(daily_ar, id_col)</span>
<span id="cb55-1115"><a href="#cb55-1115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb55-1116"><a href="#cb55-1116" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Done.</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb55-1117"><a href="#cb55-1117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚ïê‚ïê‚ïê Results Summary ‚ïê‚ïê‚ïê"</span>)</span>
<span id="cb55-1118"><a href="#cb55-1118" aria-hidden="true" tabindex="-1"></a>        cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb55-1119"><a href="#cb55-1119" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>]</span>
<span id="cb55-1120"><a href="#cb55-1120" aria-hidden="true" tabindex="-1"></a>        avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> cols <span class="cf">if</span> c <span class="kw">in</span> test_stats.columns]</span>
<span id="cb55-1121"><a href="#cb55-1121" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(test_stats[avail].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1122"><a href="#cb55-1122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1123"><a href="#cb55-1123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb55-1124"><a href="#cb55-1124" aria-hidden="true" tabindex="-1"></a>        <span class="st">'config'</span>: config,</span>
<span id="cb55-1125"><a href="#cb55-1125" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: params,</span>
<span id="cb55-1126"><a href="#cb55-1126" aria-hidden="true" tabindex="-1"></a>        <span class="st">'daily_ar'</span>: daily_ar,</span>
<span id="cb55-1127"><a href="#cb55-1127" aria-hidden="true" tabindex="-1"></a>        <span class="st">'event_ar'</span>: event_ar,</span>
<span id="cb55-1128"><a href="#cb55-1128" aria-hidden="true" tabindex="-1"></a>        <span class="st">'daily_stats'</span>: daily_stats,</span>
<span id="cb55-1129"><a href="#cb55-1129" aria-hidden="true" tabindex="-1"></a>        <span class="st">'test_stats'</span>: test_stats,</span>
<span id="cb55-1130"><a href="#cb55-1130" aria-hidden="true" tabindex="-1"></a>        <span class="st">'calendar'</span>: calendar,</span>
<span id="cb55-1131"><a href="#cb55-1131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-1132"><a href="#cb55-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1133"><a href="#cb55-1133" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Master pipeline ready."</span>)</span>
<span id="cb55-1134"><a href="#cb55-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1135"><a href="#cb55-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1136"><a href="#cb55-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">## Demonstration with Simulated Data</span></span>
<span id="cb55-1137"><a href="#cb55-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1138"><a href="#cb55-1138" aria-hidden="true" tabindex="-1"></a>Since we are building a general-purpose framework (the actual event data will be supplied later), we demonstrate the full pipeline with **realistic simulated data**.</span>
<span id="cb55-1139"><a href="#cb55-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1142"><a href="#cb55-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1143"><a href="#cb55-1143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulation</span></span>
<span id="cb55-1144"><a href="#cb55-1144" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Generate realistic simulated market data"</span></span>
<span id="cb55-1145"><a href="#cb55-1145" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Event study results using simulated data with known abnormal returns"</span></span>
<span id="cb55-1146"><a href="#cb55-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1147"><a href="#cb55-1147" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2024</span>)</span>
<span id="cb55-1148"><a href="#cb55-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1149"><a href="#cb55-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated trading calendar (Vietnamese market: ~245 days/year) ---</span></span>
<span id="cb55-1150"><a href="#cb55-1150" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.bdate_range(<span class="st">'2019-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'B'</span>)</span>
<span id="cb55-1151"><a href="#cb55-1151" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Tet + national holidays (simplified)</span></span>
<span id="cb55-1152"><a href="#cb55-1152" aria-hidden="true" tabindex="-1"></a>tet_holidays <span class="op">=</span> pd.to_datetime([</span>
<span id="cb55-1153"><a href="#cb55-1153" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019-02-04'</span>,<span class="st">'2019-02-05'</span>,<span class="st">'2019-02-06'</span>,<span class="st">'2019-02-07'</span>,<span class="st">'2019-02-08'</span>,</span>
<span id="cb55-1154"><a href="#cb55-1154" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2020-01-23'</span>,<span class="st">'2020-01-24'</span>,<span class="st">'2020-01-27'</span>,<span class="st">'2020-01-28'</span>,<span class="st">'2020-01-29'</span>,</span>
<span id="cb55-1155"><a href="#cb55-1155" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2021-02-10'</span>,<span class="st">'2021-02-11'</span>,<span class="st">'2021-02-12'</span>,<span class="st">'2021-02-15'</span>,<span class="st">'2021-02-16'</span>,</span>
<span id="cb55-1156"><a href="#cb55-1156" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2022-01-31'</span>,<span class="st">'2022-02-01'</span>,<span class="st">'2022-02-02'</span>,<span class="st">'2022-02-03'</span>,<span class="st">'2022-02-04'</span>,</span>
<span id="cb55-1157"><a href="#cb55-1157" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2023-01-20'</span>,<span class="st">'2023-01-23'</span>,<span class="st">'2023-01-24'</span>,<span class="st">'2023-01-25'</span>,<span class="st">'2023-01-26'</span>,</span>
<span id="cb55-1158"><a href="#cb55-1158" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb55-1159"><a href="#cb55-1159" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> dates.difference(tet_holidays)</span>
<span id="cb55-1160"><a href="#cb55-1160" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="bu">len</span>(dates)</span>
<span id="cb55-1161"><a href="#cb55-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1162"><a href="#cb55-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated factors (realistic Vietnamese market parameters) ---</span></span>
<span id="cb55-1163"><a href="#cb55-1163" aria-hidden="true" tabindex="-1"></a>rf_daily <span class="op">=</span> <span class="fl">0.04</span> <span class="op">/</span> <span class="dv">252</span>  <span class="co"># ~4% annual risk-free</span></span>
<span id="cb55-1164"><a href="#cb55-1164" aria-hidden="true" tabindex="-1"></a>mkt_excess <span class="op">=</span> np.random.normal(<span class="fl">0.0003</span>, <span class="fl">0.012</span>, T)  <span class="co"># ~7.5% annual, ~19% vol</span></span>
<span id="cb55-1165"><a href="#cb55-1165" aria-hidden="true" tabindex="-1"></a>smb <span class="op">=</span> np.random.normal(<span class="fl">0.0001</span>, <span class="fl">0.006</span>, T)</span>
<span id="cb55-1166"><a href="#cb55-1166" aria-hidden="true" tabindex="-1"></a>hml <span class="op">=</span> np.random.normal(<span class="fl">0.0001</span>, <span class="fl">0.005</span>, T)</span>
<span id="cb55-1167"><a href="#cb55-1167" aria-hidden="true" tabindex="-1"></a>rmw <span class="op">=</span> np.random.normal(<span class="fl">0.00005</span>, <span class="fl">0.004</span>, T)</span>
<span id="cb55-1168"><a href="#cb55-1168" aria-hidden="true" tabindex="-1"></a>cma <span class="op">=</span> np.random.normal(<span class="fl">0.00005</span>, <span class="fl">0.004</span>, T)</span>
<span id="cb55-1169"><a href="#cb55-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1170"><a href="#cb55-1170" aria-hidden="true" tabindex="-1"></a>factors_sim <span class="op">=</span> pd.DataFrame({</span>
<span id="cb55-1171"><a href="#cb55-1171" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: dates, <span class="st">'mkt_excess'</span>: mkt_excess, <span class="st">'smb'</span>: smb, <span class="st">'hml'</span>: hml,</span>
<span id="cb55-1172"><a href="#cb55-1172" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmw'</span>: rmw, <span class="st">'cma'</span>: cma, <span class="st">'risk_free'</span>: rf_daily</span>
<span id="cb55-1173"><a href="#cb55-1173" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb55-1174"><a href="#cb55-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1175"><a href="#cb55-1175" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 100 simulated stocks ---</span></span>
<span id="cb55-1176"><a href="#cb55-1176" aria-hidden="true" tabindex="-1"></a>n_stocks <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb55-1177"><a href="#cb55-1177" aria-hidden="true" tabindex="-1"></a>symbols <span class="op">=</span> [<span class="ss">f'SIM</span><span class="sc">{</span>i<span class="sc">:03d}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_stocks)]</span>
<span id="cb55-1178"><a href="#cb55-1178" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> np.random.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>, n_stocks)</span>
<span id="cb55-1179"><a href="#cb55-1179" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.0002</span>, n_stocks)</span>
<span id="cb55-1180"><a href="#cb55-1180" aria-hidden="true" tabindex="-1"></a>idio_vols <span class="op">=</span> np.random.uniform(<span class="fl">0.015</span>, <span class="fl">0.035</span>, n_stocks)</span>
<span id="cb55-1181"><a href="#cb55-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1182"><a href="#cb55-1182" aria-hidden="true" tabindex="-1"></a>price_rows <span class="op">=</span> []</span>
<span id="cb55-1183"><a href="#cb55-1183" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, sym <span class="kw">in</span> <span class="bu">enumerate</span>(symbols):</span>
<span id="cb55-1184"><a href="#cb55-1184" aria-hidden="true" tabindex="-1"></a>    eps <span class="op">=</span> np.random.normal(<span class="dv">0</span>, idio_vols[i], T)</span>
<span id="cb55-1185"><a href="#cb55-1185" aria-hidden="true" tabindex="-1"></a>    rets <span class="op">=</span> alphas[i] <span class="op">+</span> betas[i] <span class="op">*</span> mkt_excess <span class="op">+</span> <span class="fl">0.3</span><span class="op">*</span>smb <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span>hml <span class="op">+</span> eps</span>
<span id="cb55-1186"><a href="#cb55-1186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb55-1187"><a href="#cb55-1187" aria-hidden="true" tabindex="-1"></a>        price_rows.append({</span>
<span id="cb55-1188"><a href="#cb55-1188" aria-hidden="true" tabindex="-1"></a>            <span class="st">'symbol'</span>: sym, <span class="st">'date'</span>: dates[j], <span class="st">'ret'</span>: rets[j],</span>
<span id="cb55-1189"><a href="#cb55-1189" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ret_excess'</span>: rets[j] <span class="op">-</span> rf_daily,</span>
<span id="cb55-1190"><a href="#cb55-1190" aria-hidden="true" tabindex="-1"></a>            <span class="st">'risk_free'</span>: rf_daily,</span>
<span id="cb55-1191"><a href="#cb55-1191" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mktcap'</span>: np.random.uniform(<span class="dv">100</span>, <span class="dv">5000</span>),</span>
<span id="cb55-1192"><a href="#cb55-1192" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb55-1193"><a href="#cb55-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1194"><a href="#cb55-1194" aria-hidden="true" tabindex="-1"></a>prices_sim <span class="op">=</span> pd.DataFrame(price_rows)</span>
<span id="cb55-1195"><a href="#cb55-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1196"><a href="#cb55-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Simulated events: 50 random firm-dates with KNOWN positive AR ---</span></span>
<span id="cb55-1197"><a href="#cb55-1197" aria-hidden="true" tabindex="-1"></a>event_indices <span class="op">=</span> np.random.choice(<span class="bu">range</span>(<span class="dv">250</span>, T<span class="op">-</span><span class="dv">50</span>), <span class="dv">50</span>, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-1198"><a href="#cb55-1198" aria-hidden="true" tabindex="-1"></a>event_firms <span class="op">=</span> np.random.choice(symbols, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-1199"><a href="#cb55-1199" aria-hidden="true" tabindex="-1"></a>event_dates_sim <span class="op">=</span> [dates[i] <span class="cf">for</span> i <span class="kw">in</span> event_indices]</span>
<span id="cb55-1200"><a href="#cb55-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1201"><a href="#cb55-1201" aria-hidden="true" tabindex="-1"></a><span class="co"># Inject abnormal returns on event date (2% positive shock)</span></span>
<span id="cb55-1202"><a href="#cb55-1202" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> firm, edate <span class="kw">in</span> <span class="bu">zip</span>(event_firms, event_dates_sim):</span>
<span id="cb55-1203"><a href="#cb55-1203" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> (prices_sim[<span class="st">'symbol'</span>] <span class="op">==</span> firm) <span class="op">&amp;</span> (prices_sim[<span class="st">'date'</span>] <span class="op">==</span> edate)</span>
<span id="cb55-1204"><a href="#cb55-1204" aria-hidden="true" tabindex="-1"></a>    prices_sim.loc[mask, <span class="st">'ret'</span>] <span class="op">+=</span> <span class="fl">0.02</span></span>
<span id="cb55-1205"><a href="#cb55-1205" aria-hidden="true" tabindex="-1"></a>    prices_sim.loc[mask, <span class="st">'ret_excess'</span>] <span class="op">+=</span> <span class="fl">0.02</span></span>
<span id="cb55-1206"><a href="#cb55-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1207"><a href="#cb55-1207" aria-hidden="true" tabindex="-1"></a>events_sim <span class="op">=</span> pd.DataFrame({</span>
<span id="cb55-1208"><a href="#cb55-1208" aria-hidden="true" tabindex="-1"></a>    <span class="st">'symbol'</span>: event_firms,</span>
<span id="cb55-1209"><a href="#cb55-1209" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event_date'</span>: event_dates_sim,</span>
<span id="cb55-1210"><a href="#cb55-1210" aria-hidden="true" tabindex="-1"></a>    <span class="st">'group'</span>: np.random.choice([<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">50</span>)</span>
<span id="cb55-1211"><a href="#cb55-1211" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb55-1212"><a href="#cb55-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1213"><a href="#cb55-1213" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Simulated data: </span><span class="sc">{</span>n_stocks<span class="sc">}</span><span class="ss"> stocks √ó </span><span class="sc">{</span>T<span class="sc">}</span><span class="ss"> days = </span><span class="sc">{</span><span class="bu">len</span>(prices_sim)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb55-1214"><a href="#cb55-1214" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Events: </span><span class="sc">{</span><span class="bu">len</span>(events_sim)<span class="sc">}</span><span class="ss"> firm-event pairs"</span>)</span>
<span id="cb55-1215"><a href="#cb55-1215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Injected abnormal return: +2% on event date"</span>)</span>
<span id="cb55-1216"><a href="#cb55-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1217"><a href="#cb55-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1218"><a href="#cb55-1218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Running the Full Pipeline</span></span>
<span id="cb55-1219"><a href="#cb55-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1222"><a href="#cb55-1222" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1223"><a href="#cb55-1223" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-pipeline</span></span>
<span id="cb55-1224"><a href="#cb55-1224" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Execute the event study"</span></span>
<span id="cb55-1225"><a href="#cb55-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1226"><a href="#cb55-1226" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1227"><a href="#cb55-1227" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb55-1228"><a href="#cb55-1228" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb55-1229"><a href="#cb55-1229" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-1230"><a href="#cb55-1230" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb55-1231"><a href="#cb55-1231" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb55-1232"><a href="#cb55-1232" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-1233"><a href="#cb55-1233" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1234"><a href="#cb55-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1235"><a href="#cb55-1235" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> run_event_study(</span>
<span id="cb55-1236"><a href="#cb55-1236" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_sim,</span>
<span id="cb55-1237"><a href="#cb55-1237" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_sim,</span>
<span id="cb55-1238"><a href="#cb55-1238" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_sim,</span>
<span id="cb55-1239"><a href="#cb55-1239" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config,</span>
<span id="cb55-1240"><a href="#cb55-1240" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb55-1241"><a href="#cb55-1241" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1242"><a href="#cb55-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1243"><a href="#cb55-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1244"><a href="#cb55-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing Results</span></span>
<span id="cb55-1245"><a href="#cb55-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1248"><a href="#cb55-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1249"><a href="#cb55-1249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-car-dynamics</span></span>
<span id="cb55-1250"><a href="#cb55-1250" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Dynamics of cumulative abnormal returns (CARs) and buy-and-hold abnormal returns (BHARs) around the event date. The positive jump at t=0 reflects the injected 2% abnormal return."</span></span>
<span id="cb55-1251"><a href="#cb55-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1252"><a href="#cb55-1252" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> plot_event_study(</span>
<span id="cb55-1253"><a href="#cb55-1253" aria-hidden="true" tabindex="-1"></a>    results[<span class="st">'daily_stats'</span>],</span>
<span id="cb55-1254"><a href="#cb55-1254" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Event Study: FF3 Model ‚Äî Simulated Vietnamese Market"</span></span>
<span id="cb55-1255"><a href="#cb55-1255" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1256"><a href="#cb55-1256" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-1257"><a href="#cb55-1257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1258"><a href="#cb55-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1261"><a href="#cb55-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1262"><a href="#cb55-1262" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-car-distribution</span></span>
<span id="cb55-1263"><a href="#cb55-1263" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cross-sectional distribution of cumulative abnormal returns. The rightward shift from zero and positive skewness are consistent with the injected positive event effect."</span></span>
<span id="cb55-1264"><a href="#cb55-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1265"><a href="#cb55-1265" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> plot_car_distribution(results[<span class="st">'event_ar'</span>], <span class="st">'CAR'</span>)</span>
<span id="cb55-1266"><a href="#cb55-1266" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-1267"><a href="#cb55-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1268"><a href="#cb55-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1269"><a href="#cb55-1269" aria-hidden="true" tabindex="-1"></a><span class="fu">### Complete Test Statistics</span></span>
<span id="cb55-1270"><a href="#cb55-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1273"><a href="#cb55-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1274"><a href="#cb55-1274" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-test-results</span></span>
<span id="cb55-1275"><a href="#cb55-1275" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Event study test statistics for the full sample and by subgroup"</span></span>
<span id="cb55-1276"><a href="#cb55-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1277"><a href="#cb55-1277" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for display</span></span>
<span id="cb55-1278"><a href="#cb55-1278" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> results[<span class="st">'test_stats'</span>].copy()</span>
<span id="cb55-1279"><a href="#cb55-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1280"><a href="#cb55-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># Select key columns</span></span>
<span id="cb55-1281"><a href="#cb55-1281" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb55-1282"><a href="#cb55-1282" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'Z_Patell'</span>, <span class="st">'p_Patell'</span>,</span>
<span id="cb55-1283"><a href="#cb55-1283" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>,</span>
<span id="cb55-1284"><a href="#cb55-1284" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Z_GSign'</span>, <span class="st">'p_GSign'</span>, <span class="st">'t_SkAdj'</span>, <span class="st">'p_SkAdj'</span>]</span>
<span id="cb55-1285"><a href="#cb55-1285" aria-hidden="true" tabindex="-1"></a>avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> ts.columns]</span>
<span id="cb55-1286"><a href="#cb55-1286" aria-hidden="true" tabindex="-1"></a>display_df <span class="op">=</span> ts[avail].copy()</span>
<span id="cb55-1287"><a href="#cb55-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1288"><a href="#cb55-1288" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb55-1289"><a href="#cb55-1289" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> display_df.columns:</span>
<span id="cb55-1290"><a href="#cb55-1290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> [<span class="st">'N'</span>]:</span>
<span id="cb55-1291"><a href="#cb55-1291" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].astype(<span class="bu">int</span>)</span>
<span id="cb55-1292"><a href="#cb55-1292" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c.startswith(<span class="st">'p_'</span>):</span>
<span id="cb55-1293"><a href="#cb55-1293" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1294"><a href="#cb55-1294" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="kw">in</span> [<span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb55-1295"><a href="#cb55-1295" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1296"><a href="#cb55-1296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'pct_positive'</span>:</span>
<span id="cb55-1297"><a href="#cb55-1297" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.1%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1298"><a href="#cb55-1298" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(display_df[c].iloc[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)):</span>
<span id="cb55-1299"><a href="#cb55-1299" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1300"><a href="#cb55-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1301"><a href="#cb55-1301" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(display_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1302"><a href="#cb55-1302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1303"><a href="#cb55-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1304"><a href="#cb55-1304" aria-hidden="true" tabindex="-1"></a><span class="fu">### Running Multiple Models for Robustness</span></span>
<span id="cb55-1305"><a href="#cb55-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1306"><a href="#cb55-1306" aria-hidden="true" tabindex="-1"></a>A key best practice is to report results across multiple risk models. If conclusions are robust across models, this strengthens the findings:</span>
<span id="cb55-1307"><a href="#cb55-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1310"><a href="#cb55-1310" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1311"><a href="#cb55-1311" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: multi-model</span></span>
<span id="cb55-1312"><a href="#cb55-1312" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Run event study across all available models"</span></span>
<span id="cb55-1313"><a href="#cb55-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1314"><a href="#cb55-1314" aria-hidden="true" tabindex="-1"></a>models_to_run <span class="op">=</span> [</span>
<span id="cb55-1315"><a href="#cb55-1315" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market-Adjusted"</span>, RiskModel.MARKET_ADJ),</span>
<span id="cb55-1316"><a href="#cb55-1316" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market Model"</span>, RiskModel.MARKET_MODEL),</span>
<span id="cb55-1317"><a href="#cb55-1317" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 3"</span>, RiskModel.FF3),</span>
<span id="cb55-1318"><a href="#cb55-1318" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 5"</span>, RiskModel.FF5),</span>
<span id="cb55-1319"><a href="#cb55-1319" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb55-1320"><a href="#cb55-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1321"><a href="#cb55-1321" aria-hidden="true" tabindex="-1"></a>robustness <span class="op">=</span> []</span>
<span id="cb55-1322"><a href="#cb55-1322" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, mdl <span class="kw">in</span> models_to_run:</span>
<span id="cb55-1323"><a href="#cb55-1323" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1324"><a href="#cb55-1324" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-1325"><a href="#cb55-1325" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>mdl</span>
<span id="cb55-1326"><a href="#cb55-1326" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1327"><a href="#cb55-1327" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_sim, prices_sim, factors_sim, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-1328"><a href="#cb55-1328" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb55-1329"><a href="#cb55-1329" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-1330"><a href="#cb55-1330" aria-hidden="true" tabindex="-1"></a>    robustness.append({</span>
<span id="cb55-1331"><a href="#cb55-1331" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb55-1332"><a href="#cb55-1332" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb55-1333"><a href="#cb55-1333" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1334"><a href="#cb55-1334" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1335"><a href="#cb55-1335" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb55-1336"><a href="#cb55-1336" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb55-1337"><a href="#cb55-1337" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb55-1338"><a href="#cb55-1338" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'t_KP'</span>, np.nan)<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb55-1339"><a href="#cb55-1339" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb55-1340"><a href="#cb55-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1341"><a href="#cb55-1341" aria-hidden="true" tabindex="-1"></a>rob_df <span class="op">=</span> pd.DataFrame(robustness)</span>
<span id="cb55-1342"><a href="#cb55-1342" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Robustness Across Risk Models:"</span>)</span>
<span id="cb55-1343"><a href="#cb55-1343" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rob_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1344"><a href="#cb55-1344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1345"><a href="#cb55-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1346"><a href="#cb55-1346" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to Use This Framework with Your Data</span></span>
<span id="cb55-1347"><a href="#cb55-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Data Format</span></span>
<span id="cb55-1348"><a href="#cb55-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1349"><a href="#cb55-1349" aria-hidden="true" tabindex="-1"></a>To run the event study on real Vietnamese market data, prepare three inputs:</span>
<span id="cb55-1350"><a href="#cb55-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1351"><a href="#cb55-1351" aria-hidden="true" tabindex="-1"></a>**1. Stock Returns** (<span class="in">`prices`</span> DataFrame):</span>
<span id="cb55-1352"><a href="#cb55-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1353"><a href="#cb55-1353" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Column                <span class="pp">|</span> Description            <span class="pp">|</span> Example      <span class="pp">|</span></span>
<span id="cb55-1354"><a href="#cb55-1354" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------------------|------------------------|--------------|</span></span>
<span id="cb55-1355"><a href="#cb55-1355" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`symbol`</span>              <span class="pp">|</span> Stock ticker           <span class="pp">|</span> <span class="in">`'VNM'`</span>      <span class="pp">|</span></span>
<span id="cb55-1356"><a href="#cb55-1356" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`date`</span>                <span class="pp">|</span> Trading date           <span class="pp">|</span> <span class="in">`2023-06-15`</span> <span class="pp">|</span></span>
<span id="cb55-1357"><a href="#cb55-1357" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`ret`</span> or <span class="in">`ret_excess`</span> <span class="pp">|</span> Daily return (decimal) <span class="pp">|</span> <span class="in">`0.0123`</span>     <span class="pp">|</span></span>
<span id="cb55-1358"><a href="#cb55-1358" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`risk_free`</span>           <span class="pp">|</span> Daily risk-free rate   <span class="pp">|</span> <span class="in">`0.000159`</span>   <span class="pp">|</span></span>
<span id="cb55-1359"><a href="#cb55-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1360"><a href="#cb55-1360" aria-hidden="true" tabindex="-1"></a>**2. Factor Returns** (<span class="in">`factors`</span> DataFrame):</span>
<span id="cb55-1361"><a href="#cb55-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1362"><a href="#cb55-1362" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Column       <span class="pp">|</span> Description                <span class="pp">|</span></span>
<span id="cb55-1363"><a href="#cb55-1363" aria-hidden="true" tabindex="-1"></a><span class="pp">|--------------|----------------------------|</span></span>
<span id="cb55-1364"><a href="#cb55-1364" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`date`</span>       <span class="pp">|</span> Trading date               <span class="pp">|</span></span>
<span id="cb55-1365"><a href="#cb55-1365" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`mkt_excess`</span> <span class="pp">|</span> Market excess return       <span class="pp">|</span></span>
<span id="cb55-1366"><a href="#cb55-1366" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`smb`</span>        <span class="pp">|</span> Size factor (FF3/FF5)      <span class="pp">|</span></span>
<span id="cb55-1367"><a href="#cb55-1367" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`hml`</span>        <span class="pp">|</span> Value factor (FF3/FF5)     <span class="pp">|</span></span>
<span id="cb55-1368"><a href="#cb55-1368" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`rmw`</span>        <span class="pp">|</span> Profitability factor (FF5) <span class="pp">|</span></span>
<span id="cb55-1369"><a href="#cb55-1369" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`cma`</span>        <span class="pp">|</span> Investment factor (FF5)    <span class="pp">|</span></span>
<span id="cb55-1370"><a href="#cb55-1370" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`risk_free`</span>  <span class="pp">|</span> Risk-free rate             <span class="pp">|</span></span>
<span id="cb55-1371"><a href="#cb55-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1372"><a href="#cb55-1372" aria-hidden="true" tabindex="-1"></a>**3. Event File** (<span class="in">`events`</span> DataFrame):</span>
<span id="cb55-1373"><a href="#cb55-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1374"><a href="#cb55-1374" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Column       <span class="pp">|</span> Description         <span class="pp">|</span> Example      <span class="pp">|</span></span>
<span id="cb55-1375"><a href="#cb55-1375" aria-hidden="true" tabindex="-1"></a><span class="pp">|--------------|---------------------|--------------|</span></span>
<span id="cb55-1376"><a href="#cb55-1376" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`symbol`</span>     <span class="pp">|</span> Stock ticker        <span class="pp">|</span> <span class="in">`'VNM'`</span>      <span class="pp">|</span></span>
<span id="cb55-1377"><a href="#cb55-1377" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`event_date`</span> <span class="pp">|</span> Event date          <span class="pp">|</span> <span class="in">`2023-03-15`</span> <span class="pp">|</span></span>
<span id="cb55-1378"><a href="#cb55-1378" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`group`</span>      <span class="pp">|</span> (Optional) subgroup <span class="pp">|</span> <span class="in">`1`</span>          <span class="pp">|</span></span>
<span id="cb55-1379"><a href="#cb55-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1380"><a href="#cb55-1380" aria-hidden="true" tabindex="-1"></a><span class="fu">### Minimal Usage Example</span></span>
<span id="cb55-1381"><a href="#cb55-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1382"><a href="#cb55-1382" aria-hidden="true" tabindex="-1"></a><span class="in">``` python</span></span>
<span id="cb55-1383"><a href="#cb55-1383" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your data</span></span>
<span id="cb55-1384"><a href="#cb55-1384" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> pd.read_csv(<span class="st">'prices_daily.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb55-1385"><a href="#cb55-1385" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> pd.read_csv(<span class="st">'factors_ff3_daily.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb55-1386"><a href="#cb55-1386" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.read_csv(<span class="st">'my_events.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'event_date'</span>])</span>
<span id="cb55-1387"><a href="#cb55-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1388"><a href="#cb55-1388" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure</span></span>
<span id="cb55-1389"><a href="#cb55-1389" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1390"><a href="#cb55-1390" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb55-1391"><a href="#cb55-1391" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">5</span>,</span>
<span id="cb55-1392"><a href="#cb55-1392" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb55-1393"><a href="#cb55-1393" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb55-1394"><a href="#cb55-1394" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb55-1395"><a href="#cb55-1395" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-1396"><a href="#cb55-1396" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1397"><a href="#cb55-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1398"><a href="#cb55-1398" aria-hidden="true" tabindex="-1"></a><span class="co"># Run</span></span>
<span id="cb55-1399"><a href="#cb55-1399" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> run_event_study(events, prices, factors, config)</span>
<span id="cb55-1400"><a href="#cb55-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1401"><a href="#cb55-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># Access outputs</span></span>
<span id="cb55-1402"><a href="#cb55-1402" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'test_stats'</span>]    <span class="co"># Test statistics</span></span>
<span id="cb55-1403"><a href="#cb55-1403" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'event_ar'</span>]      <span class="co"># Firm-level CARs/BHARs</span></span>
<span id="cb55-1404"><a href="#cb55-1404" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'daily_ar'</span>]      <span class="co"># Daily abnormal returns</span></span>
<span id="cb55-1405"><a href="#cb55-1405" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'daily_stats'</span>]   <span class="co"># Event-time aggregates</span></span>
<span id="cb55-1406"><a href="#cb55-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1407"><a href="#cb55-1407" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb55-1408"><a href="#cb55-1408" aria-hidden="true" tabindex="-1"></a>plot_event_study(results[<span class="st">'daily_stats'</span>], title<span class="op">=</span><span class="st">"My Event Study"</span>)</span>
<span id="cb55-1409"><a href="#cb55-1409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1410"><a href="#cb55-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1411"><a href="#cb55-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">## Demonstration with Vietnamese Market Data</span></span>
<span id="cb55-1412"><a href="#cb55-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1413"><a href="#cb55-1413" aria-hidden="true" tabindex="-1"></a>We now demonstrate the full event study pipeline using actual Vietnamese stock market data. The datasets available are:</span>
<span id="cb55-1414"><a href="#cb55-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1415"><a href="#cb55-1415" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`prices_daily`</span>: <span class="in">`symbol`</span>, <span class="in">`date`</span>, <span class="in">`ret_excess`</span>, <span class="in">`mktcap`</span>, <span class="in">`mktcap_lag`</span>, <span class="in">`risk_free`</span></span>
<span id="cb55-1416"><a href="#cb55-1416" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`prices_monthly`</span>: same structure</span>
<span id="cb55-1417"><a href="#cb55-1417" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`factors_ff3_daily`</span>: <span class="in">`date`</span>, <span class="in">`smb`</span>, <span class="in">`hml`</span>, <span class="in">`mkt_excess`</span>, <span class="in">`risk_free`</span></span>
<span id="cb55-1418"><a href="#cb55-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`factors_ff3_monthly`</span> ‚Äî monthly frequency version</span>
<span id="cb55-1419"><a href="#cb55-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`factors_ff5_daily`</span>: <span class="in">`date`</span>, <span class="in">`smb`</span>, <span class="in">`hml`</span>, <span class="in">`mkt_excess`</span>, <span class="in">`risk_free`</span>, <span class="in">`rmw`</span>, <span class="in">`cma`</span></span>
<span id="cb55-1420"><a href="#cb55-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`factors_ff5_monthly`</span></span>
<span id="cb55-1421"><a href="#cb55-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1422"><a href="#cb55-1422" aria-hidden="true" tabindex="-1"></a>Since our data provides <span class="in">`ret_excess`</span> rather than raw returns, we recover raw returns as $R_{it} = R^e_{it} + R_{f,t}$, and the market return as $R_{m,t} = R^e_{m,t} + R_{f,t}$. The <span class="in">`extract_event_returns()`</span> function handles this automatically.</span>
<span id="cb55-1423"><a href="#cb55-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1424"><a href="#cb55-1424" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loading the Data</span></span>
<span id="cb55-1425"><a href="#cb55-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1428"><a href="#cb55-1428" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1429"><a href="#cb55-1429" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data</span></span>
<span id="cb55-1430"><a href="#cb55-1430" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Load Vietnamese market data"</span></span>
<span id="cb55-1431"><a href="#cb55-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1432"><a href="#cb55-1432" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Recover raw returns ---</span></span>
<span id="cb55-1433"><a href="#cb55-1433" aria-hidden="true" tabindex="-1"></a><span class="co"># ret = ret_excess + risk_free</span></span>
<span id="cb55-1434"><a href="#cb55-1434" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">'ret'</span>] <span class="op">=</span> prices_daily[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices_daily[<span class="st">'risk_free'</span>]</span>
<span id="cb55-1435"><a href="#cb55-1435" aria-hidden="true" tabindex="-1"></a>prices_monthly[<span class="st">'ret'</span>] <span class="op">=</span> prices_monthly[<span class="st">'ret_excess'</span>] <span class="op">+</span> prices_monthly[<span class="st">'risk_free'</span>]</span>
<span id="cb55-1436"><a href="#cb55-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1437"><a href="#cb55-1437" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inspect the data ---</span></span>
<span id="cb55-1438"><a href="#cb55-1438" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb55-1439"><a href="#cb55-1439" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VIETNAMESE MARKET DATA SUMMARY"</span>)</span>
<span id="cb55-1440"><a href="#cb55-1440" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb55-1441"><a href="#cb55-1441" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">prices_daily: </span><span class="sc">{</span>prices_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows, "</span></span>
<span id="cb55-1442"><a href="#cb55-1442" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_daily[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> stocks, "</span></span>
<span id="cb55-1443"><a href="#cb55-1443" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_daily[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>prices_daily[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-1444"><a href="#cb55-1444" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"prices_monthly: </span><span class="sc">{</span>prices_monthly<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows, "</span></span>
<span id="cb55-1445"><a href="#cb55-1445" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>prices_monthly[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> stocks"</span>)</span>
<span id="cb55-1446"><a href="#cb55-1446" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">factors_ff3_daily: </span><span class="sc">{</span>factors_ff3_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> trading days"</span>)</span>
<span id="cb55-1447"><a href="#cb55-1447" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">list</span>(factors_ff3_daily.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-1448"><a href="#cb55-1448" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"factors_ff5_daily: </span><span class="sc">{</span>factors_ff5_daily<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> trading days"</span>)</span>
<span id="cb55-1449"><a href="#cb55-1449" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">list</span>(factors_ff5_daily.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-1450"><a href="#cb55-1450" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample daily returns:"</span>)</span>
<span id="cb55-1451"><a href="#cb55-1451" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prices_daily[[<span class="st">'symbol'</span>, <span class="st">'date'</span>, <span class="st">'ret_excess'</span>, <span class="st">'ret'</span>, <span class="st">'risk_free'</span>, <span class="st">'mktcap'</span>]]</span>
<span id="cb55-1452"><a href="#cb55-1452" aria-hidden="true" tabindex="-1"></a>      .head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1453"><a href="#cb55-1453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample daily factors:"</span>)</span>
<span id="cb55-1454"><a href="#cb55-1454" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(factors_ff3_daily.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1455"><a href="#cb55-1455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1456"><a href="#cb55-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1457"><a href="#cb55-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Sample Events</span></span>
<span id="cb55-1458"><a href="#cb55-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1459"><a href="#cb55-1459" aria-hidden="true" tabindex="-1"></a>For this demonstration, we create a sample event file. In practice, events would come from corporate announcements (earnings, M&amp;A, dividends), regulatory changes, or other information shocks. Here we select 50 large-cap Vietnamese stocks and assign random event dates from the most recent two years of data to illustrate the pipeline mechanics.</span>
<span id="cb55-1460"><a href="#cb55-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1463"><a href="#cb55-1463" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1464"><a href="#cb55-1464" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-events</span></span>
<span id="cb55-1465"><a href="#cb55-1465" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Create sample event file for demonstration"</span></span>
<span id="cb55-1466"><a href="#cb55-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1467"><a href="#cb55-1467" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2024</span>)</span>
<span id="cb55-1468"><a href="#cb55-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1469"><a href="#cb55-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 50 largest stocks by median market cap</span></span>
<span id="cb55-1470"><a href="#cb55-1470" aria-hidden="true" tabindex="-1"></a>largest <span class="op">=</span> (prices_daily.groupby(<span class="st">'symbol'</span>)[<span class="st">'mktcap'</span>]</span>
<span id="cb55-1471"><a href="#cb55-1471" aria-hidden="true" tabindex="-1"></a>           .median()</span>
<span id="cb55-1472"><a href="#cb55-1472" aria-hidden="true" tabindex="-1"></a>           .nlargest(<span class="dv">50</span>)</span>
<span id="cb55-1473"><a href="#cb55-1473" aria-hidden="true" tabindex="-1"></a>           .index.tolist())</span>
<span id="cb55-1474"><a href="#cb55-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1475"><a href="#cb55-1475" aria-hidden="true" tabindex="-1"></a><span class="co"># Date range for events: last 2 years of data, with buffer for windows</span></span>
<span id="cb55-1476"><a href="#cb55-1476" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> prices_daily[<span class="st">'date'</span>].sort_values().unique()</span>
<span id="cb55-1477"><a href="#cb55-1477" aria-hidden="true" tabindex="-1"></a>n_dates <span class="op">=</span> <span class="bu">len</span>(date_range)</span>
<span id="cb55-1478"><a href="#cb55-1478" aria-hidden="true" tabindex="-1"></a><span class="co"># Events from the middle portion (need room for estimation + event windows)</span></span>
<span id="cb55-1479"><a href="#cb55-1479" aria-hidden="true" tabindex="-1"></a>event_eligible <span class="op">=</span> date_range[<span class="bu">int</span>(n_dates <span class="op">*</span> <span class="fl">0.3</span>):<span class="bu">int</span>(n_dates <span class="op">*</span> <span class="fl">0.85</span>)]</span>
<span id="cb55-1480"><a href="#cb55-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1481"><a href="#cb55-1481" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 50 random firm-event pairs</span></span>
<span id="cb55-1482"><a href="#cb55-1482" aria-hidden="true" tabindex="-1"></a>event_firms <span class="op">=</span> np.random.choice(largest, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-1483"><a href="#cb55-1483" aria-hidden="true" tabindex="-1"></a>event_dates <span class="op">=</span> np.random.choice(event_eligible, <span class="dv">50</span>, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-1484"><a href="#cb55-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1485"><a href="#cb55-1485" aria-hidden="true" tabindex="-1"></a>events_demo <span class="op">=</span> pd.DataFrame({</span>
<span id="cb55-1486"><a href="#cb55-1486" aria-hidden="true" tabindex="-1"></a>    <span class="st">'symbol'</span>: event_firms,</span>
<span id="cb55-1487"><a href="#cb55-1487" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event_date'</span>: pd.to_datetime(event_dates),</span>
<span id="cb55-1488"><a href="#cb55-1488" aria-hidden="true" tabindex="-1"></a>    <span class="st">'group'</span>: np.random.choice([<span class="st">'Group_A'</span>, <span class="st">'Group_B'</span>], <span class="dv">50</span>)</span>
<span id="cb55-1489"><a href="#cb55-1489" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb55-1490"><a href="#cb55-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1491"><a href="#cb55-1491" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any duplicate firm-date pairs</span></span>
<span id="cb55-1492"><a href="#cb55-1492" aria-hidden="true" tabindex="-1"></a>events_demo <span class="op">=</span> events_demo.drop_duplicates(subset<span class="op">=</span>[<span class="st">'symbol'</span>, <span class="st">'event_date'</span>])</span>
<span id="cb55-1493"><a href="#cb55-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1494"><a href="#cb55-1494" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample event file: </span><span class="sc">{</span><span class="bu">len</span>(events_demo)<span class="sc">}</span><span class="ss"> firm-event observations"</span>)</span>
<span id="cb55-1495"><a href="#cb55-1495" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique firms: </span><span class="sc">{</span>events_demo[<span class="st">'symbol'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-1496"><a href="#cb55-1496" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>events_demo[<span class="st">'event_date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to "</span></span>
<span id="cb55-1497"><a href="#cb55-1497" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>events_demo[<span class="st">'event_date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-1498"><a href="#cb55-1498" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Group distribution:"</span>)</span>
<span id="cb55-1499"><a href="#cb55-1499" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(events_demo[<span class="st">'group'</span>].value_counts().to_string())</span>
<span id="cb55-1500"><a href="#cb55-1500" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First 10 events:"</span>)</span>
<span id="cb55-1501"><a href="#cb55-1501" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(events_demo.sort_values(<span class="st">'event_date'</span>).head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1502"><a href="#cb55-1502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1503"><a href="#cb55-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1504"><a href="#cb55-1504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Daily Event Study: Fama-French 3-Factor Model</span></span>
<span id="cb55-1505"><a href="#cb55-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1508"><a href="#cb55-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1509"><a href="#cb55-1509" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-daily-ff3</span></span>
<span id="cb55-1510"><a href="#cb55-1510" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Run daily event study with FF3 model"</span></span>
<span id="cb55-1511"><a href="#cb55-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1512"><a href="#cb55-1512" aria-hidden="true" tabindex="-1"></a>config_ff3 <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1513"><a href="#cb55-1513" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb55-1514"><a href="#cb55-1514" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb55-1515"><a href="#cb55-1515" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-1516"><a href="#cb55-1516" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb55-1517"><a href="#cb55-1517" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb55-1518"><a href="#cb55-1518" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-1519"><a href="#cb55-1519" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1520"><a href="#cb55-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1521"><a href="#cb55-1521" aria-hidden="true" tabindex="-1"></a>results_ff3 <span class="op">=</span> run_event_study(</span>
<span id="cb55-1522"><a href="#cb55-1522" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_demo,</span>
<span id="cb55-1523"><a href="#cb55-1523" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_daily,</span>
<span id="cb55-1524"><a href="#cb55-1524" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_ff3_daily,</span>
<span id="cb55-1525"><a href="#cb55-1525" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config_ff3,</span>
<span id="cb55-1526"><a href="#cb55-1526" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb55-1527"><a href="#cb55-1527" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1528"><a href="#cb55-1528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1529"><a href="#cb55-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1530"><a href="#cb55-1530" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing Daily Results</span></span>
<span id="cb55-1531"><a href="#cb55-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1534"><a href="#cb55-1534" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1535"><a href="#cb55-1535" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-daily-car</span></span>
<span id="cb55-1536"><a href="#cb55-1536" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cumulative abnormal returns around event dates for Vietnamese stocks using the Fama-French 3-factor model. The event window spans [-10, +10] trading days."</span></span>
<span id="cb55-1537"><a href="#cb55-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1538"><a href="#cb55-1538" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> plot_event_study(</span>
<span id="cb55-1539"><a href="#cb55-1539" aria-hidden="true" tabindex="-1"></a>    results_ff3[<span class="st">'daily_stats'</span>],</span>
<span id="cb55-1540"><a href="#cb55-1540" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Event Study: Fama-French 3-Factor Model ‚Äî Vietnamese Market (Daily)"</span></span>
<span id="cb55-1541"><a href="#cb55-1541" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1542"><a href="#cb55-1542" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-1543"><a href="#cb55-1543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1544"><a href="#cb55-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1547"><a href="#cb55-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1548"><a href="#cb55-1548" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-daily-dist</span></span>
<span id="cb55-1549"><a href="#cb55-1549" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cross-sectional distribution of cumulative abnormal returns (CARs) across firm-events. The histogram and Q-Q plot assess normality assumptions underlying parametric tests."</span></span>
<span id="cb55-1550"><a href="#cb55-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1551"><a href="#cb55-1551" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> plot_car_distribution(results_ff3[<span class="st">'event_ar'</span>], <span class="st">'CAR'</span>)</span>
<span id="cb55-1552"><a href="#cb55-1552" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-1553"><a href="#cb55-1553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1554"><a href="#cb55-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1555"><a href="#cb55-1555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Complete Test Statistics (Daily)</span></span>
<span id="cb55-1556"><a href="#cb55-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1559"><a href="#cb55-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1560"><a href="#cb55-1560" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-daily-tests</span></span>
<span id="cb55-1561"><a href="#cb55-1561" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Event study test statistics for the full sample and by subgroup ‚Äî Daily frequency, FF3 model"</span></span>
<span id="cb55-1562"><a href="#cb55-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1563"><a href="#cb55-1563" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> results_ff3[<span class="st">'test_stats'</span>].copy()</span>
<span id="cb55-1564"><a href="#cb55-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1565"><a href="#cb55-1565" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'median_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb55-1566"><a href="#cb55-1566" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'Z_Patell'</span>, <span class="st">'p_Patell'</span>,</span>
<span id="cb55-1567"><a href="#cb55-1567" aria-hidden="true" tabindex="-1"></a>                <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>, <span class="st">'t_KP'</span>, <span class="st">'p_KP'</span>,</span>
<span id="cb55-1568"><a href="#cb55-1568" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Z_GSign'</span>, <span class="st">'p_GSign'</span>, <span class="st">'t_SkAdj'</span>, <span class="st">'p_SkAdj'</span>,</span>
<span id="cb55-1569"><a href="#cb55-1569" aria-hidden="true" tabindex="-1"></a>                <span class="st">'W_Wilcoxon'</span>, <span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb55-1570"><a href="#cb55-1570" aria-hidden="true" tabindex="-1"></a>avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> ts.columns]</span>
<span id="cb55-1571"><a href="#cb55-1571" aria-hidden="true" tabindex="-1"></a>display_df <span class="op">=</span> ts[avail].copy()</span>
<span id="cb55-1572"><a href="#cb55-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1573"><a href="#cb55-1573" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> display_df.columns:</span>
<span id="cb55-1574"><a href="#cb55-1574" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> [<span class="st">'N'</span>]:</span>
<span id="cb55-1575"><a href="#cb55-1575" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].astype(<span class="bu">int</span>)</span>
<span id="cb55-1576"><a href="#cb55-1576" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'group'</span>:</span>
<span id="cb55-1577"><a href="#cb55-1577" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb55-1578"><a href="#cb55-1578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c.startswith(<span class="st">'p_'</span>):</span>
<span id="cb55-1579"><a href="#cb55-1579" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1580"><a href="#cb55-1580" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="kw">in</span> [<span class="st">'mean_CAR'</span>, <span class="st">'median_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb55-1581"><a href="#cb55-1581" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1582"><a href="#cb55-1582" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> c <span class="op">==</span> <span class="st">'pct_positive'</span>:</span>
<span id="cb55-1583"><a href="#cb55-1583" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.1%}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1584"><a href="#cb55-1584" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(display_df[c].iloc[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)):</span>
<span id="cb55-1585"><a href="#cb55-1585" aria-hidden="true" tabindex="-1"></a>        display_df[c] <span class="op">=</span> display_df[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1586"><a href="#cb55-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1587"><a href="#cb55-1587" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(display_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1588"><a href="#cb55-1588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1589"><a href="#cb55-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1590"><a href="#cb55-1590" aria-hidden="true" tabindex="-1"></a><span class="fu">### Robustness: Multiple Risk Models (Daily)</span></span>
<span id="cb55-1591"><a href="#cb55-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1594"><a href="#cb55-1594" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1595"><a href="#cb55-1595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-robustness-daily</span></span>
<span id="cb55-1596"><a href="#cb55-1596" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Robustness of event study results across risk models ‚Äî Daily frequency"</span></span>
<span id="cb55-1597"><a href="#cb55-1597" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Run event study across all available daily models"</span></span>
<span id="cb55-1598"><a href="#cb55-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1599"><a href="#cb55-1599" aria-hidden="true" tabindex="-1"></a>models_daily <span class="op">=</span> [</span>
<span id="cb55-1600"><a href="#cb55-1600" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market-Adjusted"</span>,  RiskModel.MARKET_ADJ,    factors_ff3_daily),</span>
<span id="cb55-1601"><a href="#cb55-1601" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Market Model"</span>,     RiskModel.MARKET_MODEL,   factors_ff3_daily),</span>
<span id="cb55-1602"><a href="#cb55-1602" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 3"</span>,    RiskModel.FF3,            factors_ff3_daily),</span>
<span id="cb55-1603"><a href="#cb55-1603" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Fama-French 5"</span>,    RiskModel.FF5,            factors_ff5_daily),</span>
<span id="cb55-1604"><a href="#cb55-1604" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb55-1605"><a href="#cb55-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1606"><a href="#cb55-1606" aria-hidden="true" tabindex="-1"></a>robustness_daily <span class="op">=</span> []</span>
<span id="cb55-1607"><a href="#cb55-1607" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, mdl, facs <span class="kw">in</span> models_daily:</span>
<span id="cb55-1608"><a href="#cb55-1608" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1609"><a href="#cb55-1609" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=-</span><span class="dv">10</span>, event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-1610"><a href="#cb55-1610" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>mdl</span>
<span id="cb55-1611"><a href="#cb55-1611" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1612"><a href="#cb55-1612" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_demo, prices_daily, facs, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-1613"><a href="#cb55-1613" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb55-1614"><a href="#cb55-1614" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-1615"><a href="#cb55-1615" aria-hidden="true" tabindex="-1"></a>    robustness_daily.append({</span>
<span id="cb55-1616"><a href="#cb55-1616" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb55-1617"><a href="#cb55-1617" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb55-1618"><a href="#cb55-1618" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1619"><a href="#cb55-1619" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Median CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'median_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1620"><a href="#cb55-1620" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1621"><a href="#cb55-1621" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb55-1622"><a href="#cb55-1622" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb55-1623"><a href="#cb55-1623" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_CS'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb55-1624"><a href="#cb55-1624" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb55-1625"><a href="#cb55-1625" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb55-1626"><a href="#cb55-1626" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'t_KP'</span>, np.nan)<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb55-1627"><a href="#cb55-1627" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (KP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full<span class="sc">.</span>get(<span class="st">'p_KP'</span>, np.nan)<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb55-1628"><a href="#cb55-1628" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb55-1629"><a href="#cb55-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1630"><a href="#cb55-1630" aria-hidden="true" tabindex="-1"></a>rob_daily_df <span class="op">=</span> pd.DataFrame(robustness_daily)</span>
<span id="cb55-1631"><a href="#cb55-1631" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Robustness Across Risk Models (Daily Frequency)"</span>)</span>
<span id="cb55-1632"><a href="#cb55-1632" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb55-1633"><a href="#cb55-1633" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rob_daily_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1634"><a href="#cb55-1634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1635"><a href="#cb55-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1636"><a href="#cb55-1636" aria-hidden="true" tabindex="-1"></a><span class="fu">### Robustness: Multiple Event Windows</span></span>
<span id="cb55-1637"><a href="#cb55-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1638"><a href="#cb55-1638" aria-hidden="true" tabindex="-1"></a>A key practice is to examine sensitivity to the event window specification:</span>
<span id="cb55-1639"><a href="#cb55-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1642"><a href="#cb55-1642" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1643"><a href="#cb55-1643" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-robustness-windows</span></span>
<span id="cb55-1644"><a href="#cb55-1644" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Sensitivity of results to event window specification"</span></span>
<span id="cb55-1645"><a href="#cb55-1645" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Test across different event window widths"</span></span>
<span id="cb55-1646"><a href="#cb55-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1647"><a href="#cb55-1647" aria-hidden="true" tabindex="-1"></a>windows <span class="op">=</span> [</span>
<span id="cb55-1648"><a href="#cb55-1648" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-1, +1)"</span>,  <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb55-1649"><a href="#cb55-1649" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-3, +3)"</span>,  <span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb55-1650"><a href="#cb55-1650" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-5, +5)"</span>,  <span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb55-1651"><a href="#cb55-1651" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-10, +10)"</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb55-1652"><a href="#cb55-1652" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-1, +5)"</span>,  <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb55-1653"><a href="#cb55-1653" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(-5, +1)"</span>,  <span class="op">-</span><span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb55-1654"><a href="#cb55-1654" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"(0, 0)"</span>,     <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb55-1655"><a href="#cb55-1655" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb55-1656"><a href="#cb55-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1657"><a href="#cb55-1657" aria-hidden="true" tabindex="-1"></a>window_results <span class="op">=</span> []</span>
<span id="cb55-1658"><a href="#cb55-1658" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, ws, we <span class="kw">in</span> windows:</span>
<span id="cb55-1659"><a href="#cb55-1659" aria-hidden="true" tabindex="-1"></a>    cfg <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1660"><a href="#cb55-1660" aria-hidden="true" tabindex="-1"></a>        estimation_window<span class="op">=</span><span class="dv">150</span>, event_window_start<span class="op">=</span>ws, event_window_end<span class="op">=</span>we,</span>
<span id="cb55-1661"><a href="#cb55-1661" aria-hidden="true" tabindex="-1"></a>        gap<span class="op">=</span><span class="dv">15</span>, min_estimation_obs<span class="op">=</span><span class="dv">120</span>, risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-1662"><a href="#cb55-1662" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1663"><a href="#cb55-1663" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> run_event_study(events_demo, prices_daily, factors_ff3_daily, cfg, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-1664"><a href="#cb55-1664" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> res[<span class="st">'test_stats'</span>]</span>
<span id="cb55-1665"><a href="#cb55-1665" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> ts[ts[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-1666"><a href="#cb55-1666" aria-hidden="true" tabindex="-1"></a>    window_results.append({</span>
<span id="cb55-1667"><a href="#cb55-1667" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Window'</span>: label,</span>
<span id="cb55-1668"><a href="#cb55-1668" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Days'</span>: we <span class="op">-</span> ws <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb55-1669"><a href="#cb55-1669" aria-hidden="true" tabindex="-1"></a>        <span class="st">'N'</span>: <span class="bu">int</span>(full[<span class="st">'N'</span>]),</span>
<span id="cb55-1670"><a href="#cb55-1670" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean CAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1671"><a href="#cb55-1671" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean BHAR'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>,</span>
<span id="cb55-1672"><a href="#cb55-1672" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Positive'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb55-1673"><a href="#cb55-1673" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (CS)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb55-1674"><a href="#cb55-1674" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb55-1675"><a href="#cb55-1675" aria-hidden="true" tabindex="-1"></a>        <span class="st">'p (BMP)'</span>: <span class="ss">f"</span><span class="sc">{</span>full[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>,</span>
<span id="cb55-1676"><a href="#cb55-1676" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb55-1677"><a href="#cb55-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1678"><a href="#cb55-1678" aria-hidden="true" tabindex="-1"></a>win_df <span class="op">=</span> pd.DataFrame(window_results)</span>
<span id="cb55-1679"><a href="#cb55-1679" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sensitivity to Event Window Specification (FF3 Model)"</span>)</span>
<span id="cb55-1680"><a href="#cb55-1680" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb55-1681"><a href="#cb55-1681" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(win_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1682"><a href="#cb55-1682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1683"><a href="#cb55-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1684"><a href="#cb55-1684" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monthly Event Study: Fama-French 3-Factor Model</span></span>
<span id="cb55-1685"><a href="#cb55-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1686"><a href="#cb55-1686" aria-hidden="true" tabindex="-1"></a>For longer-horizon studies, monthly frequency is appropriate. Note that the estimation window is specified in months rather than days:</span>
<span id="cb55-1687"><a href="#cb55-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1690"><a href="#cb55-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1691"><a href="#cb55-1691" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-monthly-ff3</span></span>
<span id="cb55-1692"><a href="#cb55-1692" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Run monthly event study with FF3 model"</span></span>
<span id="cb55-1693"><a href="#cb55-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1694"><a href="#cb55-1694" aria-hidden="true" tabindex="-1"></a><span class="co"># Create monthly events aligned to the monthly data</span></span>
<span id="cb55-1695"><a href="#cb55-1695" aria-hidden="true" tabindex="-1"></a><span class="co"># Map daily event dates to the corresponding month-end</span></span>
<span id="cb55-1696"><a href="#cb55-1696" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_demo.copy()</span>
<span id="cb55-1697"><a href="#cb55-1697" aria-hidden="true" tabindex="-1"></a>events_monthly[<span class="st">'event_date'</span>] <span class="op">=</span> events_monthly[<span class="st">'event_date'</span>].dt.to_period(<span class="st">'M'</span>).dt.to_timestamp(<span class="st">'M'</span>)</span>
<span id="cb55-1698"><a href="#cb55-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1699"><a href="#cb55-1699" aria-hidden="true" tabindex="-1"></a><span class="co"># Use month-end dates from monthly prices</span></span>
<span id="cb55-1700"><a href="#cb55-1700" aria-hidden="true" tabindex="-1"></a>monthly_dates <span class="op">=</span> prices_monthly[<span class="st">'date'</span>].sort_values().unique()</span>
<span id="cb55-1701"><a href="#cb55-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1702"><a href="#cb55-1702" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter events to dates present in monthly data</span></span>
<span id="cb55-1703"><a href="#cb55-1703" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_monthly[events_monthly[<span class="st">'event_date'</span>].isin(monthly_dates)]</span>
<span id="cb55-1704"><a href="#cb55-1704" aria-hidden="true" tabindex="-1"></a>events_monthly <span class="op">=</span> events_monthly.drop_duplicates(subset<span class="op">=</span>[<span class="st">'symbol'</span>, <span class="st">'event_date'</span>])</span>
<span id="cb55-1705"><a href="#cb55-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1706"><a href="#cb55-1706" aria-hidden="true" tabindex="-1"></a>config_monthly <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1707"><a href="#cb55-1707" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">36</span>,     <span class="co"># 36 months</span></span>
<span id="cb55-1708"><a href="#cb55-1708" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">3</span>,    <span class="co"># 3 months before</span></span>
<span id="cb55-1709"><a href="#cb55-1709" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">3</span>,       <span class="co"># 3 months after</span></span>
<span id="cb55-1710"><a href="#cb55-1710" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">3</span>,                    <span class="co"># 3-month gap</span></span>
<span id="cb55-1711"><a href="#cb55-1711" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">24</span>,    <span class="co"># At least 24 months</span></span>
<span id="cb55-1712"><a href="#cb55-1712" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF3</span>
<span id="cb55-1713"><a href="#cb55-1713" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1714"><a href="#cb55-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1715"><a href="#cb55-1715" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(events_monthly) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb55-1716"><a href="#cb55-1716" aria-hidden="true" tabindex="-1"></a>    results_monthly <span class="op">=</span> run_event_study(</span>
<span id="cb55-1717"><a href="#cb55-1717" aria-hidden="true" tabindex="-1"></a>        events<span class="op">=</span>events_monthly,</span>
<span id="cb55-1718"><a href="#cb55-1718" aria-hidden="true" tabindex="-1"></a>        prices<span class="op">=</span>prices_monthly,</span>
<span id="cb55-1719"><a href="#cb55-1719" aria-hidden="true" tabindex="-1"></a>        factors<span class="op">=</span>factors_ff3_monthly,</span>
<span id="cb55-1720"><a href="#cb55-1720" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>config_monthly,</span>
<span id="cb55-1721"><a href="#cb55-1721" aria-hidden="true" tabindex="-1"></a>        group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb55-1722"><a href="#cb55-1722" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1723"><a href="#cb55-1723" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-1724"><a href="#cb55-1724" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Monthly Test Statistics ---"</span>)</span>
<span id="cb55-1725"><a href="#cb55-1725" aria-hidden="true" tabindex="-1"></a>    ts_m <span class="op">=</span> results_monthly[<span class="st">'test_stats'</span>]</span>
<span id="cb55-1726"><a href="#cb55-1726" aria-hidden="true" tabindex="-1"></a>    mcols <span class="op">=</span> [<span class="st">'group'</span>, <span class="st">'N'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'pct_positive'</span>,</span>
<span id="cb55-1727"><a href="#cb55-1727" aria-hidden="true" tabindex="-1"></a>             <span class="st">'t_CS'</span>, <span class="st">'p_CS'</span>, <span class="st">'t_BMP'</span>, <span class="st">'p_BMP'</span>]</span>
<span id="cb55-1728"><a href="#cb55-1728" aria-hidden="true" tabindex="-1"></a>    mavail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> mcols <span class="cf">if</span> c <span class="kw">in</span> ts_m.columns]</span>
<span id="cb55-1729"><a href="#cb55-1729" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ts_m[mavail].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1730"><a href="#cb55-1730" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb55-1731"><a href="#cb55-1731" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No monthly events could be aligned. Skipping monthly study."</span>)</span>
<span id="cb55-1732"><a href="#cb55-1732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1733"><a href="#cb55-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1736"><a href="#cb55-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1737"><a href="#cb55-1737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-monthly-car</span></span>
<span id="cb55-1738"><a href="#cb55-1738" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Monthly cumulative abnormal returns around event dates. Wider windows capture slower information incorporation typical of emerging markets."</span></span>
<span id="cb55-1739"><a href="#cb55-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1740"><a href="#cb55-1740" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(events_monthly) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="st">'daily_stats'</span> <span class="kw">in</span> results_monthly:</span>
<span id="cb55-1741"><a href="#cb55-1741" aria-hidden="true" tabindex="-1"></a>    fig3 <span class="op">=</span> plot_event_study(</span>
<span id="cb55-1742"><a href="#cb55-1742" aria-hidden="true" tabindex="-1"></a>        results_monthly[<span class="st">'daily_stats'</span>],</span>
<span id="cb55-1743"><a href="#cb55-1743" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Event Study: FF3 Model ‚Äî Vietnamese Market (Monthly)"</span></span>
<span id="cb55-1744"><a href="#cb55-1744" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1745"><a href="#cb55-1745" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb55-1746"><a href="#cb55-1746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1747"><a href="#cb55-1747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1748"><a href="#cb55-1748" aria-hidden="true" tabindex="-1"></a><span class="fu">### Daily Event Study: Fama-French 5-Factor Model</span></span>
<span id="cb55-1749"><a href="#cb55-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1752"><a href="#cb55-1752" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1753"><a href="#cb55-1753" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-daily-ff5</span></span>
<span id="cb55-1754"><a href="#cb55-1754" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Run daily event study with FF5 model"</span></span>
<span id="cb55-1755"><a href="#cb55-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1756"><a href="#cb55-1756" aria-hidden="true" tabindex="-1"></a>config_ff5 <span class="op">=</span> EventStudyConfig(</span>
<span id="cb55-1757"><a href="#cb55-1757" aria-hidden="true" tabindex="-1"></a>    estimation_window<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb55-1758"><a href="#cb55-1758" aria-hidden="true" tabindex="-1"></a>    event_window_start<span class="op">=-</span><span class="dv">10</span>,</span>
<span id="cb55-1759"><a href="#cb55-1759" aria-hidden="true" tabindex="-1"></a>    event_window_end<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb55-1760"><a href="#cb55-1760" aria-hidden="true" tabindex="-1"></a>    gap<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb55-1761"><a href="#cb55-1761" aria-hidden="true" tabindex="-1"></a>    min_estimation_obs<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb55-1762"><a href="#cb55-1762" aria-hidden="true" tabindex="-1"></a>    risk_model<span class="op">=</span>RiskModel.FF5</span>
<span id="cb55-1763"><a href="#cb55-1763" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1764"><a href="#cb55-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1765"><a href="#cb55-1765" aria-hidden="true" tabindex="-1"></a>results_ff5 <span class="op">=</span> run_event_study(</span>
<span id="cb55-1766"><a href="#cb55-1766" aria-hidden="true" tabindex="-1"></a>    events<span class="op">=</span>events_demo,</span>
<span id="cb55-1767"><a href="#cb55-1767" aria-hidden="true" tabindex="-1"></a>    prices<span class="op">=</span>prices_daily,</span>
<span id="cb55-1768"><a href="#cb55-1768" aria-hidden="true" tabindex="-1"></a>    factors<span class="op">=</span>factors_ff5_daily,</span>
<span id="cb55-1769"><a href="#cb55-1769" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config_ff5,</span>
<span id="cb55-1770"><a href="#cb55-1770" aria-hidden="true" tabindex="-1"></a>    group_col<span class="op">=</span><span class="st">'group'</span></span>
<span id="cb55-1771"><a href="#cb55-1771" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1772"><a href="#cb55-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1773"><a href="#cb55-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1774"><a href="#cb55-1774" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing FF3 vs FF5 Estimation Quality</span></span>
<span id="cb55-1775"><a href="#cb55-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1778"><a href="#cb55-1778" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1779"><a href="#cb55-1779" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-model-comparison</span></span>
<span id="cb55-1780"><a href="#cb55-1780" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Comparison of estimation quality between FF3 and FF5 models"</span></span>
<span id="cb55-1781"><a href="#cb55-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1782"><a href="#cb55-1782" aria-hidden="true" tabindex="-1"></a>params_ff3 <span class="op">=</span> results_ff3[<span class="st">'params'</span>]</span>
<span id="cb55-1783"><a href="#cb55-1783" aria-hidden="true" tabindex="-1"></a>params_ff5 <span class="op">=</span> results_ff5[<span class="st">'params'</span>]</span>
<span id="cb55-1784"><a href="#cb55-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1785"><a href="#cb55-1785" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model Estimation Diagnostics"</span>)</span>
<span id="cb55-1786"><a href="#cb55-1786" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb55-1787"><a href="#cb55-1787" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'Metric'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'FF3'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'FF5'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb55-1788"><a href="#cb55-1788" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">54</span>)</span>
<span id="cb55-1789"><a href="#cb55-1789" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Firm-events estimated'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(params_ff3)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(params_ff5)<span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb55-1790"><a href="#cb55-1790" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean R^2'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'r_squared'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1791"><a href="#cb55-1791" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Median R^2'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'r_squared'</span>]<span class="sc">.</span>median()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'r_squared'</span>]<span class="sc">.</span>median()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1792"><a href="#cb55-1792" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean œÉ(Œµ)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'sigma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'sigma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss">"</span>)</span>
<span id="cb55-1793"><a href="#cb55-1793" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean |Œ±|'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'alpha'</span>]<span class="sc">.</span><span class="bu">abs</span>()<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'alpha'</span>]<span class="sc">.</span><span class="bu">abs</span>()<span class="sc">.</span>mean()<span class="sc">:&gt;12.6f}</span><span class="ss">"</span>)</span>
<span id="cb55-1794"><a href="#cb55-1794" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(MKT)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_mkt_excess'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_mkt_excess'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1795"><a href="#cb55-1795" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_smb'</span> <span class="kw">in</span> params_ff3.columns:</span>
<span id="cb55-1796"><a href="#cb55-1796" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(SMB)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_smb'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_smb'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1797"><a href="#cb55-1797" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_hml'</span> <span class="kw">in</span> params_ff3.columns:</span>
<span id="cb55-1798"><a href="#cb55-1798" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(HML)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>params_ff3[<span class="st">'beta_hml'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_hml'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1799"><a href="#cb55-1799" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_rmw'</span> <span class="kw">in</span> params_ff5.columns:</span>
<span id="cb55-1800"><a href="#cb55-1800" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(RMW)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'‚Äî'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_rmw'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1801"><a href="#cb55-1801" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'beta_cma'</span> <span class="kw">in</span> params_ff5.columns:</span>
<span id="cb55-1802"><a href="#cb55-1802" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Mean Œ≤(CMA)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'‚Äî'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>params_ff5[<span class="st">'beta_cma'</span>]<span class="sc">.</span>mean()<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb55-1803"><a href="#cb55-1803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1804"><a href="#cb55-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1805"><a href="#cb55-1805" aria-hidden="true" tabindex="-1"></a><span class="fu">### Event-Level Detail</span></span>
<span id="cb55-1806"><a href="#cb55-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1809"><a href="#cb55-1809" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1810"><a href="#cb55-1810" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-event-detail</span></span>
<span id="cb55-1811"><a href="#cb55-1811" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Event-level detail: CARs and BHARs for each firm-event (FF3 model)"</span></span>
<span id="cb55-1812"><a href="#cb55-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1813"><a href="#cb55-1813" aria-hidden="true" tabindex="-1"></a>detail <span class="op">=</span> results_ff3[<span class="st">'event_ar'</span>].copy()</span>
<span id="cb55-1814"><a href="#cb55-1814" aria-hidden="true" tabindex="-1"></a>detail_cols <span class="op">=</span> [<span class="st">'symbol'</span>, <span class="st">'evtdate'</span>, <span class="st">'CAR'</span>, <span class="st">'BHAR'</span>, <span class="st">'SCAR'</span>, <span class="st">'sigma'</span>,</span>
<span id="cb55-1815"><a href="#cb55-1815" aria-hidden="true" tabindex="-1"></a>               <span class="st">'nobs'</span>, <span class="st">'alpha'</span>, <span class="st">'beta_mkt_excess'</span>]</span>
<span id="cb55-1816"><a href="#cb55-1816" aria-hidden="true" tabindex="-1"></a>detail_avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> detail_cols <span class="cf">if</span> c <span class="kw">in</span> detail.columns]</span>
<span id="cb55-1817"><a href="#cb55-1817" aria-hidden="true" tabindex="-1"></a>detail_show <span class="op">=</span> detail[detail_avail].copy()</span>
<span id="cb55-1818"><a href="#cb55-1818" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'CAR'</span>] <span class="op">=</span> detail_show[<span class="st">'CAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb55-1819"><a href="#cb55-1819" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'BHAR'</span>] <span class="op">=</span> detail_show[<span class="st">'BHAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb55-1820"><a href="#cb55-1820" aria-hidden="true" tabindex="-1"></a>detail_show[<span class="st">'SCAR'</span>] <span class="op">=</span> detail_show[<span class="st">'SCAR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb55-1821"><a href="#cb55-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1822"><a href="#cb55-1822" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Event-Level Results (first 20 firm-events)"</span>)</span>
<span id="cb55-1823"><a href="#cb55-1823" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb55-1824"><a href="#cb55-1824" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(detail_show.head(<span class="dv">20</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1825"><a href="#cb55-1825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1826"><a href="#cb55-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1827"><a href="#cb55-1827" aria-hidden="true" tabindex="-1"></a><span class="fu">### Daily Abnormal Return Dynamics</span></span>
<span id="cb55-1828"><a href="#cb55-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1831"><a href="#cb55-1831" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1832"><a href="#cb55-1832" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-daily-dynamics</span></span>
<span id="cb55-1833"><a href="#cb55-1833" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Daily dynamics of mean abnormal returns and test statistics within the event window"</span></span>
<span id="cb55-1834"><a href="#cb55-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1835"><a href="#cb55-1835" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> results_ff3[<span class="st">'daily_stats'</span>].copy()</span>
<span id="cb55-1836"><a href="#cb55-1836" aria-hidden="true" tabindex="-1"></a>ds_cols <span class="op">=</span> [<span class="st">'evttime'</span>, <span class="st">'N'</span>, <span class="st">'mean_AR'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>, <span class="st">'t_AR_CS'</span>, <span class="st">'t_AR_BMP'</span>]</span>
<span id="cb55-1837"><a href="#cb55-1837" aria-hidden="true" tabindex="-1"></a>ds_avail <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> ds_cols <span class="cf">if</span> c <span class="kw">in</span> ds.columns]</span>
<span id="cb55-1838"><a href="#cb55-1838" aria-hidden="true" tabindex="-1"></a>ds_show <span class="op">=</span> ds[ds_avail].copy()</span>
<span id="cb55-1839"><a href="#cb55-1839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1840"><a href="#cb55-1840" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'mean_AR'</span>, <span class="st">'mean_CAR'</span>, <span class="st">'mean_BHAR'</span>]:</span>
<span id="cb55-1841"><a href="#cb55-1841" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> ds_show.columns:</span>
<span id="cb55-1842"><a href="#cb55-1842" aria-hidden="true" tabindex="-1"></a>        ds_show[c] <span class="op">=</span> ds_show[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">'</span>)</span>
<span id="cb55-1843"><a href="#cb55-1843" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'t_AR_CS'</span>, <span class="st">'t_AR_BMP'</span>]:</span>
<span id="cb55-1844"><a href="#cb55-1844" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> ds_show.columns:</span>
<span id="cb55-1845"><a href="#cb55-1845" aria-hidden="true" tabindex="-1"></a>        ds_show[c] <span class="op">=</span> ds_show[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb55-1846"><a href="#cb55-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1847"><a href="#cb55-1847" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Daily Event-Window Dynamics (FF3 Model)"</span>)</span>
<span id="cb55-1848"><a href="#cb55-1848" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb55-1849"><a href="#cb55-1849" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds_show.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb55-1850"><a href="#cb55-1850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1851"><a href="#cb55-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1852"><a href="#cb55-1852" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary of Key Findings</span></span>
<span id="cb55-1853"><a href="#cb55-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1856"><a href="#cb55-1856" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb55-1857"><a href="#cb55-1857" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary</span></span>
<span id="cb55-1858"><a href="#cb55-1858" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize key findings"</span></span>
<span id="cb55-1859"><a href="#cb55-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1860"><a href="#cb55-1860" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb55-1861"><a href="#cb55-1861" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EVENT STUDY RESULTS SUMMARY"</span>)</span>
<span id="cb55-1862"><a href="#cb55-1862" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb55-1863"><a href="#cb55-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1864"><a href="#cb55-1864" aria-hidden="true" tabindex="-1"></a>ff3_all <span class="op">=</span> results_ff3[<span class="st">'test_stats'</span>][results_ff3[<span class="st">'test_stats'</span>][<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'All'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb55-1865"><a href="#cb55-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1866"><a href="#cb55-1866" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample: </span><span class="sc">{</span><span class="bu">int</span>(ff3_all[<span class="st">'N'</span>])<span class="sc">}</span><span class="ss"> firm-event observations"</span>)</span>
<span id="cb55-1867"><a href="#cb55-1867" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Frequency: Daily"</span>)</span>
<span id="cb55-1868"><a href="#cb55-1868" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Primary Model: Fama-French 3-Factor"</span>)</span>
<span id="cb55-1869"><a href="#cb55-1869" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimation Window: </span><span class="sc">{</span>config_ff3<span class="sc">.</span>estimation_window<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb55-1870"><a href="#cb55-1870" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event Window: (</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb55-1871"><a href="#cb55-1871" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Gap: </span><span class="sc">{</span>config_ff3<span class="sc">.</span>gap<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb55-1872"><a href="#cb55-1872" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Abnormal Return Measures ---"</span>)</span>
<span id="cb55-1873"><a href="#cb55-1873" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean CAR(</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_start<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>config_ff3<span class="sc">.</span>event_window_end<span class="sc">}</span><span class="ss">): "</span></span>
<span id="cb55-1874"><a href="#cb55-1874" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>ff3_all[<span class="st">'mean_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb55-1875"><a href="#cb55-1875" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median CAR: </span><span class="sc">{</span>ff3_all[<span class="st">'median_CAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb55-1876"><a href="#cb55-1876" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean BHAR: </span><span class="sc">{</span>ff3_all[<span class="st">'mean_BHAR'</span>]<span class="sc">:.4%}</span><span class="ss">"</span>)</span>
<span id="cb55-1877"><a href="#cb55-1877" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fraction positive CARs: </span><span class="sc">{</span>ff3_all[<span class="st">'pct_positive'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb55-1878"><a href="#cb55-1878" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Statistical Significance ---"</span>)</span>
<span id="cb55-1879"><a href="#cb55-1879" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cross-Sectional t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_CS'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_CS'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb55-1880"><a href="#cb55-1880" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Patell Z: </span><span class="sc">{</span>ff3_all[<span class="st">'Z_Patell'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_Patell'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb55-1881"><a href="#cb55-1881" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"BMP t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_BMP'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_BMP'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb55-1882"><a href="#cb55-1882" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kolari-Pynn√∂nen t: </span><span class="sc">{</span>ff3_all[<span class="st">'t_KP'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_KP'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb55-1883"><a href="#cb55-1883" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Generalized Sign Z: </span><span class="sc">{</span>ff3_all[<span class="st">'Z_GSign'</span>]<span class="sc">:.3f}</span><span class="ss"> (p = </span><span class="sc">{</span>ff3_all[<span class="st">'p_GSign'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb55-1884"><a href="#cb55-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1885"><a href="#cb55-1885" aria-hidden="true" tabindex="-1"></a>sig_005 <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'p_CS'</span>,<span class="st">'p_Patell'</span>,<span class="st">'p_BMP'</span>,<span class="st">'p_KP'</span>,<span class="st">'p_GSign'</span>,<span class="st">'p_SkAdj'</span>,<span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb55-1886"><a href="#cb55-1886" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> k <span class="kw">in</span> ff3_all <span class="kw">and</span> pd.notna(ff3_all[k]) <span class="kw">and</span> ff3_all[k] <span class="op">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb55-1887"><a href="#cb55-1887" aria-hidden="true" tabindex="-1"></a>total_tests <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'p_CS'</span>,<span class="st">'p_Patell'</span>,<span class="st">'p_BMP'</span>,<span class="st">'p_KP'</span>,<span class="st">'p_GSign'</span>,<span class="st">'p_SkAdj'</span>,<span class="st">'p_Wilcoxon'</span>]</span>
<span id="cb55-1888"><a href="#cb55-1888" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> k <span class="kw">in</span> ff3_all <span class="kw">and</span> pd.notna(ff3_all[k]))</span>
<span id="cb55-1889"><a href="#cb55-1889" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>sig_005<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total_tests<span class="sc">}</span><span class="ss"> tests significant at 5% level"</span>)</span>
<span id="cb55-1890"><a href="#cb55-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1891"><a href="#cb55-1891" aria-hidden="true" tabindex="-1"></a><span class="co"># Robustness note</span></span>
<span id="cb55-1892"><a href="#cb55-1892" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Robustness: Results checked across </span><span class="sc">{</span><span class="bu">len</span>(models_daily)<span class="sc">}</span><span class="ss"> risk models "</span></span>
<span id="cb55-1893"><a href="#cb55-1893" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"and </span><span class="sc">{</span><span class="bu">len</span>(windows)<span class="sc">}</span><span class="ss"> event windows"</span>)</span>
<span id="cb55-1894"><a href="#cb55-1894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1895"><a href="#cb55-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1896"><a href="#cb55-1896" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Recommendations</span></span>
<span id="cb55-1897"><a href="#cb55-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1898"><a href="#cb55-1898" aria-hidden="true" tabindex="-1"></a>Based on the literature and our implementation experience:</span>
<span id="cb55-1899"><a href="#cb55-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1900"><a href="#cb55-1900" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Estimation window**: Use 150 trading days (\~7 months) for daily studies. This balances parameter precision against structural breaks. For monthly studies, 60 months is standard <span class="co">[</span><span class="ot">@kothari2007econometrics</span><span class="co">]</span>.</span>
<span id="cb55-1901"><a href="#cb55-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1902"><a href="#cb55-1902" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Gap**: 15 trading days is standard. Increase to 30 if information leakage is a concern.</span>
<span id="cb55-1903"><a href="#cb55-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1904"><a href="#cb55-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Event window**: Start with (-1, +1) for short-window tests, then expand to (-5, +5) and (-10, +10) for robustness. Report all windows.</span>
<span id="cb55-1905"><a href="#cb55-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1906"><a href="#cb55-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Model choice**: Always report market model as the baseline. Add FF3 or FF5 for robustness. For Vietnam, local factors are preferable to global factors.</span>
<span id="cb55-1907"><a href="#cb55-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1908"><a href="#cb55-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Test statistics**: Report at minimum: cross-sectional t (for ease of interpretation), BMP (robust to event-induced variance), and one non-parametric test (sign or Wilcoxon). Report Kolari-Pynn√∂nen if events cluster in calendar time.</span>
<span id="cb55-1909"><a href="#cb55-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1910"><a href="#cb55-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Thin trading**: For Vietnamese small-caps, consider @dimson1979risk with 1 lead/lag or increase <span class="in">`min_estimation_obs`</span> to filter out illiquid stocks.</span>
<span id="cb55-1911"><a href="#cb55-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1912"><a href="#cb55-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Multiple testing**: If testing multiple event windows or subgroups, apply Bonferroni or Holm corrections to control family-wise error rate.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/60_event_studies.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>