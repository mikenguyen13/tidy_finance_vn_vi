<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Firm Valuation, Financial Distress, and Company Maturity – Applying Tidy Finance with Python to Vietnam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_discounted_cash_flow.html" rel="next">
<link href="./25_pe_ratio.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d8431037eefe704a1e7a103aa5b75ea7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="15&nbsp; Firm Valuation, Financial Distress, and Company Maturity – Applying Tidy Finance with Python to Vietnam">
<meta property="og:description" content="">
<meta property="og:image" content="https://github.com/mikenguyen13/tidy_finance_vn/26_valuation_files/figure-html/fig-tobinq-distribution-output-1.png">
<meta property="og:site_name" content="Applying Tidy Finance with Python to Vietnam">
<meta property="og:image:height" content="1455">
<meta property="og:image:width" content="4152">
<meta name="twitter:title" content="15&nbsp; Firm Valuation, Financial Distress, and Company Maturity – Applying Tidy Finance with Python to Vietnam">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://github.com/mikenguyen13/tidy_finance_vn/26_valuation_files/figure-html/fig-tobinq-distribution-output-1.png">
<meta name="twitter:image-height" content="1455">
<meta name="twitter:image-width" content="4152">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_financial_statement_analysis.html">Firm Fundamentals, Valuation, and Corporate Signals</a></li><li class="breadcrumb-item"><a href="./26_valuation.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applying Tidy Finance with Python to Vietnam</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Vietnam Financial Markets, Institutions, and Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Institutional Background and Market Structure of Vietnam’s Equity Market</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Accessing and Managing VN Financial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datacore Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_compound_return.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Compound Returns</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Portfolio Construction, Risk, and Empirical Mechanics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Asset Pricing Models and Cross-Sectional Tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_momentum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Firm Fundamentals, Valuation, and Corporate Signals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_valuation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_divop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Ownership, Market Frictions, and International Exposure</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_institutional_trade_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Institutional Trades, Flows, and Turnover Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_return_gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Return Gap: Measuring Unobserved Actions of Fund Managers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_event_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Data, Research Design, and Frontiers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link active" data-scroll-target="#required-packages"><span class="header-section-number">15.1</span> Required Packages</a></li>
  <li><a href="#sec-theory" id="toc-sec-theory" class="nav-link" data-scroll-target="#sec-theory"><span class="header-section-number">16</span> Theoretical Foundations</a>
  <ul class="collapse">
  <li><a href="#sec-tobinq-theory" id="toc-sec-tobinq-theory" class="nav-link" data-scroll-target="#sec-tobinq-theory"><span class="header-section-number">16.1</span> Tobin’s Q: Market Valuation of the Firm</a>
  <ul class="collapse">
  <li><a href="#the-original-concept" id="toc-the-original-concept" class="nav-link" data-scroll-target="#the-original-concept"><span class="header-section-number">16.1.1</span> The Original Concept</a></li>
  <li><a href="#market-value-decomposition" id="toc-market-value-decomposition" class="nav-link" data-scroll-target="#market-value-decomposition"><span class="header-section-number">16.1.2</span> Market Value Decomposition</a></li>
  <li><a href="#replacement-cost-of-assets" id="toc-replacement-cost-of-assets" class="nav-link" data-scroll-target="#replacement-cost-of-assets"><span class="header-section-number">16.1.3</span> Replacement Cost of Assets</a></li>
  <li><a href="#simplified-tobins-q" id="toc-simplified-tobins-q" class="nav-link" data-scroll-target="#simplified-tobins-q"><span class="header-section-number">16.1.4</span> Simplified Tobin’s Q</a></li>
  <li><a href="#chung-and-pruitt-approximation" id="toc-chung-and-pruitt-approximation" class="nav-link" data-scroll-target="#chung-and-pruitt-approximation"><span class="header-section-number">16.1.5</span> Chung and Pruitt Approximation</a></li>
  </ul></li>
  <li><a href="#sec-zscore-theory" id="toc-sec-zscore-theory" class="nav-link" data-scroll-target="#sec-zscore-theory"><span class="header-section-number">16.2</span> Altman Z-Score: Predicting Financial Distress</a>
  <ul class="collapse">
  <li><a href="#the-original-model" id="toc-the-original-model" class="nav-link" data-scroll-target="#the-original-model"><span class="header-section-number">16.2.1</span> The Original Model</a></li>
  <li><a href="#the-z-score-model-for-private-firms" id="toc-the-z-score-model-for-private-firms" class="nav-link" data-scroll-target="#the-z-score-model-for-private-firms"><span class="header-section-number">16.2.2</span> The Z’-Score Model for Private Firms</a></li>
  <li><a href="#the-z-score-model-for-emerging-markets" id="toc-the-z-score-model-for-emerging-markets" class="nav-link" data-scroll-target="#the-z-score-model-for-emerging-markets"><span class="header-section-number">16.2.3</span> The Z’’-Score Model for Emerging Markets</a></li>
  </ul></li>
  <li><a href="#sec-age-theory" id="toc-sec-age-theory" class="nav-link" data-scroll-target="#sec-age-theory"><span class="header-section-number">16.3</span> Company Age: Measuring Corporate Maturity</a></li>
  </ul></li>
  <li><a href="#sec-vietnam-context" id="toc-sec-vietnam-context" class="nav-link" data-scroll-target="#sec-vietnam-context"><span class="header-section-number">17</span> The Vietnamese Market Context</a>
  <ul class="collapse">
  <li><a href="#institutional-features-affecting-valuation-measures" id="toc-institutional-features-affecting-valuation-measures" class="nav-link" data-scroll-target="#institutional-features-affecting-valuation-measures"><span class="header-section-number">17.1</span> Institutional Features Affecting Valuation Measures</a>
  <ul class="collapse">
  <li><a href="#state-ownership-and-equitization" id="toc-state-ownership-and-equitization" class="nav-link" data-scroll-target="#state-ownership-and-equitization"><span class="header-section-number">17.1.1</span> State Ownership and Equitization</a></li>
  <li><a href="#foreign-ownership-limits" id="toc-foreign-ownership-limits" class="nav-link" data-scroll-target="#foreign-ownership-limits"><span class="header-section-number">17.1.2</span> Foreign Ownership Limits</a></li>
  <li><a href="#accounting-standards" id="toc-accounting-standards" class="nav-link" data-scroll-target="#accounting-standards"><span class="header-section-number">17.1.3</span> Accounting Standards</a></li>
  <li><a href="#market-microstructure" id="toc-market-microstructure" class="nav-link" data-scroll-target="#market-microstructure"><span class="header-section-number">17.1.4</span> Market Microstructure</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-data-prep" id="toc-sec-data-prep" class="nav-link" data-scroll-target="#sec-data-prep"><span class="header-section-number">18</span> Data Preparation</a>
  <ul class="collapse">
  <li><a href="#loading-and-cleaning-financial-statement-data" id="toc-loading-and-cleaning-financial-statement-data" class="nav-link" data-scroll-target="#loading-and-cleaning-financial-statement-data"><span class="header-section-number">18.1</span> Loading and Cleaning Financial Statement Data</a></li>
  <li><a href="#variable-definitions-and-mapping" id="toc-variable-definitions-and-mapping" class="nav-link" data-scroll-target="#variable-definitions-and-mapping"><span class="header-section-number">18.2</span> Variable Definitions and Mapping</a></li>
  <li><a href="#data-quality-checks" id="toc-data-quality-checks" class="nav-link" data-scroll-target="#data-quality-checks"><span class="header-section-number">18.3</span> Data Quality Checks</a></li>
  </ul></li>
  <li><a href="#sec-tobinq-computation" id="toc-sec-tobinq-computation" class="nav-link" data-scroll-target="#sec-tobinq-computation"><span class="header-section-number">19</span> Computing Tobin’s Q</a>
  <ul class="collapse">
  <li><a href="#book-value-of-equity" id="toc-book-value-of-equity" class="nav-link" data-scroll-target="#book-value-of-equity"><span class="header-section-number">19.1</span> Book Value of Equity</a></li>
  <li><a href="#market-value-of-equity" id="toc-market-value-of-equity" class="nav-link" data-scroll-target="#market-value-of-equity"><span class="header-section-number">19.2</span> Market Value of Equity</a></li>
  <li><a href="#simplified-tobins-q-1" id="toc-simplified-tobins-q-1" class="nav-link" data-scroll-target="#simplified-tobins-q-1"><span class="header-section-number">19.3</span> Simplified Tobin’s Q</a></li>
  <li><a href="#winsorizing-extreme-values" id="toc-winsorizing-extreme-values" class="nav-link" data-scroll-target="#winsorizing-extreme-values"><span class="header-section-number">19.4</span> Winsorizing Extreme Values</a></li>
  <li><a href="#cross-sectional-distribution-of-tobins-q" id="toc-cross-sectional-distribution-of-tobins-q" class="nav-link" data-scroll-target="#cross-sectional-distribution-of-tobins-q"><span class="header-section-number">19.5</span> Cross-Sectional Distribution of Tobin’s Q</a></li>
  <li><a href="#time-series-evolution-of-tobins-q" id="toc-time-series-evolution-of-tobins-q" class="nav-link" data-scroll-target="#time-series-evolution-of-tobins-q"><span class="header-section-number">19.6</span> Time-Series Evolution of Tobin’s Q</a></li>
  <li><a href="#tobins-q-by-industry" id="toc-tobins-q-by-industry" class="nav-link" data-scroll-target="#tobins-q-by-industry"><span class="header-section-number">19.7</span> Tobin’s Q by Industry</a></li>
  </ul></li>
  <li><a href="#sec-zscore-computation" id="toc-sec-zscore-computation" class="nav-link" data-scroll-target="#sec-zscore-computation"><span class="header-section-number">20</span> Computing the Altman Z-Score</a>
  <ul class="collapse">
  <li><a href="#original-z-score-for-listed-firms" id="toc-original-z-score-for-listed-firms" class="nav-link" data-scroll-target="#original-z-score-for-listed-firms"><span class="header-section-number">20.1</span> Original Z-Score for Listed Firms</a></li>
  <li><a href="#z-score-component-analysis" id="toc-z-score-component-analysis" class="nav-link" data-scroll-target="#z-score-component-analysis"><span class="header-section-number">20.2</span> Z-Score Component Analysis</a></li>
  <li><a href="#distribution-of-risk-zones" id="toc-distribution-of-risk-zones" class="nav-link" data-scroll-target="#distribution-of-risk-zones"><span class="header-section-number">20.3</span> Distribution of Risk Zones</a></li>
  <li><a href="#comparing-z-score-variants" id="toc-comparing-z-score-variants" class="nav-link" data-scroll-target="#comparing-z-score-variants"><span class="header-section-number">20.4</span> Comparing Z-Score Variants</a></li>
  </ul></li>
  <li><a href="#sec-age-computation" id="toc-sec-age-computation" class="nav-link" data-scroll-target="#sec-age-computation"><span class="header-section-number">21</span> Computing Company Age</a>
  <ul class="collapse">
  <li><a href="#multiple-age-proxies" id="toc-multiple-age-proxies" class="nav-link" data-scroll-target="#multiple-age-proxies"><span class="header-section-number">21.1</span> Multiple Age Proxies</a></li>
  <li><a href="#age-distribution" id="toc-age-distribution" class="nav-link" data-scroll-target="#age-distribution"><span class="header-section-number">21.2</span> Age Distribution</a></li>
  <li><a href="#age-and-the-equitization-effect" id="toc-age-and-the-equitization-effect" class="nav-link" data-scroll-target="#age-and-the-equitization-effect"><span class="header-section-number">21.3</span> Age and the Equitization Effect</a></li>
  </ul></li>
  <li><a href="#sec-joint-analysis" id="toc-sec-joint-analysis" class="nav-link" data-scroll-target="#sec-joint-analysis"><span class="header-section-number">22</span> Joint Analysis: Valuation, Distress, and Maturity</a>
  <ul class="collapse">
  <li><a href="#the-relationship-between-q-z-score-and-age" id="toc-the-relationship-between-q-z-score-and-age" class="nav-link" data-scroll-target="#the-relationship-between-q-z-score-and-age"><span class="header-section-number">22.1</span> The Relationship Between Q, Z-Score, and Age</a></li>
  <li><a href="#correlation-structure" id="toc-correlation-structure" class="nav-link" data-scroll-target="#correlation-structure"><span class="header-section-number">22.2</span> Correlation Structure</a></li>
  <li><a href="#cross-sectional-regression-analysis" id="toc-cross-sectional-regression-analysis" class="nav-link" data-scroll-target="#cross-sectional-regression-analysis"><span class="header-section-number">22.3</span> Cross-Sectional Regression Analysis</a></li>
  </ul></li>
  <li><a href="#sec-pipeline" id="toc-sec-pipeline" class="nav-link" data-scroll-target="#sec-pipeline"><span class="header-section-number">23</span> The Complete Pipeline</a>
  <ul class="collapse">
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">23.1</span> Putting It All Together</a></li>
  <li><a href="#exporting-results" id="toc-exporting-results" class="nav-link" data-scroll-target="#exporting-results"><span class="header-section-number">23.2</span> Exporting Results</a></li>
  </ul></li>
  <li><a href="#sec-special-topics" id="toc-sec-special-topics" class="nav-link" data-scroll-target="#sec-special-topics"><span class="header-section-number">24</span> Special Topics for the Vietnamese Market</a>
  <ul class="collapse">
  <li><a href="#state-ownership-and-valuation" id="toc-state-ownership-and-valuation" class="nav-link" data-scroll-target="#state-ownership-and-valuation"><span class="header-section-number">24.1</span> State Ownership and Valuation</a></li>
  <li><a href="#exchange-level-analysis" id="toc-exchange-level-analysis" class="nav-link" data-scroll-target="#exchange-level-analysis"><span class="header-section-number">24.2</span> Exchange-Level Analysis</a></li>
  <li><a href="#sector-heatmap-valuation-and-distress" id="toc-sector-heatmap-valuation-and-distress" class="nav-link" data-scroll-target="#sector-heatmap-valuation-and-distress"><span class="header-section-number">24.3</span> Sector Heatmap: Valuation and Distress</a></li>
  <li><a href="#handling-delisted-firms-survivorship-bias" id="toc-handling-delisted-firms-survivorship-bias" class="nav-link" data-scroll-target="#handling-delisted-firms-survivorship-bias"><span class="header-section-number">24.4</span> Handling Delisted Firms: Survivorship Bias</a></li>
  </ul></li>
  <li><a href="#sec-robustness" id="toc-sec-robustness" class="nav-link" data-scroll-target="#sec-robustness"><span class="header-section-number">25</span> Robustness Checks and Extensions</a>
  <ul class="collapse">
  <li><a href="#alternative-tobins-q-specifications" id="toc-alternative-tobins-q-specifications" class="nav-link" data-scroll-target="#alternative-tobins-q-specifications"><span class="header-section-number">25.1</span> Alternative Tobin’s Q Specifications</a></li>
  <li><a href="#industry-adjusted-measures" id="toc-industry-adjusted-measures" class="nav-link" data-scroll-target="#industry-adjusted-measures"><span class="header-section-number">25.2</span> Industry-Adjusted Measures</a></li>
  <li><a href="#panel-regression-with-fixed-effects" id="toc-panel-regression-with-fixed-effects" class="nav-link" data-scroll-target="#panel-regression-with-fixed-effects"><span class="header-section-number">25.3</span> Panel Regression with Fixed Effects</a></li>
  </ul></li>
  <li><a href="#sec-limitations" id="toc-sec-limitations" class="nav-link" data-scroll-target="#sec-limitations"><span class="header-section-number">26</span> Practical Considerations and Limitations</a>
  <ul class="collapse">
  <li><a href="#known-limitations-of-tobins-q-in-vietnam" id="toc-known-limitations-of-tobins-q-in-vietnam" class="nav-link" data-scroll-target="#known-limitations-of-tobins-q-in-vietnam"><span class="header-section-number">26.1</span> Known Limitations of Tobin’s Q in Vietnam</a></li>
  <li><a href="#known-limitations-of-altman-z-score-in-vietnam" id="toc-known-limitations-of-altman-z-score-in-vietnam" class="nav-link" data-scroll-target="#known-limitations-of-altman-z-score-in-vietnam"><span class="header-section-number">26.2</span> Known Limitations of Altman Z-Score in Vietnam</a></li>
  <li><a href="#recommendations-for-researchers" id="toc-recommendations-for-researchers" class="nav-link" data-scroll-target="#recommendations-for-researchers"><span class="header-section-number">26.3</span> Recommendations for Researchers</a></li>
  </ul></li>
  <li><a href="#sec-summary" id="toc-sec-summary" class="nav-link" data-scroll-target="#sec-summary"><span class="header-section-number">27</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/26_valuation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_financial_statement_analysis.html">Firm Fundamentals, Valuation, and Corporate Signals</a></li><li class="breadcrumb-item"><a href="./26_valuation.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Understanding firm valuation, financial health, and corporate maturity is fundamental to financial analysis and investment decision-making. Three widely used measures (e.g., Tobin’s Q, the Altman Z-Score, and company age) capture distinct but complementary dimensions of a firm’s economic standing. Tobin’s Q reflects the market’s assessment of a firm’s value relative to its asset base, the Altman Z-Score predicts the likelihood of financial distress, and company age proxies for organizational maturity and operational stability.</p>
<p>While these measures have been extensively studied in developed markets, particularly the United States <span class="citation" data-cites="lindenberg1981tobin altman1968financial gompers2003corporate">(see <a href="references.html#ref-lindenberg1981tobin" role="doc-biblioref">Lindenberg and Ross 1981</a>; <a href="references.html#ref-altman1968financial" role="doc-biblioref">Altman 1968</a>; <a href="references.html#ref-gompers2003corporate" role="doc-biblioref">Gompers, Ishii, and Metrick 2003</a>)</span>, their application in emerging markets like Vietnam presents unique challenges and opportunities. The Vietnamese stock market has grown rapidly but retains structural features, such as ownership concentration, state-owned enterprise dominance, limited bond market depth, and evolving accounting standards, which necessitate careful adaptation of standard valuation and distress metrics.</p>
<section id="required-packages" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="required-packages"><span class="header-section-number">15.1</span> Required Packages</h2>
<div id="setup" class="cell" data-message="false" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.figsize"</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.size"</span>: <span class="dv">12</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.titlesize"</span>: <span class="dv">14</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.labelsize"</span>: <span class="dv">12</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xtick.labelsize"</span>: <span class="dv">10</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ytick.labelsize"</span>: <span class="dv">10</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"legend.fontsize"</span>: <span class="dv">10</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.dpi"</span>: <span class="dv">150</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.top"</span>: <span class="va">False</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.right"</span>: <span class="va">False</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Color palette consistent with Tidy Finance style</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"primary"</span>: <span class="st">"#1f77b4"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"secondary"</span>: <span class="st">"#ff7f0e"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tertiary"</span>: <span class="st">"#2ca02c"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quaternary"</span>: <span class="st">"#d62728"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quinary"</span>: <span class="st">"#9467bd"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"safe"</span>: <span class="st">"#2ca02c"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alert"</span>: <span class="st">"#ff7f0e"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"danger"</span>: <span class="st">"#d62728"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distress"</span>: <span class="st">"#8b0000"</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-theory" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Theoretical Foundations</h1>
<section id="sec-tobinq-theory" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="sec-tobinq-theory"><span class="header-section-number">16.1</span> Tobin’s Q: Market Valuation of the Firm</h2>
<section id="the-original-concept" class="level3" data-number="16.1.1">
<h3 data-number="16.1.1" class="anchored" data-anchor-id="the-original-concept"><span class="header-section-number">16.1.1</span> The Original Concept</h3>
<p>Tobin’s Q was introduced by <span class="citation" data-cites="tobin1969general">Tobin (<a href="references.html#ref-tobin1969general" role="doc-biblioref">1969</a>)</span> as a theoretical link between financial markets and real investment decisions. The fundamental idea is elegant: if the market values a firm’s assets at more than their replacement cost, the firm has an incentive to invest in new capital; if the market values them at less, the firm should not invest, and may even benefit from selling assets.</p>
<p>Formally, Tobin’s Q is defined as:</p>
<p><span id="eq-tobinq-basic"><span class="math display">\[
Q = \frac{\text{Market Value of the Firm}}{\text{Replacement Cost of Assets}}
\tag{16.1}\]</span></span></p>
<p>When <span class="math inline">\(Q &gt; 1\)</span>, the market perceives the firm as possessing valuable intangible assets, such as brand equity, managerial talent, proprietary technology, or growth opportunities, that exceed the cost of its tangible asset base. When <span class="math inline">\(Q &lt; 1\)</span>, the market effectively values the firm at less than what it would cost to reassemble its assets, suggesting potential undervaluation or the presence of agency costs and organizational inefficiencies.</p>
</section>
<section id="market-value-decomposition" class="level3" data-number="16.1.2">
<h3 data-number="16.1.2" class="anchored" data-anchor-id="market-value-decomposition"><span class="header-section-number">16.1.2</span> Market Value Decomposition</h3>
<p>The numerator of Tobin’s Q represents the total market value of all claims on the firm:</p>
<p><span id="eq-mv-decomposition"><span class="math display">\[
MV = CS + PS + ST + LT
\tag{16.2}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(CS\)</span> = Market value of common stock (shares outstanding <span class="math inline">\(\times\)</span> market price)</li>
<li><span class="math inline">\(PS\)</span> = Market value of preferred stock</li>
<li><span class="math inline">\(ST\)</span> = Market value of short-term debt</li>
<li><span class="math inline">\(LT\)</span> = Market value of long-term debt</li>
</ul>
</section>
<section id="replacement-cost-of-assets" class="level3" data-number="16.1.3">
<h3 data-number="16.1.3" class="anchored" data-anchor-id="replacement-cost-of-assets"><span class="header-section-number">16.1.3</span> Replacement Cost of Assets</h3>
<p>The denominator captures the replacement cost of the firm’s asset base:</p>
<p><span id="eq-replacement-cost"><span class="math display">\[
RC = TA + (RNP - HNP) + (RINV - HINV)
\tag{16.3}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(TA\)</span> = Total assets as reported</li>
<li><span class="math inline">\(RNP\)</span> = Replacement cost of net plant and equipment</li>
<li><span class="math inline">\(HNP\)</span> = Historical (book) value of net plant and equipment</li>
<li><span class="math inline">\(RINV\)</span> = Replacement cost of inventories</li>
<li><span class="math inline">\(HINV\)</span> = Historical (book) value of inventories</li>
</ul>
<p>The replacement cost adjustments for plant and equipment involve recursive calculations that account for depreciation rates and, in more detailed estimations, technical progress rates <span class="citation" data-cites="lindenberg1981tobin">(<a href="references.html#ref-lindenberg1981tobin" role="doc-biblioref">Lindenberg and Ross 1981</a>)</span>. For inventories, the adjustment depends on the inventory accounting method: LIFO (Last In, First Out), FIFO (First In, First Out), average cost, or retail cost.</p>
</section>
<section id="simplified-tobins-q" class="level3" data-number="16.1.4">
<h3 data-number="16.1.4" class="anchored" data-anchor-id="simplified-tobins-q"><span class="header-section-number">16.1.4</span> Simplified Tobin’s Q</h3>
<p>In practice, the full replacement cost computation requires data that are often unavailable, particularly in emerging markets. <span class="citation" data-cites="gompers2003corporate">Gompers, Ishii, and Metrick (<a href="references.html#ref-gompers2003corporate" role="doc-biblioref">2003</a>)</span> popularized a simplified version:</p>
<p><span id="eq-tobinq-simple"><span class="math display">\[
Q_{\text{simple}} = \frac{TA + ME - BE}{TA}
\tag{16.4}\]</span></span></p>
<p>where <span class="math inline">\(ME\)</span> is the market value of equity and <span class="math inline">\(BE\)</span> is the book value of equity. This formulation assumes that the book values of debt and preferred stock approximate their market values, and that total assets approximate the replacement cost of the firm’s asset base. Despite its simplicity, this measure has been shown to correlate well with more elaborate constructions and has become the standard in empirical corporate finance research.</p>
</section>
<section id="chung-and-pruitt-approximation" class="level3" data-number="16.1.5">
<h3 data-number="16.1.5" class="anchored" data-anchor-id="chung-and-pruitt-approximation"><span class="header-section-number">16.1.5</span> Chung and Pruitt Approximation</h3>
<p><span class="citation" data-cites="chung1994simple">Chung and Pruitt (<a href="references.html#ref-chung1994simple" role="doc-biblioref">1994</a>)</span> proposed another widely used approximation:</p>
<p><span id="eq-tobinq-cp"><span class="math display">\[
Q_{\text{CP}} = \frac{ME + PS + DEBT}{TA}
\tag{16.5}\]</span></span></p>
<p>where <span class="math inline">\(DEBT = \text{Current Liabilities} - \text{Current Assets} + \text{Book Value of Inventories} + \text{Long-term Debt}\)</span>. This formulation captures the net debt position more precisely than the <span class="citation" data-cites="gompers2003corporate">Gompers, Ishii, and Metrick (<a href="references.html#ref-gompers2003corporate" role="doc-biblioref">2003</a>)</span> version.</p>
<hr>
</section>
</section>
<section id="sec-zscore-theory" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="sec-zscore-theory"><span class="header-section-number">16.2</span> Altman Z-Score: Predicting Financial Distress</h2>
<section id="the-original-model" class="level3" data-number="16.2.1">
<h3 data-number="16.2.1" class="anchored" data-anchor-id="the-original-model"><span class="header-section-number">16.2.1</span> The Original Model</h3>
<p>The Altman Z-Score, developed by <span class="citation" data-cites="altman1968financial">Altman (<a href="references.html#ref-altman1968financial" role="doc-biblioref">1968</a>)</span>, is a multivariate discriminant analysis model that predicts the probability of corporate bankruptcy within a two-year horizon. The model was originally estimated using a matched sample of bankrupt and non-bankrupt U.S. manufacturing firms and takes the form:</p>
<p><span id="eq-zscore-original"><span class="math display">\[
Z = 3.3 \cdot X_1 + 0.999 \cdot X_2 + 0.6 \cdot X_3 + 1.2 \cdot X_4 + 1.4 \cdot X_5
\tag{16.6}\]</span></span></p>
<p>where the five financial ratios are in <a href="#tbl-zscore-components" class="quarto-xref">Table&nbsp;<span>16.1</span></a></p>
<div id="tbl-zscore-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-zscore-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;16.1: Components of the Altman Z-Score
</figcaption>
<div aria-describedby="tbl-zscore-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 26%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Formula</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(X_1\)</span></td>
<td><span class="math inline">\(\frac{\text{EBIT}}{\text{Total Assets}}\)</span></td>
<td>Earning power of assets</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_2\)</span></td>
<td><span class="math inline">\(\frac{\text{Net Sales}}{\text{Total Assets}}\)</span></td>
<td>Total asset turnover</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_3\)</span></td>
<td><span class="math inline">\(\frac{\text{Market Value of Equity}}{\text{Total Liabilities}}\)</span></td>
<td>Leverage ratio (inverse)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_4\)</span></td>
<td><span class="math inline">\(\frac{\text{Working Capital}}{\text{Total Assets}}\)</span></td>
<td>Short-term liquidity</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_5\)</span></td>
<td><span class="math inline">\(\frac{\text{Retained Earnings}}{\text{Total Assets}}\)</span></td>
<td>Cumulative profitability</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The interpretation zones are in <a href="#tbl-zscore-zones" class="quarto-xref">Table&nbsp;<span>16.2</span></a></p>
<div id="tbl-zscore-zones" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-zscore-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;16.2: Altman Z-Score interpretation zones
</figcaption>
<div aria-describedby="tbl-zscore-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 48%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Z-Score Range</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(Z &gt; 2.99\)</span></td>
<td>Safe zone-low probability of financial distress</td>
</tr>
<tr class="even">
<td><span class="math inline">\(2.70 \leq Z \leq 2.99\)</span></td>
<td>Grey zone-on alert, moderate risk</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(1.80 \leq Z &lt; 2.70\)</span></td>
<td>Distress zone-significant bankruptcy risk within 2 years</td>
</tr>
<tr class="even">
<td><span class="math inline">\(Z &lt; 1.80\)</span></td>
<td>High distress-very high probability of financial failure</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="the-z-score-model-for-private-firms" class="level3" data-number="16.2.2">
<h3 data-number="16.2.2" class="anchored" data-anchor-id="the-z-score-model-for-private-firms"><span class="header-section-number">16.2.2</span> The Z’-Score Model for Private Firms</h3>
<p>Because the original model uses market value of equity in <span class="math inline">\(X_3\)</span>, <span class="citation" data-cites="altman2010corporate">Altman and Hotchkiss (<a href="references.html#ref-altman2010corporate" role="doc-biblioref">2010</a>)</span> developed the Z’-Score for private (non-publicly traded) firms by replacing market capitalization with book value of equity:</p>
<p><span id="eq-zscore-private"><span class="math display">\[
Z' = 0.717 \cdot X_1' + 0.847 \cdot X_2' + 3.107 \cdot X_3' + 0.420 \cdot X_4' + 0.998 \cdot X_5'
\tag{16.7}\]</span></span></p>
<p>where <span class="math inline">\(X_4' = \frac{\text{Book Value of Equity}}{\text{Total Liabilities}}\)</span>, and the remaining variables are defined as in the original model but with re-estimated coefficients.</p>
</section>
<section id="the-z-score-model-for-emerging-markets" class="level3" data-number="16.2.3">
<h3 data-number="16.2.3" class="anchored" data-anchor-id="the-z-score-model-for-emerging-markets"><span class="header-section-number">16.2.3</span> The Z’’-Score Model for Emerging Markets</h3>
<p>Most relevant for Vietnam, <span class="citation" data-cites="altman2010corporate">Altman and Hotchkiss (<a href="references.html#ref-altman2010corporate" role="doc-biblioref">2010</a>)</span> also developed the Z’’-Score for non-manufacturing and emerging market firms:</p>
<p><span id="eq-zscore-emerging"><span class="math display">\[
Z'' = 3.25 + 6.56 \cdot X_1'' + 3.26 \cdot X_2'' + 6.72 \cdot X_3'' + 1.05 \cdot X_4''
\tag{16.8}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(X_1'' = \frac{\text{Working Capital}}{\text{Total Assets}}\)</span></li>
<li><span class="math inline">\(X_2'' = \frac{\text{Retained Earnings}}{\text{Total Assets}}\)</span></li>
<li><span class="math inline">\(X_3'' = \frac{\text{EBIT}}{\text{Total Assets}}\)</span></li>
<li><span class="math inline">\(X_4'' = \frac{\text{Book Value of Equity}}{\text{Total Liabilities}}\)</span></li>
</ul>
<p>Note that this model drops the sales/total assets ratio (<span class="math inline">\(X_2\)</span> in the original model) to minimize industry effects and adds an intercept. The classification zones shift accordingly (<a href="#tbl-zscore-em-zones" class="quarto-xref">Table&nbsp;<span>16.3</span></a>).</p>
<div id="tbl-zscore-em-zones" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-zscore-em-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;16.3: Z’’-Score interpretation zones for emerging markets
</figcaption>
<div aria-describedby="tbl-zscore-em-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Z’’-Score Range</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(Z'' &gt; 2.60\)</span></td>
<td>Safe zone</td>
</tr>
<tr class="even">
<td><span class="math inline">\(1.10 \leq Z'' \leq 2.60\)</span></td>
<td>Grey zone</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Z'' &lt; 1.10\)</span></td>
<td>Distress zone</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="sec-age-theory" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="sec-age-theory"><span class="header-section-number">16.3</span> Company Age: Measuring Corporate Maturity</h2>
<p>Company age captures the accumulated experience, reputation, and organizational capital of a firm. Older firms typically exhibit more stable operations, established competitive advantages, and predictable cash flow patterns <span class="citation" data-cites="coad2018firm">(<a href="references.html#ref-coad2018firm" role="doc-biblioref">Coad et al. 2018</a>)</span>. Age is commonly used as a control variable in corporate finance research, and its relationship with performance is theoretically ambiguous: older firms benefit from learning effects and reputation but may suffer from organizational rigidity and declining innovation <span class="citation" data-cites="huergo2004firms">(<a href="references.html#ref-huergo2004firms" role="doc-biblioref">Huergo and Jaumandreu 2004</a>)</span>.</p>
<p>The ideal measure is the number of years since founding. When founding dates are unavailable, common proxies include:</p>
<ol type="1">
<li><strong>Listing age</strong>: Years since the first IPO or listing on a stock exchange.</li>
<li><strong>Data age</strong>: Years since the first appearance in financial databases.</li>
<li><strong>Incorporation age</strong>: Years since the date of legal incorporation.</li>
</ol>
<p>In the Vietnamese context, we can use multiple proxies, including the date of first listing on HOSE or HNX, the first available financial statement date, and (when available) the founding date from company profiles.</p>
</section>
</section>
<section id="sec-vietnam-context" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> The Vietnamese Market Context</h1>
<section id="institutional-features-affecting-valuation-measures" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="institutional-features-affecting-valuation-measures"><span class="header-section-number">17.1</span> Institutional Features Affecting Valuation Measures</h2>
<p>The Vietnamese stock market has several institutional features that are important to consider when computing and interpreting Tobin’s Q, Altman Z-Score, and company age.</p>
<section id="state-ownership-and-equitization" class="level3" data-number="17.1.1">
<h3 data-number="17.1.1" class="anchored" data-anchor-id="state-ownership-and-equitization"><span class="header-section-number">17.1.1</span> State Ownership and Equitization</h3>
<p>A significant proportion of Vietnamese listed firms are former state-owned enterprises (SOEs) that underwent equitization (cổ phần hóa). These firms often retain substantial state ownership, which can affect:</p>
<ul>
<li><strong>Tobin’s Q</strong>: State ownership may depress Q if markets perceive government influence as reducing efficiency, or it may elevate Q if state connections provide preferential access to resources and contracts.</li>
<li><strong>Z-Score</strong>: SOEs may have implicit government guarantees that reduce actual bankruptcy risk below what the Z-Score predicts.</li>
<li><strong>Age</strong>: The true operational age of equitized SOEs may far exceed their listing age, creating measurement challenges.</li>
</ul>
</section>
<section id="foreign-ownership-limits" class="level3" data-number="17.1.2">
<h3 data-number="17.1.2" class="anchored" data-anchor-id="foreign-ownership-limits"><span class="header-section-number">17.1.2</span> Foreign Ownership Limits</h3>
<p>Vietnam imposes foreign ownership limits (FOL) on listed companies, typically capped at 49% for most sectors (with some exceptions). This constraint can create price premiums for stocks approaching the FOL ceiling, potentially inflating Tobin’s Q for these firms <span class="citation" data-cites="vo2015foreign">(<a href="references.html#ref-vo2015foreign" role="doc-biblioref">Vo 2015</a>)</span>.</p>
</section>
<section id="accounting-standards" class="level3" data-number="17.1.3">
<h3 data-number="17.1.3" class="anchored" data-anchor-id="accounting-standards"><span class="header-section-number">17.1.3</span> Accounting Standards</h3>
<p>Vietnamese Accounting Standards (VAS) differ from International Financial Reporting Standards (IFRS) in several ways relevant to our measures:</p>
<ul>
<li><strong>Historical cost basis</strong>: VAS relies more heavily on historical cost, which can cause book values to diverge substantially from replacement costs, affecting both Q and Z-Score calculations.</li>
<li><strong>Limited fair value measurement</strong>: Unlike IFRS, VAS limits fair value measurement for many asset classes, making book-value-based proxies less reliable.</li>
<li><strong>Inventory methods</strong>: Vietnamese firms use various inventory valuation methods (FIFO, weighted average), which affect the book value of inventories and hence the Z-Score’s working capital component.</li>
</ul>
</section>
<section id="market-microstructure" class="level3" data-number="17.1.4">
<h3 data-number="17.1.4" class="anchored" data-anchor-id="market-microstructure"><span class="header-section-number">17.1.4</span> Market Microstructure</h3>
<p>Vietnam’s market features daily price limits (currently <span class="math inline">\(\pm\)</span> 7% on HOSE, <span class="math inline">\(\pm\)</span> 10% on HNX, <span class="math inline">\(\pm\)</span> 15% on UPCoM), which can prevent prices from reaching equilibrium values quickly. This means that market capitalization at any point may not fully reflect available information, introducing noise into market-value-based measures like Tobin’s Q.</p>
<!-- ## DataCore.vn Dataset Structure

DataCore.vn provides comprehensive financial data for Vietnamese listed companies. For this chapter, we assume access to the following datasets:

1.  **Financial statements** (`financial_statements`): Annual and quarterly balance sheets, income statements, and cash flow statements for all listed firms.
2.  **Market data** (`market_data`): Daily stock prices, shares outstanding, and market capitalization.
3.  **Company profiles** (`company_profiles`): Firm characteristics including listing date, founding date, industry classification, exchange, and ownership structure.
4.  **Delisting information** (`delisting_info`): Records of firms that have been delisted, including dates and reasons. -->
</section>
</section>
</section>
<section id="sec-data-prep" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Data Preparation</h1>
<section id="loading-and-cleaning-financial-statement-data" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="loading-and-cleaning-financial-statement-data"><span class="header-section-number">18.1</span> Loading and Cleaning Financial Statement Data</h2>
<p>We begin by loading the annual financial statement data and constructing the variables needed for our three measures.</p>
<div id="simulate-data" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice, replace this section with actual DataCore.vn API calls:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   from datacore import DataCoreClient</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   client = DataCoreClient(api_key="your_api_key")</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   financials = client.get_financial_statements(</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       frequency="annual",</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#       start_date="2005-01-01",</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#       end_date="2024-12-31"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   market = client.get_market_data(frequency="daily")</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   profiles = client.get_company_profiles()</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration purposes, we simulate realistic Vietnamese market data.</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>n_firms <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2008</span>, <span class="dv">2025</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>exchanges <span class="op">=</span> [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>industries <span class="op">=</span> [</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bất động sản"</span>, <span class="st">"Ngân hàng"</span>, <span class="st">"Thực phẩm &amp; Đồ uống"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Xây dựng &amp; Vật liệu"</span>, <span class="st">"Công nghệ thông tin"</span>, <span class="st">"Bán lẻ"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dầu khí"</span>, <span class="st">"Thép"</span>, <span class="st">"Dệt may"</span>, <span class="st">"Dược phẩm"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Điện lực"</span>, <span class="st">"Vận tải &amp; Logistics"</span>, <span class="st">"Hóa chất"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Chứng khoán"</span>, <span class="st">"Bảo hiểm"</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate firm profiles</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>firm_ids <span class="op">=</span> [<span class="ss">f"VN</span><span class="sc">{</span><span class="bu">str</span>(i)<span class="sc">.</span>zfill(<span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n_firms <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>firm_profiles <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>: firm_ids,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"exchange"</span>: np.random.choice(exchanges, n_firms, p<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>]),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"industry"</span>: np.random.choice(industries, n_firms),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"founding_year"</span>: np.random.randint(<span class="dv">1975</span>, <span class="dv">2015</span>, n_firms),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"listing_year"</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">2020</span>, n_firms),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state_ownership_pct"</span>: np.clip(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        np.random.beta(<span class="dv">2</span>, <span class="dv">5</span>, n_firms) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">75</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>firm_profiles[<span class="st">"listing_year"</span>] <span class="op">=</span> np.maximum(</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    firm_profiles[<span class="st">"listing_year"</span>],</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    firm_profiles[<span class="st">"founding_year"</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate panel data</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>records <span class="op">=</span> []</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, firm <span class="kw">in</span> firm_profiles.iterrows():</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    start_year <span class="op">=</span> <span class="bu">max</span>(firm[<span class="st">"listing_year"</span>], <span class="dv">2008</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base financial characteristics (firm fixed effects)</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    base_ta <span class="op">=</span> np.exp(np.random.normal(<span class="dv">14</span>, <span class="fl">1.5</span>))  <span class="co"># Total assets in VND millions</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    base_profitability <span class="op">=</span> np.random.normal(<span class="fl">0.08</span>, <span class="fl">0.05</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    base_leverage <span class="op">=</span> np.random.beta(<span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    base_turnover <span class="op">=</span> np.random.gamma(<span class="dv">2</span>, <span class="fl">0.4</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> year <span class="op">&lt;</span> start_year:</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> <span class="fl">0.02</span>:  <span class="co"># 2% chance of delisting</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Time-varying components with persistence</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        shock <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.15</span>)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        growth <span class="op">=</span> np.random.normal(<span class="fl">0.08</span>, <span class="fl">0.05</span>)</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        ta <span class="op">=</span> base_ta <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> growth) <span class="op">**</span> (year <span class="op">-</span> start_year) <span class="op">*</span> np.exp(shock)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        profitability <span class="op">=</span> np.clip(base_profitability <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.03</span>), <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        leverage <span class="op">=</span> np.clip(base_leverage <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="fl">0.05</span>, <span class="fl">0.95</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        lt <span class="op">=</span> ta <span class="op">*</span> leverage <span class="op">*</span> np.random.uniform(<span class="fl">0.4</span>, <span class="fl">0.7</span>)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        total_liabilities <span class="op">=</span> ta <span class="op">*</span> leverage</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        ct_liabilities <span class="op">=</span> total_liabilities <span class="op">-</span> lt</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        seq <span class="op">=</span> ta <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> leverage)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        sale <span class="op">=</span> ta <span class="op">*</span> np.clip(base_turnover <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.1</span>), <span class="fl">0.1</span>, <span class="dv">5</span>)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        ebit <span class="op">=</span> ta <span class="op">*</span> profitability</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        ni <span class="op">=</span> ebit <span class="op">*</span> np.random.uniform(<span class="fl">0.6</span>, <span class="fl">0.9</span>)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        re <span class="op">=</span> seq <span class="op">*</span> np.random.uniform(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.8</span>)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        act <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.2</span>, <span class="fl">0.7</span>)</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        lct <span class="op">=</span> ct_liabilities</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Market value with noise and sentiment</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        market_premium <span class="op">=</span> np.random.lognormal(<span class="dv">0</span>, <span class="fl">0.4</span>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>        me <span class="op">=</span> seq <span class="op">*</span> market_premium</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        prcc <span class="op">=</span> me <span class="op">/</span> <span class="bu">max</span>(np.random.uniform(<span class="dv">50</span>, <span class="dv">500</span>), <span class="dv">1</span>)</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        csho <span class="op">=</span> me <span class="op">/</span> <span class="bu">max</span>(prcc, <span class="fl">0.01</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Preferred stock (rare in Vietnam, mostly zero)</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        pstk <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> np.random.random() <span class="op">&gt;</span> <span class="fl">0.05</span> <span class="cf">else</span> seq <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Net plant and equipment</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        ppent <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.1</span>, <span class="fl">0.6</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        invt <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.05</span>, <span class="fl">0.3</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Deferred taxes and investment tax credit (typically small in VN)</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        txdb <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        itcb <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        records.append({</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ticker"</span>: firm[<span class="st">"ticker"</span>],</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">"year"</span>: year,</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>            <span class="st">"datadate"</span>: pd.Timestamp(year, <span class="dv">12</span>, <span class="dv">31</span>),</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>            <span class="st">"at"</span>: ta,            <span class="co"># Total Assets</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">"seq"</span>: seq,          <span class="co"># Stockholders' Equity</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lt"</span>: lt,            <span class="co"># Long-term Debt</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lct"</span>: lct,          <span class="co"># Current Liabilities</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tlb"</span>: total_liabilities,  <span class="co"># Total Liabilities</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sale"</span>: sale,        <span class="co"># Net Sales/Revenue</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ebit"</span>: ebit,        <span class="co"># EBIT</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ni"</span>: ni,            <span class="co"># Net Income</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">"re_var"</span>: re,        <span class="co"># Retained Earnings</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>            <span class="st">"act"</span>: act,          <span class="co"># Current Assets</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ppent"</span>: ppent,      <span class="co"># Net Plant &amp; Equipment</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>            <span class="st">"invt"</span>: invt,        <span class="co"># Inventories</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            <span class="st">"txdb"</span>: txdb,        <span class="co"># Deferred Taxes</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>            <span class="st">"itcb"</span>: itcb,        <span class="co"># Investment Tax Credit</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pstk"</span>: pstk,        <span class="co"># Preferred Stock</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>            <span class="st">"me"</span>: me,            <span class="co"># Market Value of Equity</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>            <span class="st">"prcc"</span>: prcc,        <span class="co"># Price at Calendar Year End</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">"csho"</span>: csho,        <span class="co"># Shares Outstanding</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(firm_profiles[[<span class="st">"ticker"</span>, <span class="st">"exchange"</span>, <span class="st">"industry"</span>,</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"founding_year"</span>, <span class="st">"listing_year"</span>,</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"state_ownership_pct"</span>]],</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>              on<span class="op">=</span><span class="st">"ticker"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Panel dimensions: </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-year observations"</span>)</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of unique firms: </span><span class="sc">{</span>df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Year range: </span><span class="sc">{</span>df[<span class="st">'year'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">–</span><span class="sc">{</span>df[<span class="st">'year'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Exchanges: </span><span class="sc">{</span>df[<span class="st">'exchange'</span>]<span class="sc">.</span>value_counts()<span class="sc">.</span>to_dict()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Panel dimensions: 3,484 firm-year observations
Number of unique firms: 297
Year range: 2008–2024
Exchanges: {'HOSE': 1701, 'HNX': 1118, 'UPCoM': 665}</code></pre>
</div>
</div>
</section>
<section id="variable-definitions-and-mapping" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="variable-definitions-and-mapping"><span class="header-section-number">18.2</span> Variable Definitions and Mapping</h2>
<p><a href="#tbl-variable-mapping" class="quarto-xref">Table&nbsp;<span>18.1</span></a> provides the mapping between standard variable names and the corresponding fields.</p>
<div class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>variable_map <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Compustat Variable"</span>: [</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AT"</span>, <span class="st">"SEQ"</span>, <span class="st">"LT"</span>, <span class="st">"LCT"</span>, <span class="st">"SALE"</span>, <span class="st">"EBIT"</span>, <span class="st">"NI"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RE"</span>, <span class="st">"ACT"</span>, <span class="st">"PPENT"</span>, <span class="st">"INVT"</span>, <span class="st">"TXDB"</span>, <span class="st">"ITCB"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"PSTK/PSTKRV/PSTKL"</span>, <span class="st">"PRCC_C"</span>, <span class="st">"CSHO"</span>, <span class="st">"DLDTE"</span>, <span class="st">"DLRSN"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Description"</span>: [</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total Assets"</span>, <span class="st">"Stockholders' Equity"</span>, <span class="st">"Long-term Debt"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Current Liabilities"</span>, <span class="st">"Net Sales/Revenue"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Earnings Before Interest &amp; Taxes"</span>, <span class="st">"Net Income"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Retained Earnings"</span>, <span class="st">"Current Assets"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Net Plant &amp; Equipment"</span>, <span class="st">"Total Inventories"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Deferred Taxes"</span>, <span class="st">"Investment Tax Credit"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Preferred Stock (various)"</span>, <span class="st">"Price Close (Calendar Year)"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Common Shares Outstanding"</span>, <span class="st">"Delisting Date"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Delisting Reason"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DataCore.vn Equivalent"</span>: [</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tong_tai_san"</span>, <span class="st">"von_chu_so_huu"</span>, <span class="st">"no_dai_han"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"no_ngan_han"</span>, <span class="st">"doanh_thu_thuan"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loi_nhuan_truoc_thue_va_lai_vay"</span>, <span class="st">"loi_nhuan_sau_thue"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loi_nhuan_chua_phan_phoi"</span>, <span class="st">"tai_san_ngan_han"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tai_san_co_dinh_huu_hinh"</span>, <span class="st">"hang_ton_kho"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"thue_thu_nhap_hoan_lai"</span>, <span class="st">"N/A (not applicable in VAS)"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"co_phieu_uu_dai"</span>, <span class="st">"gia_dong_cua_cuoi_nam"</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"so_luong_co_phieu_luu_hanh"</span>, <span class="st">"ngay_huy_niem_yet"</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ly_do_huy_niem_yet"</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VAS Account"</span>: [</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.100"</span>, <span class="st">"BS.400"</span>, <span class="st">"BS.330"</span>, <span class="st">"BS.310"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"IS.10"</span>, <span class="st">"Computed"</span>, <span class="st">"IS.60"</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.421"</span>, <span class="st">"BS.100"</span>, <span class="st">"BS.221"</span>, <span class="st">"BS.141"</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.262"</span>, <span class="st">"—"</span>, <span class="st">"BS.411b"</span>, <span class="st">"Market"</span>, <span class="st">"Market"</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Profile"</span>, <span class="st">"Profile"</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>variable_map.style.set_properties(<span class="op">**</span>{</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-align"</span>: <span class="st">"left"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font-size"</span>: <span class="st">"10pt"</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>}).set_table_styles([</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"th"</span>, <span class="st">"props"</span>: [</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"background-color"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"color"</span>, <span class="st">"white"</span>),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"font-weight"</span>, <span class="st">"bold"</span>),</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"text-align"</span>, <span class="st">"left"</span>),</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"padding"</span>, <span class="st">"8px"</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    ]},</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"td"</span>, <span class="st">"props"</span>: [(<span class="st">"padding"</span>, <span class="st">"6px"</span>)]},</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-variable-mapping" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="3">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-variable-mapping-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;18.1: Variable mapping
</figcaption>
<div aria-describedby="tbl-variable-mapping-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="3">
<style type="text/css">
#T_b4f98 th {
  background-color: #1f77b4;
  color: white;
  font-weight: bold;
  text-align: left;
  padding: 8px;
}
#T_b4f98 td {
  padding: 6px;
}
#T_b4f98_row0_col0, #T_b4f98_row0_col1, #T_b4f98_row0_col2, #T_b4f98_row0_col3, #T_b4f98_row1_col0, #T_b4f98_row1_col1, #T_b4f98_row1_col2, #T_b4f98_row1_col3, #T_b4f98_row2_col0, #T_b4f98_row2_col1, #T_b4f98_row2_col2, #T_b4f98_row2_col3, #T_b4f98_row3_col0, #T_b4f98_row3_col1, #T_b4f98_row3_col2, #T_b4f98_row3_col3, #T_b4f98_row4_col0, #T_b4f98_row4_col1, #T_b4f98_row4_col2, #T_b4f98_row4_col3, #T_b4f98_row5_col0, #T_b4f98_row5_col1, #T_b4f98_row5_col2, #T_b4f98_row5_col3, #T_b4f98_row6_col0, #T_b4f98_row6_col1, #T_b4f98_row6_col2, #T_b4f98_row6_col3, #T_b4f98_row7_col0, #T_b4f98_row7_col1, #T_b4f98_row7_col2, #T_b4f98_row7_col3, #T_b4f98_row8_col0, #T_b4f98_row8_col1, #T_b4f98_row8_col2, #T_b4f98_row8_col3, #T_b4f98_row9_col0, #T_b4f98_row9_col1, #T_b4f98_row9_col2, #T_b4f98_row9_col3, #T_b4f98_row10_col0, #T_b4f98_row10_col1, #T_b4f98_row10_col2, #T_b4f98_row10_col3, #T_b4f98_row11_col0, #T_b4f98_row11_col1, #T_b4f98_row11_col2, #T_b4f98_row11_col3, #T_b4f98_row12_col0, #T_b4f98_row12_col1, #T_b4f98_row12_col2, #T_b4f98_row12_col3, #T_b4f98_row13_col0, #T_b4f98_row13_col1, #T_b4f98_row13_col2, #T_b4f98_row13_col3, #T_b4f98_row14_col0, #T_b4f98_row14_col1, #T_b4f98_row14_col2, #T_b4f98_row14_col3, #T_b4f98_row15_col0, #T_b4f98_row15_col1, #T_b4f98_row15_col2, #T_b4f98_row15_col3, #T_b4f98_row16_col0, #T_b4f98_row16_col1, #T_b4f98_row16_col2, #T_b4f98_row16_col3, #T_b4f98_row17_col0, #T_b4f98_row17_col1, #T_b4f98_row17_col2, #T_b4f98_row17_col3 {
  text-align: left;
  font-size: 10pt;
}
</style>

<table id="T_b4f98" class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_b4f98_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Compustat Variable</th>
<th id="T_b4f98_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Description</th>
<th id="T_b4f98_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">DataCore.vn Equivalent</th>
<th id="T_b4f98_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">VAS Account</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_b4f98_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</th>
<td id="T_b4f98_row0_col0" class="data row0 col0">AT</td>
<td id="T_b4f98_row0_col1" class="data row0 col1">Total Assets</td>
<td id="T_b4f98_row0_col2" class="data row0 col2">tong_tai_san</td>
<td id="T_b4f98_row0_col3" class="data row0 col3">BS.100</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</th>
<td id="T_b4f98_row1_col0" class="data row1 col0">SEQ</td>
<td id="T_b4f98_row1_col1" class="data row1 col1">Stockholders' Equity</td>
<td id="T_b4f98_row1_col2" class="data row1 col2">von_chu_so_huu</td>
<td id="T_b4f98_row1_col3" class="data row1 col3">BS.400</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</th>
<td id="T_b4f98_row2_col0" class="data row2 col0">LT</td>
<td id="T_b4f98_row2_col1" class="data row2 col1">Long-term Debt</td>
<td id="T_b4f98_row2_col2" class="data row2 col2">no_dai_han</td>
<td id="T_b4f98_row2_col3" class="data row2 col3">BS.330</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</th>
<td id="T_b4f98_row3_col0" class="data row3 col0">LCT</td>
<td id="T_b4f98_row3_col1" class="data row3 col1">Current Liabilities</td>
<td id="T_b4f98_row3_col2" class="data row3 col2">no_ngan_han</td>
<td id="T_b4f98_row3_col3" class="data row3 col3">BS.310</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</th>
<td id="T_b4f98_row4_col0" class="data row4 col0">SALE</td>
<td id="T_b4f98_row4_col1" class="data row4 col1">Net Sales/Revenue</td>
<td id="T_b4f98_row4_col2" class="data row4 col2">doanh_thu_thuan</td>
<td id="T_b4f98_row4_col3" class="data row4 col3">IS.10</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</th>
<td id="T_b4f98_row5_col0" class="data row5 col0">EBIT</td>
<td id="T_b4f98_row5_col1" class="data row5 col1">Earnings Before Interest &amp; Taxes</td>
<td id="T_b4f98_row5_col2" class="data row5 col2">loi_nhuan_truoc_thue_va_lai_vay</td>
<td id="T_b4f98_row5_col3" class="data row5 col3">Computed</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</th>
<td id="T_b4f98_row6_col0" class="data row6 col0">NI</td>
<td id="T_b4f98_row6_col1" class="data row6 col1">Net Income</td>
<td id="T_b4f98_row6_col2" class="data row6 col2">loi_nhuan_sau_thue</td>
<td id="T_b4f98_row6_col3" class="data row6 col3">IS.60</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</th>
<td id="T_b4f98_row7_col0" class="data row7 col0">RE</td>
<td id="T_b4f98_row7_col1" class="data row7 col1">Retained Earnings</td>
<td id="T_b4f98_row7_col2" class="data row7 col2">loi_nhuan_chua_phan_phoi</td>
<td id="T_b4f98_row7_col3" class="data row7 col3">BS.421</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">8</th>
<td id="T_b4f98_row8_col0" class="data row8 col0">ACT</td>
<td id="T_b4f98_row8_col1" class="data row8 col1">Current Assets</td>
<td id="T_b4f98_row8_col2" class="data row8 col2">tai_san_ngan_han</td>
<td id="T_b4f98_row8_col3" class="data row8 col3">BS.100</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">9</th>
<td id="T_b4f98_row9_col0" class="data row9 col0">PPENT</td>
<td id="T_b4f98_row9_col1" class="data row9 col1">Net Plant &amp; Equipment</td>
<td id="T_b4f98_row9_col2" class="data row9 col2">tai_san_co_dinh_huu_hinh</td>
<td id="T_b4f98_row9_col3" class="data row9 col3">BS.221</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">10</th>
<td id="T_b4f98_row10_col0" class="data row10 col0">INVT</td>
<td id="T_b4f98_row10_col1" class="data row10 col1">Total Inventories</td>
<td id="T_b4f98_row10_col2" class="data row10 col2">hang_ton_kho</td>
<td id="T_b4f98_row10_col3" class="data row10 col3">BS.141</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">11</th>
<td id="T_b4f98_row11_col0" class="data row11 col0">TXDB</td>
<td id="T_b4f98_row11_col1" class="data row11 col1">Deferred Taxes</td>
<td id="T_b4f98_row11_col2" class="data row11 col2">thue_thu_nhap_hoan_lai</td>
<td id="T_b4f98_row11_col3" class="data row11 col3">BS.262</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">12</th>
<td id="T_b4f98_row12_col0" class="data row12 col0">ITCB</td>
<td id="T_b4f98_row12_col1" class="data row12 col1">Investment Tax Credit</td>
<td id="T_b4f98_row12_col2" class="data row12 col2">N/A (not applicable in VAS)</td>
<td id="T_b4f98_row12_col3" class="data row12 col3">—</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row13" class="row_heading level0 row13" data-quarto-table-cell-role="th">13</th>
<td id="T_b4f98_row13_col0" class="data row13 col0">PSTK/PSTKRV/PSTKL</td>
<td id="T_b4f98_row13_col1" class="data row13 col1">Preferred Stock (various)</td>
<td id="T_b4f98_row13_col2" class="data row13 col2">co_phieu_uu_dai</td>
<td id="T_b4f98_row13_col3" class="data row13 col3">BS.411b</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row14" class="row_heading level0 row14" data-quarto-table-cell-role="th">14</th>
<td id="T_b4f98_row14_col0" class="data row14 col0">PRCC_C</td>
<td id="T_b4f98_row14_col1" class="data row14 col1">Price Close (Calendar Year)</td>
<td id="T_b4f98_row14_col2" class="data row14 col2">gia_dong_cua_cuoi_nam</td>
<td id="T_b4f98_row14_col3" class="data row14 col3">Market</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row15" class="row_heading level0 row15" data-quarto-table-cell-role="th">15</th>
<td id="T_b4f98_row15_col0" class="data row15 col0">CSHO</td>
<td id="T_b4f98_row15_col1" class="data row15 col1">Common Shares Outstanding</td>
<td id="T_b4f98_row15_col2" class="data row15 col2">so_luong_co_phieu_luu_hanh</td>
<td id="T_b4f98_row15_col3" class="data row15 col3">Market</td>
</tr>
<tr class="odd">
<th id="T_b4f98_level0_row16" class="row_heading level0 row16" data-quarto-table-cell-role="th">16</th>
<td id="T_b4f98_row16_col0" class="data row16 col0">DLDTE</td>
<td id="T_b4f98_row16_col1" class="data row16 col1">Delisting Date</td>
<td id="T_b4f98_row16_col2" class="data row16 col2">ngay_huy_niem_yet</td>
<td id="T_b4f98_row16_col3" class="data row16 col3">Profile</td>
</tr>
<tr class="even">
<th id="T_b4f98_level0_row17" class="row_heading level0 row17" data-quarto-table-cell-role="th">17</th>
<td id="T_b4f98_row17_col0" class="data row17 col0">DLRSN</td>
<td id="T_b4f98_row17_col1" class="data row17 col1">Delisting Reason</td>
<td id="T_b4f98_row17_col2" class="data row17 col2">ly_do_huy_niem_yet</td>
<td id="T_b4f98_row17_col3" class="data row17 col3">Profile</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="data-quality-checks" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="data-quality-checks"><span class="header-section-number">18.3</span> Data Quality Checks</h2>
<p>Before computing any measures, we perform essential data quality checks that are particularly important for Vietnamese data.</p>
<div id="data-quality-checks" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data_quality_report(df):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate a comprehensive data quality report."""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    report <span class="op">=</span> {}</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for negative total assets</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Negative total assets"</span>] <span class="op">=</span> (df[<span class="st">"at"</span>] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for negative equity (acceptable but noteworthy)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Negative equity"</span>] <span class="op">=</span> (df[<span class="st">"seq"</span>] <span class="op">&lt;=</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for missing critical variables</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    critical_vars <span class="op">=</span> [<span class="st">"at"</span>, <span class="st">"seq"</span>, <span class="st">"sale"</span>, <span class="st">"ebit"</span>, <span class="st">"me"</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> critical_vars:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        report[<span class="ss">f"Missing </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> df[var].isna().<span class="bu">sum</span>()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for extreme values (potential data errors)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Extreme leverage (&gt;100%)"</span>] <span class="op">=</span> (df[<span class="st">"tlb"</span>] <span class="op">/</span> df[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="fl">1.0</span>).<span class="bu">sum</span>()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Extreme sales/assets (&gt;10)"</span>] <span class="op">=</span> (df[<span class="st">"sale"</span>] <span class="op">/</span> df[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">10</span>).<span class="bu">sum</span>()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.Series(report, name<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>quality <span class="op">=</span> data_quality_report(df)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data Quality Report"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">45</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item, count <span class="kw">in</span> quality.items():</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    status <span class="op">=</span> <span class="st">"✓"</span> <span class="cf">if</span> count <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"⚠"</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply filters</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df.copy()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_clean[df_clean[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]  <span class="co"># Positive total assets</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_clean[df_clean[<span class="st">"seq"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]  <span class="co"># Positive equity (for BE calculation)</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Observations after cleaning: </span><span class="sc">{</span><span class="bu">len</span>(df_clean)<span class="sc">:,}</span><span class="ss"> "</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(dropped </span><span class="sc">{</span><span class="bu">len</span>(df) <span class="op">-</span> <span class="bu">len</span>(df_clean)<span class="sc">:,}</span><span class="ss">)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data Quality Report
=============================================
  ✓ Negative total assets: 0
  ✓ Negative equity: 0
  ✓ Missing at: 0
  ✓ Missing seq: 0
  ✓ Missing sale: 0
  ✓ Missing ebit: 0
  ✓ Missing me: 0
  ✓ Extreme leverage (&gt;100%): 0
  ✓ Extreme sales/assets (&gt;10): 0

Observations after cleaning: 3,484 (dropped 0)</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-tobinq-computation" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Computing Tobin’s Q</h1>
<section id="book-value-of-equity" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="book-value-of-equity"><span class="header-section-number">19.1</span> Book Value of Equity</h2>
<p>Following <span class="citation" data-cites="daniel1997evidence">Daniel and Titman (<a href="references.html#ref-daniel1997evidence" role="doc-biblioref">1997</a>)</span>, we compute the book value of equity as:</p>
<p><span id="eq-book-equity"><span class="math display">\[
BE = SEQ + TXDB + ITCB - PREF
\tag{19.1}\]</span></span></p>
<p>where <span class="math inline">\(PREF\)</span> is the preferred stock value, using the redemption value if available, otherwise the liquidating value, and finally the carrying value as a last resort. In the Vietnamese context, preferred stock is relatively rare among listed companies, so <span class="math inline">\(PREF\)</span> is often zero.</p>
<div id="compute-book-equity" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_book_equity(df):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute book value of equity following Daniel and Titman (1997).</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    In Vietnam, preferred stock is uncommon among listed firms.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    The investment tax credit (ITCB) is not applicable under VAS,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    so we set it to zero when missing.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Preferred stock: use coalesce logic</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"pref"</span>] <span class="op">=</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Book equity = Shareholders' equity + Deferred taxes + ITC - Preferred</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"be"</span>] <span class="op">=</span> (</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"seq"</span>]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"txdb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"itcb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"pref"</span>]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_book_equity(df_clean)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Book Equity Summary Statistics (VND millions)"</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clean[<span class="st">"be"</span>].describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Book Equity Summary Statistics (VND millions)
count          3,484
mean       3,521,607
std        9,055,435
min            4,633
25%          386,441
50%        1,112,062
75%        3,210,269
max      247,845,397
Name: be, dtype: str</code></pre>
</div>
</div>
</section>
<section id="market-value-of-equity" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="market-value-of-equity"><span class="header-section-number">19.2</span> Market Value of Equity</h2>
<p>The market value of equity is computed using the calendar year-end stock price and shares outstanding:</p>
<p><span id="eq-market-equity"><span class="math display">\[
ME = P_{\text{close}} \times \text{CSHO}
\tag{19.2}\]</span></span></p>
<p>For Vietnamese firms, this is obtained from the closing price on the last trading day of the fiscal year. Most Vietnamese firms have a December 31 fiscal year end, though some (particularly in agriculture and banking) may differ.</p>
<div id="compute-market-equity" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ME is already computed in our simulated data as prcc * csho</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice with DataCore.vn:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   me = df["gia_dong_cua_cuoi_nam"] * df["so_luong_co_phieu_luu_hanh"]</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">"me"</span>] <span class="op">=</span> df_clean[<span class="st">"prcc"</span>] <span class="op">*</span> df_clean[<span class="st">"csho"</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Market Equity Summary Statistics (VND millions)"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clean[<span class="st">"me"</span>].describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Market Equity Summary Statistics (VND millions)
count          3,484
mean       3,653,445
std        9,747,318
min            3,379
25%          370,119
50%        1,106,646
75%        3,029,093
max      286,258,816
Name: me, dtype: str</code></pre>
</div>
</div>
</section>
<section id="simplified-tobins-q-1" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="simplified-tobins-q-1"><span class="header-section-number">19.3</span> Simplified Tobin’s Q</h2>
<p>We implement the <span class="citation" data-cites="gompers2003corporate">Gompers, Ishii, and Metrick (<a href="references.html#ref-gompers2003corporate" role="doc-biblioref">2003</a>)</span> simplified version:</p>
<p><span id="eq-tobinq-implementation"><span class="math display">\[
Q_{\text{simple}} = \frac{AT + ME - BE}{AT}
\tag{19.3}\]</span></span></p>
<p>This can be rewritten as:</p>
<p><span id="eq-tobinq-rewritten"><span class="math display">\[
Q_{\text{simple}} = 1 + \frac{ME - BE}{AT}
\tag{19.4}\]</span></span></p>
<p>which makes the interpretation clear: Tobin’s Q equals one plus the market-to-book premium (or discount) scaled by total assets.</p>
<div id="compute-tobinq" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_tobins_q(df):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute multiple variants of Tobin's Q.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Variants:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Simple Q (Gompers et al., 2003)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Chung-Pruitt Q</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Market-to-Book ratio (for comparison)</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Variant 1: Simple Q (Gompers, Ishii, Metrick 2003) ---</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_simple"</span>] <span class="op">=</span> (result[<span class="st">"at"</span>] <span class="op">+</span> result[<span class="st">"me"</span>] <span class="op">-</span> result[<span class="st">"be"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Variant 2: Chung-Pruitt Approximation ---</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DEBT = Current Liabilities - Current Assets + Inventories + LT Debt</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"debt_cp"</span>] <span class="op">=</span> (</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"invt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"lt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_cp"</span>] <span class="op">=</span> (</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        (result[<span class="st">"me"</span>] <span class="op">+</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> result[<span class="st">"debt_cp"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Market-to-Book Ratio ---</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"mtb"</span>] <span class="op">=</span> np.where(result[<span class="st">"be"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"be"</span>], np.nan)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_tobins_q(df_clean)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>q_vars <span class="op">=</span> [<span class="st">"tobin_q_simple"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>q_summary <span class="op">=</span> df_clean[q_vars].describe(percentiles<span class="op">=</span>[<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>])</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>q_summary <span class="op">=</span> q_summary.<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>q_summary.columns <span class="op">=</span> [<span class="st">"Simple Q"</span>, <span class="st">"Chung-Pruitt Q"</span>, <span class="st">"Market-to-Book"</span>]</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tobin's Q Summary Statistics"</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q_summary.to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tobin's Q Summary Statistics
       Simple Q  Chung-Pruitt Q  Market-to-Book
count  3484.000        3484.000        3484.000
mean      1.031           0.766           1.058
std       0.243           0.296           0.445
min       0.357           0.008           0.233
1%        0.602           0.189           0.382
5%        0.713           0.332           0.496
25%       0.886           0.568           0.742
50%       0.989           0.738           0.974
75%       1.132           0.926           1.287
95%       1.481           1.290           1.904
99%       1.916           1.668           2.492
max       2.804           2.433           3.189</code></pre>
</div>
</div>
</section>
<section id="winsorizing-extreme-values" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="winsorizing-extreme-values"><span class="header-section-number">19.4</span> Winsorizing Extreme Values</h2>
<p>Tobin’s Q values can be heavily influenced by outliers, particularly in emerging markets where data quality may be inconsistent. We winsorize at the 1st and 99th percentiles.</p>
<div id="winsorize" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> winsorize(series, lower<span class="op">=</span><span class="fl">0.01</span>, upper<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Winsorize a pandas Series at specified percentiles."""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    low <span class="op">=</span> series.quantile(lower)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    high <span class="op">=</span> series.quantile(upper)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series.clip(lower<span class="op">=</span>low, upper<span class="op">=</span>high)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorize Q measures</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q_simple"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>]:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    df_clean[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(df_clean[var])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Effect of Winsorization on Simple Tobin's Q:"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Before: mean=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">, "</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  After:  mean=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple_w'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">, "</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple_w'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Effect of Winsorization on Simple Tobin's Q:
  Before: mean=1.031, std=0.243
  After:  mean=1.030, std=0.233</code></pre>
</div>
</div>
</section>
<section id="cross-sectional-distribution-of-tobins-q" class="level2" data-number="19.5">
<h2 data-number="19.5" class="anchored" data-anchor-id="cross-sectional-distribution-of-tobins-q"><span class="header-section-number">19.5</span> Cross-Sectional Distribution of Tobin’s Q</h2>
<div id="cell-fig-tobinq-distribution" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest year distribution</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>latest_year <span class="op">=</span> df_clean[<span class="st">"year"</span>].<span class="bu">max</span>()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>latest_data <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    latest_data[<span class="st">"tobin_q_simple_w"</span>].dropna(),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>], linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Q = 1"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Tobin's Q (Simple)"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of Firms"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="ss">f"Cross-Sectional Distribution (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot by exchange</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>exchange_data <span class="op">=</span> latest_data[[<span class="st">"exchange"</span>, <span class="st">"tobin_q_simple_w"</span>]].dropna()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>exchanges_sorted <span class="op">=</span> exchange_data.groupby(<span class="st">"exchange"</span>)[<span class="st">"tobin_q_simple_w"</span>].median().sort_values().index</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>box_data <span class="op">=</span> [exchange_data[exchange_data[<span class="st">"exchange"</span>] <span class="op">==</span> ex][<span class="st">"tobin_q_simple_w"</span>].values</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ex <span class="kw">in</span> exchanges_sorted]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>bp <span class="op">=</span> axes[<span class="dv">1</span>].boxplot(box_data, labels<span class="op">=</span>exchanges_sorted, patch_artist<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                     medianprops<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>box_colors <span class="op">=</span> [colors[<span class="st">"primary"</span>], colors[<span class="st">"secondary"</span>], colors[<span class="st">"tertiary"</span>]]</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">"boxes"</span>], box_colors):</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    patch.set_facecolor(color)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>], linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Tobin's Q (Simple)"</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="ss">f"Tobin's Q by Exchange (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-tobinq-distribution" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tobinq-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-tobinq-distribution-output-1.png" width="2076" height="727" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tobinq-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.1: Distribution of Tobin’s Q across Vietnamese listed firms (2024). The vertical dashed line at Q=1 indicates the theoretical threshold where market value equals replacement cost.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-evolution-of-tobins-q" class="level2" data-number="19.6">
<h2 data-number="19.6" class="anchored" data-anchor-id="time-series-evolution-of-tobins-q"><span class="header-section-number">19.6</span> Time-Series Evolution of Tobin’s Q</h2>
<div id="cell-fig-tobinq-timeseries" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute annual statistics by exchange</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>annual_q <span class="op">=</span> (</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"exchange"</span>])[<span class="st">"tobin_q_simple_w"</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"median"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>), <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)])</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>annual_q.columns <span class="op">=</span> [<span class="st">"year"</span>, <span class="st">"exchange"</span>, <span class="st">"median"</span>, <span class="st">"q25"</span>, <span class="st">"q75"</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>exchange_colors <span class="op">=</span> {<span class="st">"HOSE"</span>: colors[<span class="st">"primary"</span>], <span class="st">"HNX"</span>: colors[<span class="st">"secondary"</span>],</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"UPCoM"</span>: colors[<span class="st">"tertiary"</span>]}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> exchange_colors.items():</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> annual_q[annual_q[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    ax.plot(data[<span class="st">"year"</span>], data[<span class="st">"median"</span>], color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>exchange, marker<span class="op">=</span><span class="st">"o"</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(data[<span class="st">"year"</span>], data[<span class="st">"q25"</span>], data[<span class="st">"q75"</span>],</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"Q = 1"</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Tobin's Q (Median)"</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Evolution of Tobin's Q in the Vietnamese Market"</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">2008</span>, latest_year)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(mticker.MultipleLocator(<span class="dv">2</span>))</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-tobinq-timeseries" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tobinq-timeseries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-tobinq-timeseries-output-1.png" width="1775" height="877" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tobinq-timeseries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.2: Evolution of median Tobin’s Q across Vietnamese exchanges (2008–2024). Shaded areas represent the interquartile range.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="tobins-q-by-industry" class="level2" data-number="19.7">
<h2 data-number="19.7" class="anchored" data-anchor-id="tobins-q-by-industry"><span class="header-section-number">19.7</span> Tobin’s Q by Industry</h2>
<div id="cell-fig-tobinq-industry" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>latest_industry_q <span class="op">=</span> (</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    latest_data</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"industry"</span>)[<span class="st">"tobin_q_simple_w"</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"median"</span>, <span class="st">"mean"</span>, <span class="st">"count"</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"median"</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>bar_colors <span class="op">=</span> [colors[<span class="st">"quaternary"</span>] <span class="cf">if</span> m <span class="op">&lt;</span> <span class="dv">1</span> <span class="cf">else</span> colors[<span class="st">"primary"</span>]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> m <span class="kw">in</span> latest_industry_q[<span class="st">"median"</span>]]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>ax.barh(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    latest_industry_q[<span class="st">"industry"</span>],</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    latest_industry_q[<span class="st">"median"</span>],</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>bar_colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Median Tobin's Q"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Tobin's Q by Industry (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add count annotations</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(latest_industry_q.iterrows()):</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    ax.text(row[<span class="st">"median"</span>] <span class="op">+</span> <span class="fl">0.02</span>, i, <span class="ss">f'n=</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">"count"</span>])<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-tobinq-industry" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tobinq-industry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-tobinq-industry-output-1.png" width="1474" height="1177" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tobinq-industry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.3: Median Tobin’s Q by industry in Vietnam (latest available year). Industries are sorted by median Q value.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-zscore-computation" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Computing the Altman Z-Score</h1>
<section id="original-z-score-for-listed-firms" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="original-z-score-for-listed-firms"><span class="header-section-number">20.1</span> Original Z-Score for Listed Firms</h2>
<div id="compute-zscore" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_altman_z(df):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute three variants of the Altman Z-Score:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Original Z-Score (for listed manufacturing firms)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Z'-Score (for private firms, using book equity)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Z''-Score (for emerging markets / non-manufacturing)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Common components</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"wc"</span>] <span class="op">=</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)  <span class="co"># Working Capital</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Original Z-Score ---</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z = 3.3*(EBIT/TA) + 0.999*(Sales/TA) + 0.6*(ME/TL) + 1.2*(WC/TA) + 1.4*(RE/TA)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> result[<span class="st">"ebit"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> result[<span class="st">"sale"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    x3 <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    x4 <span class="op">=</span> result[<span class="st">"wc"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    x5 <span class="op">=</span> result[<span class="st">"re_var"</span>].fillna(<span class="dv">0</span>) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x1"</span>] <span class="op">=</span> x1  <span class="co"># Earning power</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x2"</span>] <span class="op">=</span> x2  <span class="co"># Asset turnover</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x3"</span>] <span class="op">=</span> x3  <span class="co"># Leverage (inverse)</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x4"</span>] <span class="op">=</span> x4  <span class="co"># Liquidity</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x5"</span>] <span class="op">=</span> x5  <span class="co"># Cumulative profitability</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z"</span>] <span class="op">=</span> (<span class="fl">3.3</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.999</span> <span class="op">*</span> x2 <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> x3 <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">1.4</span> <span class="op">*</span> x5)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Z'-Score (Private firms) ---</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    x3_prime <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"be"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_prime"</span>] <span class="op">=</span> (</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.717</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">0.847</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">3.107</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.420</span> <span class="op">*</span> x3_prime <span class="op">+</span> <span class="fl">0.998</span> <span class="op">*</span> x2</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Z''-Score (Emerging Markets) ---</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_em"</span>] <span class="op">=</span> (</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        <span class="fl">3.25</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">6.56</span> <span class="op">*</span> x4   <span class="co"># Working Capital / TA</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">3.26</span> <span class="op">*</span> x5   <span class="co"># Retained Earnings / TA</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">6.72</span> <span class="op">*</span> x1   <span class="co"># EBIT / TA</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">1.05</span> <span class="op">*</span> x3_prime  <span class="co"># Book Equity / TL</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Classify risk zones</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z"</span>],</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.80</span>, <span class="fl">2.70</span>, <span class="fl">2.99</span>, np.inf],</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"High Distress"</span>, <span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_em_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z_em"</span>],</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.10</span>, <span class="fl">2.60</span>, np.inf],</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_altman_z(df_clean)</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorize Z-scores</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]:</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    df_clean[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(df_clean[var])</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Z-Score Summary Statistics"</span>)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>z_summary <span class="op">=</span> df_clean[[<span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]].describe().<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>z_summary.columns <span class="op">=</span> [<span class="st">"Original Z"</span>, <span class="st">"Z' (Private)"</span>, <span class="st">"Z'' (Emerging)"</span>]</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z_summary.to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Z-Score Summary Statistics
       Original Z  Z' (Private)  Z'' (Emerging)
count    3484.000      3484.000        3484.000
mean        2.610         2.042           7.467
std         1.896         1.194           3.137
min         0.059         0.155           1.578
25%         1.595         1.314           5.670
50%         2.212         1.806           6.987
75%         3.028         2.410           8.549
max        28.640        11.119          29.686</code></pre>
</div>
</div>
</section>
<section id="z-score-component-analysis" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="z-score-component-analysis"><span class="header-section-number">20.2</span> Z-Score Component Analysis</h2>
<p>Understanding which components drive the Z-Score is particularly informative in the Vietnamese context, where certain ratios may behave differently than in developed markets.</p>
<div id="cell-fig-zscore-components" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">9</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> [</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x1"</span>, <span class="fl">3.3</span>, <span class="st">"$3.3 </span><span class="ch">\\</span><span class="st">times$ EBIT/TA</span><span class="ch">\n</span><span class="st">(Earning Power)"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x2"</span>, <span class="fl">0.999</span>, <span class="st">"$0.999 </span><span class="ch">\\</span><span class="st">times$ Sales/TA</span><span class="ch">\n</span><span class="st">(Asset Turnover)"</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x3"</span>, <span class="fl">0.6</span>, <span class="st">"$0.6 </span><span class="ch">\\</span><span class="st">times$ ME/TL</span><span class="ch">\n</span><span class="st">(Leverage)"</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x4"</span>, <span class="fl">1.2</span>, <span class="st">"$1.2 </span><span class="ch">\\</span><span class="st">times$ WC/TA</span><span class="ch">\n</span><span class="st">(Liquidity)"</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x5"</span>, <span class="fl">1.4</span>, <span class="st">"$1.4 </span><span class="ch">\\</span><span class="st">times$ RE/TA</span><span class="ch">\n</span><span class="st">(Cum. Profitability)"</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>latest_z <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, (var, weight, label) <span class="kw">in</span> <span class="bu">enumerate</span>(components):</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[idx <span class="op">//</span> <span class="dv">3</span>, idx <span class="op">%</span> <span class="dv">3</span>]</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    weighted_vals <span class="op">=</span> (latest_z[var] <span class="op">*</span> weight).dropna()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    weighted_vals <span class="op">=</span> weighted_vals[weighted_vals.between(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        weighted_vals.quantile(<span class="fl">0.01</span>), weighted_vals.quantile(<span class="fl">0.99</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    )]</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    ax.hist(weighted_vals, bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>weighted_vals.median(), color<span class="op">=</span>colors[<span class="st">"quaternary"</span>],</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>               linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>weighted_vals<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    ax.set_title(label, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    ax.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove empty subplot</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="ss">f"Z-Score Component Distributions (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-zscore-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zscore-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-zscore-components-output-1.png" width="2226" height="1381" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zscore-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20.1: Distribution of Altman Z-Score component ratios for Vietnamese listed firms. Each panel shows a component weighted by its coefficient in the original Z-Score formula.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="distribution-of-risk-zones" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="distribution-of-risk-zones"><span class="header-section-number">20.3</span> Distribution of Risk Zones</h2>
<div id="cell-fig-zscore-zones" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Original Z-Score Zones ---</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>zone_counts <span class="op">=</span> (</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"z_zone"</span>])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>zone_pcts <span class="op">=</span> zone_counts.div(zone_counts.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>zone_colors <span class="op">=</span> {</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Safe"</span>: colors[<span class="st">"safe"</span>],</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Grey Zone"</span>: colors[<span class="st">"alert"</span>],</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Distress"</span>: colors[<span class="st">"quaternary"</span>],</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"High Distress"</span>: colors[<span class="st">"distress"</span>],</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].stackplot(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    zone_pcts.index,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>[zone_pcts[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[zone_colors[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Percentage of Firms"</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Original Z-Score Risk Zones"</span>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">"upper right"</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Emerging Market Z''-Score Zones ---</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>em_zone_counts <span class="op">=</span> (</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"z_em_zone"</span>])</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>em_zone_pcts <span class="op">=</span> em_zone_counts.div(em_zone_counts.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>em_zone_colors <span class="op">=</span> {<span class="st">"Safe"</span>: colors[<span class="st">"safe"</span>], <span class="st">"Grey Zone"</span>: colors[<span class="st">"alert"</span>],</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Distress"</span>: colors[<span class="st">"quaternary"</span>]}</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].stackplot(</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    em_zone_pcts.index,</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>[em_zone_pcts[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[em_zone_colors[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Percentage of Firms"</span>)</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Emerging Market Z''-Score Risk Zones"</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">"upper right"</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-zscore-zones" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zscore-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-zscore-zones-output-1.png" width="2076" height="877" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zscore-zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20.2: Proportion of Vietnamese listed firms in each Altman Z-Score risk zone over time. The figure shows both the original Z-Score zones and the emerging market Z’’-Score zones.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="comparing-z-score-variants" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="comparing-z-score-variants"><span class="header-section-number">20.4</span> Comparing Z-Score Variants</h2>
<p>An important practical question is which Z-Score variant is most appropriate for Vietnamese firms. The original model was calibrated on U.S. manufacturing firms, while the Z’’-Score was specifically designed for emerging markets and non-manufacturing sectors.</p>
<div id="cell-fig-zscore-comparison" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest_z.dropna(subset<span class="op">=</span>[<span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em_w"</span>]).sample(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(<span class="dv">500</span>, <span class="bu">len</span>(latest_z)), random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax.scatter(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"altman_z_w"</span>], sample[<span class="st">"altman_z_em_w"</span>],</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"tobin_q_simple_w"</span>], cmap<span class="op">=</span><span class="st">"RdYlGn"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference lines</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">"45° line"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add zone boundaries</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">1.10</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">2.60</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Original Z-Score"</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Emerging Market Z''-Score"</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Z-Score vs Z''-Score for Vietnamese Firms"</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-zscore-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zscore-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-zscore-comparison-output-1.png" width="1136" height="1177" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zscore-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20.3: Comparison of original Z-Score and emerging market Z’‘-Score for Vietnamese listed firms. Points above (below) the 45-degree line have higher Z’’-Scores (Z-Scores) than the other measure.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-age-computation" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Computing Company Age</h1>
<section id="multiple-age-proxies" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="multiple-age-proxies"><span class="header-section-number">21.1</span> Multiple Age Proxies</h2>
<p>For Vietnamese firms, we compute three age measures:</p>
<p><span id="eq-age-founding"><span class="math display">\[
\text{Age}_{\text{founding}} = \text{Current Year} - \text{Founding Year}
\tag{21.1}\]</span></span></p>
<p><span id="eq-age-listing"><span class="math display">\[
\text{Age}_{\text{listing}} = \text{Current Year} - \text{Listing Year}
\tag{21.2}\]</span></span></p>
<p><span id="eq-age-data"><span class="math display">\[
\text{Age}_{\text{data}} = \text{Current Year} - \text{First Year with Data}
\tag{21.3}\]</span></span></p>
<div id="compute-age" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_company_age(df):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute multiple proxies for company age.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For Vietnamese firms:</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - Founding age: based on founding/incorporation date</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">    - Listing age: based on first listing on HOSE/HNX/UPCoM</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">    - Data age: based on first year with available financial data</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Founding age</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_founding"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"founding_year"</span>]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Listing age</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_listing"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"listing_year"</span>]</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_listing"</span>] <span class="op">=</span> result[<span class="st">"age_listing"</span>].clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data age (years since first available financial data)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    first_year <span class="op">=</span> result.groupby(<span class="st">"ticker"</span>)[<span class="st">"year"</span>].transform(<span class="st">"min"</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_data"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> first_year</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log of age (commonly used in regressions)</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"ln_age_founding"</span>] <span class="op">=</span> np.log1p(result[<span class="st">"age_founding"</span>])</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"ln_age_listing"</span>] <span class="op">=</span> np.log1p(result[<span class="st">"age_listing"</span>])</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_company_age(df_clean)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Company Age Summary Statistics"</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>age_summary <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year][</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>]</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>].describe().<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>age_summary.columns <span class="op">=</span> [<span class="st">"Founding Age"</span>, <span class="st">"Listing Age"</span>, <span class="st">"Data Age"</span>]</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(age_summary.to_string())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Company Age Summary Statistics
       Founding Age  Listing Age  Data Age
count         232.0        232.0     232.0
mean           30.1         13.9      12.3
std            11.6          5.8       3.9
min            10.0          5.0       5.0
25%            20.0          9.0       9.0
50%            30.0         13.0      13.0
75%            40.0         19.0      16.0
max            49.0         24.0      16.0</code></pre>
</div>
</div>
</section>
<section id="age-distribution" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="age-distribution"><span class="header-section-number">21.2</span> Age Distribution</h2>
<div id="cell-fig-age-distribution" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>age_vars <span class="op">=</span> [</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_founding"</span>, <span class="st">"Founding Age (years)"</span>, colors[<span class="st">"primary"</span>]),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_listing"</span>, <span class="st">"Listing Age (years)"</span>, colors[<span class="st">"secondary"</span>]),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_data"</span>, <span class="st">"Data Age (years)"</span>, colors[<span class="st">"tertiary"</span>]),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, (var, label, color) <span class="kw">in</span> <span class="bu">zip</span>(axes, age_vars):</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> latest[var].dropna()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    ax.hist(data, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>data.median(), color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>               linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>data<span class="sc">.</span>median()<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(label)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Number of Firms"</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Founding Age"</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Listing Age"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Data Age"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="ss">f"Company Age Distributions (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-age-distribution" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-age-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-age-distribution-output-1.png" width="2226" height="769" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21.1: Distribution of company age measures for Vietnamese listed firms. Founding age reflects true organizational maturity, while listing age captures capital market experience.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="age-and-the-equitization-effect" class="level2" data-number="21.3">
<h2 data-number="21.3" class="anchored" data-anchor-id="age-and-the-equitization-effect"><span class="header-section-number">21.3</span> Age and the Equitization Effect</h2>
<p>A distinctive feature of the Vietnamese market is the equitization of SOEs. Many firms have founding dates that predate the stock market by decades, creating a large gap between founding age and listing age.</p>
<div id="cell-fig-age-gap" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year].copy()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>latest[<span class="st">"soe_flag"</span>] <span class="op">=</span> latest[<span class="st">"state_ownership_pct"</span>] <span class="op">&gt;</span> <span class="dv">30</span>  <span class="co"># SOE proxy</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> soe, label, color, marker <span class="kw">in</span> [</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    (<span class="va">True</span>, <span class="st">"SOE (&gt;30</span><span class="sc">% s</span><span class="st">tate)"</span>, colors[<span class="st">"quaternary"</span>], <span class="st">"s"</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    (<span class="va">False</span>, <span class="st">"Non-SOE"</span>, colors[<span class="st">"primary"</span>], <span class="st">"o"</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> latest[latest[<span class="st">"soe_flag"</span>] <span class="op">==</span> soe]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    ax.scatter(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"age_listing"</span>], subset[<span class="st">"age_founding"</span>],</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">25</span>, marker<span class="op">=</span>marker, label<span class="op">=</span>label, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 45-degree line</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>max_age <span class="op">=</span> <span class="bu">max</span>(latest[<span class="st">"age_founding"</span>].<span class="bu">max</span>(), latest[<span class="st">"age_listing"</span>].<span class="bu">max</span>())</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="dv">0</span>, max_age], [<span class="dv">0</span>, max_age], <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, label<span class="op">=</span><span class="st">"Founding = Listing age"</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Listing Age (years)"</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Founding vs. Listing Age: The Equitization Gap"</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-age-gap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-age-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-age-gap-output-1.png" width="1176" height="1177" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21.2: Relationship between founding age and listing age for Vietnamese firms. The gap reflects years of pre-listing operations, which is especially large for equitized state-owned enterprises.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-joint-analysis" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Joint Analysis: Valuation, Distress, and Maturity</h1>
<section id="the-relationship-between-q-z-score-and-age" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="the-relationship-between-q-z-score-and-age"><span class="header-section-number">22.1</span> The Relationship Between Q, Z-Score, and Age</h2>
<p>These three measures capture different dimensions of a firm’s financial standing, but they are not independent. Theoretically, we expect:</p>
<ul>
<li><strong>Q and Z</strong>: Firms with high growth opportunities (high Q) tend to be financially healthier (high Z), but the relationship is not monotonic, very high Q values may indicate speculative overvaluation.</li>
<li><strong>Q and Age</strong>: Young firms may have higher Q (growth expectations) or lower Q (unproven business model). The relationship depends on the industry life cycle.</li>
<li><strong>Z and Age</strong>: Older firms typically have more stable earnings and higher retained earnings, contributing to higher Z-Scores, though very old firms may face declining competitiveness.</li>
</ul>
<div id="cell-fig-joint-analysis" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">5</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest.dropna(subset<span class="op">=</span>[<span class="st">"tobin_q_simple_w"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"age_founding"</span>])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> sample.sample(<span class="bu">min</span>(<span class="dv">300</span>, <span class="bu">len</span>(sample)), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs Z</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"altman_z_w"</span>], sample[<span class="st">"tobin_q_simple_w"</span>],</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"age_founding"</span>], cmap<span class="op">=</span><span class="st">"viridis"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Altman Z-Score"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Valuation vs. Distress Risk"</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs Age</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"age_founding"</span>], sample[<span class="st">"tobin_q_simple_w"</span>],</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"altman_z_w"</span>], cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Valuation vs. Maturity"</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Z vs Age</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> axes[<span class="dv">2</span>].scatter(</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"age_founding"</span>], sample[<span class="st">"altman_z_w"</span>],</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"tobin_q_simple_w"</span>], cmap<span class="op">=</span><span class="st">"coolwarm"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylabel(<span class="st">"Altman Z-Score"</span>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Distress Risk vs. Maturity"</span>)</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-joint-analysis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-joint-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-joint-analysis-output-1.png" width="2374" height="727" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-joint-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.1: Relationship between Tobin’s Q, Altman Z-Score, and company age for Vietnamese listed firms. Bubble size reflects total assets; color indicates the emerging market Z’’-Score risk zone.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-structure" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="correlation-structure"><span class="header-section-number">22.2</span> Correlation Structure</h2>
<div id="cell-fig-correlation-matrix" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>corr_vars <span class="op">=</span> [</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tobin_q_simple_w"</span>, <span class="st">"mtb_w"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"z_x1"</span>, <span class="st">"z_x2"</span>, <span class="st">"z_x3"</span>, <span class="st">"z_x4"</span>, <span class="st">"z_x5"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>corr_labels <span class="op">=</span> [</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tobin's Q"</span>, <span class="st">"M/B Ratio"</span>, <span class="st">"Z-Score"</span>, <span class="st">"Z'' (EM)"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Age (Found.)"</span>, <span class="st">"Age (List.)"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EBIT/TA"</span>, <span class="st">"Sales/TA"</span>, <span class="st">"ME/TL"</span>, <span class="st">"WC/TA"</span>, <span class="st">"RE/TA"</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> df_clean[corr_vars].corr()</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>corr_matrix.index <span class="op">=</span> corr_labels</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>corr_matrix.columns <span class="op">=</span> corr_labels</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(corr_matrix, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">250</span>, <span class="dv">15</span>, s<span class="op">=</span><span class="dv">75</span>, l<span class="op">=</span><span class="dv">40</span>, n<span class="op">=</span><span class="dv">9</span>, center<span class="op">=</span><span class="st">"light"</span>, as_cmap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    corr_matrix, mask<span class="op">=</span>mask, cmap<span class="op">=</span>cmap, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">9</span>}</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Correlation Matrix of Key Financial Measures"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-correlation-matrix" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-correlation-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-correlation-matrix-output-1.png" width="1660" height="1515" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-correlation-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.2: Correlation matrix of key valuation, distress, and maturity measures for Vietnamese listed firms.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="cross-sectional-regression-analysis" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="cross-sectional-regression-analysis"><span class="header-section-number">22.3</span> Cross-Sectional Regression Analysis</h2>
<p>We estimate a simple cross-sectional model to examine the determinants of Tobin’s Q in the Vietnamese market:</p>
<p><span id="eq-regression-q"><span class="math display">\[
Q_{i,t} = \alpha + \beta_1 \ln(\text{Age}_{i}) + \beta_2 Z''_{i,t} + \beta_3 \text{SOE}_{i} + \beta_4 \ln(\text{TA}_{i,t}) + \varepsilon_{i,t}
\tag{22.1}\]</span></span></p>
<div id="regression-analysis" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.linalg <span class="im">import</span> lstsq</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare regression data</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>reg_data <span class="op">=</span> latest.dropna(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_simple_w"</span>, <span class="st">"ln_age_founding"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"at"</span>]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>).copy()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"ln_at"</span>] <span class="op">=</span> np.log(reg_data[<span class="st">"at"</span>])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"soe_dummy"</span>] <span class="op">=</span> (reg_data[<span class="st">"state_ownership_pct"</span>] <span class="op">&gt;</span> <span class="dv">30</span>).astype(<span class="bu">int</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"constant"</span>] <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS estimation</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> reg_data[<span class="st">"tobin_q_simple_w"</span>].values</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> reg_data[[<span class="st">"constant"</span>, <span class="st">"ln_age_founding"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"soe_dummy"</span>, <span class="st">"ln_at"</span>]].values</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>betas, residuals, rank, sv <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>y_hat <span class="op">=</span> X <span class="op">@</span> betas</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>resid <span class="op">=</span> y <span class="op">-</span> y_hat</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> X.shape</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard errors (heteroskedasticity-robust would be better)</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> (n <span class="op">-</span> k)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>var_beta <span class="op">=</span> sigma2 <span class="op">*</span> np.linalg.inv(X.T <span class="op">@</span> X)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> np.sqrt(np.diag(var_beta))</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>t_stats <span class="op">=</span> betas <span class="op">/</span> se</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>r_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> np.<span class="bu">sum</span>((y <span class="op">-</span> y.mean())<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>adj_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r_squared) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> k <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>var_names <span class="op">=</span> [<span class="st">"Constant"</span>, <span class="st">"ln(Age)"</span>, <span class="st">"Z''-Score (EM)"</span>, <span class="st">"SOE Dummy"</span>, <span class="st">"ln(Total Assets)"</span>]</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Cross-Sectional Regression: Determinants of Tobin's Q"</span>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Dependent Variable: Tobin's Q (Simple, Winsorized)"</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Sample: </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> firms (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="st">'Variable'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Coef'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Std.Err'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;10}</span><span class="ss">"</span>)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, b, s, t <span class="kw">in</span> <span class="bu">zip</span>(var_names, betas, se, t_stats):</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> <span class="st">"***"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">2.576</span> <span class="cf">else</span> <span class="st">"**"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.96</span> <span class="cf">else</span> <span class="st">"*"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.645</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>name<span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span>b<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>s<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss"> </span><span class="sc">{</span>sig<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared: </span><span class="sc">{</span>r_squared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Adjusted R-squared: </span><span class="sc">{</span>adj_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Observations: </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Significance: *** p&lt;0.01, ** p&lt;0.05, * p&lt;0.10"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=================================================================
  Cross-Sectional Regression: Determinants of Tobin's Q
  Dependent Variable: Tobin's Q (Simple, Winsorized)
  Sample: 232 firms (2024)
=================================================================
  Variable                     Coef    Std.Err     t-stat
-----------------------------------------------------------------
  Constant                   0.9686     0.1959     4.94 ***
  ln(Age)                   -0.0064     0.0365    -0.18 
  Z''-Score (EM)             0.0067     0.0050     1.34 
  SOE Dummy                  0.0327     0.0315     1.04 
  ln(Total Assets)           0.0018     0.0096     0.19 
-----------------------------------------------------------------
  R-squared: 0.0126
  Adjusted R-squared: -0.0092
  Observations: 232
=================================================================
  Significance: *** p&lt;0.01, ** p&lt;0.05, * p&lt;0.10</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-pipeline" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> The Complete Pipeline</h1>
<section id="putting-it-all-together" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">23.1</span> Putting It All Together</h2>
<p>Here we provide a single, clean function that takes raw DataCore.vn financial data and produces a complete dataset with all three measures computed.</p>
<div id="complete-pipeline" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_valuation_distress_age(df, firm_profiles<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Complete pipeline to compute Tobin's Q, Altman Z-Score variants,</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and Company Age for Vietnamese listed firms.</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pd.DataFrame</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">        Panel of firm-year financial data with columns:</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">        at, seq, lt, lct, tlb, sale, ebit, ni, re_var, act,</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">        ppent, invt, txdb, itcb, pstk, me, prcc, csho, year, ticker</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">    firm_profiles : pd.DataFrame, optional</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Company profiles with founding_year, listing_year</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Input data augmented with computed measures</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Data Quality Filters ===</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result[result[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result[result[<span class="st">"seq"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Book Value of Equity (Daniel &amp; Titman 1997) ===</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"pref"</span>] <span class="op">=</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"be"</span>] <span class="op">=</span> (</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"seq"</span>]</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"txdb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"itcb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"pref"</span>]</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Market Value of Equity ===</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"me"</span> <span class="kw">not</span> <span class="kw">in</span> result.columns <span class="kw">or</span> result[<span class="st">"me"</span>].isna().<span class="bu">all</span>():</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"me"</span>] <span class="op">=</span> result[<span class="st">"prcc"</span>] <span class="op">*</span> result[<span class="st">"csho"</span>]</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Tobin's Q Variants ===</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple Q (Gompers et al. 2003)</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q"</span>] <span class="op">=</span> (result[<span class="st">"at"</span>] <span class="op">+</span> result[<span class="st">"me"</span>] <span class="op">-</span> result[<span class="st">"be"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chung-Pruitt Q</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    debt_cp <span class="op">=</span> (</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"invt"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> result[<span class="st">"lt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_cp"</span>] <span class="op">=</span> (</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>        (result[<span class="st">"me"</span>] <span class="op">+</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> debt_cp) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market-to-Book</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"mtb"</span>] <span class="op">=</span> np.where(result[<span class="st">"be"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"be"</span>], np.nan)</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Altman Z-Score Variants ===</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"wc"</span>] <span class="op">=</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> result[<span class="st">"ebit"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> result[<span class="st">"sale"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    x3_market <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    x3_book <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"be"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    x4 <span class="op">=</span> result[<span class="st">"wc"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    x5 <span class="op">=</span> result[<span class="st">"re_var"</span>].fillna(<span class="dv">0</span>) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Original Z</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z"</span>] <span class="op">=</span> <span class="fl">3.3</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.999</span> <span class="op">*</span> x2 <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> x3_market <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">1.4</span> <span class="op">*</span> x5</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z' (private firms)</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_prime"</span>] <span class="op">=</span> (</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.717</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">0.847</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">3.107</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.420</span> <span class="op">*</span> x3_book <span class="op">+</span> <span class="fl">0.998</span> <span class="op">*</span> x2</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z'' (emerging markets)</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_em"</span>] <span class="op">=</span> (</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>        <span class="fl">3.25</span> <span class="op">+</span> <span class="fl">6.56</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">3.26</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">6.72</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">1.05</span> <span class="op">*</span> x3_book</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Risk zones</span></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z"</span>],</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.80</span>, <span class="fl">2.70</span>, <span class="fl">2.99</span>, np.inf],</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"High Distress"</span>, <span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_em_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z_em"</span>],</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.10</span>, <span class="fl">2.60</span>, np.inf],</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Company Age ===</span></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> firm_profiles <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> result.merge(</span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>            firm_profiles[[<span class="st">"ticker"</span>, <span class="st">"founding_year"</span>, <span class="st">"listing_year"</span>]],</span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span><span class="st">"ticker"</span>, how<span class="op">=</span><span class="st">"left"</span>, suffixes<span class="op">=</span>(<span class="st">""</span>, <span class="st">"_profile"</span>)</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"age_founding"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"founding_year"</span>]</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"age_listing"</span>] <span class="op">=</span> (result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"listing_year"</span>]).clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>    first_year <span class="op">=</span> result.groupby(<span class="st">"ticker"</span>)[<span class="st">"year"</span>].transform(<span class="st">"min"</span>)</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_data"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> first_year</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Winsorize ===</span></span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]:</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var <span class="kw">in</span> result.columns:</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>            result[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(result[var])</span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate the pipeline</span></span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> compute_valuation_distress_age(df, firm_profiles)</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final dataset: </span><span class="sc">{</span>final_df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> observations, </span><span class="sc">{</span>final_df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> variables"</span>)</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Firms: </span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Key variables computed:"</span>)</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>,</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>            <span class="st">"altman_z_em"</span>, <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>]:</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var <span class="kw">in</span> final_df.columns:</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>        non_null <span class="op">=</span> final_df[var].notna().<span class="bu">sum</span>()</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>non_null<span class="sc">:,}</span><span class="ss"> non-null values"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Final dataset: 3,484 observations, 48 variables
Firms: 297

Key variables computed:
  tobin_q: 3,484 non-null values
  tobin_q_cp: 3,484 non-null values
  mtb: 3,484 non-null values
  altman_z: 3,484 non-null values
  altman_z_prime: 3,484 non-null values
  altman_z_em: 3,484 non-null values
  age_founding: 3,484 non-null values
  age_listing: 3,484 non-null values
  age_data: 3,484 non-null values</code></pre>
</div>
</div>
</section>
<section id="exporting-results" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="exporting-results"><span class="header-section-number">23.2</span> Exporting Results</h2>
<div id="export-results" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select key output variables</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>output_vars <span class="op">=</span> [</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>, <span class="st">"year"</span>, <span class="st">"datadate"</span>, <span class="st">"exchange"</span>, <span class="st">"industry"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"at"</span>, <span class="st">"be"</span>, <span class="st">"me"</span>, <span class="st">"tobin_q"</span>, <span class="st">"tobin_q_w"</span>, <span class="st">"mtb"</span>, <span class="st">"mtb_w"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"altman_z"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"z_zone"</span>, <span class="st">"z_em_zone"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state_ownership_pct"</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>export_cols <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> output_vars <span class="cf">if</span> v <span class="kw">in</span> final_df.columns]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>export_df <span class="op">=</span> final_df[export_cols].copy()</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># export_df.to_csv("vn_valuation_distress_age.csv", index=False)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># export_df.to_parquet("vn_valuation_distress_age.parquet", index=False)</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Export dataset: </span><span class="sc">{</span>export_df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows × </span><span class="sc">{</span>export_df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> columns"</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample output (first 5 rows):"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">"ticker"</span>, <span class="st">"year"</span>, <span class="st">"tobin_q"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_em"</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"z_zone"</span>, <span class="st">"age_founding"</span>]</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> export_df.columns]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(export_df[display_cols].head().to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Export dataset: 3,484 rows × 22 columns

Sample output (first 5 rows):
ticker  year  tobin_q  altman_z  altman_z_em z_zone  age_founding
VN0001  2017 0.905928  3.345941     5.605169   Safe             4
VN0001  2018 1.270114  5.324082     9.228846   Safe             5
VN0001  2019 1.866493  5.478529     6.264178   Safe             6
VN0001  2020 1.016979  5.612289    10.445449   Safe             7
VN0001  2021 0.805818  4.220869     7.588273   Safe             8</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-special-topics" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> Special Topics for the Vietnamese Market</h1>
<section id="state-ownership-and-valuation" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="state-ownership-and-valuation"><span class="header-section-number">24.1</span> State Ownership and Valuation</h2>
<p>State ownership is a defining feature of the Vietnamese corporate landscape. We examine how state ownership affects both Tobin’s Q and financial distress risk.</p>
<div id="cell-fig-soe-analysis" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> final_df[final_df[<span class="st">"year"</span>] <span class="op">==</span> latest_year].dropna(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"state_ownership_pct"</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs State Ownership</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    latest[<span class="st">"state_ownership_pct"</span>], latest[<span class="st">"tobin_q_w"</span>],</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Binned means</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> pd.cut(latest[<span class="st">"state_ownership_pct"</span>], bins<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>binned <span class="op">=</span> latest.groupby(bins)[<span class="st">"tobin_q_w"</span>].mean()</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>bin_centers <span class="op">=</span> [(b.left <span class="op">+</span> b.right) <span class="op">/</span> <span class="dv">2</span> <span class="cf">for</span> b <span class="kw">in</span> binned.index]</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(bin_centers, binned.values, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>],</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">"Binned Mean"</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"State Ownership (%)"</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"State Ownership and Firm Valuation"</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Z''-Score by SOE quartile</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>latest[<span class="st">"soe_quartile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    latest[<span class="st">"state_ownership_pct"</span>],</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="dv">4</span>, labels<span class="op">=</span>[<span class="st">"Q1 (Low)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4 (High)"</span>],</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    duplicates<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>soe_groups <span class="op">=</span> latest.groupby(<span class="st">"soe_quartile"</span>)[<span class="st">"altman_z_em_w"</span>]</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>box_data <span class="op">=</span> [group.values <span class="cf">for</span> name, group <span class="kw">in</span> soe_groups]</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>bp <span class="op">=</span> axes[<span class="dv">1</span>].boxplot(</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    box_data,</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[name <span class="cf">for</span> name, _ <span class="kw">in</span> soe_groups],</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    patch_artist<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    medianprops<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>gradient_colors <span class="op">=</span> plt.cm.Blues(np.linspace(<span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(bp[<span class="st">"boxes"</span>])))</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">"boxes"</span>], gradient_colors):</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    patch.set_facecolor(color)</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="fl">2.60</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Safe threshold"</span>)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="fl">1.10</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Distress threshold"</span>)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"State Ownership Quartile"</span>)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Z''-Score (Emerging Market)"</span>)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Financial Health by State Ownership"</span>)</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-soe-analysis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-soe-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-soe-analysis-output-1.png" width="2075" height="877" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-soe-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24.1: Relationship between state ownership percentage and firm valuation/distress measures. The left panel shows Tobin’s Q against state ownership, with a LOWESS smoother. The right panel shows the Z’’-Score by state ownership quartile.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="exchange-level-analysis" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="exchange-level-analysis"><span class="header-section-number">24.2</span> Exchange-Level Analysis</h2>
<div class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>exchange_summary <span class="op">=</span> (</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    latest</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"exchange"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        n_firms<span class="op">=</span>(<span class="st">"ticker"</span>, <span class="st">"nunique"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        median_q<span class="op">=</span>(<span class="st">"tobin_q_w"</span>, <span class="st">"median"</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        mean_q<span class="op">=</span>(<span class="st">"tobin_q_w"</span>, <span class="st">"mean"</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        median_z<span class="op">=</span>(<span class="st">"altman_z_w"</span>, <span class="st">"median"</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        mean_z_em<span class="op">=</span>(<span class="st">"altman_z_em_w"</span>, <span class="st">"mean"</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        pct_distress_z<span class="op">=</span>(<span class="st">"z_zone"</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">"High Distress"</span>).mean() <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        pct_distress_em<span class="op">=</span>(<span class="st">"z_em_zone"</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">"Distress"</span>).mean() <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">"age_founding"</span>, <span class="st">"median"</span>),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        median_soe<span class="op">=</span>(<span class="st">"state_ownership_pct"</span>, <span class="st">"median"</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>exchange_summary.columns <span class="op">=</span> [</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N Firms"</span>, <span class="st">"Median Q"</span>, <span class="st">"Mean Q"</span>, <span class="st">"Median Z"</span>, <span class="st">"Mean Z'' (EM)"</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Distress (Z)"</span>, <span class="st">"% Distress (Z'')"</span>, <span class="st">"Median Age"</span>, <span class="st">"Median SOE %"</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>exchange_summary.style.set_properties(<span class="op">**</span>{</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-align"</span>: <span class="st">"center"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font-size"</span>: <span class="st">"10pt"</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>}).set_table_styles([</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"th"</span>, <span class="st">"props"</span>: [</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"background-color"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"color"</span>, <span class="st">"white"</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"text-align"</span>, <span class="st">"center"</span>),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"padding"</span>, <span class="st">"8px"</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    ]},</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>]).<span class="bu">format</span>({</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Q"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>, <span class="st">"Mean Q"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Z"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>, <span class="st">"Mean Z'' (EM)"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Distress (Z)"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span>, <span class="st">"% Distress (Z'')"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span>,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Age"</span>: <span class="st">"</span><span class="sc">{:.0f}</span><span class="st">"</span>, <span class="st">"Median SOE %"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-exchange-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="25">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-exchange-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;24.1: Summary statistics by exchange for Vietnamese listed firms (latest year)
</figcaption>
<div aria-describedby="tbl-exchange-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="25">
<style type="text/css">
#T_7e322 th {
  background-color: #1f77b4;
  color: white;
  text-align: center;
  padding: 8px;
}
#T_7e322_row0_col0, #T_7e322_row0_col1, #T_7e322_row0_col2, #T_7e322_row0_col3, #T_7e322_row0_col4, #T_7e322_row0_col5, #T_7e322_row0_col6, #T_7e322_row0_col7, #T_7e322_row0_col8, #T_7e322_row1_col0, #T_7e322_row1_col1, #T_7e322_row1_col2, #T_7e322_row1_col3, #T_7e322_row1_col4, #T_7e322_row1_col5, #T_7e322_row1_col6, #T_7e322_row1_col7, #T_7e322_row1_col8, #T_7e322_row2_col0, #T_7e322_row2_col1, #T_7e322_row2_col2, #T_7e322_row2_col3, #T_7e322_row2_col4, #T_7e322_row2_col5, #T_7e322_row2_col6, #T_7e322_row2_col7, #T_7e322_row2_col8 {
  text-align: center;
  font-size: 10pt;
}
</style>

<table id="T_7e322" class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_7e322_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">N Firms</th>
<th id="T_7e322_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Median Q</th>
<th id="T_7e322_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Mean Q</th>
<th id="T_7e322_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Median Z</th>
<th id="T_7e322_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Mean Z'' (EM)</th>
<th id="T_7e322_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">% Distress (Z)</th>
<th id="T_7e322_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">% Distress (Z'')</th>
<th id="T_7e322_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">Median Age</th>
<th id="T_7e322_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">Median SOE %</th>
</tr>
<tr class="even">
<th class="index_name level0" data-quarto-table-cell-role="th">exchange</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col2" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col3" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col4" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col5" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col6" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col7" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col8" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_7e322_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">HNX</th>
<td id="T_7e322_row0_col0" class="data row0 col0">77</td>
<td id="T_7e322_row0_col1" class="data row0 col1">0.99</td>
<td id="T_7e322_row0_col2" class="data row0 col2">1.02</td>
<td id="T_7e322_row0_col3" class="data row0 col3">2.07</td>
<td id="T_7e322_row0_col4" class="data row0 col4">7.25</td>
<td id="T_7e322_row0_col5" class="data row0 col5">32.5%</td>
<td id="T_7e322_row0_col6" class="data row0 col6">0.0%</td>
<td id="T_7e322_row0_col7" class="data row0 col7">33</td>
<td id="T_7e322_row0_col8" class="data row0 col8">22.1%</td>
</tr>
<tr class="even">
<th id="T_7e322_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">HOSE</th>
<td id="T_7e322_row1_col0" class="data row1 col0">113</td>
<td id="T_7e322_row1_col1" class="data row1 col1">1.00</td>
<td id="T_7e322_row1_col2" class="data row1 col2">1.04</td>
<td id="T_7e322_row1_col3" class="data row1 col3">2.06</td>
<td id="T_7e322_row1_col4" class="data row1 col4">7.24</td>
<td id="T_7e322_row1_col5" class="data row1 col5">40.7%</td>
<td id="T_7e322_row1_col6" class="data row1 col6">0.0%</td>
<td id="T_7e322_row1_col7" class="data row1 col7">29</td>
<td id="T_7e322_row1_col8" class="data row1 col8">26.8%</td>
</tr>
<tr class="odd">
<th id="T_7e322_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">UPCoM</th>
<td id="T_7e322_row2_col0" class="data row2 col0">42</td>
<td id="T_7e322_row2_col1" class="data row2 col1">0.98</td>
<td id="T_7e322_row2_col2" class="data row2 col2">1.05</td>
<td id="T_7e322_row2_col3" class="data row2 col3">2.13</td>
<td id="T_7e322_row2_col4" class="data row2 col4">7.80</td>
<td id="T_7e322_row2_col5" class="data row2 col5">30.9%</td>
<td id="T_7e322_row2_col6" class="data row2 col6">0.0%</td>
<td id="T_7e322_row2_col7" class="data row2 col7">26</td>
<td id="T_7e322_row2_col8" class="data row2 col8">27.6%</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="sector-heatmap-valuation-and-distress" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="sector-heatmap-valuation-and-distress"><span class="header-section-number">24.3</span> Sector Heatmap: Valuation and Distress</h2>
<div id="cell-fig-sector-heatmap" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tobin's Q heatmap</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>q_pivot <span class="op">=</span> (</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    final_df</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"industry"</span>, <span class="st">"year"</span>])[<span class="st">"tobin_q_w"</span>]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    q_pivot, cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>],</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"label"</span>: <span class="st">"Median Q"</span>, <span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span><span class="dv">2</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Tobin's Q by Industry and Year"</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Z''-Score heatmap</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>z_pivot <span class="op">=</span> (</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    final_df</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"industry"</span>, <span class="st">"year"</span>])[<span class="st">"altman_z_em_w"</span>]</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    z_pivot, cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span><span class="fl">2.6</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>],</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"label"</span>: <span class="st">"Median Z''"</span>, <span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span><span class="dv">2</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Z''-Score (EM) by Industry and Year"</span>)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-sector-heatmap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sector-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-sector-heatmap-output-1.png" width="2360" height="1177" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sector-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24.2: Median Tobin’s Q and Z’’-Score by industry and year for Vietnamese listed firms. Warmer colors indicate higher values.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="handling-delisted-firms-survivorship-bias" class="level2" data-number="24.4">
<h2 data-number="24.4" class="anchored" data-anchor-id="handling-delisted-firms-survivorship-bias"><span class="header-section-number">24.4</span> Handling Delisted Firms: Survivorship Bias</h2>
<p>A critical issue in measuring financial distress is survivorship bias. If we only analyze currently listed firms, we miss the very firms that the Z-Score is designed to identify, those that went bankrupt or were delisted.</p>
<div id="survivorship-bias" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate delisting data (replace with DataCore.vn delisting records)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>n_delisted <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>delisted_firms <span class="op">=</span> pd.DataFrame({</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>: [<span class="ss">f"VN</span><span class="sc">{</span><span class="bu">str</span>(i)<span class="sc">.</span>zfill(<span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms <span class="op">+</span> <span class="dv">1</span>, n_firms <span class="op">+</span> n_delisted <span class="op">+</span> <span class="dv">1</span>)],</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delist_year"</span>: np.random.randint(<span class="dv">2010</span>, <span class="dv">2024</span>, n_delisted),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delist_reason"</span>: np.random.choice(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"Bankruptcy/Liquidation"</span>, <span class="st">"Merger/Acquisition"</span>, <span class="st">"Voluntary Delisting"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Regulatory Non-compliance"</span>, <span class="st">"Below Minimum Requirements"</span>],</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        n_delisted,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>[<span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of delisting reasons</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Delisting Reasons Summary"</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>reason_counts <span class="op">=</span> delisted_firms[<span class="st">"delist_reason"</span>].value_counts()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> reason, count <span class="kw">in</span> reason_counts.items():</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>reason<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="op">/</span>n_delisted<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%)"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total delisted: </span><span class="sc">{</span>n_delisted<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Currently listed: </span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Survivorship rate: "</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="op">/</span>(final_df[<span class="st">'ticker'</span>].nunique()<span class="op">+</span>n_delisted)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Delisting Reasons Summary
==================================================
  Merger/Acquisition: 16 (32%)
  Voluntary Delisting: 14 (28%)
  Regulatory Non-compliance: 9 (18%)
  Below Minimum Requirements: 7 (14%)
  Bankruptcy/Liquidation: 4 (8%)

Total delisted: 50
Currently listed: 297

Survivorship rate: 85.6%</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-robustness" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> Robustness Checks and Extensions</h1>
<section id="alternative-tobins-q-specifications" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="alternative-tobins-q-specifications"><span class="header-section-number">25.1</span> Alternative Tobin’s Q Specifications</h2>
<div id="cell-fig-q-variants-comparison" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest.dropna(subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"tobin_q_cp"</span>]).copy()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>sample[<span class="st">"tobin_q_cp_w"</span>] <span class="op">=</span> winsorize(sample[<span class="st">"tobin_q_cp"</span>])</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>ax.scatter(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"tobin_q_w"</span>], sample[<span class="st">"tobin_q_cp_w"</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 45-degree line</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> sample[<span class="st">"tobin_q_w"</span>].corr(sample[<span class="st">"tobin_q_cp_w"</span>])</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="ss">f"Correlation: </span><span class="sc">{</span>corr<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        verticalalignment<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round"</span>, facecolor<span class="op">=</span><span class="st">"wheat"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Simple Q (Gompers et al.)"</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Chung-Pruitt Q"</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Comparison of Tobin's Q Variants"</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-q-variants-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q-variants-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26_valuation_files/figure-html/fig-q-variants-comparison-output-1.png" width="1026" height="1027" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q-variants-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25.1: Comparison of Tobin’s Q variants: Simple Q (Gompers et al.&nbsp;2003) vs.&nbsp;Chung-Pruitt approximation. High correlation supports the use of the simpler measure.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="industry-adjusted-measures" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="industry-adjusted-measures"><span class="header-section-number">25.2</span> Industry-Adjusted Measures</h2>
<p>Raw Tobin’s Q and Z-Scores may reflect industry characteristics rather than firm-specific attributes. We compute industry-adjusted versions:</p>
<p><span id="eq-industry-adj-q"><span class="math display">\[
Q^{\text{adj}}_{i,t} = Q_{i,t} - \overline{Q}_{j(i),t}
\tag{25.1}\]</span></span></p>
<p>where <span class="math inline">\(\overline{Q}_{j(i),t}\)</span> is the median Tobin’s Q of the industry <span class="math inline">\(j\)</span> to which firm <span class="math inline">\(i\)</span> belongs in year <span class="math inline">\(t\)</span>.</p>
<div id="industry-adjusted" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> industry_adjust(df, var, group_var<span class="op">=</span><span class="st">"industry"</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute industry-adjusted measure (deviation from industry median)."""</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    industry_median <span class="op">=</span> df.groupby([<span class="st">"year"</span>, group_var])[var].transform(<span class="st">"median"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[var] <span class="op">-</span> industry_median</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">"tobin_q_adj"</span>] <span class="op">=</span> industry_adjust(final_df, <span class="st">"tobin_q_w"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">"altman_z_em_adj"</span>] <span class="op">=</span> industry_adjust(final_df, <span class="st">"altman_z_em_w"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>latest_adj <span class="op">=</span> final_df[final_df[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Industry-Adjusted Measures (Latest Year)"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Tobin's Q (adjusted): mean=</span><span class="sc">{</span>latest_adj[<span class="st">'tobin_q_adj'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>latest_adj[<span class="st">'tobin_q_adj'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Z''-Score (adjusted): mean=</span><span class="sc">{</span>latest_adj[<span class="st">'altman_z_em_adj'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>latest_adj[<span class="st">'altman_z_em_adj'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Industry-Adjusted Measures (Latest Year)
  Tobin's Q (adjusted): mean=0.0352, std=0.226
  Z''-Score (adjusted): mean=0.4840, std=3.030</code></pre>
</div>
</div>
</section>
<section id="panel-regression-with-fixed-effects" class="level2" data-number="25.3">
<h2 data-number="25.3" class="anchored" data-anchor-id="panel-regression-with-fixed-effects"><span class="header-section-number">25.3</span> Panel Regression with Fixed Effects</h2>
<p>For more rigorous analysis, we estimate a panel model with firm and year fixed effects:</p>
<p><span id="eq-panel-regression"><span class="math display">\[
Q_{i,t} = \alpha_i + \gamma_t + \beta_1 Z''_{i,t} + \beta_2 \ln(\text{Age}_{i,t}) + \beta_3 \text{Size}_{i,t} + \varepsilon_{i,t}
\tag{25.2}\]</span></span></p>
<div id="panel-regression" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplified within-estimator (year and industry demeaning)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> final_df.dropna(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"age_founding"</span>, <span class="st">"at"</span>]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>).copy()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">"ln_at"</span>] <span class="op">=</span> np.log(panel[<span class="st">"at"</span>])</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">"ln_age"</span>] <span class="op">=</span> np.log1p(panel[<span class="st">"age_founding"</span>])</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Demean by year-industry (proxy for fixed effects)</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>fe_vars <span class="op">=</span> [<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"ln_age"</span>, <span class="st">"ln_at"</span>]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> fe_vars:</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    group_mean <span class="op">=</span> panel.groupby([<span class="st">"year"</span>, <span class="st">"industry"</span>])[var].transform(<span class="st">"mean"</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    panel[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_dm"</span>] <span class="op">=</span> panel[var] <span class="op">-</span> group_mean</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS on demeaned data</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> panel[<span class="st">"tobin_q_w_dm"</span>].values</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.column_stack([</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    np.ones(<span class="bu">len</span>(panel)),</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"altman_z_em_w_dm"</span>].values,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"ln_age_dm"</span>].values,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"ln_at_dm"</span>].values,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>betas, _, _, _ <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>y_hat <span class="op">=</span> X <span class="op">@</span> betas</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>resid <span class="op">=</span> y <span class="op">-</span> y_hat</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> X.shape</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> (n <span class="op">-</span> k)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>var_beta <span class="op">=</span> sigma2 <span class="op">*</span> np.linalg.inv(X.T <span class="op">@</span> X)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> np.sqrt(np.diag(var_beta))</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>t_stats <span class="op">=</span> betas <span class="op">/</span> se</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>r_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> np.<span class="bu">sum</span>((y <span class="op">-</span> y.mean())<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>var_names <span class="op">=</span> [<span class="st">"Constant"</span>, <span class="st">"Z''-Score (EM)"</span>, <span class="st">"ln(Age)"</span>, <span class="st">"ln(Total Assets)"</span>]</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel Regression: Tobin's Q with Year-Industry FE"</span>)</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  (Within estimator via year×industry demeaning)"</span>)</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="st">'Variable'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Coef'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Std.Err'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;10}</span><span class="ss">"</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, b, s, t <span class="kw">in</span> <span class="bu">zip</span>(var_names, betas, se, t_stats):</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> <span class="st">"***"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">2.576</span> <span class="cf">else</span> <span class="st">"**"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.96</span> <span class="cf">else</span> <span class="st">"*"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.645</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>name<span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span>b<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>s<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss"> </span><span class="sc">{</span>sig<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared (within): </span><span class="sc">{</span>r_squared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Observations: </span><span class="sc">{</span>n<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=================================================================
  Panel Regression: Tobin's Q with Year-Industry FE
  (Within estimator via year×industry demeaning)
=================================================================
  Variable                     Coef    Std.Err     t-stat
-----------------------------------------------------------------
  Constant                   0.0000     0.0038     0.00 
  Z''-Score (EM)             0.0034     0.0014     2.45 **
  ln(Age)                   -0.0055     0.0063    -0.88 
  ln(Total Assets)          -0.0031     0.0026    -1.16 
-----------------------------------------------------------------
  R-squared (within): 0.0024
  Observations: 3,484
=================================================================</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-limitations" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> Practical Considerations and Limitations</h1>
<section id="known-limitations-of-tobins-q-in-vietnam" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="known-limitations-of-tobins-q-in-vietnam"><span class="header-section-number">26.1</span> Known Limitations of Tobin’s Q in Vietnam</h2>
<p>Several issues affect the reliability of Tobin’s Q estimates for Vietnamese firms:</p>
<ol type="1">
<li><p><strong>Book value as replacement cost proxy</strong>: The simplified Q measure assumes that book value of assets approximates replacement cost. Under VAS’s heavy reliance on historical cost, this assumption may be more problematic than in IFRS-adopting countries, particularly for firms with significant land use rights or long-lived tangible assets.</p></li>
<li><p><strong>Market microstructure effects</strong>: Vietnam’s daily price limits can prevent market prices from reaching equilibrium, potentially distorting the market value component. Foreign ownership limits may create artificial price premiums for certain stocks.</p></li>
<li><p><strong>Preferred stock rarity</strong>: While this simplifies the computation (most Vietnamese firms have no preferred stock), it means the BE calculation is dominated by common equity, which may not capture all ownership claims.</p></li>
<li><p><strong>Cross-listing effects</strong>: Some Vietnamese firms are listed on multiple venues (HOSE, HNX, UPCoM, or even foreign exchanges). Care must be taken to use consistent price and share data.</p></li>
</ol>
</section>
<section id="known-limitations-of-altman-z-score-in-vietnam" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="known-limitations-of-altman-z-score-in-vietnam"><span class="header-section-number">26.2</span> Known Limitations of Altman Z-Score in Vietnam</h2>
<ol type="1">
<li><p><strong>Calibration sample</strong>: The original Z-Score was estimated on mid-20th-century U.S. manufacturing firms. The Z’’-Score for emerging markets is more appropriate but was still estimated on a non-Vietnamese sample.</p></li>
<li><p><strong>Accounting differences</strong>: VAS accounting standards produce financial ratios with different distributional properties than US GAAP or IFRS data, potentially affecting the discriminant function’s classification accuracy.</p></li>
<li><p><strong>Banking and financial firms</strong>: The Z-Score was not designed for financial institutions, which have fundamentally different balance sheet structures. Banks, insurance companies, and securities firms should be excluded or analyzed separately.</p></li>
<li><p><strong>Implicit guarantees</strong>: SOEs and firms connected to major economic groups may have implicit support that reduces actual default risk below Z-Score predictions.</p></li>
</ol>
</section>
<section id="recommendations-for-researchers" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="recommendations-for-researchers"><span class="header-section-number">26.3</span> Recommendations for Researchers</h2>
<p>Based on our analysis, we offer the following recommendations for researchers working with Vietnamese data:</p>
<ol type="1">
<li><strong>Use the Z’’-Score (Emerging Market) variant</strong> as the primary distress measure for Vietnamese non-financial firms.</li>
<li><strong>Report multiple Q variants</strong> (Simple and Chung-Pruitt) to demonstrate robustness.</li>
<li><strong>Winsorize at 1%/99%</strong> to mitigate the impact of data errors and extreme outliers.</li>
<li><strong>Compute industry-adjusted measures</strong> when making cross-sectional comparisons.</li>
<li><strong>Use founding age</strong> rather than listing age when available, but report both to distinguish organizational maturity from capital market experience.</li>
<li><strong>Exclude financial firms</strong> from Z-Score analysis.</li>
<li><strong>Account for state ownership</strong> as a moderating variable in valuation and distress studies.</li>
</ol>
</section>
</section>
<section id="sec-summary" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> Summary</h1>
<p>This chapter presented a treatment of three fundamental corporate finance measures (i.e., Tobin’s Q, the Altman Z-Score, and Company Age). We covered the theoretical foundations of each measure and provided extensive visualizations of cross-sectional and time-series patterns.</p>
<p>Key findings from our analysis of Vietnamese listed firms include:</p>
<ol type="1">
<li><p><strong>Tobin’s Q</strong> varies substantially across industries and exchanges, with technology and consumer-facing sectors typically commanding higher valuations. HOSE-listed firms tend to have higher Q values than HNX or UPCoM firms, reflecting both firm quality differences and liquidity effects.</p></li>
<li><p><strong>The Altman Z-Score</strong> reveals that a meaningful proportion of Vietnamese firms operate in or near the distress zone, though the appropriate variant matters; the emerging market Z’’-Score provides more nuanced classification than the original model. Financial health shows significant time-series variation, with notable deterioration during economic downturns.</p></li>
<li><p><strong>Company age</strong> in Vietnam requires careful treatment due to the equitization of SOEs, which creates large gaps between founding age and listing age. This distinction is substantively important for understanding the relationship between maturity, valuation, and financial stability.</p></li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-altman1968financial" class="csl-entry" role="listitem">
Altman, Edward I. 1968. <span>“Financial Ratios, Discriminant Analysis and the Prediction of Corporate Bankruptcy.”</span> <em>The Journal of Finance</em> 23 (4): 589–609.
</div>
<div id="ref-altman2010corporate" class="csl-entry" role="listitem">
Altman, Edward I, and Edith Hotchkiss. 2010. <em>Corporate Financial Distress and Bankruptcy: Predict and Avoid Bankruptcy, Analyze and Invest in Distressed Debt</em>. Vol. 289. John Wiley &amp; Sons.
</div>
<div id="ref-chung1994simple" class="csl-entry" role="listitem">
Chung, Kee H, and Stephen W Pruitt. 1994. <span>“A Simple Approximation of Tobin’s q.”</span> <em>Financial Management</em>, 70–74.
</div>
<div id="ref-coad2018firm" class="csl-entry" role="listitem">
Coad, Alex, Jacob Rubæk Holm, Jackie Krafft, and Francesco Quatraro. 2018. <span>“Firm Age and Performance.”</span> <em>Journal of Evolutionary Economics</em> 28 (1): 1–11.
</div>
<div id="ref-daniel1997evidence" class="csl-entry" role="listitem">
Daniel, Kent, and Sheridan Titman. 1997. <span>“Evidence on the Characteristics of Cross Sectional Variation in Stock Returns.”</span> <em>The Journal of Finance</em> 52 (1): 1–33.
</div>
<div id="ref-gompers2003corporate" class="csl-entry" role="listitem">
Gompers, Paul, Joy Ishii, and Andrew Metrick. 2003. <span>“Corporate Governance and Equity Prices.”</span> <em>The Quarterly Journal of Economics</em> 118 (1): 107–56.
</div>
<div id="ref-huergo2004firms" class="csl-entry" role="listitem">
Huergo, Elena, and Jordi Jaumandreu. 2004. <span>“Firms’ Age, Process Innovation and Productivity Growth.”</span> <em>International Journal of Industrial Organization</em> 22 (4): 541–59.
</div>
<div id="ref-lindenberg1981tobin" class="csl-entry" role="listitem">
Lindenberg, Eric B, and Stephen A Ross. 1981. <span>“Tobin’s q Ratio and Industrial Organization.”</span> <em>Journal of Business</em>, 1–32.
</div>
<div id="ref-tobin1969general" class="csl-entry" role="listitem">
Tobin, James. 1969. <span>“A General Equilibrium Approach to Monetary Theory.”</span> <em>Journal of Money, Credit and Banking</em> 1 (1): 15–29.
</div>
<div id="ref-vo2015foreign" class="csl-entry" role="listitem">
Vo, Xuan Vinh. 2015. <span>“Foreign Ownership and Stock Return Volatility–Evidence from Vietnam.”</span> <em>Journal of Multinational Financial Management</em> 30: 101–9.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "© " + year;
});
</script>
<script>
(function () {
  const GA_ID = "G-LMDLDJXXSC";   // your real GA4 ID
  const CONSENT_KEY = "cookie_consent_v1";

  function log(msg) {
    console.log("[GA Loader]", msg);
  }

  function loadGtag() {
    if (window.__gtag_loaded__) {
      log("GA already loaded, skipping");
      return;
    }

    log("Loading Google Analytics...");

    window.__gtag_loaded__ = true;

    const script = document.createElement("script");
    script.async = true;
    script.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(GA_ID);

    script.onload = function () {
      log("gtag.js loaded");

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;

      gtag("js", new Date());
      gtag("config", GA_ID, {
        anonymize_ip: true,
        transport_type: "beacon"
      });

      log("GA initialized successfully");
    };

    script.onerror = function () {
      log("FAILED to load gtag.js. Likely blocked by ad blocker or network.");
    };

    document.head.appendChild(script);
  }

  function checkConsentAndLoad() {
    const consent = localStorage.getItem(CONSENT_KEY);
    log("Stored consent value = " + consent);

    if (consent === "accepted") {
      loadGtag();
    } else {
      log("Analytics blocked due to missing or declined consent");
    }
  }

  // Run on page load
  checkConsentAndLoad();

  // Listen for cookie banner decisions
  window.addEventListener("cookie-consent-changed", function (e) {
    log("Consent event received: " + e.detail);
    if (e.detail === "accepted") {
      loadGtag();
    }
  });

})();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/mikenguyen13\/tidy_finance_vn");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./25_pe_ratio.html" class="pagination-link" aria-label="P/E Ratio">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_discounted_cash_flow.html" class="pagination-link" aria-label="Discounted Cash Flow Analysis">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Firm Valuation, Financial Distress, and Company Maturity</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>Understanding firm valuation, financial health, and corporate maturity is fundamental to financial analysis and investment decision-making. Three widely used measures (e.g., Tobin's Q, the Altman Z-Score, and company age) capture distinct but complementary dimensions of a firm's economic standing. Tobin's Q reflects the market's assessment of a firm's value relative to its asset base, the Altman Z-Score predicts the likelihood of financial distress, and company age proxies for organizational maturity and operational stability.</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>While these measures have been extensively studied in developed markets, particularly the United States <span class="co">[</span><span class="ot">see @lindenberg1981tobin; @altman1968financial; @gompers2003corporate</span><span class="co">]</span>, their application in emerging markets like Vietnam presents unique challenges and opportunities. The Vietnamese stock market has grown rapidly but retains structural features, such as ownership concentration, state-owned enterprise dominance, limited bond market depth, and evolving accounting standards, which necessitate careful adaptation of standard valuation and distress metrics.</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Required Packages</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.figsize"</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.size"</span>: <span class="dv">12</span>,</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.titlesize"</span>: <span class="dv">14</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.labelsize"</span>: <span class="dv">12</span>,</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xtick.labelsize"</span>: <span class="dv">10</span>,</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ytick.labelsize"</span>: <span class="dv">10</span>,</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"legend.fontsize"</span>: <span class="dv">10</span>,</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.dpi"</span>: <span class="dv">150</span>,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.top"</span>: <span class="va">False</span>,</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.right"</span>: <span class="va">False</span>,</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Color palette consistent with Tidy Finance style</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"primary"</span>: <span class="st">"#1f77b4"</span>,</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"secondary"</span>: <span class="st">"#ff7f0e"</span>,</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tertiary"</span>: <span class="st">"#2ca02c"</span>,</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quaternary"</span>: <span class="st">"#d62728"</span>,</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quinary"</span>: <span class="st">"#9467bd"</span>,</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"safe"</span>: <span class="st">"#2ca02c"</span>,</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alert"</span>: <span class="st">"#ff7f0e"</span>,</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"danger"</span>: <span class="st">"#d62728"</span>,</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"distress"</span>: <span class="st">"#8b0000"</span>,</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="fu"># Theoretical Foundations {#sec-theory}</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tobin's Q: Market Valuation of the Firm {#sec-tobinq-theory}</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Original Concept</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>Tobin's Q was introduced by @tobin1969general as a theoretical link between financial markets and real investment decisions. The fundamental idea is elegant: if the market values a firm's assets at more than their replacement cost, the firm has an incentive to invest in new capital; if the market values them at less, the firm should not invest, and may even benefit from selling assets.</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>Formally, Tobin's Q is defined as:</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>Q = \frac{\text{Market Value of the Firm}}{\text{Replacement Cost of Assets}}</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>$$ {#eq-tobinq-basic}</span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>When $Q &gt; 1$, the market perceives the firm as possessing valuable intangible assets, such as brand equity, managerial talent, proprietary technology, or growth opportunities, that exceed the cost of its tangible asset base. When $Q &lt; 1$, the market effectively values the firm at less than what it would cost to reassemble its assets, suggesting potential undervaluation or the presence of agency costs and organizational inefficiencies.</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### Market Value Decomposition</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>The numerator of Tobin's Q represents the total market value of all claims on the firm:</span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a>MV = CS + PS + ST + LT</span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>$$ {#eq-mv-decomposition}</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$CS$ = Market value of common stock (shares outstanding $\times$ market price)</span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$PS$ = Market value of preferred stock</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$ST$ = Market value of short-term debt</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$LT$ = Market value of long-term debt</span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a><span class="fu">### Replacement Cost of Assets</span></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>The denominator captures the replacement cost of the firm's asset base:</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a>RC = TA + (RNP - HNP) + (RINV - HINV)</span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>$$ {#eq-replacement-cost}</span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$TA$ = Total assets as reported</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$RNP$ = Replacement cost of net plant and equipment</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$HNP$ = Historical (book) value of net plant and equipment</span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$RINV$ = Replacement cost of inventories</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$HINV$ = Historical (book) value of inventories</span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a>The replacement cost adjustments for plant and equipment involve recursive calculations that account for depreciation rates and, in more detailed estimations, technical progress rates <span class="co">[</span><span class="ot">@lindenberg1981tobin</span><span class="co">]</span>. For inventories, the adjustment depends on the inventory accounting method: LIFO (Last In, First Out), FIFO (First In, First Out), average cost, or retail cost.</span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simplified Tobin's Q</span></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>In practice, the full replacement cost computation requires data that are often unavailable, particularly in emerging markets. @gompers2003corporate popularized a simplified version:</span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>Q_{\text{simple}} = \frac{TA + ME - BE}{TA}</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>$$ {#eq-tobinq-simple}</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a>where $ME$ is the market value of equity and $BE$ is the book value of equity. This formulation assumes that the book values of debt and preferred stock approximate their market values, and that total assets approximate the replacement cost of the firm's asset base. Despite its simplicity, this measure has been shown to correlate well with more elaborate constructions and has become the standard in empirical corporate finance research.</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chung and Pruitt Approximation</span></span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a>@chung1994simple proposed another widely used approximation:</span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>Q_{\text{CP}} = \frac{ME + PS + DEBT}{TA}</span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a>$$ {#eq-tobinq-cp}</span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>where $DEBT = \text{Current Liabilities} - \text{Current Assets} + \text{Book Value of Inventories} + \text{Long-term Debt}$. This formulation captures the net debt position more precisely than the @gompers2003corporate version.</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a><span class="fu">## Altman Z-Score: Predicting Financial Distress {#sec-zscore-theory}</span></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Original Model</span></span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a>The Altman Z-Score, developed by @altman1968financial, is a multivariate discriminant analysis model that predicts the probability of corporate bankruptcy within a two-year horizon. The model was originally estimated using a matched sample of bankrupt and non-bankrupt U.S. manufacturing firms and takes the form:</span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a>Z = 3.3 \cdot X_1 + 0.999 \cdot X_2 + 0.6 \cdot X_3 + 1.2 \cdot X_4 + 1.4 \cdot X_5</span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a>$$ {#eq-zscore-original}</span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a>where the five financial ratios are in @tbl-zscore-components</span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Variable <span class="pp">|</span> Formula <span class="pp">|</span> Interpretation <span class="pp">|</span></span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a><span class="pp">|---------------------|-------------------|--------------------------------|</span></span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $X_1$ <span class="pp">|</span> $\frac{\text{EBIT}}{\text{Total Assets}}$ <span class="pp">|</span> Earning power of assets <span class="pp">|</span></span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $X_2$ <span class="pp">|</span> $\frac{\text{Net Sales}}{\text{Total Assets}}$ <span class="pp">|</span> Total asset turnover <span class="pp">|</span></span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $X_3$ <span class="pp">|</span> $\frac{\text{Market Value of Equity}}{\text{Total Liabilities}}$ <span class="pp">|</span> Leverage ratio (inverse) <span class="pp">|</span></span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $X_4$ <span class="pp">|</span> $\frac{\text{Working Capital}}{\text{Total Assets}}$ <span class="pp">|</span> Short-term liquidity <span class="pp">|</span></span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $X_5$ <span class="pp">|</span> $\frac{\text{Retained Earnings}}{\text{Total Assets}}$ <span class="pp">|</span> Cumulative profitability <span class="pp">|</span></span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>: Components of the Altman Z-Score {#tbl-zscore-components}</span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>The interpretation zones are in @tbl-zscore-zones</span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Z-Score Range <span class="pp">|</span> Interpretation <span class="pp">|</span></span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------------------------------|-------------------------------------|</span></span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $Z &gt; 2.99$ <span class="pp">|</span> Safe zone-low probability of financial distress <span class="pp">|</span></span>
<span id="cb45-150"><a href="#cb45-150" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $2.70 \leq Z \leq 2.99$ <span class="pp">|</span> Grey zone-on alert, moderate risk <span class="pp">|</span></span>
<span id="cb45-151"><a href="#cb45-151" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $1.80 \leq Z &lt; 2.70$ <span class="pp">|</span> Distress zone-significant bankruptcy risk within 2 years <span class="pp">|</span></span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $Z &lt; 1.80$ <span class="pp">|</span> High distress-very high probability of financial failure <span class="pp">|</span></span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a>: Altman Z-Score interpretation zones {#tbl-zscore-zones}</span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Z'-Score Model for Private Firms</span></span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a>Because the original model uses market value of equity in $X_3$, @altman2010corporate developed the Z'-Score for private (non-publicly traded) firms by replacing market capitalization with book value of equity:</span>
<span id="cb45-159"><a href="#cb45-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-160"><a href="#cb45-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-161"><a href="#cb45-161" aria-hidden="true" tabindex="-1"></a>Z' = 0.717 \cdot X_1' + 0.847 \cdot X_2' + 3.107 \cdot X_3' + 0.420 \cdot X_4' + 0.998 \cdot X_5'</span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a>$$ {#eq-zscore-private}</span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-164"><a href="#cb45-164" aria-hidden="true" tabindex="-1"></a>where $X_4' = \frac{\text{Book Value of Equity}}{\text{Total Liabilities}}$, and the remaining variables are defined as in the original model but with re-estimated coefficients.</span>
<span id="cb45-165"><a href="#cb45-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-166"><a href="#cb45-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Z''-Score Model for Emerging Markets</span></span>
<span id="cb45-167"><a href="#cb45-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a>Most relevant for Vietnam, @altman2010corporate also developed the Z''-Score for non-manufacturing and emerging market firms:</span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-171"><a href="#cb45-171" aria-hidden="true" tabindex="-1"></a>Z'' = 3.25 + 6.56 \cdot X_1'' + 3.26 \cdot X_2'' + 6.72 \cdot X_3'' + 1.05 \cdot X_4''</span>
<span id="cb45-172"><a href="#cb45-172" aria-hidden="true" tabindex="-1"></a>$$ {#eq-zscore-emerging}</span>
<span id="cb45-173"><a href="#cb45-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_1'' = \frac{\text{Working Capital}}{\text{Total Assets}}$</span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_2'' = \frac{\text{Retained Earnings}}{\text{Total Assets}}$</span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_3'' = \frac{\text{EBIT}}{\text{Total Assets}}$</span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_4'' = \frac{\text{Book Value of Equity}}{\text{Total Liabilities}}$</span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a>Note that this model drops the sales/total assets ratio ($X_2$ in the original model) to minimize industry effects and adds an intercept. The classification zones shift accordingly (@tbl-zscore-em-zones).</span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Z''-Score Range           <span class="pp">|</span> Interpretation <span class="pp">|</span></span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a><span class="pp">|---------------------------|----------------|</span></span>
<span id="cb45-185"><a href="#cb45-185" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $Z'' &gt; 2.60$              <span class="pp">|</span> Safe zone      <span class="pp">|</span></span>
<span id="cb45-186"><a href="#cb45-186" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $1.10 \leq Z'' \leq 2.60$ <span class="pp">|</span> Grey zone      <span class="pp">|</span></span>
<span id="cb45-187"><a href="#cb45-187" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $Z'' &lt; 1.10$              <span class="pp">|</span> Distress zone  <span class="pp">|</span></span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a>: Z''-Score interpretation zones for emerging markets {#tbl-zscore-em-zones}</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-191"><a href="#cb45-191" aria-hidden="true" tabindex="-1"></a><span class="fu">## Company Age: Measuring Corporate Maturity {#sec-age-theory}</span></span>
<span id="cb45-192"><a href="#cb45-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a>Company age captures the accumulated experience, reputation, and organizational capital of a firm. Older firms typically exhibit more stable operations, established competitive advantages, and predictable cash flow patterns <span class="co">[</span><span class="ot">@coad2018firm</span><span class="co">]</span>. Age is commonly used as a control variable in corporate finance research, and its relationship with performance is theoretically ambiguous: older firms benefit from learning effects and reputation but may suffer from organizational rigidity and declining innovation <span class="co">[</span><span class="ot">@huergo2004firms</span><span class="co">]</span>.</span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-195"><a href="#cb45-195" aria-hidden="true" tabindex="-1"></a>The ideal measure is the number of years since founding. When founding dates are unavailable, common proxies include:</span>
<span id="cb45-196"><a href="#cb45-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Listing age**: Years since the first IPO or listing on a stock exchange.</span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Data age**: Years since the first appearance in financial databases.</span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Incorporation age**: Years since the date of legal incorporation.</span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-201"><a href="#cb45-201" aria-hidden="true" tabindex="-1"></a>In the Vietnamese context, we can use multiple proxies, including the date of first listing on HOSE or HNX, the first available financial statement date, and (when available) the founding date from company profiles.</span>
<span id="cb45-202"><a href="#cb45-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Vietnamese Market Context {#sec-vietnam-context}</span></span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a><span class="fu">## Institutional Features Affecting Valuation Measures</span></span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a>The Vietnamese stock market has several institutional features that are important to consider when computing and interpreting Tobin's Q, Altman Z-Score, and company age.</span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a><span class="fu">### State Ownership and Equitization</span></span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-211"><a href="#cb45-211" aria-hidden="true" tabindex="-1"></a>A significant proportion of Vietnamese listed firms are former state-owned enterprises (SOEs) that underwent equitization (cổ phần hóa). These firms often retain substantial state ownership, which can affect:</span>
<span id="cb45-212"><a href="#cb45-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-213"><a href="#cb45-213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Tobin's Q**: State ownership may depress Q if markets perceive government influence as reducing efficiency, or it may elevate Q if state connections provide preferential access to resources and contracts.</span>
<span id="cb45-214"><a href="#cb45-214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Z-Score**: SOEs may have implicit government guarantees that reduce actual bankruptcy risk below what the Z-Score predicts.</span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Age**: The true operational age of equitized SOEs may far exceed their listing age, creating measurement challenges.</span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a><span class="fu">### Foreign Ownership Limits</span></span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a>Vietnam imposes foreign ownership limits (FOL) on listed companies, typically capped at 49% for most sectors (with some exceptions). This constraint can create price premiums for stocks approaching the FOL ceiling, potentially inflating Tobin's Q for these firms <span class="co">[</span><span class="ot">@vo2015foreign</span><span class="co">]</span>.</span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Accounting Standards</span></span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a>Vietnamese Accounting Standards (VAS) differ from International Financial Reporting Standards (IFRS) in several ways relevant to our measures:</span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-225"><a href="#cb45-225" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Historical cost basis**: VAS relies more heavily on historical cost, which can cause book values to diverge substantially from replacement costs, affecting both Q and Z-Score calculations.</span>
<span id="cb45-226"><a href="#cb45-226" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Limited fair value measurement**: Unlike IFRS, VAS limits fair value measurement for many asset classes, making book-value-based proxies less reliable.</span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Inventory methods**: Vietnamese firms use various inventory valuation methods (FIFO, weighted average), which affect the book value of inventories and hence the Z-Score's working capital component.</span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-229"><a href="#cb45-229" aria-hidden="true" tabindex="-1"></a><span class="fu">### Market Microstructure</span></span>
<span id="cb45-230"><a href="#cb45-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a>Vietnam's market features daily price limits (currently $\pm$ 7% on HOSE, $\pm$ 10% on HNX, $\pm$ 15% on UPCoM), which can prevent prices from reaching equilibrium values quickly. This means that market capitalization at any point may not fully reflect available information, introducing noise into market-value-based measures like Tobin's Q.</span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;!-- ## DataCore.vn Dataset Structure</span></span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-236"><a href="#cb45-236" aria-hidden="true" tabindex="-1"></a><span class="in">DataCore.vn provides comprehensive financial data for Vietnamese listed companies. For this chapter, we assume access to the following datasets:</span></span>
<span id="cb45-237"><a href="#cb45-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-238"><a href="#cb45-238" aria-hidden="true" tabindex="-1"></a><span class="in">1.  **Financial statements** (`financial_statements`): Annual and quarterly balance sheets, income statements, and cash flow statements for all listed firms.</span></span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a><span class="in">2.  **Market data** (`market_data`): Daily stock prices, shares outstanding, and market capitalization.</span></span>
<span id="cb45-240"><a href="#cb45-240" aria-hidden="true" tabindex="-1"></a><span class="in">3.  **Company profiles** (`company_profiles`): Firm characteristics including listing date, founding date, industry classification, exchange, and ownership structure.</span></span>
<span id="cb45-241"><a href="#cb45-241" aria-hidden="true" tabindex="-1"></a><span class="in">4.  **Delisting information** (`delisting_info`): Records of firms that have been delisted, including dates and reasons. --&gt;</span></span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Preparation {#sec-data-prep}</span></span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading and Cleaning Financial Statement Data</span></span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a>We begin by loading the annual financial statement data and constructing the variables needed for our three measures.</span>
<span id="cb45-249"><a href="#cb45-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-data</span></span>
<span id="cb45-254"><a href="#cb45-254" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Simulate Vietnamese financial data (replace with DataCore.vn API calls)"</span></span>
<span id="cb45-255"><a href="#cb45-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-256"><a href="#cb45-256" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice, replace this section with actual DataCore.vn API calls:</span></span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a><span class="co">#   from datacore import DataCoreClient</span></span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a><span class="co">#   client = DataCoreClient(api_key="your_api_key")</span></span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a><span class="co">#   financials = client.get_financial_statements(</span></span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a><span class="co">#       frequency="annual",</span></span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a><span class="co">#       start_date="2005-01-01",</span></span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a><span class="co">#       end_date="2024-12-31"</span></span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb45-266"><a href="#cb45-266" aria-hidden="true" tabindex="-1"></a><span class="co">#   market = client.get_market_data(frequency="daily")</span></span>
<span id="cb45-267"><a href="#cb45-267" aria-hidden="true" tabindex="-1"></a><span class="co">#   profiles = client.get_company_profiles()</span></span>
<span id="cb45-268"><a href="#cb45-268" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration purposes, we simulate realistic Vietnamese market data.</span></span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a>n_firms <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb45-275"><a href="#cb45-275" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2008</span>, <span class="dv">2025</span>)</span>
<span id="cb45-276"><a href="#cb45-276" aria-hidden="true" tabindex="-1"></a>exchanges <span class="op">=</span> [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>]</span>
<span id="cb45-277"><a href="#cb45-277" aria-hidden="true" tabindex="-1"></a>industries <span class="op">=</span> [</span>
<span id="cb45-278"><a href="#cb45-278" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bất động sản"</span>, <span class="st">"Ngân hàng"</span>, <span class="st">"Thực phẩm &amp; Đồ uống"</span>,</span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Xây dựng &amp; Vật liệu"</span>, <span class="st">"Công nghệ thông tin"</span>, <span class="st">"Bán lẻ"</span>,</span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dầu khí"</span>, <span class="st">"Thép"</span>, <span class="st">"Dệt may"</span>, <span class="st">"Dược phẩm"</span>,</span>
<span id="cb45-281"><a href="#cb45-281" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Điện lực"</span>, <span class="st">"Vận tải &amp; Logistics"</span>, <span class="st">"Hóa chất"</span>,</span>
<span id="cb45-282"><a href="#cb45-282" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Chứng khoán"</span>, <span class="st">"Bảo hiểm"</span></span>
<span id="cb45-283"><a href="#cb45-283" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-284"><a href="#cb45-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-285"><a href="#cb45-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate firm profiles</span></span>
<span id="cb45-286"><a href="#cb45-286" aria-hidden="true" tabindex="-1"></a>firm_ids <span class="op">=</span> [<span class="ss">f"VN</span><span class="sc">{</span><span class="bu">str</span>(i)<span class="sc">.</span>zfill(<span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n_firms <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb45-287"><a href="#cb45-287" aria-hidden="true" tabindex="-1"></a>firm_profiles <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-288"><a href="#cb45-288" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>: firm_ids,</span>
<span id="cb45-289"><a href="#cb45-289" aria-hidden="true" tabindex="-1"></a>    <span class="st">"exchange"</span>: np.random.choice(exchanges, n_firms, p<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>]),</span>
<span id="cb45-290"><a href="#cb45-290" aria-hidden="true" tabindex="-1"></a>    <span class="st">"industry"</span>: np.random.choice(industries, n_firms),</span>
<span id="cb45-291"><a href="#cb45-291" aria-hidden="true" tabindex="-1"></a>    <span class="st">"founding_year"</span>: np.random.randint(<span class="dv">1975</span>, <span class="dv">2015</span>, n_firms),</span>
<span id="cb45-292"><a href="#cb45-292" aria-hidden="true" tabindex="-1"></a>    <span class="st">"listing_year"</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">2020</span>, n_firms),</span>
<span id="cb45-293"><a href="#cb45-293" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state_ownership_pct"</span>: np.clip(</span>
<span id="cb45-294"><a href="#cb45-294" aria-hidden="true" tabindex="-1"></a>        np.random.beta(<span class="dv">2</span>, <span class="dv">5</span>, n_firms) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">75</span></span>
<span id="cb45-295"><a href="#cb45-295" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb45-296"><a href="#cb45-296" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-297"><a href="#cb45-297" aria-hidden="true" tabindex="-1"></a>firm_profiles[<span class="st">"listing_year"</span>] <span class="op">=</span> np.maximum(</span>
<span id="cb45-298"><a href="#cb45-298" aria-hidden="true" tabindex="-1"></a>    firm_profiles[<span class="st">"listing_year"</span>],</span>
<span id="cb45-299"><a href="#cb45-299" aria-hidden="true" tabindex="-1"></a>    firm_profiles[<span class="st">"founding_year"</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb45-300"><a href="#cb45-300" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-301"><a href="#cb45-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-302"><a href="#cb45-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate panel data</span></span>
<span id="cb45-303"><a href="#cb45-303" aria-hidden="true" tabindex="-1"></a>records <span class="op">=</span> []</span>
<span id="cb45-304"><a href="#cb45-304" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, firm <span class="kw">in</span> firm_profiles.iterrows():</span>
<span id="cb45-305"><a href="#cb45-305" aria-hidden="true" tabindex="-1"></a>    start_year <span class="op">=</span> <span class="bu">max</span>(firm[<span class="st">"listing_year"</span>], <span class="dv">2008</span>)</span>
<span id="cb45-306"><a href="#cb45-306" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base financial characteristics (firm fixed effects)</span></span>
<span id="cb45-307"><a href="#cb45-307" aria-hidden="true" tabindex="-1"></a>    base_ta <span class="op">=</span> np.exp(np.random.normal(<span class="dv">14</span>, <span class="fl">1.5</span>))  <span class="co"># Total assets in VND millions</span></span>
<span id="cb45-308"><a href="#cb45-308" aria-hidden="true" tabindex="-1"></a>    base_profitability <span class="op">=</span> np.random.normal(<span class="fl">0.08</span>, <span class="fl">0.05</span>)</span>
<span id="cb45-309"><a href="#cb45-309" aria-hidden="true" tabindex="-1"></a>    base_leverage <span class="op">=</span> np.random.beta(<span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb45-310"><a href="#cb45-310" aria-hidden="true" tabindex="-1"></a>    base_turnover <span class="op">=</span> np.random.gamma(<span class="dv">2</span>, <span class="fl">0.4</span>)</span>
<span id="cb45-311"><a href="#cb45-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-312"><a href="#cb45-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb45-313"><a href="#cb45-313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> year <span class="op">&lt;</span> start_year:</span>
<span id="cb45-314"><a href="#cb45-314" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb45-315"><a href="#cb45-315" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> <span class="fl">0.02</span>:  <span class="co"># 2% chance of delisting</span></span>
<span id="cb45-316"><a href="#cb45-316" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb45-317"><a href="#cb45-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-318"><a href="#cb45-318" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Time-varying components with persistence</span></span>
<span id="cb45-319"><a href="#cb45-319" aria-hidden="true" tabindex="-1"></a>        shock <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.15</span>)</span>
<span id="cb45-320"><a href="#cb45-320" aria-hidden="true" tabindex="-1"></a>        growth <span class="op">=</span> np.random.normal(<span class="fl">0.08</span>, <span class="fl">0.05</span>)</span>
<span id="cb45-321"><a href="#cb45-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-322"><a href="#cb45-322" aria-hidden="true" tabindex="-1"></a>        ta <span class="op">=</span> base_ta <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> growth) <span class="op">**</span> (year <span class="op">-</span> start_year) <span class="op">*</span> np.exp(shock)</span>
<span id="cb45-323"><a href="#cb45-323" aria-hidden="true" tabindex="-1"></a>        profitability <span class="op">=</span> np.clip(base_profitability <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.03</span>), <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>)</span>
<span id="cb45-324"><a href="#cb45-324" aria-hidden="true" tabindex="-1"></a>        leverage <span class="op">=</span> np.clip(base_leverage <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="fl">0.05</span>, <span class="fl">0.95</span>)</span>
<span id="cb45-325"><a href="#cb45-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-326"><a href="#cb45-326" aria-hidden="true" tabindex="-1"></a>        lt <span class="op">=</span> ta <span class="op">*</span> leverage <span class="op">*</span> np.random.uniform(<span class="fl">0.4</span>, <span class="fl">0.7</span>)</span>
<span id="cb45-327"><a href="#cb45-327" aria-hidden="true" tabindex="-1"></a>        total_liabilities <span class="op">=</span> ta <span class="op">*</span> leverage</span>
<span id="cb45-328"><a href="#cb45-328" aria-hidden="true" tabindex="-1"></a>        ct_liabilities <span class="op">=</span> total_liabilities <span class="op">-</span> lt</span>
<span id="cb45-329"><a href="#cb45-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-330"><a href="#cb45-330" aria-hidden="true" tabindex="-1"></a>        seq <span class="op">=</span> ta <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> leverage)</span>
<span id="cb45-331"><a href="#cb45-331" aria-hidden="true" tabindex="-1"></a>        sale <span class="op">=</span> ta <span class="op">*</span> np.clip(base_turnover <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.1</span>), <span class="fl">0.1</span>, <span class="dv">5</span>)</span>
<span id="cb45-332"><a href="#cb45-332" aria-hidden="true" tabindex="-1"></a>        ebit <span class="op">=</span> ta <span class="op">*</span> profitability</span>
<span id="cb45-333"><a href="#cb45-333" aria-hidden="true" tabindex="-1"></a>        ni <span class="op">=</span> ebit <span class="op">*</span> np.random.uniform(<span class="fl">0.6</span>, <span class="fl">0.9</span>)</span>
<span id="cb45-334"><a href="#cb45-334" aria-hidden="true" tabindex="-1"></a>        re <span class="op">=</span> seq <span class="op">*</span> np.random.uniform(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.8</span>)</span>
<span id="cb45-335"><a href="#cb45-335" aria-hidden="true" tabindex="-1"></a>        act <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.2</span>, <span class="fl">0.7</span>)</span>
<span id="cb45-336"><a href="#cb45-336" aria-hidden="true" tabindex="-1"></a>        lct <span class="op">=</span> ct_liabilities</span>
<span id="cb45-337"><a href="#cb45-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-338"><a href="#cb45-338" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Market value with noise and sentiment</span></span>
<span id="cb45-339"><a href="#cb45-339" aria-hidden="true" tabindex="-1"></a>        market_premium <span class="op">=</span> np.random.lognormal(<span class="dv">0</span>, <span class="fl">0.4</span>)</span>
<span id="cb45-340"><a href="#cb45-340" aria-hidden="true" tabindex="-1"></a>        me <span class="op">=</span> seq <span class="op">*</span> market_premium</span>
<span id="cb45-341"><a href="#cb45-341" aria-hidden="true" tabindex="-1"></a>        prcc <span class="op">=</span> me <span class="op">/</span> <span class="bu">max</span>(np.random.uniform(<span class="dv">50</span>, <span class="dv">500</span>), <span class="dv">1</span>)</span>
<span id="cb45-342"><a href="#cb45-342" aria-hidden="true" tabindex="-1"></a>        csho <span class="op">=</span> me <span class="op">/</span> <span class="bu">max</span>(prcc, <span class="fl">0.01</span>)</span>
<span id="cb45-343"><a href="#cb45-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-344"><a href="#cb45-344" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Preferred stock (rare in Vietnam, mostly zero)</span></span>
<span id="cb45-345"><a href="#cb45-345" aria-hidden="true" tabindex="-1"></a>        pstk <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> np.random.random() <span class="op">&gt;</span> <span class="fl">0.05</span> <span class="cf">else</span> seq <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb45-346"><a href="#cb45-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-347"><a href="#cb45-347" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Net plant and equipment</span></span>
<span id="cb45-348"><a href="#cb45-348" aria-hidden="true" tabindex="-1"></a>        ppent <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.1</span>, <span class="fl">0.6</span>)</span>
<span id="cb45-349"><a href="#cb45-349" aria-hidden="true" tabindex="-1"></a>        invt <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="fl">0.05</span>, <span class="fl">0.3</span>)</span>
<span id="cb45-350"><a href="#cb45-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-351"><a href="#cb45-351" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Deferred taxes and investment tax credit (typically small in VN)</span></span>
<span id="cb45-352"><a href="#cb45-352" aria-hidden="true" tabindex="-1"></a>        txdb <span class="op">=</span> ta <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb45-353"><a href="#cb45-353" aria-hidden="true" tabindex="-1"></a>        itcb <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb45-354"><a href="#cb45-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-355"><a href="#cb45-355" aria-hidden="true" tabindex="-1"></a>        records.append({</span>
<span id="cb45-356"><a href="#cb45-356" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ticker"</span>: firm[<span class="st">"ticker"</span>],</span>
<span id="cb45-357"><a href="#cb45-357" aria-hidden="true" tabindex="-1"></a>            <span class="st">"year"</span>: year,</span>
<span id="cb45-358"><a href="#cb45-358" aria-hidden="true" tabindex="-1"></a>            <span class="st">"datadate"</span>: pd.Timestamp(year, <span class="dv">12</span>, <span class="dv">31</span>),</span>
<span id="cb45-359"><a href="#cb45-359" aria-hidden="true" tabindex="-1"></a>            <span class="st">"at"</span>: ta,            <span class="co"># Total Assets</span></span>
<span id="cb45-360"><a href="#cb45-360" aria-hidden="true" tabindex="-1"></a>            <span class="st">"seq"</span>: seq,          <span class="co"># Stockholders' Equity</span></span>
<span id="cb45-361"><a href="#cb45-361" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lt"</span>: lt,            <span class="co"># Long-term Debt</span></span>
<span id="cb45-362"><a href="#cb45-362" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lct"</span>: lct,          <span class="co"># Current Liabilities</span></span>
<span id="cb45-363"><a href="#cb45-363" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tlb"</span>: total_liabilities,  <span class="co"># Total Liabilities</span></span>
<span id="cb45-364"><a href="#cb45-364" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sale"</span>: sale,        <span class="co"># Net Sales/Revenue</span></span>
<span id="cb45-365"><a href="#cb45-365" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ebit"</span>: ebit,        <span class="co"># EBIT</span></span>
<span id="cb45-366"><a href="#cb45-366" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ni"</span>: ni,            <span class="co"># Net Income</span></span>
<span id="cb45-367"><a href="#cb45-367" aria-hidden="true" tabindex="-1"></a>            <span class="st">"re_var"</span>: re,        <span class="co"># Retained Earnings</span></span>
<span id="cb45-368"><a href="#cb45-368" aria-hidden="true" tabindex="-1"></a>            <span class="st">"act"</span>: act,          <span class="co"># Current Assets</span></span>
<span id="cb45-369"><a href="#cb45-369" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ppent"</span>: ppent,      <span class="co"># Net Plant &amp; Equipment</span></span>
<span id="cb45-370"><a href="#cb45-370" aria-hidden="true" tabindex="-1"></a>            <span class="st">"invt"</span>: invt,        <span class="co"># Inventories</span></span>
<span id="cb45-371"><a href="#cb45-371" aria-hidden="true" tabindex="-1"></a>            <span class="st">"txdb"</span>: txdb,        <span class="co"># Deferred Taxes</span></span>
<span id="cb45-372"><a href="#cb45-372" aria-hidden="true" tabindex="-1"></a>            <span class="st">"itcb"</span>: itcb,        <span class="co"># Investment Tax Credit</span></span>
<span id="cb45-373"><a href="#cb45-373" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pstk"</span>: pstk,        <span class="co"># Preferred Stock</span></span>
<span id="cb45-374"><a href="#cb45-374" aria-hidden="true" tabindex="-1"></a>            <span class="st">"me"</span>: me,            <span class="co"># Market Value of Equity</span></span>
<span id="cb45-375"><a href="#cb45-375" aria-hidden="true" tabindex="-1"></a>            <span class="st">"prcc"</span>: prcc,        <span class="co"># Price at Calendar Year End</span></span>
<span id="cb45-376"><a href="#cb45-376" aria-hidden="true" tabindex="-1"></a>            <span class="st">"csho"</span>: csho,        <span class="co"># Shares Outstanding</span></span>
<span id="cb45-377"><a href="#cb45-377" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb45-378"><a href="#cb45-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-379"><a href="#cb45-379" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb45-380"><a href="#cb45-380" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(firm_profiles[[<span class="st">"ticker"</span>, <span class="st">"exchange"</span>, <span class="st">"industry"</span>,</span>
<span id="cb45-381"><a href="#cb45-381" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"founding_year"</span>, <span class="st">"listing_year"</span>,</span>
<span id="cb45-382"><a href="#cb45-382" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"state_ownership_pct"</span>]],</span>
<span id="cb45-383"><a href="#cb45-383" aria-hidden="true" tabindex="-1"></a>              on<span class="op">=</span><span class="st">"ticker"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb45-384"><a href="#cb45-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-385"><a href="#cb45-385" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Panel dimensions: </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-year observations"</span>)</span>
<span id="cb45-386"><a href="#cb45-386" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of unique firms: </span><span class="sc">{</span>df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-387"><a href="#cb45-387" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Year range: </span><span class="sc">{</span>df[<span class="st">'year'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">–</span><span class="sc">{</span>df[<span class="st">'year'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-388"><a href="#cb45-388" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Exchanges: </span><span class="sc">{</span>df[<span class="st">'exchange'</span>]<span class="sc">.</span>value_counts()<span class="sc">.</span>to_dict()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-389"><a href="#cb45-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-390"><a href="#cb45-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-391"><a href="#cb45-391" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variable Definitions and Mapping</span></span>
<span id="cb45-392"><a href="#cb45-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-393"><a href="#cb45-393" aria-hidden="true" tabindex="-1"></a>@tbl-variable-mapping provides the mapping between standard variable names and the corresponding fields.</span>
<span id="cb45-394"><a href="#cb45-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-397"><a href="#cb45-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-398"><a href="#cb45-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-variable-mapping</span></span>
<span id="cb45-399"><a href="#cb45-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Variable mapping"</span></span>
<span id="cb45-400"><a href="#cb45-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-401"><a href="#cb45-401" aria-hidden="true" tabindex="-1"></a>variable_map <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-402"><a href="#cb45-402" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Compustat Variable"</span>: [</span>
<span id="cb45-403"><a href="#cb45-403" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AT"</span>, <span class="st">"SEQ"</span>, <span class="st">"LT"</span>, <span class="st">"LCT"</span>, <span class="st">"SALE"</span>, <span class="st">"EBIT"</span>, <span class="st">"NI"</span>,</span>
<span id="cb45-404"><a href="#cb45-404" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RE"</span>, <span class="st">"ACT"</span>, <span class="st">"PPENT"</span>, <span class="st">"INVT"</span>, <span class="st">"TXDB"</span>, <span class="st">"ITCB"</span>,</span>
<span id="cb45-405"><a href="#cb45-405" aria-hidden="true" tabindex="-1"></a>        <span class="st">"PSTK/PSTKRV/PSTKL"</span>, <span class="st">"PRCC_C"</span>, <span class="st">"CSHO"</span>, <span class="st">"DLDTE"</span>, <span class="st">"DLRSN"</span></span>
<span id="cb45-406"><a href="#cb45-406" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb45-407"><a href="#cb45-407" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Description"</span>: [</span>
<span id="cb45-408"><a href="#cb45-408" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total Assets"</span>, <span class="st">"Stockholders' Equity"</span>, <span class="st">"Long-term Debt"</span>,</span>
<span id="cb45-409"><a href="#cb45-409" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Current Liabilities"</span>, <span class="st">"Net Sales/Revenue"</span>,</span>
<span id="cb45-410"><a href="#cb45-410" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Earnings Before Interest &amp; Taxes"</span>, <span class="st">"Net Income"</span>,</span>
<span id="cb45-411"><a href="#cb45-411" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Retained Earnings"</span>, <span class="st">"Current Assets"</span>,</span>
<span id="cb45-412"><a href="#cb45-412" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Net Plant &amp; Equipment"</span>, <span class="st">"Total Inventories"</span>,</span>
<span id="cb45-413"><a href="#cb45-413" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Deferred Taxes"</span>, <span class="st">"Investment Tax Credit"</span>,</span>
<span id="cb45-414"><a href="#cb45-414" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Preferred Stock (various)"</span>, <span class="st">"Price Close (Calendar Year)"</span>,</span>
<span id="cb45-415"><a href="#cb45-415" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Common Shares Outstanding"</span>, <span class="st">"Delisting Date"</span>,</span>
<span id="cb45-416"><a href="#cb45-416" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Delisting Reason"</span></span>
<span id="cb45-417"><a href="#cb45-417" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb45-418"><a href="#cb45-418" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DataCore.vn Equivalent"</span>: [</span>
<span id="cb45-419"><a href="#cb45-419" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tong_tai_san"</span>, <span class="st">"von_chu_so_huu"</span>, <span class="st">"no_dai_han"</span>,</span>
<span id="cb45-420"><a href="#cb45-420" aria-hidden="true" tabindex="-1"></a>        <span class="st">"no_ngan_han"</span>, <span class="st">"doanh_thu_thuan"</span>,</span>
<span id="cb45-421"><a href="#cb45-421" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loi_nhuan_truoc_thue_va_lai_vay"</span>, <span class="st">"loi_nhuan_sau_thue"</span>,</span>
<span id="cb45-422"><a href="#cb45-422" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loi_nhuan_chua_phan_phoi"</span>, <span class="st">"tai_san_ngan_han"</span>,</span>
<span id="cb45-423"><a href="#cb45-423" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tai_san_co_dinh_huu_hinh"</span>, <span class="st">"hang_ton_kho"</span>,</span>
<span id="cb45-424"><a href="#cb45-424" aria-hidden="true" tabindex="-1"></a>        <span class="st">"thue_thu_nhap_hoan_lai"</span>, <span class="st">"N/A (not applicable in VAS)"</span>,</span>
<span id="cb45-425"><a href="#cb45-425" aria-hidden="true" tabindex="-1"></a>        <span class="st">"co_phieu_uu_dai"</span>, <span class="st">"gia_dong_cua_cuoi_nam"</span>,</span>
<span id="cb45-426"><a href="#cb45-426" aria-hidden="true" tabindex="-1"></a>        <span class="st">"so_luong_co_phieu_luu_hanh"</span>, <span class="st">"ngay_huy_niem_yet"</span>,</span>
<span id="cb45-427"><a href="#cb45-427" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ly_do_huy_niem_yet"</span></span>
<span id="cb45-428"><a href="#cb45-428" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb45-429"><a href="#cb45-429" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VAS Account"</span>: [</span>
<span id="cb45-430"><a href="#cb45-430" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.100"</span>, <span class="st">"BS.400"</span>, <span class="st">"BS.330"</span>, <span class="st">"BS.310"</span>,</span>
<span id="cb45-431"><a href="#cb45-431" aria-hidden="true" tabindex="-1"></a>        <span class="st">"IS.10"</span>, <span class="st">"Computed"</span>, <span class="st">"IS.60"</span>,</span>
<span id="cb45-432"><a href="#cb45-432" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.421"</span>, <span class="st">"BS.100"</span>, <span class="st">"BS.221"</span>, <span class="st">"BS.141"</span>,</span>
<span id="cb45-433"><a href="#cb45-433" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BS.262"</span>, <span class="st">"—"</span>, <span class="st">"BS.411b"</span>, <span class="st">"Market"</span>, <span class="st">"Market"</span>,</span>
<span id="cb45-434"><a href="#cb45-434" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Profile"</span>, <span class="st">"Profile"</span></span>
<span id="cb45-435"><a href="#cb45-435" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb45-436"><a href="#cb45-436" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-437"><a href="#cb45-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-438"><a href="#cb45-438" aria-hidden="true" tabindex="-1"></a>variable_map.style.set_properties(<span class="op">**</span>{</span>
<span id="cb45-439"><a href="#cb45-439" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-align"</span>: <span class="st">"left"</span>,</span>
<span id="cb45-440"><a href="#cb45-440" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font-size"</span>: <span class="st">"10pt"</span></span>
<span id="cb45-441"><a href="#cb45-441" aria-hidden="true" tabindex="-1"></a>}).set_table_styles([</span>
<span id="cb45-442"><a href="#cb45-442" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"th"</span>, <span class="st">"props"</span>: [</span>
<span id="cb45-443"><a href="#cb45-443" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"background-color"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb45-444"><a href="#cb45-444" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"color"</span>, <span class="st">"white"</span>),</span>
<span id="cb45-445"><a href="#cb45-445" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"font-weight"</span>, <span class="st">"bold"</span>),</span>
<span id="cb45-446"><a href="#cb45-446" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"text-align"</span>, <span class="st">"left"</span>),</span>
<span id="cb45-447"><a href="#cb45-447" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"padding"</span>, <span class="st">"8px"</span>)</span>
<span id="cb45-448"><a href="#cb45-448" aria-hidden="true" tabindex="-1"></a>    ]},</span>
<span id="cb45-449"><a href="#cb45-449" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"td"</span>, <span class="st">"props"</span>: [(<span class="st">"padding"</span>, <span class="st">"6px"</span>)]},</span>
<span id="cb45-450"><a href="#cb45-450" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb45-451"><a href="#cb45-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-452"><a href="#cb45-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-453"><a href="#cb45-453" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Quality Checks</span></span>
<span id="cb45-454"><a href="#cb45-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-455"><a href="#cb45-455" aria-hidden="true" tabindex="-1"></a>Before computing any measures, we perform essential data quality checks that are particularly important for Vietnamese data.</span>
<span id="cb45-456"><a href="#cb45-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-459"><a href="#cb45-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-460"><a href="#cb45-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-quality-checks</span></span>
<span id="cb45-461"><a href="#cb45-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Data quality validation"</span></span>
<span id="cb45-462"><a href="#cb45-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-463"><a href="#cb45-463" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data_quality_report(df):</span>
<span id="cb45-464"><a href="#cb45-464" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate a comprehensive data quality report."""</span></span>
<span id="cb45-465"><a href="#cb45-465" aria-hidden="true" tabindex="-1"></a>    report <span class="op">=</span> {}</span>
<span id="cb45-466"><a href="#cb45-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-467"><a href="#cb45-467" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for negative total assets</span></span>
<span id="cb45-468"><a href="#cb45-468" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Negative total assets"</span>] <span class="op">=</span> (df[<span class="st">"at"</span>] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb45-469"><a href="#cb45-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-470"><a href="#cb45-470" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for negative equity (acceptable but noteworthy)</span></span>
<span id="cb45-471"><a href="#cb45-471" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Negative equity"</span>] <span class="op">=</span> (df[<span class="st">"seq"</span>] <span class="op">&lt;=</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb45-472"><a href="#cb45-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-473"><a href="#cb45-473" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for missing critical variables</span></span>
<span id="cb45-474"><a href="#cb45-474" aria-hidden="true" tabindex="-1"></a>    critical_vars <span class="op">=</span> [<span class="st">"at"</span>, <span class="st">"seq"</span>, <span class="st">"sale"</span>, <span class="st">"ebit"</span>, <span class="st">"me"</span>]</span>
<span id="cb45-475"><a href="#cb45-475" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> critical_vars:</span>
<span id="cb45-476"><a href="#cb45-476" aria-hidden="true" tabindex="-1"></a>        report[<span class="ss">f"Missing </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> df[var].isna().<span class="bu">sum</span>()</span>
<span id="cb45-477"><a href="#cb45-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-478"><a href="#cb45-478" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for extreme values (potential data errors)</span></span>
<span id="cb45-479"><a href="#cb45-479" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Extreme leverage (&gt;100%)"</span>] <span class="op">=</span> (df[<span class="st">"tlb"</span>] <span class="op">/</span> df[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="fl">1.0</span>).<span class="bu">sum</span>()</span>
<span id="cb45-480"><a href="#cb45-480" aria-hidden="true" tabindex="-1"></a>    report[<span class="st">"Extreme sales/assets (&gt;10)"</span>] <span class="op">=</span> (df[<span class="st">"sale"</span>] <span class="op">/</span> df[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">10</span>).<span class="bu">sum</span>()</span>
<span id="cb45-481"><a href="#cb45-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-482"><a href="#cb45-482" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.Series(report, name<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb45-483"><a href="#cb45-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-484"><a href="#cb45-484" aria-hidden="true" tabindex="-1"></a>quality <span class="op">=</span> data_quality_report(df)</span>
<span id="cb45-485"><a href="#cb45-485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data Quality Report"</span>)</span>
<span id="cb45-486"><a href="#cb45-486" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">45</span>)</span>
<span id="cb45-487"><a href="#cb45-487" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item, count <span class="kw">in</span> quality.items():</span>
<span id="cb45-488"><a href="#cb45-488" aria-hidden="true" tabindex="-1"></a>    status <span class="op">=</span> <span class="st">"✓"</span> <span class="cf">if</span> count <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"⚠"</span></span>
<span id="cb45-489"><a href="#cb45-489" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb45-490"><a href="#cb45-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-491"><a href="#cb45-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply filters</span></span>
<span id="cb45-492"><a href="#cb45-492" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df.copy()</span>
<span id="cb45-493"><a href="#cb45-493" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_clean[df_clean[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]  <span class="co"># Positive total assets</span></span>
<span id="cb45-494"><a href="#cb45-494" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_clean[df_clean[<span class="st">"seq"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]  <span class="co"># Positive equity (for BE calculation)</span></span>
<span id="cb45-495"><a href="#cb45-495" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Observations after cleaning: </span><span class="sc">{</span><span class="bu">len</span>(df_clean)<span class="sc">:,}</span><span class="ss"> "</span></span>
<span id="cb45-496"><a href="#cb45-496" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(dropped </span><span class="sc">{</span><span class="bu">len</span>(df) <span class="op">-</span> <span class="bu">len</span>(df_clean)<span class="sc">:,}</span><span class="ss">)"</span>)</span>
<span id="cb45-497"><a href="#cb45-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-498"><a href="#cb45-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-499"><a href="#cb45-499" aria-hidden="true" tabindex="-1"></a><span class="fu"># Computing Tobin's Q {#sec-tobinq-computation}</span></span>
<span id="cb45-500"><a href="#cb45-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-501"><a href="#cb45-501" aria-hidden="true" tabindex="-1"></a><span class="fu">## Book Value of Equity</span></span>
<span id="cb45-502"><a href="#cb45-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-503"><a href="#cb45-503" aria-hidden="true" tabindex="-1"></a>Following @daniel1997evidence, we compute the book value of equity as:</span>
<span id="cb45-504"><a href="#cb45-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-505"><a href="#cb45-505" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-506"><a href="#cb45-506" aria-hidden="true" tabindex="-1"></a>BE = SEQ + TXDB + ITCB - PREF</span>
<span id="cb45-507"><a href="#cb45-507" aria-hidden="true" tabindex="-1"></a>$$ {#eq-book-equity}</span>
<span id="cb45-508"><a href="#cb45-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-509"><a href="#cb45-509" aria-hidden="true" tabindex="-1"></a>where $PREF$ is the preferred stock value, using the redemption value if available, otherwise the liquidating value, and finally the carrying value as a last resort. In the Vietnamese context, preferred stock is relatively rare among listed companies, so $PREF$ is often zero.</span>
<span id="cb45-510"><a href="#cb45-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-513"><a href="#cb45-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-514"><a href="#cb45-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-book-equity</span></span>
<span id="cb45-515"><a href="#cb45-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Book value of equity computation"</span></span>
<span id="cb45-516"><a href="#cb45-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-517"><a href="#cb45-517" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_book_equity(df):</span>
<span id="cb45-518"><a href="#cb45-518" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-519"><a href="#cb45-519" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute book value of equity following Daniel and Titman (1997).</span></span>
<span id="cb45-520"><a href="#cb45-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-521"><a href="#cb45-521" aria-hidden="true" tabindex="-1"></a><span class="co">    In Vietnam, preferred stock is uncommon among listed firms.</span></span>
<span id="cb45-522"><a href="#cb45-522" aria-hidden="true" tabindex="-1"></a><span class="co">    The investment tax credit (ITCB) is not applicable under VAS,</span></span>
<span id="cb45-523"><a href="#cb45-523" aria-hidden="true" tabindex="-1"></a><span class="co">    so we set it to zero when missing.</span></span>
<span id="cb45-524"><a href="#cb45-524" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-525"><a href="#cb45-525" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb45-526"><a href="#cb45-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-527"><a href="#cb45-527" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Preferred stock: use coalesce logic</span></span>
<span id="cb45-528"><a href="#cb45-528" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"pref"</span>] <span class="op">=</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-529"><a href="#cb45-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-530"><a href="#cb45-530" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Book equity = Shareholders' equity + Deferred taxes + ITC - Preferred</span></span>
<span id="cb45-531"><a href="#cb45-531" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"be"</span>] <span class="op">=</span> (</span>
<span id="cb45-532"><a href="#cb45-532" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"seq"</span>]</span>
<span id="cb45-533"><a href="#cb45-533" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"txdb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-534"><a href="#cb45-534" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"itcb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-535"><a href="#cb45-535" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"pref"</span>]</span>
<span id="cb45-536"><a href="#cb45-536" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-537"><a href="#cb45-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-538"><a href="#cb45-538" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb45-539"><a href="#cb45-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-540"><a href="#cb45-540" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_book_equity(df_clean)</span>
<span id="cb45-541"><a href="#cb45-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-542"><a href="#cb45-542" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Book Equity Summary Statistics (VND millions)"</span>)</span>
<span id="cb45-543"><a href="#cb45-543" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clean[<span class="st">"be"</span>].describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>))</span>
<span id="cb45-544"><a href="#cb45-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-545"><a href="#cb45-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-546"><a href="#cb45-546" aria-hidden="true" tabindex="-1"></a><span class="fu">## Market Value of Equity</span></span>
<span id="cb45-547"><a href="#cb45-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-548"><a href="#cb45-548" aria-hidden="true" tabindex="-1"></a>The market value of equity is computed using the calendar year-end stock price and shares outstanding:</span>
<span id="cb45-549"><a href="#cb45-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-550"><a href="#cb45-550" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-551"><a href="#cb45-551" aria-hidden="true" tabindex="-1"></a>ME = P_{\text{close}} \times \text{CSHO}</span>
<span id="cb45-552"><a href="#cb45-552" aria-hidden="true" tabindex="-1"></a>$$ {#eq-market-equity}</span>
<span id="cb45-553"><a href="#cb45-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-554"><a href="#cb45-554" aria-hidden="true" tabindex="-1"></a>For Vietnamese firms, this is obtained from the closing price on the last trading day of the fiscal year. Most Vietnamese firms have a December 31 fiscal year end, though some (particularly in agriculture and banking) may differ.</span>
<span id="cb45-555"><a href="#cb45-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-558"><a href="#cb45-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-559"><a href="#cb45-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-market-equity</span></span>
<span id="cb45-560"><a href="#cb45-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Market value of equity computation"</span></span>
<span id="cb45-561"><a href="#cb45-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-562"><a href="#cb45-562" aria-hidden="true" tabindex="-1"></a><span class="co"># ME is already computed in our simulated data as prcc * csho</span></span>
<span id="cb45-563"><a href="#cb45-563" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice with DataCore.vn:</span></span>
<span id="cb45-564"><a href="#cb45-564" aria-hidden="true" tabindex="-1"></a><span class="co">#   me = df["gia_dong_cua_cuoi_nam"] * df["so_luong_co_phieu_luu_hanh"]</span></span>
<span id="cb45-565"><a href="#cb45-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-566"><a href="#cb45-566" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">"me"</span>] <span class="op">=</span> df_clean[<span class="st">"prcc"</span>] <span class="op">*</span> df_clean[<span class="st">"csho"</span>]</span>
<span id="cb45-567"><a href="#cb45-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-568"><a href="#cb45-568" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Market Equity Summary Statistics (VND millions)"</span>)</span>
<span id="cb45-569"><a href="#cb45-569" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clean[<span class="st">"me"</span>].describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>))</span>
<span id="cb45-570"><a href="#cb45-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-571"><a href="#cb45-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-572"><a href="#cb45-572" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simplified Tobin's Q</span></span>
<span id="cb45-573"><a href="#cb45-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-574"><a href="#cb45-574" aria-hidden="true" tabindex="-1"></a>We implement the @gompers2003corporate simplified version:</span>
<span id="cb45-575"><a href="#cb45-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-576"><a href="#cb45-576" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-577"><a href="#cb45-577" aria-hidden="true" tabindex="-1"></a>Q_{\text{simple}} = \frac{AT + ME - BE}{AT}</span>
<span id="cb45-578"><a href="#cb45-578" aria-hidden="true" tabindex="-1"></a>$$ {#eq-tobinq-implementation}</span>
<span id="cb45-579"><a href="#cb45-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-580"><a href="#cb45-580" aria-hidden="true" tabindex="-1"></a>This can be rewritten as:</span>
<span id="cb45-581"><a href="#cb45-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-582"><a href="#cb45-582" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-583"><a href="#cb45-583" aria-hidden="true" tabindex="-1"></a>Q_{\text{simple}} = 1 + \frac{ME - BE}{AT}</span>
<span id="cb45-584"><a href="#cb45-584" aria-hidden="true" tabindex="-1"></a>$$ {#eq-tobinq-rewritten}</span>
<span id="cb45-585"><a href="#cb45-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-586"><a href="#cb45-586" aria-hidden="true" tabindex="-1"></a>which makes the interpretation clear: Tobin's Q equals one plus the market-to-book premium (or discount) scaled by total assets.</span>
<span id="cb45-587"><a href="#cb45-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-590"><a href="#cb45-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-591"><a href="#cb45-591" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-tobinq</span></span>
<span id="cb45-592"><a href="#cb45-592" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Tobin's Q computation with multiple variants"</span></span>
<span id="cb45-593"><a href="#cb45-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-594"><a href="#cb45-594" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_tobins_q(df):</span>
<span id="cb45-595"><a href="#cb45-595" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-596"><a href="#cb45-596" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute multiple variants of Tobin's Q.</span></span>
<span id="cb45-597"><a href="#cb45-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-598"><a href="#cb45-598" aria-hidden="true" tabindex="-1"></a><span class="co">    Variants:</span></span>
<span id="cb45-599"><a href="#cb45-599" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Simple Q (Gompers et al., 2003)</span></span>
<span id="cb45-600"><a href="#cb45-600" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Chung-Pruitt Q</span></span>
<span id="cb45-601"><a href="#cb45-601" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Market-to-Book ratio (for comparison)</span></span>
<span id="cb45-602"><a href="#cb45-602" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-603"><a href="#cb45-603" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb45-604"><a href="#cb45-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-605"><a href="#cb45-605" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Variant 1: Simple Q (Gompers, Ishii, Metrick 2003) ---</span></span>
<span id="cb45-606"><a href="#cb45-606" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_simple"</span>] <span class="op">=</span> (result[<span class="st">"at"</span>] <span class="op">+</span> result[<span class="st">"me"</span>] <span class="op">-</span> result[<span class="st">"be"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-607"><a href="#cb45-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-608"><a href="#cb45-608" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Variant 2: Chung-Pruitt Approximation ---</span></span>
<span id="cb45-609"><a href="#cb45-609" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DEBT = Current Liabilities - Current Assets + Inventories + LT Debt</span></span>
<span id="cb45-610"><a href="#cb45-610" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"debt_cp"</span>] <span class="op">=</span> (</span>
<span id="cb45-611"><a href="#cb45-611" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-612"><a href="#cb45-612" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-613"><a href="#cb45-613" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"invt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-614"><a href="#cb45-614" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"lt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-615"><a href="#cb45-615" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-616"><a href="#cb45-616" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_cp"</span>] <span class="op">=</span> (</span>
<span id="cb45-617"><a href="#cb45-617" aria-hidden="true" tabindex="-1"></a>        (result[<span class="st">"me"</span>] <span class="op">+</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> result[<span class="st">"debt_cp"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-618"><a href="#cb45-618" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-619"><a href="#cb45-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-620"><a href="#cb45-620" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Market-to-Book Ratio ---</span></span>
<span id="cb45-621"><a href="#cb45-621" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"mtb"</span>] <span class="op">=</span> np.where(result[<span class="st">"be"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"be"</span>], np.nan)</span>
<span id="cb45-622"><a href="#cb45-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-623"><a href="#cb45-623" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb45-624"><a href="#cb45-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-625"><a href="#cb45-625" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_tobins_q(df_clean)</span>
<span id="cb45-626"><a href="#cb45-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-627"><a href="#cb45-627" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb45-628"><a href="#cb45-628" aria-hidden="true" tabindex="-1"></a>q_vars <span class="op">=</span> [<span class="st">"tobin_q_simple"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>]</span>
<span id="cb45-629"><a href="#cb45-629" aria-hidden="true" tabindex="-1"></a>q_summary <span class="op">=</span> df_clean[q_vars].describe(percentiles<span class="op">=</span>[<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>])</span>
<span id="cb45-630"><a href="#cb45-630" aria-hidden="true" tabindex="-1"></a>q_summary <span class="op">=</span> q_summary.<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb45-631"><a href="#cb45-631" aria-hidden="true" tabindex="-1"></a>q_summary.columns <span class="op">=</span> [<span class="st">"Simple Q"</span>, <span class="st">"Chung-Pruitt Q"</span>, <span class="st">"Market-to-Book"</span>]</span>
<span id="cb45-632"><a href="#cb45-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-633"><a href="#cb45-633" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tobin's Q Summary Statistics"</span>)</span>
<span id="cb45-634"><a href="#cb45-634" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q_summary.to_string())</span>
<span id="cb45-635"><a href="#cb45-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-636"><a href="#cb45-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-637"><a href="#cb45-637" aria-hidden="true" tabindex="-1"></a><span class="fu">## Winsorizing Extreme Values</span></span>
<span id="cb45-638"><a href="#cb45-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-639"><a href="#cb45-639" aria-hidden="true" tabindex="-1"></a>Tobin's Q values can be heavily influenced by outliers, particularly in emerging markets where data quality may be inconsistent. We winsorize at the 1st and 99th percentiles.</span>
<span id="cb45-640"><a href="#cb45-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-643"><a href="#cb45-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-644"><a href="#cb45-644" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: winsorize</span></span>
<span id="cb45-645"><a href="#cb45-645" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Winsorization of extreme values"</span></span>
<span id="cb45-646"><a href="#cb45-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-647"><a href="#cb45-647" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> winsorize(series, lower<span class="op">=</span><span class="fl">0.01</span>, upper<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb45-648"><a href="#cb45-648" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Winsorize a pandas Series at specified percentiles."""</span></span>
<span id="cb45-649"><a href="#cb45-649" aria-hidden="true" tabindex="-1"></a>    low <span class="op">=</span> series.quantile(lower)</span>
<span id="cb45-650"><a href="#cb45-650" aria-hidden="true" tabindex="-1"></a>    high <span class="op">=</span> series.quantile(upper)</span>
<span id="cb45-651"><a href="#cb45-651" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series.clip(lower<span class="op">=</span>low, upper<span class="op">=</span>high)</span>
<span id="cb45-652"><a href="#cb45-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-653"><a href="#cb45-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorize Q measures</span></span>
<span id="cb45-654"><a href="#cb45-654" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q_simple"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>]:</span>
<span id="cb45-655"><a href="#cb45-655" aria-hidden="true" tabindex="-1"></a>    df_clean[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(df_clean[var])</span>
<span id="cb45-656"><a href="#cb45-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-657"><a href="#cb45-657" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Effect of Winsorization on Simple Tobin's Q:"</span>)</span>
<span id="cb45-658"><a href="#cb45-658" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Before: mean=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">, "</span></span>
<span id="cb45-659"><a href="#cb45-659" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb45-660"><a href="#cb45-660" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  After:  mean=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple_w'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">, "</span></span>
<span id="cb45-661"><a href="#cb45-661" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>df_clean[<span class="st">'tobin_q_simple_w'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb45-662"><a href="#cb45-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-663"><a href="#cb45-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-664"><a href="#cb45-664" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cross-Sectional Distribution of Tobin's Q</span></span>
<span id="cb45-665"><a href="#cb45-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-668"><a href="#cb45-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-669"><a href="#cb45-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tobinq-distribution</span></span>
<span id="cb45-670"><a href="#cb45-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of Tobin's Q across Vietnamese listed firms (2024). The vertical dashed line at Q=1 indicates the theoretical threshold where market value equals replacement cost."</span></span>
<span id="cb45-671"><a href="#cb45-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-672"><a href="#cb45-672" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb45-673"><a href="#cb45-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-674"><a href="#cb45-674" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest year distribution</span></span>
<span id="cb45-675"><a href="#cb45-675" aria-hidden="true" tabindex="-1"></a>latest_year <span class="op">=</span> df_clean[<span class="st">"year"</span>].<span class="bu">max</span>()</span>
<span id="cb45-676"><a href="#cb45-676" aria-hidden="true" tabindex="-1"></a>latest_data <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb45-677"><a href="#cb45-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-678"><a href="#cb45-678" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram</span></span>
<span id="cb45-679"><a href="#cb45-679" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(</span>
<span id="cb45-680"><a href="#cb45-680" aria-hidden="true" tabindex="-1"></a>    latest_data[<span class="st">"tobin_q_simple_w"</span>].dropna(),</span>
<span id="cb45-681"><a href="#cb45-681" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb45-682"><a href="#cb45-682" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-683"><a href="#cb45-683" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>], linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Q = 1"</span>)</span>
<span id="cb45-684"><a href="#cb45-684" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Tobin's Q (Simple)"</span>)</span>
<span id="cb45-685"><a href="#cb45-685" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of Firms"</span>)</span>
<span id="cb45-686"><a href="#cb45-686" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="ss">f"Cross-Sectional Distribution (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb45-687"><a href="#cb45-687" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb45-688"><a href="#cb45-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-689"><a href="#cb45-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot by exchange</span></span>
<span id="cb45-690"><a href="#cb45-690" aria-hidden="true" tabindex="-1"></a>exchange_data <span class="op">=</span> latest_data[[<span class="st">"exchange"</span>, <span class="st">"tobin_q_simple_w"</span>]].dropna()</span>
<span id="cb45-691"><a href="#cb45-691" aria-hidden="true" tabindex="-1"></a>exchanges_sorted <span class="op">=</span> exchange_data.groupby(<span class="st">"exchange"</span>)[<span class="st">"tobin_q_simple_w"</span>].median().sort_values().index</span>
<span id="cb45-692"><a href="#cb45-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-693"><a href="#cb45-693" aria-hidden="true" tabindex="-1"></a>box_data <span class="op">=</span> [exchange_data[exchange_data[<span class="st">"exchange"</span>] <span class="op">==</span> ex][<span class="st">"tobin_q_simple_w"</span>].values</span>
<span id="cb45-694"><a href="#cb45-694" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ex <span class="kw">in</span> exchanges_sorted]</span>
<span id="cb45-695"><a href="#cb45-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-696"><a href="#cb45-696" aria-hidden="true" tabindex="-1"></a>bp <span class="op">=</span> axes[<span class="dv">1</span>].boxplot(box_data, labels<span class="op">=</span>exchanges_sorted, patch_artist<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-697"><a href="#cb45-697" aria-hidden="true" tabindex="-1"></a>                     medianprops<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb45-698"><a href="#cb45-698" aria-hidden="true" tabindex="-1"></a>box_colors <span class="op">=</span> [colors[<span class="st">"primary"</span>], colors[<span class="st">"secondary"</span>], colors[<span class="st">"tertiary"</span>]]</span>
<span id="cb45-699"><a href="#cb45-699" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">"boxes"</span>], box_colors):</span>
<span id="cb45-700"><a href="#cb45-700" aria-hidden="true" tabindex="-1"></a>    patch.set_facecolor(color)</span>
<span id="cb45-701"><a href="#cb45-701" aria-hidden="true" tabindex="-1"></a>    patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb45-702"><a href="#cb45-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-703"><a href="#cb45-703" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>], linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb45-704"><a href="#cb45-704" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Tobin's Q (Simple)"</span>)</span>
<span id="cb45-705"><a href="#cb45-705" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="ss">f"Tobin's Q by Exchange (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb45-706"><a href="#cb45-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-707"><a href="#cb45-707" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-708"><a href="#cb45-708" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-709"><a href="#cb45-709" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-710"><a href="#cb45-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-711"><a href="#cb45-711" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time-Series Evolution of Tobin's Q</span></span>
<span id="cb45-712"><a href="#cb45-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-715"><a href="#cb45-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-716"><a href="#cb45-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tobinq-timeseries</span></span>
<span id="cb45-717"><a href="#cb45-717" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Evolution of median Tobin's Q across Vietnamese exchanges (2008–2024). Shaded areas represent the interquartile range."</span></span>
<span id="cb45-718"><a href="#cb45-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-719"><a href="#cb45-719" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute annual statistics by exchange</span></span>
<span id="cb45-720"><a href="#cb45-720" aria-hidden="true" tabindex="-1"></a>annual_q <span class="op">=</span> (</span>
<span id="cb45-721"><a href="#cb45-721" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb45-722"><a href="#cb45-722" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"exchange"</span>])[<span class="st">"tobin_q_simple_w"</span>]</span>
<span id="cb45-723"><a href="#cb45-723" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"median"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>), <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)])</span>
<span id="cb45-724"><a href="#cb45-724" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb45-725"><a href="#cb45-725" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-726"><a href="#cb45-726" aria-hidden="true" tabindex="-1"></a>annual_q.columns <span class="op">=</span> [<span class="st">"year"</span>, <span class="st">"exchange"</span>, <span class="st">"median"</span>, <span class="st">"q25"</span>, <span class="st">"q75"</span>]</span>
<span id="cb45-727"><a href="#cb45-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-728"><a href="#cb45-728" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb45-729"><a href="#cb45-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-730"><a href="#cb45-730" aria-hidden="true" tabindex="-1"></a>exchange_colors <span class="op">=</span> {<span class="st">"HOSE"</span>: colors[<span class="st">"primary"</span>], <span class="st">"HNX"</span>: colors[<span class="st">"secondary"</span>],</span>
<span id="cb45-731"><a href="#cb45-731" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"UPCoM"</span>: colors[<span class="st">"tertiary"</span>]}</span>
<span id="cb45-732"><a href="#cb45-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-733"><a href="#cb45-733" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> exchange_colors.items():</span>
<span id="cb45-734"><a href="#cb45-734" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> annual_q[annual_q[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb45-735"><a href="#cb45-735" aria-hidden="true" tabindex="-1"></a>    ax.plot(data[<span class="st">"year"</span>], data[<span class="st">"median"</span>], color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb45-736"><a href="#cb45-736" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>exchange, marker<span class="op">=</span><span class="st">"o"</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb45-737"><a href="#cb45-737" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(data[<span class="st">"year"</span>], data[<span class="st">"q25"</span>], data[<span class="st">"q75"</span>],</span>
<span id="cb45-738"><a href="#cb45-738" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb45-739"><a href="#cb45-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-740"><a href="#cb45-740" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"Q = 1"</span>)</span>
<span id="cb45-741"><a href="#cb45-741" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb45-742"><a href="#cb45-742" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Tobin's Q (Median)"</span>)</span>
<span id="cb45-743"><a href="#cb45-743" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Evolution of Tobin's Q in the Vietnamese Market"</span>)</span>
<span id="cb45-744"><a href="#cb45-744" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb45-745"><a href="#cb45-745" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">2008</span>, latest_year)</span>
<span id="cb45-746"><a href="#cb45-746" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(mticker.MultipleLocator(<span class="dv">2</span>))</span>
<span id="cb45-747"><a href="#cb45-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-748"><a href="#cb45-748" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-749"><a href="#cb45-749" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-750"><a href="#cb45-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-751"><a href="#cb45-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-752"><a href="#cb45-752" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tobin's Q by Industry</span></span>
<span id="cb45-753"><a href="#cb45-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-756"><a href="#cb45-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-757"><a href="#cb45-757" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tobinq-industry</span></span>
<span id="cb45-758"><a href="#cb45-758" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Median Tobin's Q by industry in Vietnam (latest available year). Industries are sorted by median Q value."</span></span>
<span id="cb45-759"><a href="#cb45-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-760"><a href="#cb45-760" aria-hidden="true" tabindex="-1"></a>latest_industry_q <span class="op">=</span> (</span>
<span id="cb45-761"><a href="#cb45-761" aria-hidden="true" tabindex="-1"></a>    latest_data</span>
<span id="cb45-762"><a href="#cb45-762" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"industry"</span>)[<span class="st">"tobin_q_simple_w"</span>]</span>
<span id="cb45-763"><a href="#cb45-763" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"median"</span>, <span class="st">"mean"</span>, <span class="st">"count"</span>])</span>
<span id="cb45-764"><a href="#cb45-764" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb45-765"><a href="#cb45-765" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"median"</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-766"><a href="#cb45-766" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-767"><a href="#cb45-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-768"><a href="#cb45-768" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb45-769"><a href="#cb45-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-770"><a href="#cb45-770" aria-hidden="true" tabindex="-1"></a>bar_colors <span class="op">=</span> [colors[<span class="st">"quaternary"</span>] <span class="cf">if</span> m <span class="op">&lt;</span> <span class="dv">1</span> <span class="cf">else</span> colors[<span class="st">"primary"</span>]</span>
<span id="cb45-771"><a href="#cb45-771" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> m <span class="kw">in</span> latest_industry_q[<span class="st">"median"</span>]]</span>
<span id="cb45-772"><a href="#cb45-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-773"><a href="#cb45-773" aria-hidden="true" tabindex="-1"></a>ax.barh(</span>
<span id="cb45-774"><a href="#cb45-774" aria-hidden="true" tabindex="-1"></a>    latest_industry_q[<span class="st">"industry"</span>],</span>
<span id="cb45-775"><a href="#cb45-775" aria-hidden="true" tabindex="-1"></a>    latest_industry_q[<span class="st">"median"</span>],</span>
<span id="cb45-776"><a href="#cb45-776" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>bar_colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb45-777"><a href="#cb45-777" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-778"><a href="#cb45-778" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb45-779"><a href="#cb45-779" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Median Tobin's Q"</span>)</span>
<span id="cb45-780"><a href="#cb45-780" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Tobin's Q by Industry (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb45-781"><a href="#cb45-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-782"><a href="#cb45-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Add count annotations</span></span>
<span id="cb45-783"><a href="#cb45-783" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(latest_industry_q.iterrows()):</span>
<span id="cb45-784"><a href="#cb45-784" aria-hidden="true" tabindex="-1"></a>    ax.text(row[<span class="st">"median"</span>] <span class="op">+</span> <span class="fl">0.02</span>, i, <span class="ss">f'n=</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">"count"</span>])<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb45-785"><a href="#cb45-785" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb45-786"><a href="#cb45-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-787"><a href="#cb45-787" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-788"><a href="#cb45-788" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-789"><a href="#cb45-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-790"><a href="#cb45-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-791"><a href="#cb45-791" aria-hidden="true" tabindex="-1"></a><span class="fu"># Computing the Altman Z-Score {#sec-zscore-computation}</span></span>
<span id="cb45-792"><a href="#cb45-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-793"><a href="#cb45-793" aria-hidden="true" tabindex="-1"></a><span class="fu">## Original Z-Score for Listed Firms</span></span>
<span id="cb45-794"><a href="#cb45-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-797"><a href="#cb45-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-798"><a href="#cb45-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-zscore</span></span>
<span id="cb45-799"><a href="#cb45-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Altman Z-Score computation (all three variants)"</span></span>
<span id="cb45-800"><a href="#cb45-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-801"><a href="#cb45-801" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_altman_z(df):</span>
<span id="cb45-802"><a href="#cb45-802" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-803"><a href="#cb45-803" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute three variants of the Altman Z-Score:</span></span>
<span id="cb45-804"><a href="#cb45-804" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Original Z-Score (for listed manufacturing firms)</span></span>
<span id="cb45-805"><a href="#cb45-805" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Z'-Score (for private firms, using book equity)</span></span>
<span id="cb45-806"><a href="#cb45-806" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Z''-Score (for emerging markets / non-manufacturing)</span></span>
<span id="cb45-807"><a href="#cb45-807" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-808"><a href="#cb45-808" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb45-809"><a href="#cb45-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-810"><a href="#cb45-810" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Common components</span></span>
<span id="cb45-811"><a href="#cb45-811" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"wc"</span>] <span class="op">=</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)  <span class="co"># Working Capital</span></span>
<span id="cb45-812"><a href="#cb45-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-813"><a href="#cb45-813" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Original Z-Score ---</span></span>
<span id="cb45-814"><a href="#cb45-814" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z = 3.3*(EBIT/TA) + 0.999*(Sales/TA) + 0.6*(ME/TL) + 1.2*(WC/TA) + 1.4*(RE/TA)</span></span>
<span id="cb45-815"><a href="#cb45-815" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> result[<span class="st">"ebit"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-816"><a href="#cb45-816" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> result[<span class="st">"sale"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-817"><a href="#cb45-817" aria-hidden="true" tabindex="-1"></a>    x3 <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb45-818"><a href="#cb45-818" aria-hidden="true" tabindex="-1"></a>    x4 <span class="op">=</span> result[<span class="st">"wc"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-819"><a href="#cb45-819" aria-hidden="true" tabindex="-1"></a>    x5 <span class="op">=</span> result[<span class="st">"re_var"</span>].fillna(<span class="dv">0</span>) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-820"><a href="#cb45-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-821"><a href="#cb45-821" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x1"</span>] <span class="op">=</span> x1  <span class="co"># Earning power</span></span>
<span id="cb45-822"><a href="#cb45-822" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x2"</span>] <span class="op">=</span> x2  <span class="co"># Asset turnover</span></span>
<span id="cb45-823"><a href="#cb45-823" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x3"</span>] <span class="op">=</span> x3  <span class="co"># Leverage (inverse)</span></span>
<span id="cb45-824"><a href="#cb45-824" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x4"</span>] <span class="op">=</span> x4  <span class="co"># Liquidity</span></span>
<span id="cb45-825"><a href="#cb45-825" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_x5"</span>] <span class="op">=</span> x5  <span class="co"># Cumulative profitability</span></span>
<span id="cb45-826"><a href="#cb45-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-827"><a href="#cb45-827" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z"</span>] <span class="op">=</span> (<span class="fl">3.3</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.999</span> <span class="op">*</span> x2 <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> x3 <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">1.4</span> <span class="op">*</span> x5)</span>
<span id="cb45-828"><a href="#cb45-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-829"><a href="#cb45-829" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Z'-Score (Private firms) ---</span></span>
<span id="cb45-830"><a href="#cb45-830" aria-hidden="true" tabindex="-1"></a>    x3_prime <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"be"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb45-831"><a href="#cb45-831" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_prime"</span>] <span class="op">=</span> (</span>
<span id="cb45-832"><a href="#cb45-832" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.717</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">0.847</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">3.107</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.420</span> <span class="op">*</span> x3_prime <span class="op">+</span> <span class="fl">0.998</span> <span class="op">*</span> x2</span>
<span id="cb45-833"><a href="#cb45-833" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-834"><a href="#cb45-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-835"><a href="#cb45-835" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Z''-Score (Emerging Markets) ---</span></span>
<span id="cb45-836"><a href="#cb45-836" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_em"</span>] <span class="op">=</span> (</span>
<span id="cb45-837"><a href="#cb45-837" aria-hidden="true" tabindex="-1"></a>        <span class="fl">3.25</span></span>
<span id="cb45-838"><a href="#cb45-838" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">6.56</span> <span class="op">*</span> x4   <span class="co"># Working Capital / TA</span></span>
<span id="cb45-839"><a href="#cb45-839" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">3.26</span> <span class="op">*</span> x5   <span class="co"># Retained Earnings / TA</span></span>
<span id="cb45-840"><a href="#cb45-840" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">6.72</span> <span class="op">*</span> x1   <span class="co"># EBIT / TA</span></span>
<span id="cb45-841"><a href="#cb45-841" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="fl">1.05</span> <span class="op">*</span> x3_prime  <span class="co"># Book Equity / TL</span></span>
<span id="cb45-842"><a href="#cb45-842" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-843"><a href="#cb45-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-844"><a href="#cb45-844" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Classify risk zones</span></span>
<span id="cb45-845"><a href="#cb45-845" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb45-846"><a href="#cb45-846" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z"</span>],</span>
<span id="cb45-847"><a href="#cb45-847" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.80</span>, <span class="fl">2.70</span>, <span class="fl">2.99</span>, np.inf],</span>
<span id="cb45-848"><a href="#cb45-848" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"High Distress"</span>, <span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb45-849"><a href="#cb45-849" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-850"><a href="#cb45-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-851"><a href="#cb45-851" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_em_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb45-852"><a href="#cb45-852" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z_em"</span>],</span>
<span id="cb45-853"><a href="#cb45-853" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.10</span>, <span class="fl">2.60</span>, np.inf],</span>
<span id="cb45-854"><a href="#cb45-854" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb45-855"><a href="#cb45-855" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-856"><a href="#cb45-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-857"><a href="#cb45-857" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb45-858"><a href="#cb45-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-859"><a href="#cb45-859" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_altman_z(df_clean)</span>
<span id="cb45-860"><a href="#cb45-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-861"><a href="#cb45-861" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorize Z-scores</span></span>
<span id="cb45-862"><a href="#cb45-862" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]:</span>
<span id="cb45-863"><a href="#cb45-863" aria-hidden="true" tabindex="-1"></a>    df_clean[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(df_clean[var])</span>
<span id="cb45-864"><a href="#cb45-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-865"><a href="#cb45-865" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Z-Score Summary Statistics"</span>)</span>
<span id="cb45-866"><a href="#cb45-866" aria-hidden="true" tabindex="-1"></a>z_summary <span class="op">=</span> df_clean[[<span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]].describe().<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb45-867"><a href="#cb45-867" aria-hidden="true" tabindex="-1"></a>z_summary.columns <span class="op">=</span> [<span class="st">"Original Z"</span>, <span class="st">"Z' (Private)"</span>, <span class="st">"Z'' (Emerging)"</span>]</span>
<span id="cb45-868"><a href="#cb45-868" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z_summary.to_string())</span>
<span id="cb45-869"><a href="#cb45-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-870"><a href="#cb45-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-871"><a href="#cb45-871" aria-hidden="true" tabindex="-1"></a><span class="fu">## Z-Score Component Analysis</span></span>
<span id="cb45-872"><a href="#cb45-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-873"><a href="#cb45-873" aria-hidden="true" tabindex="-1"></a>Understanding which components drive the Z-Score is particularly informative in the Vietnamese context, where certain ratios may behave differently than in developed markets.</span>
<span id="cb45-874"><a href="#cb45-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-877"><a href="#cb45-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-878"><a href="#cb45-878" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-zscore-components</span></span>
<span id="cb45-879"><a href="#cb45-879" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of Altman Z-Score component ratios for Vietnamese listed firms. Each panel shows a component weighted by its coefficient in the original Z-Score formula."</span></span>
<span id="cb45-880"><a href="#cb45-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-881"><a href="#cb45-881" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">9</span>))</span>
<span id="cb45-882"><a href="#cb45-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-883"><a href="#cb45-883" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> [</span>
<span id="cb45-884"><a href="#cb45-884" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x1"</span>, <span class="fl">3.3</span>, <span class="st">"$3.3 </span><span class="ch">\\</span><span class="st">times$ EBIT/TA</span><span class="ch">\n</span><span class="st">(Earning Power)"</span>),</span>
<span id="cb45-885"><a href="#cb45-885" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x2"</span>, <span class="fl">0.999</span>, <span class="st">"$0.999 </span><span class="ch">\\</span><span class="st">times$ Sales/TA</span><span class="ch">\n</span><span class="st">(Asset Turnover)"</span>),</span>
<span id="cb45-886"><a href="#cb45-886" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x3"</span>, <span class="fl">0.6</span>, <span class="st">"$0.6 </span><span class="ch">\\</span><span class="st">times$ ME/TL</span><span class="ch">\n</span><span class="st">(Leverage)"</span>),</span>
<span id="cb45-887"><a href="#cb45-887" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x4"</span>, <span class="fl">1.2</span>, <span class="st">"$1.2 </span><span class="ch">\\</span><span class="st">times$ WC/TA</span><span class="ch">\n</span><span class="st">(Liquidity)"</span>),</span>
<span id="cb45-888"><a href="#cb45-888" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"z_x5"</span>, <span class="fl">1.4</span>, <span class="st">"$1.4 </span><span class="ch">\\</span><span class="st">times$ RE/TA</span><span class="ch">\n</span><span class="st">(Cum. Profitability)"</span>),</span>
<span id="cb45-889"><a href="#cb45-889" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-890"><a href="#cb45-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-891"><a href="#cb45-891" aria-hidden="true" tabindex="-1"></a>latest_z <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb45-892"><a href="#cb45-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-893"><a href="#cb45-893" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, (var, weight, label) <span class="kw">in</span> <span class="bu">enumerate</span>(components):</span>
<span id="cb45-894"><a href="#cb45-894" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[idx <span class="op">//</span> <span class="dv">3</span>, idx <span class="op">%</span> <span class="dv">3</span>]</span>
<span id="cb45-895"><a href="#cb45-895" aria-hidden="true" tabindex="-1"></a>    weighted_vals <span class="op">=</span> (latest_z[var] <span class="op">*</span> weight).dropna()</span>
<span id="cb45-896"><a href="#cb45-896" aria-hidden="true" tabindex="-1"></a>    weighted_vals <span class="op">=</span> weighted_vals[weighted_vals.between(</span>
<span id="cb45-897"><a href="#cb45-897" aria-hidden="true" tabindex="-1"></a>        weighted_vals.quantile(<span class="fl">0.01</span>), weighted_vals.quantile(<span class="fl">0.99</span>)</span>
<span id="cb45-898"><a href="#cb45-898" aria-hidden="true" tabindex="-1"></a>    )]</span>
<span id="cb45-899"><a href="#cb45-899" aria-hidden="true" tabindex="-1"></a>    ax.hist(weighted_vals, bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb45-900"><a href="#cb45-900" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>weighted_vals.median(), color<span class="op">=</span>colors[<span class="st">"quaternary"</span>],</span>
<span id="cb45-901"><a href="#cb45-901" aria-hidden="true" tabindex="-1"></a>               linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>weighted_vals<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb45-902"><a href="#cb45-902" aria-hidden="true" tabindex="-1"></a>    ax.set_title(label, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb45-903"><a href="#cb45-903" aria-hidden="true" tabindex="-1"></a>    ax.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb45-904"><a href="#cb45-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-905"><a href="#cb45-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove empty subplot</span></span>
<span id="cb45-906"><a href="#cb45-906" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb45-907"><a href="#cb45-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-908"><a href="#cb45-908" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="ss">f"Z-Score Component Distributions (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb45-909"><a href="#cb45-909" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-910"><a href="#cb45-910" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-911"><a href="#cb45-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-912"><a href="#cb45-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-913"><a href="#cb45-913" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution of Risk Zones</span></span>
<span id="cb45-914"><a href="#cb45-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-917"><a href="#cb45-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-918"><a href="#cb45-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-zscore-zones</span></span>
<span id="cb45-919"><a href="#cb45-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Proportion of Vietnamese listed firms in each Altman Z-Score risk zone over time. The figure shows both the original Z-Score zones and the emerging market Z''-Score zones."</span></span>
<span id="cb45-920"><a href="#cb45-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-921"><a href="#cb45-921" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb45-922"><a href="#cb45-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-923"><a href="#cb45-923" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Original Z-Score Zones ---</span></span>
<span id="cb45-924"><a href="#cb45-924" aria-hidden="true" tabindex="-1"></a>zone_counts <span class="op">=</span> (</span>
<span id="cb45-925"><a href="#cb45-925" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb45-926"><a href="#cb45-926" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"z_zone"</span>])</span>
<span id="cb45-927"><a href="#cb45-927" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb45-928"><a href="#cb45-928" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-929"><a href="#cb45-929" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-930"><a href="#cb45-930" aria-hidden="true" tabindex="-1"></a>zone_pcts <span class="op">=</span> zone_counts.div(zone_counts.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb45-931"><a href="#cb45-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-932"><a href="#cb45-932" aria-hidden="true" tabindex="-1"></a>zone_colors <span class="op">=</span> {</span>
<span id="cb45-933"><a href="#cb45-933" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Safe"</span>: colors[<span class="st">"safe"</span>],</span>
<span id="cb45-934"><a href="#cb45-934" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Grey Zone"</span>: colors[<span class="st">"alert"</span>],</span>
<span id="cb45-935"><a href="#cb45-935" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Distress"</span>: colors[<span class="st">"quaternary"</span>],</span>
<span id="cb45-936"><a href="#cb45-936" aria-hidden="true" tabindex="-1"></a>    <span class="st">"High Distress"</span>: colors[<span class="st">"distress"</span>],</span>
<span id="cb45-937"><a href="#cb45-937" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-938"><a href="#cb45-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-939"><a href="#cb45-939" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].stackplot(</span>
<span id="cb45-940"><a href="#cb45-940" aria-hidden="true" tabindex="-1"></a>    zone_pcts.index,</span>
<span id="cb45-941"><a href="#cb45-941" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>[zone_pcts[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb45-942"><a href="#cb45-942" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb45-943"><a href="#cb45-943" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb45-944"><a href="#cb45-944" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb45-945"><a href="#cb45-945" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[zone_colors[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>, <span class="st">"High Distress"</span>]</span>
<span id="cb45-946"><a href="#cb45-946" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> zone_pcts.columns],</span>
<span id="cb45-947"><a href="#cb45-947" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb45-948"><a href="#cb45-948" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-949"><a href="#cb45-949" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb45-950"><a href="#cb45-950" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Percentage of Firms"</span>)</span>
<span id="cb45-951"><a href="#cb45-951" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Original Z-Score Risk Zones"</span>)</span>
<span id="cb45-952"><a href="#cb45-952" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">"upper right"</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb45-953"><a href="#cb45-953" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb45-954"><a href="#cb45-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-955"><a href="#cb45-955" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Emerging Market Z''-Score Zones ---</span></span>
<span id="cb45-956"><a href="#cb45-956" aria-hidden="true" tabindex="-1"></a>em_zone_counts <span class="op">=</span> (</span>
<span id="cb45-957"><a href="#cb45-957" aria-hidden="true" tabindex="-1"></a>    df_clean</span>
<span id="cb45-958"><a href="#cb45-958" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year"</span>, <span class="st">"z_em_zone"</span>])</span>
<span id="cb45-959"><a href="#cb45-959" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb45-960"><a href="#cb45-960" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-961"><a href="#cb45-961" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-962"><a href="#cb45-962" aria-hidden="true" tabindex="-1"></a>em_zone_pcts <span class="op">=</span> em_zone_counts.div(em_zone_counts.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb45-963"><a href="#cb45-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-964"><a href="#cb45-964" aria-hidden="true" tabindex="-1"></a>em_zone_colors <span class="op">=</span> {<span class="st">"Safe"</span>: colors[<span class="st">"safe"</span>], <span class="st">"Grey Zone"</span>: colors[<span class="st">"alert"</span>],</span>
<span id="cb45-965"><a href="#cb45-965" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Distress"</span>: colors[<span class="st">"quaternary"</span>]}</span>
<span id="cb45-966"><a href="#cb45-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-967"><a href="#cb45-967" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].stackplot(</span>
<span id="cb45-968"><a href="#cb45-968" aria-hidden="true" tabindex="-1"></a>    em_zone_pcts.index,</span>
<span id="cb45-969"><a href="#cb45-969" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>[em_zone_pcts[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb45-970"><a href="#cb45-970" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb45-971"><a href="#cb45-971" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb45-972"><a href="#cb45-972" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb45-973"><a href="#cb45-973" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[em_zone_colors[col] <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Safe"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Distress"</span>]</span>
<span id="cb45-974"><a href="#cb45-974" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> em_zone_pcts.columns],</span>
<span id="cb45-975"><a href="#cb45-975" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb45-976"><a href="#cb45-976" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-977"><a href="#cb45-977" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb45-978"><a href="#cb45-978" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Percentage of Firms"</span>)</span>
<span id="cb45-979"><a href="#cb45-979" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Emerging Market Z''-Score Risk Zones"</span>)</span>
<span id="cb45-980"><a href="#cb45-980" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">"upper right"</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb45-981"><a href="#cb45-981" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb45-982"><a href="#cb45-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-983"><a href="#cb45-983" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-984"><a href="#cb45-984" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-985"><a href="#cb45-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-986"><a href="#cb45-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-987"><a href="#cb45-987" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Z-Score Variants</span></span>
<span id="cb45-988"><a href="#cb45-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-989"><a href="#cb45-989" aria-hidden="true" tabindex="-1"></a>An important practical question is which Z-Score variant is most appropriate for Vietnamese firms. The original model was calibrated on U.S. manufacturing firms, while the Z''-Score was specifically designed for emerging markets and non-manufacturing sectors.</span>
<span id="cb45-990"><a href="#cb45-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-993"><a href="#cb45-993" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-994"><a href="#cb45-994" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-zscore-comparison</span></span>
<span id="cb45-995"><a href="#cb45-995" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparison of original Z-Score and emerging market Z''-Score for Vietnamese listed firms. Points above (below) the 45-degree line have higher Z''-Scores (Z-Scores) than the other measure."</span></span>
<span id="cb45-996"><a href="#cb45-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-997"><a href="#cb45-997" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb45-998"><a href="#cb45-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-999"><a href="#cb45-999" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest_z.dropna(subset<span class="op">=</span>[<span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em_w"</span>]).sample(</span>
<span id="cb45-1000"><a href="#cb45-1000" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(<span class="dv">500</span>, <span class="bu">len</span>(latest_z)), random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb45-1001"><a href="#cb45-1001" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1002"><a href="#cb45-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1003"><a href="#cb45-1003" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax.scatter(</span>
<span id="cb45-1004"><a href="#cb45-1004" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"altman_z_w"</span>], sample[<span class="st">"altman_z_em_w"</span>],</span>
<span id="cb45-1005"><a href="#cb45-1005" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"tobin_q_simple_w"</span>], cmap<span class="op">=</span><span class="st">"RdYlGn"</span>,</span>
<span id="cb45-1006"><a href="#cb45-1006" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb45-1007"><a href="#cb45-1007" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1008"><a href="#cb45-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1009"><a href="#cb45-1009" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference lines</span></span>
<span id="cb45-1010"><a href="#cb45-1010" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb45-1011"><a href="#cb45-1011" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb45-1012"><a href="#cb45-1012" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb45-1013"><a href="#cb45-1013" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1014"><a href="#cb45-1014" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">"45° line"</span>)</span>
<span id="cb45-1015"><a href="#cb45-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1016"><a href="#cb45-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># Add zone boundaries</span></span>
<span id="cb45-1017"><a href="#cb45-1017" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-1018"><a href="#cb45-1018" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-1019"><a href="#cb45-1019" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">1.10</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-1020"><a href="#cb45-1020" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">2.60</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-1021"><a href="#cb45-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1022"><a href="#cb45-1022" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Original Z-Score"</span>)</span>
<span id="cb45-1023"><a href="#cb45-1023" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Emerging Market Z''-Score"</span>)</span>
<span id="cb45-1024"><a href="#cb45-1024" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Z-Score vs Z''-Score for Vietnamese Firms"</span>)</span>
<span id="cb45-1025"><a href="#cb45-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1026"><a href="#cb45-1026" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb45-1027"><a href="#cb45-1027" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb45-1028"><a href="#cb45-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1029"><a href="#cb45-1029" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb45-1030"><a href="#cb45-1030" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1031"><a href="#cb45-1031" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1032"><a href="#cb45-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1033"><a href="#cb45-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1034"><a href="#cb45-1034" aria-hidden="true" tabindex="-1"></a><span class="fu"># Computing Company Age {#sec-age-computation}</span></span>
<span id="cb45-1035"><a href="#cb45-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1036"><a href="#cb45-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Age Proxies</span></span>
<span id="cb45-1037"><a href="#cb45-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1038"><a href="#cb45-1038" aria-hidden="true" tabindex="-1"></a>For Vietnamese firms, we compute three age measures:</span>
<span id="cb45-1039"><a href="#cb45-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1040"><a href="#cb45-1040" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1041"><a href="#cb45-1041" aria-hidden="true" tabindex="-1"></a>\text{Age}_{\text{founding}} = \text{Current Year} - \text{Founding Year}</span>
<span id="cb45-1042"><a href="#cb45-1042" aria-hidden="true" tabindex="-1"></a>$$ {#eq-age-founding}</span>
<span id="cb45-1043"><a href="#cb45-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1044"><a href="#cb45-1044" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1045"><a href="#cb45-1045" aria-hidden="true" tabindex="-1"></a>\text{Age}_{\text{listing}} = \text{Current Year} - \text{Listing Year}</span>
<span id="cb45-1046"><a href="#cb45-1046" aria-hidden="true" tabindex="-1"></a>$$ {#eq-age-listing}</span>
<span id="cb45-1047"><a href="#cb45-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1048"><a href="#cb45-1048" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1049"><a href="#cb45-1049" aria-hidden="true" tabindex="-1"></a>\text{Age}_{\text{data}} = \text{Current Year} - \text{First Year with Data}</span>
<span id="cb45-1050"><a href="#cb45-1050" aria-hidden="true" tabindex="-1"></a>$$ {#eq-age-data}</span>
<span id="cb45-1051"><a href="#cb45-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1054"><a href="#cb45-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1055"><a href="#cb45-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-age</span></span>
<span id="cb45-1056"><a href="#cb45-1056" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Company age computation with multiple proxies"</span></span>
<span id="cb45-1057"><a href="#cb45-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1058"><a href="#cb45-1058" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_company_age(df):</span>
<span id="cb45-1059"><a href="#cb45-1059" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-1060"><a href="#cb45-1060" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute multiple proxies for company age.</span></span>
<span id="cb45-1061"><a href="#cb45-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1062"><a href="#cb45-1062" aria-hidden="true" tabindex="-1"></a><span class="co">    For Vietnamese firms:</span></span>
<span id="cb45-1063"><a href="#cb45-1063" aria-hidden="true" tabindex="-1"></a><span class="co">    - Founding age: based on founding/incorporation date</span></span>
<span id="cb45-1064"><a href="#cb45-1064" aria-hidden="true" tabindex="-1"></a><span class="co">    - Listing age: based on first listing on HOSE/HNX/UPCoM</span></span>
<span id="cb45-1065"><a href="#cb45-1065" aria-hidden="true" tabindex="-1"></a><span class="co">    - Data age: based on first year with available financial data</span></span>
<span id="cb45-1066"><a href="#cb45-1066" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-1067"><a href="#cb45-1067" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb45-1068"><a href="#cb45-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1069"><a href="#cb45-1069" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Founding age</span></span>
<span id="cb45-1070"><a href="#cb45-1070" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_founding"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"founding_year"</span>]</span>
<span id="cb45-1071"><a href="#cb45-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1072"><a href="#cb45-1072" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Listing age</span></span>
<span id="cb45-1073"><a href="#cb45-1073" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_listing"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"listing_year"</span>]</span>
<span id="cb45-1074"><a href="#cb45-1074" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_listing"</span>] <span class="op">=</span> result[<span class="st">"age_listing"</span>].clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-1075"><a href="#cb45-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1076"><a href="#cb45-1076" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data age (years since first available financial data)</span></span>
<span id="cb45-1077"><a href="#cb45-1077" aria-hidden="true" tabindex="-1"></a>    first_year <span class="op">=</span> result.groupby(<span class="st">"ticker"</span>)[<span class="st">"year"</span>].transform(<span class="st">"min"</span>)</span>
<span id="cb45-1078"><a href="#cb45-1078" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_data"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> first_year</span>
<span id="cb45-1079"><a href="#cb45-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1080"><a href="#cb45-1080" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log of age (commonly used in regressions)</span></span>
<span id="cb45-1081"><a href="#cb45-1081" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"ln_age_founding"</span>] <span class="op">=</span> np.log1p(result[<span class="st">"age_founding"</span>])</span>
<span id="cb45-1082"><a href="#cb45-1082" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"ln_age_listing"</span>] <span class="op">=</span> np.log1p(result[<span class="st">"age_listing"</span>])</span>
<span id="cb45-1083"><a href="#cb45-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1084"><a href="#cb45-1084" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb45-1085"><a href="#cb45-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1086"><a href="#cb45-1086" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> compute_company_age(df_clean)</span>
<span id="cb45-1087"><a href="#cb45-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1088"><a href="#cb45-1088" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Company Age Summary Statistics"</span>)</span>
<span id="cb45-1089"><a href="#cb45-1089" aria-hidden="true" tabindex="-1"></a>age_summary <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year][</span>
<span id="cb45-1090"><a href="#cb45-1090" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>]</span>
<span id="cb45-1091"><a href="#cb45-1091" aria-hidden="true" tabindex="-1"></a>].describe().<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb45-1092"><a href="#cb45-1092" aria-hidden="true" tabindex="-1"></a>age_summary.columns <span class="op">=</span> [<span class="st">"Founding Age"</span>, <span class="st">"Listing Age"</span>, <span class="st">"Data Age"</span>]</span>
<span id="cb45-1093"><a href="#cb45-1093" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(age_summary.to_string())</span>
<span id="cb45-1094"><a href="#cb45-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1095"><a href="#cb45-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1096"><a href="#cb45-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">## Age Distribution</span></span>
<span id="cb45-1097"><a href="#cb45-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1100"><a href="#cb45-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1101"><a href="#cb45-1101" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-distribution</span></span>
<span id="cb45-1102"><a href="#cb45-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of company age measures for Vietnamese listed firms. Founding age reflects true organizational maturity, while listing age captures capital market experience."</span></span>
<span id="cb45-1103"><a href="#cb45-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1104"><a href="#cb45-1104" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb45-1105"><a href="#cb45-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1106"><a href="#cb45-1106" aria-hidden="true" tabindex="-1"></a>age_vars <span class="op">=</span> [</span>
<span id="cb45-1107"><a href="#cb45-1107" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_founding"</span>, <span class="st">"Founding Age (years)"</span>, colors[<span class="st">"primary"</span>]),</span>
<span id="cb45-1108"><a href="#cb45-1108" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_listing"</span>, <span class="st">"Listing Age (years)"</span>, colors[<span class="st">"secondary"</span>]),</span>
<span id="cb45-1109"><a href="#cb45-1109" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"age_data"</span>, <span class="st">"Data Age (years)"</span>, colors[<span class="st">"tertiary"</span>]),</span>
<span id="cb45-1110"><a href="#cb45-1110" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1111"><a href="#cb45-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1112"><a href="#cb45-1112" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb45-1113"><a href="#cb45-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1114"><a href="#cb45-1114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, (var, label, color) <span class="kw">in</span> <span class="bu">zip</span>(axes, age_vars):</span>
<span id="cb45-1115"><a href="#cb45-1115" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> latest[var].dropna()</span>
<span id="cb45-1116"><a href="#cb45-1116" aria-hidden="true" tabindex="-1"></a>    ax.hist(data, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb45-1117"><a href="#cb45-1117" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>data.median(), color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="cb45-1118"><a href="#cb45-1118" aria-hidden="true" tabindex="-1"></a>               linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>data<span class="sc">.</span>median()<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb45-1119"><a href="#cb45-1119" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(label)</span>
<span id="cb45-1120"><a href="#cb45-1120" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Number of Firms"</span>)</span>
<span id="cb45-1121"><a href="#cb45-1121" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb45-1122"><a href="#cb45-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1123"><a href="#cb45-1123" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Founding Age"</span>)</span>
<span id="cb45-1124"><a href="#cb45-1124" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Listing Age"</span>)</span>
<span id="cb45-1125"><a href="#cb45-1125" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Data Age"</span>)</span>
<span id="cb45-1126"><a href="#cb45-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1127"><a href="#cb45-1127" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="ss">f"Company Age Distributions (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb45-1128"><a href="#cb45-1128" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1129"><a href="#cb45-1129" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1130"><a href="#cb45-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1131"><a href="#cb45-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1132"><a href="#cb45-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Age and the Equitization Effect</span></span>
<span id="cb45-1133"><a href="#cb45-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1134"><a href="#cb45-1134" aria-hidden="true" tabindex="-1"></a>A distinctive feature of the Vietnamese market is the equitization of SOEs. Many firms have founding dates that predate the stock market by decades, creating a large gap between founding age and listing age.</span>
<span id="cb45-1135"><a href="#cb45-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1138"><a href="#cb45-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1139"><a href="#cb45-1139" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-gap</span></span>
<span id="cb45-1140"><a href="#cb45-1140" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Relationship between founding age and listing age for Vietnamese firms. The gap reflects years of pre-listing operations, which is especially large for equitized state-owned enterprises."</span></span>
<span id="cb45-1141"><a href="#cb45-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1142"><a href="#cb45-1142" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb45-1143"><a href="#cb45-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1144"><a href="#cb45-1144" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> df_clean[df_clean[<span class="st">"year"</span>] <span class="op">==</span> latest_year].copy()</span>
<span id="cb45-1145"><a href="#cb45-1145" aria-hidden="true" tabindex="-1"></a>latest[<span class="st">"soe_flag"</span>] <span class="op">=</span> latest[<span class="st">"state_ownership_pct"</span>] <span class="op">&gt;</span> <span class="dv">30</span>  <span class="co"># SOE proxy</span></span>
<span id="cb45-1146"><a href="#cb45-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1147"><a href="#cb45-1147" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> soe, label, color, marker <span class="kw">in</span> [</span>
<span id="cb45-1148"><a href="#cb45-1148" aria-hidden="true" tabindex="-1"></a>    (<span class="va">True</span>, <span class="st">"SOE (&gt;30</span><span class="sc">% s</span><span class="st">tate)"</span>, colors[<span class="st">"quaternary"</span>], <span class="st">"s"</span>),</span>
<span id="cb45-1149"><a href="#cb45-1149" aria-hidden="true" tabindex="-1"></a>    (<span class="va">False</span>, <span class="st">"Non-SOE"</span>, colors[<span class="st">"primary"</span>], <span class="st">"o"</span>),</span>
<span id="cb45-1150"><a href="#cb45-1150" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb45-1151"><a href="#cb45-1151" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> latest[latest[<span class="st">"soe_flag"</span>] <span class="op">==</span> soe]</span>
<span id="cb45-1152"><a href="#cb45-1152" aria-hidden="true" tabindex="-1"></a>    ax.scatter(</span>
<span id="cb45-1153"><a href="#cb45-1153" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"age_listing"</span>], subset[<span class="st">"age_founding"</span>],</span>
<span id="cb45-1154"><a href="#cb45-1154" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">25</span>, marker<span class="op">=</span>marker, label<span class="op">=</span>label, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb45-1155"><a href="#cb45-1155" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1156"><a href="#cb45-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1157"><a href="#cb45-1157" aria-hidden="true" tabindex="-1"></a><span class="co"># 45-degree line</span></span>
<span id="cb45-1158"><a href="#cb45-1158" aria-hidden="true" tabindex="-1"></a>max_age <span class="op">=</span> <span class="bu">max</span>(latest[<span class="st">"age_founding"</span>].<span class="bu">max</span>(), latest[<span class="st">"age_listing"</span>].<span class="bu">max</span>())</span>
<span id="cb45-1159"><a href="#cb45-1159" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="dv">0</span>, max_age], [<span class="dv">0</span>, max_age], <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, label<span class="op">=</span><span class="st">"Founding = Listing age"</span>)</span>
<span id="cb45-1160"><a href="#cb45-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1161"><a href="#cb45-1161" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Listing Age (years)"</span>)</span>
<span id="cb45-1162"><a href="#cb45-1162" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb45-1163"><a href="#cb45-1163" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Founding vs. Listing Age: The Equitization Gap"</span>)</span>
<span id="cb45-1164"><a href="#cb45-1164" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb45-1165"><a href="#cb45-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1166"><a href="#cb45-1166" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1167"><a href="#cb45-1167" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1168"><a href="#cb45-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1169"><a href="#cb45-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1170"><a href="#cb45-1170" aria-hidden="true" tabindex="-1"></a><span class="fu"># Joint Analysis: Valuation, Distress, and Maturity {#sec-joint-analysis}</span></span>
<span id="cb45-1171"><a href="#cb45-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1172"><a href="#cb45-1172" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Relationship Between Q, Z-Score, and Age</span></span>
<span id="cb45-1173"><a href="#cb45-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1174"><a href="#cb45-1174" aria-hidden="true" tabindex="-1"></a>These three measures capture different dimensions of a firm's financial standing, but they are not independent. Theoretically, we expect:</span>
<span id="cb45-1175"><a href="#cb45-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1176"><a href="#cb45-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Q and Z**: Firms with high growth opportunities (high Q) tend to be financially healthier (high Z), but the relationship is not monotonic, very high Q values may indicate speculative overvaluation.</span>
<span id="cb45-1177"><a href="#cb45-1177" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Q and Age**: Young firms may have higher Q (growth expectations) or lower Q (unproven business model). The relationship depends on the industry life cycle.</span>
<span id="cb45-1178"><a href="#cb45-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Z and Age**: Older firms typically have more stable earnings and higher retained earnings, contributing to higher Z-Scores, though very old firms may face declining competitiveness.</span>
<span id="cb45-1179"><a href="#cb45-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1182"><a href="#cb45-1182" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1183"><a href="#cb45-1183" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-joint-analysis</span></span>
<span id="cb45-1184"><a href="#cb45-1184" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Relationship between Tobin's Q, Altman Z-Score, and company age for Vietnamese listed firms. Bubble size reflects total assets; color indicates the emerging market Z''-Score risk zone."</span></span>
<span id="cb45-1185"><a href="#cb45-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1186"><a href="#cb45-1186" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">5</span>))</span>
<span id="cb45-1187"><a href="#cb45-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1188"><a href="#cb45-1188" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest.dropna(subset<span class="op">=</span>[<span class="st">"tobin_q_simple_w"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"age_founding"</span>])</span>
<span id="cb45-1189"><a href="#cb45-1189" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> sample.sample(<span class="bu">min</span>(<span class="dv">300</span>, <span class="bu">len</span>(sample)), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb45-1190"><a href="#cb45-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1191"><a href="#cb45-1191" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs Z</span></span>
<span id="cb45-1192"><a href="#cb45-1192" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(</span>
<span id="cb45-1193"><a href="#cb45-1193" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"altman_z_w"</span>], sample[<span class="st">"tobin_q_simple_w"</span>],</span>
<span id="cb45-1194"><a href="#cb45-1194" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"age_founding"</span>], cmap<span class="op">=</span><span class="st">"viridis"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb45-1195"><a href="#cb45-1195" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb45-1196"><a href="#cb45-1196" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1197"><a href="#cb45-1197" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Altman Z-Score"</span>)</span>
<span id="cb45-1198"><a href="#cb45-1198" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb45-1199"><a href="#cb45-1199" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Valuation vs. Distress Risk"</span>)</span>
<span id="cb45-1200"><a href="#cb45-1200" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1201"><a href="#cb45-1201" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1202"><a href="#cb45-1202" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1203"><a href="#cb45-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1204"><a href="#cb45-1204" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs Age</span></span>
<span id="cb45-1205"><a href="#cb45-1205" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(</span>
<span id="cb45-1206"><a href="#cb45-1206" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"age_founding"</span>], sample[<span class="st">"tobin_q_simple_w"</span>],</span>
<span id="cb45-1207"><a href="#cb45-1207" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"altman_z_w"</span>], cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb45-1208"><a href="#cb45-1208" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb45-1209"><a href="#cb45-1209" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1210"><a href="#cb45-1210" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb45-1211"><a href="#cb45-1211" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb45-1212"><a href="#cb45-1212" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Valuation vs. Maturity"</span>)</span>
<span id="cb45-1213"><a href="#cb45-1213" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1214"><a href="#cb45-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1215"><a href="#cb45-1215" aria-hidden="true" tabindex="-1"></a><span class="co"># Z vs Age</span></span>
<span id="cb45-1216"><a href="#cb45-1216" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> axes[<span class="dv">2</span>].scatter(</span>
<span id="cb45-1217"><a href="#cb45-1217" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"age_founding"</span>], sample[<span class="st">"altman_z_w"</span>],</span>
<span id="cb45-1218"><a href="#cb45-1218" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>sample[<span class="st">"tobin_q_simple_w"</span>], cmap<span class="op">=</span><span class="st">"coolwarm"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb45-1219"><a href="#cb45-1219" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>np.log1p(sample[<span class="st">"at"</span>]) <span class="op">*</span> <span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb45-1220"><a href="#cb45-1220" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1221"><a href="#cb45-1221" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlabel(<span class="st">"Founding Age (years)"</span>)</span>
<span id="cb45-1222"><a href="#cb45-1222" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylabel(<span class="st">"Altman Z-Score"</span>)</span>
<span id="cb45-1223"><a href="#cb45-1223" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Distress Risk vs. Maturity"</span>)</span>
<span id="cb45-1224"><a href="#cb45-1224" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">1.80</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1225"><a href="#cb45-1225" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">2.99</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1226"><a href="#cb45-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1227"><a href="#cb45-1227" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1228"><a href="#cb45-1228" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1229"><a href="#cb45-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1230"><a href="#cb45-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1231"><a href="#cb45-1231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Correlation Structure</span></span>
<span id="cb45-1232"><a href="#cb45-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1235"><a href="#cb45-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1236"><a href="#cb45-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-correlation-matrix</span></span>
<span id="cb45-1237"><a href="#cb45-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Correlation matrix of key valuation, distress, and maturity measures for Vietnamese listed firms."</span></span>
<span id="cb45-1238"><a href="#cb45-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1239"><a href="#cb45-1239" aria-hidden="true" tabindex="-1"></a>corr_vars <span class="op">=</span> [</span>
<span id="cb45-1240"><a href="#cb45-1240" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tobin_q_simple_w"</span>, <span class="st">"mtb_w"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb45-1241"><a href="#cb45-1241" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>,</span>
<span id="cb45-1242"><a href="#cb45-1242" aria-hidden="true" tabindex="-1"></a>    <span class="st">"z_x1"</span>, <span class="st">"z_x2"</span>, <span class="st">"z_x3"</span>, <span class="st">"z_x4"</span>, <span class="st">"z_x5"</span></span>
<span id="cb45-1243"><a href="#cb45-1243" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1244"><a href="#cb45-1244" aria-hidden="true" tabindex="-1"></a>corr_labels <span class="op">=</span> [</span>
<span id="cb45-1245"><a href="#cb45-1245" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tobin's Q"</span>, <span class="st">"M/B Ratio"</span>, <span class="st">"Z-Score"</span>, <span class="st">"Z'' (EM)"</span>,</span>
<span id="cb45-1246"><a href="#cb45-1246" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Age (Found.)"</span>, <span class="st">"Age (List.)"</span>,</span>
<span id="cb45-1247"><a href="#cb45-1247" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EBIT/TA"</span>, <span class="st">"Sales/TA"</span>, <span class="st">"ME/TL"</span>, <span class="st">"WC/TA"</span>, <span class="st">"RE/TA"</span></span>
<span id="cb45-1248"><a href="#cb45-1248" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1249"><a href="#cb45-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1250"><a href="#cb45-1250" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> df_clean[corr_vars].corr()</span>
<span id="cb45-1251"><a href="#cb45-1251" aria-hidden="true" tabindex="-1"></a>corr_matrix.index <span class="op">=</span> corr_labels</span>
<span id="cb45-1252"><a href="#cb45-1252" aria-hidden="true" tabindex="-1"></a>corr_matrix.columns <span class="op">=</span> corr_labels</span>
<span id="cb45-1253"><a href="#cb45-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1254"><a href="#cb45-1254" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb45-1255"><a href="#cb45-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1256"><a href="#cb45-1256" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(corr_matrix, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-1257"><a href="#cb45-1257" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">250</span>, <span class="dv">15</span>, s<span class="op">=</span><span class="dv">75</span>, l<span class="op">=</span><span class="dv">40</span>, n<span class="op">=</span><span class="dv">9</span>, center<span class="op">=</span><span class="st">"light"</span>, as_cmap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-1258"><a href="#cb45-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1259"><a href="#cb45-1259" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb45-1260"><a href="#cb45-1260" aria-hidden="true" tabindex="-1"></a>    corr_matrix, mask<span class="op">=</span>mask, cmap<span class="op">=</span>cmap, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb45-1261"><a href="#cb45-1261" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-1262"><a href="#cb45-1262" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb45-1263"><a href="#cb45-1263" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb45-1264"><a href="#cb45-1264" aria-hidden="true" tabindex="-1"></a>    annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">9</span>}</span>
<span id="cb45-1265"><a href="#cb45-1265" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1266"><a href="#cb45-1266" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Correlation Matrix of Key Financial Measures"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb45-1267"><a href="#cb45-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1268"><a href="#cb45-1268" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1269"><a href="#cb45-1269" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1270"><a href="#cb45-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1271"><a href="#cb45-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1272"><a href="#cb45-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cross-Sectional Regression Analysis</span></span>
<span id="cb45-1273"><a href="#cb45-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1274"><a href="#cb45-1274" aria-hidden="true" tabindex="-1"></a>We estimate a simple cross-sectional model to examine the determinants of Tobin's Q in the Vietnamese market:</span>
<span id="cb45-1275"><a href="#cb45-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1276"><a href="#cb45-1276" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1277"><a href="#cb45-1277" aria-hidden="true" tabindex="-1"></a>Q_{i,t} = \alpha + \beta_1 \ln(\text{Age}_{i}) + \beta_2 Z''_{i,t} + \beta_3 \text{SOE}_{i} + \beta_4 \ln(\text{TA}_{i,t}) + \varepsilon_{i,t}</span>
<span id="cb45-1278"><a href="#cb45-1278" aria-hidden="true" tabindex="-1"></a>$$ {#eq-regression-q}</span>
<span id="cb45-1279"><a href="#cb45-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1282"><a href="#cb45-1282" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1283"><a href="#cb45-1283" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: regression-analysis</span></span>
<span id="cb45-1284"><a href="#cb45-1284" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Cross-sectional regression of Tobin's Q"</span></span>
<span id="cb45-1285"><a href="#cb45-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1286"><a href="#cb45-1286" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.linalg <span class="im">import</span> lstsq</span>
<span id="cb45-1287"><a href="#cb45-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1288"><a href="#cb45-1288" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare regression data</span></span>
<span id="cb45-1289"><a href="#cb45-1289" aria-hidden="true" tabindex="-1"></a>reg_data <span class="op">=</span> latest.dropna(</span>
<span id="cb45-1290"><a href="#cb45-1290" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_simple_w"</span>, <span class="st">"ln_age_founding"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"at"</span>]</span>
<span id="cb45-1291"><a href="#cb45-1291" aria-hidden="true" tabindex="-1"></a>).copy()</span>
<span id="cb45-1292"><a href="#cb45-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1293"><a href="#cb45-1293" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"ln_at"</span>] <span class="op">=</span> np.log(reg_data[<span class="st">"at"</span>])</span>
<span id="cb45-1294"><a href="#cb45-1294" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"soe_dummy"</span>] <span class="op">=</span> (reg_data[<span class="st">"state_ownership_pct"</span>] <span class="op">&gt;</span> <span class="dv">30</span>).astype(<span class="bu">int</span>)</span>
<span id="cb45-1295"><a href="#cb45-1295" aria-hidden="true" tabindex="-1"></a>reg_data[<span class="st">"constant"</span>] <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb45-1296"><a href="#cb45-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1297"><a href="#cb45-1297" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS estimation</span></span>
<span id="cb45-1298"><a href="#cb45-1298" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> reg_data[<span class="st">"tobin_q_simple_w"</span>].values</span>
<span id="cb45-1299"><a href="#cb45-1299" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> reg_data[[<span class="st">"constant"</span>, <span class="st">"ln_age_founding"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb45-1300"><a href="#cb45-1300" aria-hidden="true" tabindex="-1"></a>              <span class="st">"soe_dummy"</span>, <span class="st">"ln_at"</span>]].values</span>
<span id="cb45-1301"><a href="#cb45-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1302"><a href="#cb45-1302" aria-hidden="true" tabindex="-1"></a>betas, residuals, rank, sv <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-1303"><a href="#cb45-1303" aria-hidden="true" tabindex="-1"></a>y_hat <span class="op">=</span> X <span class="op">@</span> betas</span>
<span id="cb45-1304"><a href="#cb45-1304" aria-hidden="true" tabindex="-1"></a>resid <span class="op">=</span> y <span class="op">-</span> y_hat</span>
<span id="cb45-1305"><a href="#cb45-1305" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> X.shape</span>
<span id="cb45-1306"><a href="#cb45-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1307"><a href="#cb45-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard errors (heteroskedasticity-robust would be better)</span></span>
<span id="cb45-1308"><a href="#cb45-1308" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> (n <span class="op">-</span> k)</span>
<span id="cb45-1309"><a href="#cb45-1309" aria-hidden="true" tabindex="-1"></a>var_beta <span class="op">=</span> sigma2 <span class="op">*</span> np.linalg.inv(X.T <span class="op">@</span> X)</span>
<span id="cb45-1310"><a href="#cb45-1310" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> np.sqrt(np.diag(var_beta))</span>
<span id="cb45-1311"><a href="#cb45-1311" aria-hidden="true" tabindex="-1"></a>t_stats <span class="op">=</span> betas <span class="op">/</span> se</span>
<span id="cb45-1312"><a href="#cb45-1312" aria-hidden="true" tabindex="-1"></a>r_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> np.<span class="bu">sum</span>((y <span class="op">-</span> y.mean())<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb45-1313"><a href="#cb45-1313" aria-hidden="true" tabindex="-1"></a>adj_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r_squared) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> k <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb45-1314"><a href="#cb45-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1315"><a href="#cb45-1315" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb45-1316"><a href="#cb45-1316" aria-hidden="true" tabindex="-1"></a>var_names <span class="op">=</span> [<span class="st">"Constant"</span>, <span class="st">"ln(Age)"</span>, <span class="st">"Z''-Score (EM)"</span>, <span class="st">"SOE Dummy"</span>, <span class="st">"ln(Total Assets)"</span>]</span>
<span id="cb45-1317"><a href="#cb45-1317" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1318"><a href="#cb45-1318" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Cross-Sectional Regression: Determinants of Tobin's Q"</span>)</span>
<span id="cb45-1319"><a href="#cb45-1319" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Dependent Variable: Tobin's Q (Simple, Winsorized)"</span>)</span>
<span id="cb45-1320"><a href="#cb45-1320" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Sample: </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> firms (</span><span class="sc">{</span>latest_year<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb45-1321"><a href="#cb45-1321" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1322"><a href="#cb45-1322" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="st">'Variable'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Coef'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Std.Err'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;10}</span><span class="ss">"</span>)</span>
<span id="cb45-1323"><a href="#cb45-1323" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1324"><a href="#cb45-1324" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, b, s, t <span class="kw">in</span> <span class="bu">zip</span>(var_names, betas, se, t_stats):</span>
<span id="cb45-1325"><a href="#cb45-1325" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> <span class="st">"***"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">2.576</span> <span class="cf">else</span> <span class="st">"**"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.96</span> <span class="cf">else</span> <span class="st">"*"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.645</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb45-1326"><a href="#cb45-1326" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>name<span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span>b<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>s<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss"> </span><span class="sc">{</span>sig<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1327"><a href="#cb45-1327" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1328"><a href="#cb45-1328" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared: </span><span class="sc">{</span>r_squared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb45-1329"><a href="#cb45-1329" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Adjusted R-squared: </span><span class="sc">{</span>adj_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb45-1330"><a href="#cb45-1330" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Observations: </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1331"><a href="#cb45-1331" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1332"><a href="#cb45-1332" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Significance: *** p&lt;0.01, ** p&lt;0.05, * p&lt;0.10"</span>)</span>
<span id="cb45-1333"><a href="#cb45-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1334"><a href="#cb45-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1335"><a href="#cb45-1335" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Complete Pipeline {#sec-pipeline}</span></span>
<span id="cb45-1336"><a href="#cb45-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1337"><a href="#cb45-1337" aria-hidden="true" tabindex="-1"></a><span class="fu">## Putting It All Together</span></span>
<span id="cb45-1338"><a href="#cb45-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1339"><a href="#cb45-1339" aria-hidden="true" tabindex="-1"></a>Here we provide a single, clean function that takes raw DataCore.vn financial data and produces a complete dataset with all three measures computed.</span>
<span id="cb45-1340"><a href="#cb45-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1343"><a href="#cb45-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1344"><a href="#cb45-1344" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: complete-pipeline</span></span>
<span id="cb45-1345"><a href="#cb45-1345" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Complete pipeline for computing Tobin's Q, Z-Score, and Company Age"</span></span>
<span id="cb45-1346"><a href="#cb45-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1347"><a href="#cb45-1347" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_valuation_distress_age(df, firm_profiles<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb45-1348"><a href="#cb45-1348" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-1349"><a href="#cb45-1349" aria-hidden="true" tabindex="-1"></a><span class="co">    Complete pipeline to compute Tobin's Q, Altman Z-Score variants,</span></span>
<span id="cb45-1350"><a href="#cb45-1350" aria-hidden="true" tabindex="-1"></a><span class="co">    and Company Age for Vietnamese listed firms.</span></span>
<span id="cb45-1351"><a href="#cb45-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1352"><a href="#cb45-1352" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb45-1353"><a href="#cb45-1353" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb45-1354"><a href="#cb45-1354" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pd.DataFrame</span></span>
<span id="cb45-1355"><a href="#cb45-1355" aria-hidden="true" tabindex="-1"></a><span class="co">        Panel of firm-year financial data with columns:</span></span>
<span id="cb45-1356"><a href="#cb45-1356" aria-hidden="true" tabindex="-1"></a><span class="co">        at, seq, lt, lct, tlb, sale, ebit, ni, re_var, act,</span></span>
<span id="cb45-1357"><a href="#cb45-1357" aria-hidden="true" tabindex="-1"></a><span class="co">        ppent, invt, txdb, itcb, pstk, me, prcc, csho, year, ticker</span></span>
<span id="cb45-1358"><a href="#cb45-1358" aria-hidden="true" tabindex="-1"></a><span class="co">    firm_profiles : pd.DataFrame, optional</span></span>
<span id="cb45-1359"><a href="#cb45-1359" aria-hidden="true" tabindex="-1"></a><span class="co">        Company profiles with founding_year, listing_year</span></span>
<span id="cb45-1360"><a href="#cb45-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1361"><a href="#cb45-1361" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb45-1362"><a href="#cb45-1362" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb45-1363"><a href="#cb45-1363" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame</span></span>
<span id="cb45-1364"><a href="#cb45-1364" aria-hidden="true" tabindex="-1"></a><span class="co">        Input data augmented with computed measures</span></span>
<span id="cb45-1365"><a href="#cb45-1365" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-1366"><a href="#cb45-1366" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df.copy()</span>
<span id="cb45-1367"><a href="#cb45-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1368"><a href="#cb45-1368" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Data Quality Filters ===</span></span>
<span id="cb45-1369"><a href="#cb45-1369" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result[result[<span class="st">"at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb45-1370"><a href="#cb45-1370" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result[result[<span class="st">"seq"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb45-1371"><a href="#cb45-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1372"><a href="#cb45-1372" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Book Value of Equity (Daniel &amp; Titman 1997) ===</span></span>
<span id="cb45-1373"><a href="#cb45-1373" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"pref"</span>] <span class="op">=</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1374"><a href="#cb45-1374" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"be"</span>] <span class="op">=</span> (</span>
<span id="cb45-1375"><a href="#cb45-1375" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"seq"</span>]</span>
<span id="cb45-1376"><a href="#cb45-1376" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"txdb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1377"><a href="#cb45-1377" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"itcb"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1378"><a href="#cb45-1378" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> result[<span class="st">"pref"</span>]</span>
<span id="cb45-1379"><a href="#cb45-1379" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1380"><a href="#cb45-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1381"><a href="#cb45-1381" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Market Value of Equity ===</span></span>
<span id="cb45-1382"><a href="#cb45-1382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"me"</span> <span class="kw">not</span> <span class="kw">in</span> result.columns <span class="kw">or</span> result[<span class="st">"me"</span>].isna().<span class="bu">all</span>():</span>
<span id="cb45-1383"><a href="#cb45-1383" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"me"</span>] <span class="op">=</span> result[<span class="st">"prcc"</span>] <span class="op">*</span> result[<span class="st">"csho"</span>]</span>
<span id="cb45-1384"><a href="#cb45-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1385"><a href="#cb45-1385" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Tobin's Q Variants ===</span></span>
<span id="cb45-1386"><a href="#cb45-1386" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple Q (Gompers et al. 2003)</span></span>
<span id="cb45-1387"><a href="#cb45-1387" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q"</span>] <span class="op">=</span> (result[<span class="st">"at"</span>] <span class="op">+</span> result[<span class="st">"me"</span>] <span class="op">-</span> result[<span class="st">"be"</span>]) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1388"><a href="#cb45-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1389"><a href="#cb45-1389" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chung-Pruitt Q</span></span>
<span id="cb45-1390"><a href="#cb45-1390" aria-hidden="true" tabindex="-1"></a>    debt_cp <span class="op">=</span> (</span>
<span id="cb45-1391"><a href="#cb45-1391" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1392"><a href="#cb45-1392" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> result[<span class="st">"invt"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> result[<span class="st">"lt"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1393"><a href="#cb45-1393" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1394"><a href="#cb45-1394" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"tobin_q_cp"</span>] <span class="op">=</span> (</span>
<span id="cb45-1395"><a href="#cb45-1395" aria-hidden="true" tabindex="-1"></a>        (result[<span class="st">"me"</span>] <span class="op">+</span> result[<span class="st">"pstk"</span>].fillna(<span class="dv">0</span>) <span class="op">+</span> debt_cp) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1396"><a href="#cb45-1396" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1397"><a href="#cb45-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1398"><a href="#cb45-1398" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market-to-Book</span></span>
<span id="cb45-1399"><a href="#cb45-1399" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"mtb"</span>] <span class="op">=</span> np.where(result[<span class="st">"be"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"be"</span>], np.nan)</span>
<span id="cb45-1400"><a href="#cb45-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1401"><a href="#cb45-1401" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Altman Z-Score Variants ===</span></span>
<span id="cb45-1402"><a href="#cb45-1402" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"wc"</span>] <span class="op">=</span> result[<span class="st">"act"</span>].fillna(<span class="dv">0</span>) <span class="op">-</span> result[<span class="st">"lct"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb45-1403"><a href="#cb45-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1404"><a href="#cb45-1404" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> result[<span class="st">"ebit"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1405"><a href="#cb45-1405" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> result[<span class="st">"sale"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1406"><a href="#cb45-1406" aria-hidden="true" tabindex="-1"></a>    x3_market <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"me"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb45-1407"><a href="#cb45-1407" aria-hidden="true" tabindex="-1"></a>    x3_book <span class="op">=</span> np.where(result[<span class="st">"tlb"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, result[<span class="st">"be"</span>] <span class="op">/</span> result[<span class="st">"tlb"</span>], np.nan)</span>
<span id="cb45-1408"><a href="#cb45-1408" aria-hidden="true" tabindex="-1"></a>    x4 <span class="op">=</span> result[<span class="st">"wc"</span>] <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1409"><a href="#cb45-1409" aria-hidden="true" tabindex="-1"></a>    x5 <span class="op">=</span> result[<span class="st">"re_var"</span>].fillna(<span class="dv">0</span>) <span class="op">/</span> result[<span class="st">"at"</span>]</span>
<span id="cb45-1410"><a href="#cb45-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1411"><a href="#cb45-1411" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Original Z</span></span>
<span id="cb45-1412"><a href="#cb45-1412" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z"</span>] <span class="op">=</span> <span class="fl">3.3</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.999</span> <span class="op">*</span> x2 <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> x3_market <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">1.4</span> <span class="op">*</span> x5</span>
<span id="cb45-1413"><a href="#cb45-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1414"><a href="#cb45-1414" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z' (private firms)</span></span>
<span id="cb45-1415"><a href="#cb45-1415" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_prime"</span>] <span class="op">=</span> (</span>
<span id="cb45-1416"><a href="#cb45-1416" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.717</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">0.847</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">3.107</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.420</span> <span class="op">*</span> x3_book <span class="op">+</span> <span class="fl">0.998</span> <span class="op">*</span> x2</span>
<span id="cb45-1417"><a href="#cb45-1417" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1418"><a href="#cb45-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1419"><a href="#cb45-1419" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z'' (emerging markets)</span></span>
<span id="cb45-1420"><a href="#cb45-1420" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"altman_z_em"</span>] <span class="op">=</span> (</span>
<span id="cb45-1421"><a href="#cb45-1421" aria-hidden="true" tabindex="-1"></a>        <span class="fl">3.25</span> <span class="op">+</span> <span class="fl">6.56</span> <span class="op">*</span> x4 <span class="op">+</span> <span class="fl">3.26</span> <span class="op">*</span> x5 <span class="op">+</span> <span class="fl">6.72</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">1.05</span> <span class="op">*</span> x3_book</span>
<span id="cb45-1422"><a href="#cb45-1422" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1423"><a href="#cb45-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1424"><a href="#cb45-1424" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Risk zones</span></span>
<span id="cb45-1425"><a href="#cb45-1425" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb45-1426"><a href="#cb45-1426" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z"</span>],</span>
<span id="cb45-1427"><a href="#cb45-1427" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.80</span>, <span class="fl">2.70</span>, <span class="fl">2.99</span>, np.inf],</span>
<span id="cb45-1428"><a href="#cb45-1428" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"High Distress"</span>, <span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb45-1429"><a href="#cb45-1429" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1430"><a href="#cb45-1430" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"z_em_zone"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb45-1431"><a href="#cb45-1431" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"altman_z_em"</span>],</span>
<span id="cb45-1432"><a href="#cb45-1432" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="fl">1.10</span>, <span class="fl">2.60</span>, np.inf],</span>
<span id="cb45-1433"><a href="#cb45-1433" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"Distress"</span>, <span class="st">"Grey Zone"</span>, <span class="st">"Safe"</span>]</span>
<span id="cb45-1434"><a href="#cb45-1434" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1435"><a href="#cb45-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1436"><a href="#cb45-1436" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Company Age ===</span></span>
<span id="cb45-1437"><a href="#cb45-1437" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> firm_profiles <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb45-1438"><a href="#cb45-1438" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> result.merge(</span>
<span id="cb45-1439"><a href="#cb45-1439" aria-hidden="true" tabindex="-1"></a>            firm_profiles[[<span class="st">"ticker"</span>, <span class="st">"founding_year"</span>, <span class="st">"listing_year"</span>]],</span>
<span id="cb45-1440"><a href="#cb45-1440" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span><span class="st">"ticker"</span>, how<span class="op">=</span><span class="st">"left"</span>, suffixes<span class="op">=</span>(<span class="st">""</span>, <span class="st">"_profile"</span>)</span>
<span id="cb45-1441"><a href="#cb45-1441" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-1442"><a href="#cb45-1442" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"age_founding"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"founding_year"</span>]</span>
<span id="cb45-1443"><a href="#cb45-1443" aria-hidden="true" tabindex="-1"></a>        result[<span class="st">"age_listing"</span>] <span class="op">=</span> (result[<span class="st">"year"</span>] <span class="op">-</span> result[<span class="st">"listing_year"</span>]).clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-1444"><a href="#cb45-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1445"><a href="#cb45-1445" aria-hidden="true" tabindex="-1"></a>    first_year <span class="op">=</span> result.groupby(<span class="st">"ticker"</span>)[<span class="st">"year"</span>].transform(<span class="st">"min"</span>)</span>
<span id="cb45-1446"><a href="#cb45-1446" aria-hidden="true" tabindex="-1"></a>    result[<span class="st">"age_data"</span>] <span class="op">=</span> result[<span class="st">"year"</span>] <span class="op">-</span> first_year</span>
<span id="cb45-1447"><a href="#cb45-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1448"><a href="#cb45-1448" aria-hidden="true" tabindex="-1"></a>    <span class="co"># === Winsorize ===</span></span>
<span id="cb45-1449"><a href="#cb45-1449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>, <span class="st">"altman_z_em"</span>]:</span>
<span id="cb45-1450"><a href="#cb45-1450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var <span class="kw">in</span> result.columns:</span>
<span id="cb45-1451"><a href="#cb45-1451" aria-hidden="true" tabindex="-1"></a>            result[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> winsorize(result[var])</span>
<span id="cb45-1452"><a href="#cb45-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1453"><a href="#cb45-1453" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb45-1454"><a href="#cb45-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1455"><a href="#cb45-1455" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate the pipeline</span></span>
<span id="cb45-1456"><a href="#cb45-1456" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> compute_valuation_distress_age(df, firm_profiles)</span>
<span id="cb45-1457"><a href="#cb45-1457" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final dataset: </span><span class="sc">{</span>final_df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> observations, </span><span class="sc">{</span>final_df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> variables"</span>)</span>
<span id="cb45-1458"><a href="#cb45-1458" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Firms: </span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1459"><a href="#cb45-1459" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Key variables computed:"</span>)</span>
<span id="cb45-1460"><a href="#cb45-1460" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">"tobin_q"</span>, <span class="st">"tobin_q_cp"</span>, <span class="st">"mtb"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_prime"</span>,</span>
<span id="cb45-1461"><a href="#cb45-1461" aria-hidden="true" tabindex="-1"></a>            <span class="st">"altman_z_em"</span>, <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>]:</span>
<span id="cb45-1462"><a href="#cb45-1462" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var <span class="kw">in</span> final_df.columns:</span>
<span id="cb45-1463"><a href="#cb45-1463" aria-hidden="true" tabindex="-1"></a>        non_null <span class="op">=</span> final_df[var].notna().<span class="bu">sum</span>()</span>
<span id="cb45-1464"><a href="#cb45-1464" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>non_null<span class="sc">:,}</span><span class="ss"> non-null values"</span>)</span>
<span id="cb45-1465"><a href="#cb45-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1466"><a href="#cb45-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1467"><a href="#cb45-1467" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exporting Results</span></span>
<span id="cb45-1468"><a href="#cb45-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1471"><a href="#cb45-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1472"><a href="#cb45-1472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: export-results</span></span>
<span id="cb45-1473"><a href="#cb45-1473" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Export computed measures to CSV"</span></span>
<span id="cb45-1474"><a href="#cb45-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1475"><a href="#cb45-1475" aria-hidden="true" tabindex="-1"></a><span class="co"># Select key output variables</span></span>
<span id="cb45-1476"><a href="#cb45-1476" aria-hidden="true" tabindex="-1"></a>output_vars <span class="op">=</span> [</span>
<span id="cb45-1477"><a href="#cb45-1477" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>, <span class="st">"year"</span>, <span class="st">"datadate"</span>, <span class="st">"exchange"</span>, <span class="st">"industry"</span>,</span>
<span id="cb45-1478"><a href="#cb45-1478" aria-hidden="true" tabindex="-1"></a>    <span class="st">"at"</span>, <span class="st">"be"</span>, <span class="st">"me"</span>, <span class="st">"tobin_q"</span>, <span class="st">"tobin_q_w"</span>, <span class="st">"mtb"</span>, <span class="st">"mtb_w"</span>,</span>
<span id="cb45-1479"><a href="#cb45-1479" aria-hidden="true" tabindex="-1"></a>    <span class="st">"altman_z"</span>, <span class="st">"altman_z_w"</span>, <span class="st">"altman_z_em"</span>, <span class="st">"altman_z_em_w"</span>,</span>
<span id="cb45-1480"><a href="#cb45-1480" aria-hidden="true" tabindex="-1"></a>    <span class="st">"z_zone"</span>, <span class="st">"z_em_zone"</span>,</span>
<span id="cb45-1481"><a href="#cb45-1481" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age_founding"</span>, <span class="st">"age_listing"</span>, <span class="st">"age_data"</span>,</span>
<span id="cb45-1482"><a href="#cb45-1482" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state_ownership_pct"</span></span>
<span id="cb45-1483"><a href="#cb45-1483" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1484"><a href="#cb45-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1485"><a href="#cb45-1485" aria-hidden="true" tabindex="-1"></a>export_cols <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> output_vars <span class="cf">if</span> v <span class="kw">in</span> final_df.columns]</span>
<span id="cb45-1486"><a href="#cb45-1486" aria-hidden="true" tabindex="-1"></a>export_df <span class="op">=</span> final_df[export_cols].copy()</span>
<span id="cb45-1487"><a href="#cb45-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1488"><a href="#cb45-1488" aria-hidden="true" tabindex="-1"></a><span class="co"># export_df.to_csv("vn_valuation_distress_age.csv", index=False)</span></span>
<span id="cb45-1489"><a href="#cb45-1489" aria-hidden="true" tabindex="-1"></a><span class="co"># export_df.to_parquet("vn_valuation_distress_age.parquet", index=False)</span></span>
<span id="cb45-1490"><a href="#cb45-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1491"><a href="#cb45-1491" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Export dataset: </span><span class="sc">{</span>export_df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows × </span><span class="sc">{</span>export_df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> columns"</span>)</span>
<span id="cb45-1492"><a href="#cb45-1492" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample output (first 5 rows):"</span>)</span>
<span id="cb45-1493"><a href="#cb45-1493" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [<span class="st">"ticker"</span>, <span class="st">"year"</span>, <span class="st">"tobin_q"</span>, <span class="st">"altman_z"</span>, <span class="st">"altman_z_em"</span>,</span>
<span id="cb45-1494"><a href="#cb45-1494" aria-hidden="true" tabindex="-1"></a>                <span class="st">"z_zone"</span>, <span class="st">"age_founding"</span>]</span>
<span id="cb45-1495"><a href="#cb45-1495" aria-hidden="true" tabindex="-1"></a>display_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> display_cols <span class="cf">if</span> c <span class="kw">in</span> export_df.columns]</span>
<span id="cb45-1496"><a href="#cb45-1496" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(export_df[display_cols].head().to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb45-1497"><a href="#cb45-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1498"><a href="#cb45-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1499"><a href="#cb45-1499" aria-hidden="true" tabindex="-1"></a><span class="fu"># Special Topics for the Vietnamese Market {#sec-special-topics}</span></span>
<span id="cb45-1500"><a href="#cb45-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1501"><a href="#cb45-1501" aria-hidden="true" tabindex="-1"></a><span class="fu">## State Ownership and Valuation</span></span>
<span id="cb45-1502"><a href="#cb45-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1503"><a href="#cb45-1503" aria-hidden="true" tabindex="-1"></a>State ownership is a defining feature of the Vietnamese corporate landscape. We examine how state ownership affects both Tobin's Q and financial distress risk.</span>
<span id="cb45-1504"><a href="#cb45-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1507"><a href="#cb45-1507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1508"><a href="#cb45-1508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-soe-analysis</span></span>
<span id="cb45-1509"><a href="#cb45-1509" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Relationship between state ownership percentage and firm valuation/distress measures. The left panel shows Tobin's Q against state ownership, with a LOWESS smoother. The right panel shows the Z''-Score by state ownership quartile."</span></span>
<span id="cb45-1510"><a href="#cb45-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1511"><a href="#cb45-1511" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb45-1512"><a href="#cb45-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1513"><a href="#cb45-1513" aria-hidden="true" tabindex="-1"></a>latest <span class="op">=</span> final_df[final_df[<span class="st">"year"</span>] <span class="op">==</span> latest_year].dropna(</span>
<span id="cb45-1514"><a href="#cb45-1514" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"state_ownership_pct"</span>]</span>
<span id="cb45-1515"><a href="#cb45-1515" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1516"><a href="#cb45-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1517"><a href="#cb45-1517" aria-hidden="true" tabindex="-1"></a><span class="co"># Q vs State Ownership</span></span>
<span id="cb45-1518"><a href="#cb45-1518" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(</span>
<span id="cb45-1519"><a href="#cb45-1519" aria-hidden="true" tabindex="-1"></a>    latest[<span class="st">"state_ownership_pct"</span>], latest[<span class="st">"tobin_q_w"</span>],</span>
<span id="cb45-1520"><a href="#cb45-1520" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb45-1521"><a href="#cb45-1521" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1522"><a href="#cb45-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1523"><a href="#cb45-1523" aria-hidden="true" tabindex="-1"></a><span class="co"># Binned means</span></span>
<span id="cb45-1524"><a href="#cb45-1524" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> pd.cut(latest[<span class="st">"state_ownership_pct"</span>], bins<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb45-1525"><a href="#cb45-1525" aria-hidden="true" tabindex="-1"></a>binned <span class="op">=</span> latest.groupby(bins)[<span class="st">"tobin_q_w"</span>].mean()</span>
<span id="cb45-1526"><a href="#cb45-1526" aria-hidden="true" tabindex="-1"></a>bin_centers <span class="op">=</span> [(b.left <span class="op">+</span> b.right) <span class="op">/</span> <span class="dv">2</span> <span class="cf">for</span> b <span class="kw">in</span> binned.index]</span>
<span id="cb45-1527"><a href="#cb45-1527" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(bin_centers, binned.values, color<span class="op">=</span>colors[<span class="st">"quaternary"</span>],</span>
<span id="cb45-1528"><a href="#cb45-1528" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">"Binned Mean"</span>)</span>
<span id="cb45-1529"><a href="#cb45-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1530"><a href="#cb45-1530" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"State Ownership (%)"</span>)</span>
<span id="cb45-1531"><a href="#cb45-1531" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Tobin's Q"</span>)</span>
<span id="cb45-1532"><a href="#cb45-1532" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"State Ownership and Firm Valuation"</span>)</span>
<span id="cb45-1533"><a href="#cb45-1533" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-1534"><a href="#cb45-1534" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb45-1535"><a href="#cb45-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1536"><a href="#cb45-1536" aria-hidden="true" tabindex="-1"></a><span class="co"># Z''-Score by SOE quartile</span></span>
<span id="cb45-1537"><a href="#cb45-1537" aria-hidden="true" tabindex="-1"></a>latest[<span class="st">"soe_quartile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb45-1538"><a href="#cb45-1538" aria-hidden="true" tabindex="-1"></a>    latest[<span class="st">"state_ownership_pct"</span>],</span>
<span id="cb45-1539"><a href="#cb45-1539" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="dv">4</span>, labels<span class="op">=</span>[<span class="st">"Q1 (Low)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4 (High)"</span>],</span>
<span id="cb45-1540"><a href="#cb45-1540" aria-hidden="true" tabindex="-1"></a>    duplicates<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb45-1541"><a href="#cb45-1541" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1542"><a href="#cb45-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1543"><a href="#cb45-1543" aria-hidden="true" tabindex="-1"></a>soe_groups <span class="op">=</span> latest.groupby(<span class="st">"soe_quartile"</span>)[<span class="st">"altman_z_em_w"</span>]</span>
<span id="cb45-1544"><a href="#cb45-1544" aria-hidden="true" tabindex="-1"></a>box_data <span class="op">=</span> [group.values <span class="cf">for</span> name, group <span class="kw">in</span> soe_groups]</span>
<span id="cb45-1545"><a href="#cb45-1545" aria-hidden="true" tabindex="-1"></a>bp <span class="op">=</span> axes[<span class="dv">1</span>].boxplot(</span>
<span id="cb45-1546"><a href="#cb45-1546" aria-hidden="true" tabindex="-1"></a>    box_data,</span>
<span id="cb45-1547"><a href="#cb45-1547" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[name <span class="cf">for</span> name, _ <span class="kw">in</span> soe_groups],</span>
<span id="cb45-1548"><a href="#cb45-1548" aria-hidden="true" tabindex="-1"></a>    patch_artist<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-1549"><a href="#cb45-1549" aria-hidden="true" tabindex="-1"></a>    medianprops<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb45-1550"><a href="#cb45-1550" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1551"><a href="#cb45-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1552"><a href="#cb45-1552" aria-hidden="true" tabindex="-1"></a>gradient_colors <span class="op">=</span> plt.cm.Blues(np.linspace(<span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(bp[<span class="st">"boxes"</span>])))</span>
<span id="cb45-1553"><a href="#cb45-1553" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">"boxes"</span>], gradient_colors):</span>
<span id="cb45-1554"><a href="#cb45-1554" aria-hidden="true" tabindex="-1"></a>    patch.set_facecolor(color)</span>
<span id="cb45-1555"><a href="#cb45-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1556"><a href="#cb45-1556" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="fl">2.60</span>, color<span class="op">=</span><span class="st">"green"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Safe threshold"</span>)</span>
<span id="cb45-1557"><a href="#cb45-1557" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="fl">1.10</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Distress threshold"</span>)</span>
<span id="cb45-1558"><a href="#cb45-1558" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"State Ownership Quartile"</span>)</span>
<span id="cb45-1559"><a href="#cb45-1559" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Z''-Score (Emerging Market)"</span>)</span>
<span id="cb45-1560"><a href="#cb45-1560" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Financial Health by State Ownership"</span>)</span>
<span id="cb45-1561"><a href="#cb45-1561" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb45-1562"><a href="#cb45-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1563"><a href="#cb45-1563" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1564"><a href="#cb45-1564" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1565"><a href="#cb45-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1566"><a href="#cb45-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1567"><a href="#cb45-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exchange-Level Analysis</span></span>
<span id="cb45-1568"><a href="#cb45-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1571"><a href="#cb45-1571" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1572"><a href="#cb45-1572" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-exchange-summary</span></span>
<span id="cb45-1573"><a href="#cb45-1573" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Summary statistics by exchange for Vietnamese listed firms (latest year)"</span></span>
<span id="cb45-1574"><a href="#cb45-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1575"><a href="#cb45-1575" aria-hidden="true" tabindex="-1"></a>exchange_summary <span class="op">=</span> (</span>
<span id="cb45-1576"><a href="#cb45-1576" aria-hidden="true" tabindex="-1"></a>    latest</span>
<span id="cb45-1577"><a href="#cb45-1577" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"exchange"</span>)</span>
<span id="cb45-1578"><a href="#cb45-1578" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb45-1579"><a href="#cb45-1579" aria-hidden="true" tabindex="-1"></a>        n_firms<span class="op">=</span>(<span class="st">"ticker"</span>, <span class="st">"nunique"</span>),</span>
<span id="cb45-1580"><a href="#cb45-1580" aria-hidden="true" tabindex="-1"></a>        median_q<span class="op">=</span>(<span class="st">"tobin_q_w"</span>, <span class="st">"median"</span>),</span>
<span id="cb45-1581"><a href="#cb45-1581" aria-hidden="true" tabindex="-1"></a>        mean_q<span class="op">=</span>(<span class="st">"tobin_q_w"</span>, <span class="st">"mean"</span>),</span>
<span id="cb45-1582"><a href="#cb45-1582" aria-hidden="true" tabindex="-1"></a>        median_z<span class="op">=</span>(<span class="st">"altman_z_w"</span>, <span class="st">"median"</span>),</span>
<span id="cb45-1583"><a href="#cb45-1583" aria-hidden="true" tabindex="-1"></a>        mean_z_em<span class="op">=</span>(<span class="st">"altman_z_em_w"</span>, <span class="st">"mean"</span>),</span>
<span id="cb45-1584"><a href="#cb45-1584" aria-hidden="true" tabindex="-1"></a>        pct_distress_z<span class="op">=</span>(<span class="st">"z_zone"</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">"High Distress"</span>).mean() <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb45-1585"><a href="#cb45-1585" aria-hidden="true" tabindex="-1"></a>        pct_distress_em<span class="op">=</span>(<span class="st">"z_em_zone"</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">"Distress"</span>).mean() <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb45-1586"><a href="#cb45-1586" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">"age_founding"</span>, <span class="st">"median"</span>),</span>
<span id="cb45-1587"><a href="#cb45-1587" aria-hidden="true" tabindex="-1"></a>        median_soe<span class="op">=</span>(<span class="st">"state_ownership_pct"</span>, <span class="st">"median"</span>),</span>
<span id="cb45-1588"><a href="#cb45-1588" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1589"><a href="#cb45-1589" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb45-1590"><a href="#cb45-1590" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1591"><a href="#cb45-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1592"><a href="#cb45-1592" aria-hidden="true" tabindex="-1"></a>exchange_summary.columns <span class="op">=</span> [</span>
<span id="cb45-1593"><a href="#cb45-1593" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N Firms"</span>, <span class="st">"Median Q"</span>, <span class="st">"Mean Q"</span>, <span class="st">"Median Z"</span>, <span class="st">"Mean Z'' (EM)"</span>,</span>
<span id="cb45-1594"><a href="#cb45-1594" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Distress (Z)"</span>, <span class="st">"% Distress (Z'')"</span>, <span class="st">"Median Age"</span>, <span class="st">"Median SOE %"</span></span>
<span id="cb45-1595"><a href="#cb45-1595" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1596"><a href="#cb45-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1597"><a href="#cb45-1597" aria-hidden="true" tabindex="-1"></a>exchange_summary.style.set_properties(<span class="op">**</span>{</span>
<span id="cb45-1598"><a href="#cb45-1598" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-align"</span>: <span class="st">"center"</span>,</span>
<span id="cb45-1599"><a href="#cb45-1599" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font-size"</span>: <span class="st">"10pt"</span></span>
<span id="cb45-1600"><a href="#cb45-1600" aria-hidden="true" tabindex="-1"></a>}).set_table_styles([</span>
<span id="cb45-1601"><a href="#cb45-1601" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"selector"</span>: <span class="st">"th"</span>, <span class="st">"props"</span>: [</span>
<span id="cb45-1602"><a href="#cb45-1602" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"background-color"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb45-1603"><a href="#cb45-1603" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"color"</span>, <span class="st">"white"</span>),</span>
<span id="cb45-1604"><a href="#cb45-1604" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"text-align"</span>, <span class="st">"center"</span>),</span>
<span id="cb45-1605"><a href="#cb45-1605" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"padding"</span>, <span class="st">"8px"</span>)</span>
<span id="cb45-1606"><a href="#cb45-1606" aria-hidden="true" tabindex="-1"></a>    ]},</span>
<span id="cb45-1607"><a href="#cb45-1607" aria-hidden="true" tabindex="-1"></a>]).<span class="bu">format</span>({</span>
<span id="cb45-1608"><a href="#cb45-1608" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Q"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>, <span class="st">"Mean Q"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>,</span>
<span id="cb45-1609"><a href="#cb45-1609" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Z"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>, <span class="st">"Mean Z'' (EM)"</span>: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>,</span>
<span id="cb45-1610"><a href="#cb45-1610" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Distress (Z)"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span>, <span class="st">"% Distress (Z'')"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span>,</span>
<span id="cb45-1611"><a href="#cb45-1611" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Age"</span>: <span class="st">"</span><span class="sc">{:.0f}</span><span class="st">"</span>, <span class="st">"Median SOE %"</span>: <span class="st">"</span><span class="sc">{:.1f}</span><span class="st">%"</span></span>
<span id="cb45-1612"><a href="#cb45-1612" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-1613"><a href="#cb45-1613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1614"><a href="#cb45-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1615"><a href="#cb45-1615" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sector Heatmap: Valuation and Distress</span></span>
<span id="cb45-1616"><a href="#cb45-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1619"><a href="#cb45-1619" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1620"><a href="#cb45-1620" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sector-heatmap</span></span>
<span id="cb45-1621"><a href="#cb45-1621" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Median Tobin's Q and Z''-Score by industry and year for Vietnamese listed firms. Warmer colors indicate higher values."</span></span>
<span id="cb45-1622"><a href="#cb45-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1623"><a href="#cb45-1623" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb45-1624"><a href="#cb45-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1625"><a href="#cb45-1625" aria-hidden="true" tabindex="-1"></a><span class="co"># Tobin's Q heatmap</span></span>
<span id="cb45-1626"><a href="#cb45-1626" aria-hidden="true" tabindex="-1"></a>q_pivot <span class="op">=</span> (</span>
<span id="cb45-1627"><a href="#cb45-1627" aria-hidden="true" tabindex="-1"></a>    final_df</span>
<span id="cb45-1628"><a href="#cb45-1628" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"industry"</span>, <span class="st">"year"</span>])[<span class="st">"tobin_q_w"</span>]</span>
<span id="cb45-1629"><a href="#cb45-1629" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb45-1630"><a href="#cb45-1630" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb45-1631"><a href="#cb45-1631" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1632"><a href="#cb45-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1633"><a href="#cb45-1633" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb45-1634"><a href="#cb45-1634" aria-hidden="true" tabindex="-1"></a>    q_pivot, cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>],</span>
<span id="cb45-1635"><a href="#cb45-1635" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"label"</span>: <span class="st">"Median Q"</span>, <span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb45-1636"><a href="#cb45-1636" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb45-1637"><a href="#cb45-1637" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span><span class="dv">2</span></span>
<span id="cb45-1638"><a href="#cb45-1638" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1639"><a href="#cb45-1639" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Tobin's Q by Industry and Year"</span>)</span>
<span id="cb45-1640"><a href="#cb45-1640" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb45-1641"><a href="#cb45-1641" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="cb45-1642"><a href="#cb45-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1643"><a href="#cb45-1643" aria-hidden="true" tabindex="-1"></a><span class="co"># Z''-Score heatmap</span></span>
<span id="cb45-1644"><a href="#cb45-1644" aria-hidden="true" tabindex="-1"></a>z_pivot <span class="op">=</span> (</span>
<span id="cb45-1645"><a href="#cb45-1645" aria-hidden="true" tabindex="-1"></a>    final_df</span>
<span id="cb45-1646"><a href="#cb45-1646" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"industry"</span>, <span class="st">"year"</span>])[<span class="st">"altman_z_em_w"</span>]</span>
<span id="cb45-1647"><a href="#cb45-1647" aria-hidden="true" tabindex="-1"></a>    .median()</span>
<span id="cb45-1648"><a href="#cb45-1648" aria-hidden="true" tabindex="-1"></a>    .unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb45-1649"><a href="#cb45-1649" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1650"><a href="#cb45-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1651"><a href="#cb45-1651" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb45-1652"><a href="#cb45-1652" aria-hidden="true" tabindex="-1"></a>    z_pivot, cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span><span class="fl">2.6</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>],</span>
<span id="cb45-1653"><a href="#cb45-1653" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"label"</span>: <span class="st">"Median Z''"</span>, <span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb45-1654"><a href="#cb45-1654" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb45-1655"><a href="#cb45-1655" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span><span class="dv">2</span></span>
<span id="cb45-1656"><a href="#cb45-1656" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1657"><a href="#cb45-1657" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Z''-Score (EM) by Industry and Year"</span>)</span>
<span id="cb45-1658"><a href="#cb45-1658" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb45-1659"><a href="#cb45-1659" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="cb45-1660"><a href="#cb45-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1661"><a href="#cb45-1661" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1662"><a href="#cb45-1662" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1663"><a href="#cb45-1663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1664"><a href="#cb45-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1665"><a href="#cb45-1665" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Delisted Firms: Survivorship Bias</span></span>
<span id="cb45-1666"><a href="#cb45-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1667"><a href="#cb45-1667" aria-hidden="true" tabindex="-1"></a>A critical issue in measuring financial distress is survivorship bias. If we only analyze currently listed firms, we miss the very firms that the Z-Score is designed to identify, those that went bankrupt or were delisted.</span>
<span id="cb45-1668"><a href="#cb45-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1671"><a href="#cb45-1671" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1672"><a href="#cb45-1672" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: survivorship-bias</span></span>
<span id="cb45-1673"><a href="#cb45-1673" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Analysis of delisted firms and survivorship bias"</span></span>
<span id="cb45-1674"><a href="#cb45-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1675"><a href="#cb45-1675" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate delisting data (replace with DataCore.vn delisting records)</span></span>
<span id="cb45-1676"><a href="#cb45-1676" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb45-1677"><a href="#cb45-1677" aria-hidden="true" tabindex="-1"></a>n_delisted <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb45-1678"><a href="#cb45-1678" aria-hidden="true" tabindex="-1"></a>delisted_firms <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-1679"><a href="#cb45-1679" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>: [<span class="ss">f"VN</span><span class="sc">{</span><span class="bu">str</span>(i)<span class="sc">.</span>zfill(<span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms <span class="op">+</span> <span class="dv">1</span>, n_firms <span class="op">+</span> n_delisted <span class="op">+</span> <span class="dv">1</span>)],</span>
<span id="cb45-1680"><a href="#cb45-1680" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delist_year"</span>: np.random.randint(<span class="dv">2010</span>, <span class="dv">2024</span>, n_delisted),</span>
<span id="cb45-1681"><a href="#cb45-1681" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delist_reason"</span>: np.random.choice(</span>
<span id="cb45-1682"><a href="#cb45-1682" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"Bankruptcy/Liquidation"</span>, <span class="st">"Merger/Acquisition"</span>, <span class="st">"Voluntary Delisting"</span>,</span>
<span id="cb45-1683"><a href="#cb45-1683" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Regulatory Non-compliance"</span>, <span class="st">"Below Minimum Requirements"</span>],</span>
<span id="cb45-1684"><a href="#cb45-1684" aria-hidden="true" tabindex="-1"></a>        n_delisted,</span>
<span id="cb45-1685"><a href="#cb45-1685" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>[<span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>]</span>
<span id="cb45-1686"><a href="#cb45-1686" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-1687"><a href="#cb45-1687" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-1688"><a href="#cb45-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1689"><a href="#cb45-1689" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of delisting reasons</span></span>
<span id="cb45-1690"><a href="#cb45-1690" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Delisting Reasons Summary"</span>)</span>
<span id="cb45-1691"><a href="#cb45-1691" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb45-1692"><a href="#cb45-1692" aria-hidden="true" tabindex="-1"></a>reason_counts <span class="op">=</span> delisted_firms[<span class="st">"delist_reason"</span>].value_counts()</span>
<span id="cb45-1693"><a href="#cb45-1693" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> reason, count <span class="kw">in</span> reason_counts.items():</span>
<span id="cb45-1694"><a href="#cb45-1694" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>reason<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="op">/</span>n_delisted<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%)"</span>)</span>
<span id="cb45-1695"><a href="#cb45-1695" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total delisted: </span><span class="sc">{</span>n_delisted<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1696"><a href="#cb45-1696" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Currently listed: </span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1697"><a href="#cb45-1697" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Survivorship rate: "</span></span>
<span id="cb45-1698"><a href="#cb45-1698" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>final_df[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="op">/</span>(final_df[<span class="st">'ticker'</span>].nunique()<span class="op">+</span>n_delisted)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb45-1699"><a href="#cb45-1699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1700"><a href="#cb45-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1701"><a href="#cb45-1701" aria-hidden="true" tabindex="-1"></a><span class="fu"># Robustness Checks and Extensions {#sec-robustness}</span></span>
<span id="cb45-1702"><a href="#cb45-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1703"><a href="#cb45-1703" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alternative Tobin's Q Specifications</span></span>
<span id="cb45-1704"><a href="#cb45-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1707"><a href="#cb45-1707" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1708"><a href="#cb45-1708" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-q-variants-comparison</span></span>
<span id="cb45-1709"><a href="#cb45-1709" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparison of Tobin's Q variants: Simple Q (Gompers et al. 2003) vs. Chung-Pruitt approximation. High correlation supports the use of the simpler measure."</span></span>
<span id="cb45-1710"><a href="#cb45-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1711"><a href="#cb45-1711" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb45-1712"><a href="#cb45-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1713"><a href="#cb45-1713" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> latest.dropna(subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"tobin_q_cp"</span>]).copy()</span>
<span id="cb45-1714"><a href="#cb45-1714" aria-hidden="true" tabindex="-1"></a>sample[<span class="st">"tobin_q_cp_w"</span>] <span class="op">=</span> winsorize(sample[<span class="st">"tobin_q_cp"</span>])</span>
<span id="cb45-1715"><a href="#cb45-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1716"><a href="#cb45-1716" aria-hidden="true" tabindex="-1"></a>ax.scatter(</span>
<span id="cb45-1717"><a href="#cb45-1717" aria-hidden="true" tabindex="-1"></a>    sample[<span class="st">"tobin_q_w"</span>], sample[<span class="st">"tobin_q_cp_w"</span>],</span>
<span id="cb45-1718"><a href="#cb45-1718" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span>colors[<span class="st">"primary"</span>], edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb45-1719"><a href="#cb45-1719" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-1720"><a href="#cb45-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1721"><a href="#cb45-1721" aria-hidden="true" tabindex="-1"></a><span class="co"># 45-degree line</span></span>
<span id="cb45-1722"><a href="#cb45-1722" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb45-1723"><a href="#cb45-1723" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb45-1724"><a href="#cb45-1724" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb45-1725"><a href="#cb45-1725" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-1726"><a href="#cb45-1726" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"k--"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb45-1727"><a href="#cb45-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1728"><a href="#cb45-1728" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> sample[<span class="st">"tobin_q_w"</span>].corr(sample[<span class="st">"tobin_q_cp_w"</span>])</span>
<span id="cb45-1729"><a href="#cb45-1729" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="ss">f"Correlation: </span><span class="sc">{</span>corr<span class="sc">:.3f}</span><span class="ss">"</span>,</span>
<span id="cb45-1730"><a href="#cb45-1730" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb45-1731"><a href="#cb45-1731" aria-hidden="true" tabindex="-1"></a>        verticalalignment<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb45-1732"><a href="#cb45-1732" aria-hidden="true" tabindex="-1"></a>        bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round"</span>, facecolor<span class="op">=</span><span class="st">"wheat"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb45-1733"><a href="#cb45-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1734"><a href="#cb45-1734" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Simple Q (Gompers et al.)"</span>)</span>
<span id="cb45-1735"><a href="#cb45-1735" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Chung-Pruitt Q"</span>)</span>
<span id="cb45-1736"><a href="#cb45-1736" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Comparison of Tobin's Q Variants"</span>)</span>
<span id="cb45-1737"><a href="#cb45-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1738"><a href="#cb45-1738" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-1739"><a href="#cb45-1739" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-1740"><a href="#cb45-1740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1741"><a href="#cb45-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1742"><a href="#cb45-1742" aria-hidden="true" tabindex="-1"></a><span class="fu">## Industry-Adjusted Measures</span></span>
<span id="cb45-1743"><a href="#cb45-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1744"><a href="#cb45-1744" aria-hidden="true" tabindex="-1"></a>Raw Tobin's Q and Z-Scores may reflect industry characteristics rather than firm-specific attributes. We compute industry-adjusted versions:</span>
<span id="cb45-1745"><a href="#cb45-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1746"><a href="#cb45-1746" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1747"><a href="#cb45-1747" aria-hidden="true" tabindex="-1"></a>Q^{\text{adj}}_{i,t} = Q_{i,t} - \overline{Q}_{j(i),t}</span>
<span id="cb45-1748"><a href="#cb45-1748" aria-hidden="true" tabindex="-1"></a>$$ {#eq-industry-adj-q}</span>
<span id="cb45-1749"><a href="#cb45-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1750"><a href="#cb45-1750" aria-hidden="true" tabindex="-1"></a>where $\overline{Q}_{j(i),t}$ is the median Tobin's Q of the industry $j$ to which firm $i$ belongs in year $t$.</span>
<span id="cb45-1751"><a href="#cb45-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1754"><a href="#cb45-1754" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1755"><a href="#cb45-1755" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: industry-adjusted</span></span>
<span id="cb45-1756"><a href="#cb45-1756" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Industry-adjusted measures"</span></span>
<span id="cb45-1757"><a href="#cb45-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1758"><a href="#cb45-1758" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> industry_adjust(df, var, group_var<span class="op">=</span><span class="st">"industry"</span>):</span>
<span id="cb45-1759"><a href="#cb45-1759" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute industry-adjusted measure (deviation from industry median)."""</span></span>
<span id="cb45-1760"><a href="#cb45-1760" aria-hidden="true" tabindex="-1"></a>    industry_median <span class="op">=</span> df.groupby([<span class="st">"year"</span>, group_var])[var].transform(<span class="st">"median"</span>)</span>
<span id="cb45-1761"><a href="#cb45-1761" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[var] <span class="op">-</span> industry_median</span>
<span id="cb45-1762"><a href="#cb45-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1763"><a href="#cb45-1763" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">"tobin_q_adj"</span>] <span class="op">=</span> industry_adjust(final_df, <span class="st">"tobin_q_w"</span>)</span>
<span id="cb45-1764"><a href="#cb45-1764" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">"altman_z_em_adj"</span>] <span class="op">=</span> industry_adjust(final_df, <span class="st">"altman_z_em_w"</span>)</span>
<span id="cb45-1765"><a href="#cb45-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1766"><a href="#cb45-1766" aria-hidden="true" tabindex="-1"></a>latest_adj <span class="op">=</span> final_df[final_df[<span class="st">"year"</span>] <span class="op">==</span> latest_year]</span>
<span id="cb45-1767"><a href="#cb45-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1768"><a href="#cb45-1768" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Industry-Adjusted Measures (Latest Year)"</span>)</span>
<span id="cb45-1769"><a href="#cb45-1769" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Tobin's Q (adjusted): mean=</span><span class="sc">{</span>latest_adj[<span class="st">'tobin_q_adj'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb45-1770"><a href="#cb45-1770" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>latest_adj[<span class="st">'tobin_q_adj'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb45-1771"><a href="#cb45-1771" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Z''-Score (adjusted): mean=</span><span class="sc">{</span>latest_adj[<span class="st">'altman_z_em_adj'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb45-1772"><a href="#cb45-1772" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"std=</span><span class="sc">{</span>latest_adj[<span class="st">'altman_z_em_adj'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb45-1773"><a href="#cb45-1773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1774"><a href="#cb45-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1775"><a href="#cb45-1775" aria-hidden="true" tabindex="-1"></a><span class="fu">## Panel Regression with Fixed Effects</span></span>
<span id="cb45-1776"><a href="#cb45-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1777"><a href="#cb45-1777" aria-hidden="true" tabindex="-1"></a>For more rigorous analysis, we estimate a panel model with firm and year fixed effects:</span>
<span id="cb45-1778"><a href="#cb45-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1779"><a href="#cb45-1779" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-1780"><a href="#cb45-1780" aria-hidden="true" tabindex="-1"></a>Q_{i,t} = \alpha_i + \gamma_t + \beta_1 Z''_{i,t} + \beta_2 \ln(\text{Age}_{i,t}) + \beta_3 \text{Size}_{i,t} + \varepsilon_{i,t}</span>
<span id="cb45-1781"><a href="#cb45-1781" aria-hidden="true" tabindex="-1"></a>$$ {#eq-panel-regression}</span>
<span id="cb45-1782"><a href="#cb45-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1785"><a href="#cb45-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-1786"><a href="#cb45-1786" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: panel-regression</span></span>
<span id="cb45-1787"><a href="#cb45-1787" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Panel regression with year and industry fixed effects"</span></span>
<span id="cb45-1788"><a href="#cb45-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1789"><a href="#cb45-1789" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplified within-estimator (year and industry demeaning)</span></span>
<span id="cb45-1790"><a href="#cb45-1790" aria-hidden="true" tabindex="-1"></a>panel <span class="op">=</span> final_df.dropna(</span>
<span id="cb45-1791"><a href="#cb45-1791" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"age_founding"</span>, <span class="st">"at"</span>]</span>
<span id="cb45-1792"><a href="#cb45-1792" aria-hidden="true" tabindex="-1"></a>).copy()</span>
<span id="cb45-1793"><a href="#cb45-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1794"><a href="#cb45-1794" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">"ln_at"</span>] <span class="op">=</span> np.log(panel[<span class="st">"at"</span>])</span>
<span id="cb45-1795"><a href="#cb45-1795" aria-hidden="true" tabindex="-1"></a>panel[<span class="st">"ln_age"</span>] <span class="op">=</span> np.log1p(panel[<span class="st">"age_founding"</span>])</span>
<span id="cb45-1796"><a href="#cb45-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1797"><a href="#cb45-1797" aria-hidden="true" tabindex="-1"></a><span class="co"># Demean by year-industry (proxy for fixed effects)</span></span>
<span id="cb45-1798"><a href="#cb45-1798" aria-hidden="true" tabindex="-1"></a>fe_vars <span class="op">=</span> [<span class="st">"tobin_q_w"</span>, <span class="st">"altman_z_em_w"</span>, <span class="st">"ln_age"</span>, <span class="st">"ln_at"</span>]</span>
<span id="cb45-1799"><a href="#cb45-1799" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> fe_vars:</span>
<span id="cb45-1800"><a href="#cb45-1800" aria-hidden="true" tabindex="-1"></a>    group_mean <span class="op">=</span> panel.groupby([<span class="st">"year"</span>, <span class="st">"industry"</span>])[var].transform(<span class="st">"mean"</span>)</span>
<span id="cb45-1801"><a href="#cb45-1801" aria-hidden="true" tabindex="-1"></a>    panel[<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">_dm"</span>] <span class="op">=</span> panel[var] <span class="op">-</span> group_mean</span>
<span id="cb45-1802"><a href="#cb45-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1803"><a href="#cb45-1803" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS on demeaned data</span></span>
<span id="cb45-1804"><a href="#cb45-1804" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> panel[<span class="st">"tobin_q_w_dm"</span>].values</span>
<span id="cb45-1805"><a href="#cb45-1805" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.column_stack([</span>
<span id="cb45-1806"><a href="#cb45-1806" aria-hidden="true" tabindex="-1"></a>    np.ones(<span class="bu">len</span>(panel)),</span>
<span id="cb45-1807"><a href="#cb45-1807" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"altman_z_em_w_dm"</span>].values,</span>
<span id="cb45-1808"><a href="#cb45-1808" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"ln_age_dm"</span>].values,</span>
<span id="cb45-1809"><a href="#cb45-1809" aria-hidden="true" tabindex="-1"></a>    panel[<span class="st">"ln_at_dm"</span>].values,</span>
<span id="cb45-1810"><a href="#cb45-1810" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb45-1811"><a href="#cb45-1811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1812"><a href="#cb45-1812" aria-hidden="true" tabindex="-1"></a>betas, _, _, _ <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-1813"><a href="#cb45-1813" aria-hidden="true" tabindex="-1"></a>y_hat <span class="op">=</span> X <span class="op">@</span> betas</span>
<span id="cb45-1814"><a href="#cb45-1814" aria-hidden="true" tabindex="-1"></a>resid <span class="op">=</span> y <span class="op">-</span> y_hat</span>
<span id="cb45-1815"><a href="#cb45-1815" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> X.shape</span>
<span id="cb45-1816"><a href="#cb45-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1817"><a href="#cb45-1817" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> (n <span class="op">-</span> k)</span>
<span id="cb45-1818"><a href="#cb45-1818" aria-hidden="true" tabindex="-1"></a>var_beta <span class="op">=</span> sigma2 <span class="op">*</span> np.linalg.inv(X.T <span class="op">@</span> X)</span>
<span id="cb45-1819"><a href="#cb45-1819" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> np.sqrt(np.diag(var_beta))</span>
<span id="cb45-1820"><a href="#cb45-1820" aria-hidden="true" tabindex="-1"></a>t_stats <span class="op">=</span> betas <span class="op">/</span> se</span>
<span id="cb45-1821"><a href="#cb45-1821" aria-hidden="true" tabindex="-1"></a>r_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">sum</span>(resid<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> np.<span class="bu">sum</span>((y <span class="op">-</span> y.mean())<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb45-1822"><a href="#cb45-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1823"><a href="#cb45-1823" aria-hidden="true" tabindex="-1"></a>var_names <span class="op">=</span> [<span class="st">"Constant"</span>, <span class="st">"Z''-Score (EM)"</span>, <span class="st">"ln(Age)"</span>, <span class="st">"ln(Total Assets)"</span>]</span>
<span id="cb45-1824"><a href="#cb45-1824" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1825"><a href="#cb45-1825" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel Regression: Tobin's Q with Year-Industry FE"</span>)</span>
<span id="cb45-1826"><a href="#cb45-1826" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  (Within estimator via year×industry demeaning)"</span>)</span>
<span id="cb45-1827"><a href="#cb45-1827" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1828"><a href="#cb45-1828" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="st">'Variable'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Coef'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Std.Err'</span><span class="sc">:&gt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'t-stat'</span><span class="sc">:&gt;10}</span><span class="ss">"</span>)</span>
<span id="cb45-1829"><a href="#cb45-1829" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1830"><a href="#cb45-1830" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, b, s, t <span class="kw">in</span> <span class="bu">zip</span>(var_names, betas, se, t_stats):</span>
<span id="cb45-1831"><a href="#cb45-1831" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> <span class="st">"***"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">2.576</span> <span class="cf">else</span> <span class="st">"**"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.96</span> <span class="cf">else</span> <span class="st">"*"</span> <span class="cf">if</span> <span class="bu">abs</span>(t) <span class="op">&gt;</span> <span class="fl">1.645</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb45-1832"><a href="#cb45-1832" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>name<span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span>b<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>s<span class="sc">:&gt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>t<span class="sc">:&gt;8.2f}</span><span class="ss"> </span><span class="sc">{</span>sig<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-1833"><a href="#cb45-1833" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1834"><a href="#cb45-1834" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R-squared (within): </span><span class="sc">{</span>r_squared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb45-1835"><a href="#cb45-1835" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Observations: </span><span class="sc">{</span>n<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb45-1836"><a href="#cb45-1836" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb45-1837"><a href="#cb45-1837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-1838"><a href="#cb45-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1839"><a href="#cb45-1839" aria-hidden="true" tabindex="-1"></a><span class="fu"># Practical Considerations and Limitations {#sec-limitations}</span></span>
<span id="cb45-1840"><a href="#cb45-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1841"><a href="#cb45-1841" aria-hidden="true" tabindex="-1"></a><span class="fu">## Known Limitations of Tobin's Q in Vietnam</span></span>
<span id="cb45-1842"><a href="#cb45-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1843"><a href="#cb45-1843" aria-hidden="true" tabindex="-1"></a>Several issues affect the reliability of Tobin's Q estimates for Vietnamese firms:</span>
<span id="cb45-1844"><a href="#cb45-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1845"><a href="#cb45-1845" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Book value as replacement cost proxy**: The simplified Q measure assumes that book value of assets approximates replacement cost. Under VAS's heavy reliance on historical cost, this assumption may be more problematic than in IFRS-adopting countries, particularly for firms with significant land use rights or long-lived tangible assets.</span>
<span id="cb45-1846"><a href="#cb45-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1847"><a href="#cb45-1847" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Market microstructure effects**: Vietnam's daily price limits can prevent market prices from reaching equilibrium, potentially distorting the market value component. Foreign ownership limits may create artificial price premiums for certain stocks.</span>
<span id="cb45-1848"><a href="#cb45-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1849"><a href="#cb45-1849" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Preferred stock rarity**: While this simplifies the computation (most Vietnamese firms have no preferred stock), it means the BE calculation is dominated by common equity, which may not capture all ownership claims.</span>
<span id="cb45-1850"><a href="#cb45-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1851"><a href="#cb45-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Cross-listing effects**: Some Vietnamese firms are listed on multiple venues (HOSE, HNX, UPCoM, or even foreign exchanges). Care must be taken to use consistent price and share data.</span>
<span id="cb45-1852"><a href="#cb45-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1853"><a href="#cb45-1853" aria-hidden="true" tabindex="-1"></a><span class="fu">## Known Limitations of Altman Z-Score in Vietnam</span></span>
<span id="cb45-1854"><a href="#cb45-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1855"><a href="#cb45-1855" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Calibration sample**: The original Z-Score was estimated on mid-20th-century U.S. manufacturing firms. The Z''-Score for emerging markets is more appropriate but was still estimated on a non-Vietnamese sample.</span>
<span id="cb45-1856"><a href="#cb45-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1857"><a href="#cb45-1857" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Accounting differences**: VAS accounting standards produce financial ratios with different distributional properties than US GAAP or IFRS data, potentially affecting the discriminant function's classification accuracy.</span>
<span id="cb45-1858"><a href="#cb45-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1859"><a href="#cb45-1859" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Banking and financial firms**: The Z-Score was not designed for financial institutions, which have fundamentally different balance sheet structures. Banks, insurance companies, and securities firms should be excluded or analyzed separately.</span>
<span id="cb45-1860"><a href="#cb45-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1861"><a href="#cb45-1861" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Implicit guarantees**: SOEs and firms connected to major economic groups may have implicit support that reduces actual default risk below Z-Score predictions.</span>
<span id="cb45-1862"><a href="#cb45-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1863"><a href="#cb45-1863" aria-hidden="true" tabindex="-1"></a><span class="fu">## Recommendations for Researchers</span></span>
<span id="cb45-1864"><a href="#cb45-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1865"><a href="#cb45-1865" aria-hidden="true" tabindex="-1"></a>Based on our analysis, we offer the following recommendations for researchers working with Vietnamese data:</span>
<span id="cb45-1866"><a href="#cb45-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1867"><a href="#cb45-1867" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Use the Z''-Score (Emerging Market) variant** as the primary distress measure for Vietnamese non-financial firms.</span>
<span id="cb45-1868"><a href="#cb45-1868" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Report multiple Q variants** (Simple and Chung-Pruitt) to demonstrate robustness.</span>
<span id="cb45-1869"><a href="#cb45-1869" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Winsorize at 1%/99%** to mitigate the impact of data errors and extreme outliers.</span>
<span id="cb45-1870"><a href="#cb45-1870" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Compute industry-adjusted measures** when making cross-sectional comparisons.</span>
<span id="cb45-1871"><a href="#cb45-1871" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Use founding age** rather than listing age when available, but report both to distinguish organizational maturity from capital market experience.</span>
<span id="cb45-1872"><a href="#cb45-1872" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Exclude financial firms** from Z-Score analysis.</span>
<span id="cb45-1873"><a href="#cb45-1873" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Account for state ownership** as a moderating variable in valuation and distress studies.</span>
<span id="cb45-1874"><a href="#cb45-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1875"><a href="#cb45-1875" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary {#sec-summary}</span></span>
<span id="cb45-1876"><a href="#cb45-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1877"><a href="#cb45-1877" aria-hidden="true" tabindex="-1"></a>This chapter presented a treatment of three fundamental corporate finance measures (i.e., Tobin's Q, the Altman Z-Score, and Company Age). We covered the theoretical foundations of each measure and provided extensive visualizations of cross-sectional and time-series patterns.</span>
<span id="cb45-1878"><a href="#cb45-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1879"><a href="#cb45-1879" aria-hidden="true" tabindex="-1"></a>Key findings from our analysis of Vietnamese listed firms include:</span>
<span id="cb45-1880"><a href="#cb45-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1881"><a href="#cb45-1881" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Tobin's Q** varies substantially across industries and exchanges, with technology and consumer-facing sectors typically commanding higher valuations. HOSE-listed firms tend to have higher Q values than HNX or UPCoM firms, reflecting both firm quality differences and liquidity effects.</span>
<span id="cb45-1882"><a href="#cb45-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1883"><a href="#cb45-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**The Altman Z-Score** reveals that a meaningful proportion of Vietnamese firms operate in or near the distress zone, though the appropriate variant matters; the emerging market Z''-Score provides more nuanced classification than the original model. Financial health shows significant time-series variation, with notable deterioration during economic downturns.</span>
<span id="cb45-1884"><a href="#cb45-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1885"><a href="#cb45-1885" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Company age** in Vietnam requires careful treatment due to the equitization of SOEs, which creates large gaps between founding age and listing age. This distinction is substantively important for understanding the relationship between maturity, valuation, and financial stability.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/26_valuation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>