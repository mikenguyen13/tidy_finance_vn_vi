<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Market Microstructure in Vietnam – Applying Tidy Finance with Python to Vietnam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_risk_free_rate_construction.html" rel="next">
<link href="./02_datacore_data.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d8431037eefe704a1e7a103aa5b75ea7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="4&nbsp; Market Microstructure in Vietnam – Applying Tidy Finance with Python to Vietnam">
<meta property="og:description" content="">
<meta property="og:site_name" content="Applying Tidy Finance with Python to Vietnam">
<meta name="twitter:title" content="4&nbsp; Market Microstructure in Vietnam – Applying Tidy Finance with Python to Vietnam">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_institutional_background.html">Vietnam Financial Markets, Institutions, and Data</a></li><li class="breadcrumb-item"><a href="./03_market_microstructure.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applying Tidy Finance with Python to Vietnam</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Vietnam Financial Markets, Institutions, and Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Institutional Background and Market Structure of Vietnam’s Equity Market</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Accessing and Managing VN Financial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datacore Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_market_microstructure.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_risk_free_rate_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk-Free Rate Construction in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_compound_return.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Compound Returns</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Portfolio Construction, Risk, and Empirical Mechanics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_size_sorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Size Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_value_bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Value and Bivariate Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_portfolio_weighting_and_rebalancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Portfolio Weighting and Rebalancing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Asset Pricing Models and Cross-Sectional Tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_momentum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Firm Fundamentals, Valuation, and Corporate Signals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_info_earnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Information Content of Earnings Announcements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_accruals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Accruals, Earnings Persistence, and Market Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_earning_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./35_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./36_valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./37_disclosure_quality_and_timing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Disclosure Quality and Timing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./38_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./39_divop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Ownership, Market Frictions, and International Exposure</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52_institutional_trade_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Institutional Trades, Flows, and Turnover Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./53_governance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Corporate Governance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./54_return_gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Return Gap: Measuring Unobserved Actions of Fund Managers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./57_exchange_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Exchange Rate Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Data, Research Design, and Frontiers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_textual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Textual Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./65_event_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-market-microstructure" id="toc-what-is-market-microstructure" class="nav-link active" data-scroll-target="#what-is-market-microstructure"><span class="header-section-number">4.1</span> What Is Market Microstructure?</a>
  <ul class="collapse">
  <li><a href="#the-microstructure-asset-pricing-interface" id="toc-the-microstructure-asset-pricing-interface" class="nav-link" data-scroll-target="#the-microstructure-asset-pricing-interface"><span class="header-section-number">4.1.1</span> The Microstructure-Asset Pricing Interface</a></li>
  </ul></li>
  <li><a href="#trading-architecture-in-vietnam" id="toc-trading-architecture-in-vietnam" class="nav-link" data-scroll-target="#trading-architecture-in-vietnam"><span class="header-section-number">4.2</span> Trading Architecture in Vietnam</a>
  <ul class="collapse">
  <li><a href="#exchange-characteristics" id="toc-exchange-characteristics" class="nav-link" data-scroll-target="#exchange-characteristics"><span class="header-section-number">4.2.1</span> Exchange Characteristics</a></li>
  <li><a href="#trading-sessions" id="toc-trading-sessions" class="nav-link" data-scroll-target="#trading-sessions"><span class="header-section-number">4.2.2</span> Trading Sessions</a></li>
  <li><a href="#order-types-and-matching-rules" id="toc-order-types-and-matching-rules" class="nav-link" data-scroll-target="#order-types-and-matching-rules"><span class="header-section-number">4.2.3</span> Order Types and Matching Rules</a></li>
  <li><a href="#tick-size-structure" id="toc-tick-size-structure" class="nav-link" data-scroll-target="#tick-size-structure"><span class="header-section-number">4.2.4</span> Tick Size Structure</a></li>
  <li><a href="#investor-composition" id="toc-investor-composition" class="nav-link" data-scroll-target="#investor-composition"><span class="header-section-number">4.2.5</span> Investor Composition</a></li>
  </ul></li>
  <li><a href="#price-limits-and-their-consequences" id="toc-price-limits-and-their-consequences" class="nav-link" data-scroll-target="#price-limits-and-their-consequences"><span class="header-section-number">4.3</span> Price Limits and Their Consequences</a>
  <ul class="collapse">
  <li><a href="#theoretical-framework" id="toc-theoretical-framework" class="nav-link" data-scroll-target="#theoretical-framework"><span class="header-section-number">4.3.1</span> Theoretical Framework</a></li>
  <li><a href="#detecting-price-limit-hits" id="toc-detecting-price-limit-hits" class="nav-link" data-scroll-target="#detecting-price-limit-hits"><span class="header-section-number">4.3.2</span> Detecting Price Limit Hits</a></li>
  <li><a href="#frequency-of-limit-hits" id="toc-frequency-of-limit-hits" class="nav-link" data-scroll-target="#frequency-of-limit-hits"><span class="header-section-number">4.3.3</span> Frequency of Limit Hits</a></li>
  <li><a href="#volatility-spillover-test" id="toc-volatility-spillover-test" class="nav-link" data-scroll-target="#volatility-spillover-test"><span class="header-section-number">4.3.4</span> Volatility Spillover Test</a></li>
  <li><a href="#return-autocorrelation-induced-by-price-limits" id="toc-return-autocorrelation-induced-by-price-limits" class="nav-link" data-scroll-target="#return-autocorrelation-induced-by-price-limits"><span class="header-section-number">4.3.5</span> Return Autocorrelation Induced by Price Limits</a></li>
  </ul></li>
  <li><a href="#liquidity-thin-trading-and-zero-returns" id="toc-liquidity-thin-trading-and-zero-returns" class="nav-link" data-scroll-target="#liquidity-thin-trading-and-zero-returns"><span class="header-section-number">4.4</span> Liquidity, Thin Trading, and Zero Returns</a>
  <ul class="collapse">
  <li><a href="#measuring-liquidity" id="toc-measuring-liquidity" class="nav-link" data-scroll-target="#measuring-liquidity"><span class="header-section-number">4.4.1</span> Measuring Liquidity</a></li>
  <li><a href="#computing-liquidity-diagnostics" id="toc-computing-liquidity-diagnostics" class="nav-link" data-scroll-target="#computing-liquidity-diagnostics"><span class="header-section-number">4.4.2</span> Computing Liquidity Diagnostics</a></li>
  <li><a href="#cross-sectional-distribution-of-liquidity" id="toc-cross-sectional-distribution-of-liquidity" class="nav-link" data-scroll-target="#cross-sectional-distribution-of-liquidity"><span class="header-section-number">4.4.3</span> Cross-Sectional Distribution of Liquidity</a></li>
  <li><a href="#liquidity-distribution-across-exchanges" id="toc-liquidity-distribution-across-exchanges" class="nav-link" data-scroll-target="#liquidity-distribution-across-exchanges"><span class="header-section-number">4.4.4</span> Liquidity Distribution Across Exchanges</a></li>
  <li><a href="#time-variation-in-aggregate-liquidity" id="toc-time-variation-in-aggregate-liquidity" class="nav-link" data-scroll-target="#time-variation-in-aggregate-liquidity"><span class="header-section-number">4.4.5</span> Time Variation in Aggregate Liquidity</a></li>
  </ul></li>
  <li><a href="#bid-ask-spread-estimation" id="toc-bid-ask-spread-estimation" class="nav-link" data-scroll-target="#bid-ask-spread-estimation"><span class="header-section-number">4.5</span> Bid-Ask Spread Estimation</a></li>
  <li><a href="#non-synchronous-trading-bias" id="toc-non-synchronous-trading-bias" class="nav-link" data-scroll-target="#non-synchronous-trading-bias"><span class="header-section-number">4.6</span> Non-Synchronous Trading Bias</a>
  <ul class="collapse">
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link" data-scroll-target="#the-problem"><span class="header-section-number">4.6.1</span> The Problem</a></li>
  <li><a href="#quantifying-the-bias" id="toc-quantifying-the-bias" class="nav-link" data-scroll-target="#quantifying-the-bias"><span class="header-section-number">4.6.2</span> Quantifying the Bias</a></li>
  <li><a href="#the-dimson-beta-correction" id="toc-the-dimson-beta-correction" class="nav-link" data-scroll-target="#the-dimson-beta-correction"><span class="header-section-number">4.6.3</span> The Dimson Beta Correction</a></li>
  <li><a href="#the-scholes-williams-estimator" id="toc-the-scholes-williams-estimator" class="nav-link" data-scroll-target="#the-scholes-williams-estimator"><span class="header-section-number">4.6.4</span> The Scholes-Williams Estimator</a></li>
  </ul></li>
  <li><a href="#implications-for-portfolio-construction" id="toc-implications-for-portfolio-construction" class="nav-link" data-scroll-target="#implications-for-portfolio-construction"><span class="header-section-number">4.7</span> Implications for Portfolio Construction</a>
  <ul class="collapse">
  <li><a href="#equal-weighted-vs.-value-weighted-returns" id="toc-equal-weighted-vs.-value-weighted-returns" class="nav-link" data-scroll-target="#equal-weighted-vs.-value-weighted-returns"><span class="header-section-number">4.7.1</span> Equal-Weighted vs.&nbsp;Value-Weighted Returns</a></li>
  <li><a href="#recommended-liquidity-filters" id="toc-recommended-liquidity-filters" class="nav-link" data-scroll-target="#recommended-liquidity-filters"><span class="header-section-number">4.7.2</span> Recommended Liquidity Filters</a></li>
  <li><a href="#monthly-vs.-daily-frequency" id="toc-monthly-vs.-daily-frequency" class="nav-link" data-scroll-target="#monthly-vs.-daily-frequency"><span class="header-section-number">4.7.3</span> Monthly vs.&nbsp;Daily Frequency</a></li>
  </ul></li>
  <li><a href="#implications-for-asset-pricing-tests" id="toc-implications-for-asset-pricing-tests" class="nav-link" data-scroll-target="#implications-for-asset-pricing-tests"><span class="header-section-number">4.8</span> Implications for Asset Pricing Tests</a>
  <ul class="collapse">
  <li><a href="#factor-model-estimation" id="toc-factor-model-estimation" class="nav-link" data-scroll-target="#factor-model-estimation"><span class="header-section-number">4.8.1</span> Factor Model Estimation</a></li>
  <li><a href="#adjusted-testing-procedure" id="toc-adjusted-testing-procedure" class="nav-link" data-scroll-target="#adjusted-testing-procedure"><span class="header-section-number">4.8.2</span> Adjusted Testing Procedure</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">4.9</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/03_market_microstructure.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_institutional_background.html">Vietnam Financial Markets, Institutions, and Data</a></li><li class="breadcrumb-item"><a href="./03_market_microstructure.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Microstructure in Vietnam</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter, we examine how the institutional design of Vietnamese equity markets, such as trading sessions, price limits, order types, and investor composition, shapes observed prices, returns, and liquidity. We quantify microstructure frictions and demonstrate why ignoring these frictions leads to biased inference in asset pricing tests.</p>
</div>
</div>
<p>Market microstructure is the study of how trading rules, order handling mechanisms, and market design affect price formation, transaction costs, and liquidity. The field, pioneered by <span class="citation" data-cites="kyle1985continuous">Kyle (<a href="references.html#ref-kyle1985continuous" role="doc-biblioref">1985</a>)</span>, <span class="citation" data-cites="glosten1985bid">Glosten and Milgrom (<a href="references.html#ref-glosten1985bid" role="doc-biblioref">1985</a>)</span>, and <span class="citation" data-cites="hasbrouck2007empirical">Hasbrouck (<a href="references.html#ref-hasbrouck2007empirical" role="doc-biblioref">2007</a>)</span>, provides the analytical toolkit for understanding why observed prices may deviate from fundamental values and for how long.</p>
<p>In developed markets with continuous electronic trading, designated market makers, and minimal regulatory constraints on price movement, microstructure frictions are typically second-order concerns for researchers working at monthly or lower frequencies. In Vietnam’s equity markets, this is emphatically not the case. Daily price limits, thin trading, a predominantly retail investor base, discrete tick sizes, and the absence of formal market-making arrangements generate frictions that propagate into monthly returns, distort factor loadings, and bias portfolio-level inference. Any serious empirical analysis of Vietnamese equities must therefore begin with a careful assessment of market microstructure.</p>
<p>This chapter provides that assessment. We first describe the institutional architecture of Vietnamese equity trading. We then develop diagnostics for the most consequential frictions, such as price limit hits, zero-return days, illiquidity, and non-synchronous trading, and quantify their severity in the cross-section of listed firms. Finally, we derive practical guidance for adjusting portfolio construction and asset pricing tests.</p>
<section id="what-is-market-microstructure" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-is-market-microstructure"><span class="header-section-number">4.1</span> What Is Market Microstructure?</h2>
<p>The textbook assumption of frictionless markets implies that prices continuously and costlessly incorporate information. Under this assumption, the observed return on any asset at any frequency equals the “true” return dictated by fundamentals. Market microstructure relaxes this assumption by recognizing that prices are generated by a specific trading process with real costs, constraints, and imperfections.</p>
<p>The canonical framework of <span class="citation" data-cites="kyle1985continuous">Kyle (<a href="references.html#ref-kyle1985continuous" role="doc-biblioref">1985</a>)</span> models a market with three types of participants:</p>
<ol type="1">
<li>an informed trader who knows the asset’s fundamental value,</li>
<li>noise traders who trade for liquidity reasons, and</li>
<li>a market maker who sets prices to break even in expectation.</li>
</ol>
<p>The key insight is that the market maker cannot distinguish informed from uninformed order flow, so prices adjust gradually to information, creating a wedge between the transaction price and the fundamental value. The size of this wedge (the bid-ask spread) and the speed of price adjustment (market depth) are the core objects of microstructure theory.</p>
<p><span class="citation" data-cites="glosten1985bid">Glosten and Milgrom (<a href="references.html#ref-glosten1985bid" role="doc-biblioref">1985</a>)</span> extend this framework to a sequential trade setting and show that the bid-ask spread has two components: an adverse selection component (compensation for trading against informed traders) and an order processing component (compensation for the mechanical costs of trading). <span class="citation" data-cites="huang1997components">Huang and Stoll (<a href="references.html#ref-huang1997components" role="doc-biblioref">1997</a>)</span> further decompose the spread into realized spread and price impact components. These decompositions are important because they reveal different sources of trading costs and have different implications for market quality.</p>
<p>For empirical asset pricing, the key question is: at what frequency and under what conditions do microstructure effects become negligible? In highly liquid markets, <span class="citation" data-cites="bali2016empirical">Bali, Engle, and Murray (<a href="references.html#ref-bali2016empirical" role="doc-biblioref">2016</a>)</span> argue that monthly returns are largely free of microstructure contamination. In Vietnam, as we demonstrate below, this is not the case. Microstructure effects persist at monthly and even quarterly frequencies for a substantial fraction of listed firms.</p>
<section id="the-microstructure-asset-pricing-interface" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="the-microstructure-asset-pricing-interface"><span class="header-section-number">4.1.1</span> The Microstructure-Asset Pricing Interface</h3>
<p>The interface between microstructure and asset pricing operates through several channels. First, illiquidity itself may be a priced risk factor. <span class="citation" data-cites="amihud2002illiquidity">Amihud (<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">2002</a>)</span> shows that expected illiquidity is positively related to expected stock returns, implying a liquidity premium. <span class="citation" data-cites="pastor2003liquidity">Pástor and Stambaugh (<a href="references.html#ref-pastor2003liquidity" role="doc-biblioref">2003</a>)</span> develop an equilibrium model in which liquidity risk (i.e., the covariance of a stock’s liquidity with market liquidity) commands a risk premium. Second, microstructure noise in prices biases estimated betas, factor loadings, and test statistics. <span class="citation" data-cites="scholes1977estimating">Scholes and Williams (<a href="references.html#ref-scholes1977estimating" role="doc-biblioref">1977</a>)</span> first identified this bias in the context of non-synchronous trading, and <span class="citation" data-cites="dimson1979risk">Dimson (<a href="references.html#ref-dimson1979risk" role="doc-biblioref">1979</a>)</span> proposed an aggregated-coefficients estimator to correct it. Third, price limits and other regulatory constraints censor the return distribution, creating truncation bias in volatility estimates, return moments, and extreme-value statistics <span class="citation" data-cites="kim1997price">(<a href="references.html#ref-kim1997price" role="doc-biblioref">Kim and Rhee 1997</a>)</span>.</p>
<p><a href="#tbl-microstructure-interface" class="quarto-xref">Table&nbsp;<span>4.1</span></a> summarizes these channels and their empirical consequences.</p>
<div id="tbl-microstructure-interface" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-microstructure-interface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Channels Through Which Microstructure Affects Asset Pricing
</figcaption>
<div aria-describedby="tbl-microstructure-interface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 25%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Channel</th>
<th>Mechanism</th>
<th>Empirical Consequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Illiquidity premium</td>
<td>Compensation for bearing transaction costs and inventory risk</td>
<td>Cross-sectional return predictability by liquidity measures</td>
</tr>
<tr class="even">
<td>Non-synchronous trading</td>
<td>Infrequent trading creates stale prices</td>
<td>Downward-biased betas, attenuated correlations, and spurious lead-lag</td>
</tr>
<tr class="odd">
<td>Price limits</td>
<td>Regulatory censoring of daily returns</td>
<td>Truncated return distributions, volatility spillover, and artificial autocorrelation</td>
</tr>
<tr class="even">
<td>Discrete tick sizes</td>
<td>Prices constrained to a grid</td>
<td>Bid-ask bounce, return discreteness, biased volatility</td>
</tr>
<tr class="odd">
<td>Investor composition</td>
<td>Retail-dominated order flow</td>
<td>Noise trading, herding, sentiment-driven pricing</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="trading-architecture-in-vietnam" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="trading-architecture-in-vietnam"><span class="header-section-number">4.2</span> Trading Architecture in Vietnam</h2>
<p>Vietnam operates two stock exchanges: the Ho Chi Minh Stock Exchange (HOSE), established in 2000, and the Hanoi Stock Exchange (HNX), established in 2005. HOSE lists larger firms and accounts for the majority of market capitalization and trading volume. HNX lists smaller firms and also operates the Unlisted Public Company Market (UPCoM) for firms that have not yet met full listing requirements. All three venues operate electronic limit order book systems without designated market makers.</p>
<section id="exchange-characteristics" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="exchange-characteristics"><span class="header-section-number">4.2.1</span> Exchange Characteristics</h3>
<p><a href="#tbl-exchange-comparison" class="quarto-xref">Table&nbsp;<span>4.2</span></a> presents the key structural differences between HOSE, HNX, and UPCoM. These differences have direct implications for liquidity, price discovery, and the severity of microstructure frictions.</p>
<div id="tbl-exchange-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-exchange-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Exchange Comparison: HOSE, HNX, and UPCoM
</figcaption>
<div aria-describedby="tbl-exchange-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>HOSE</th>
<th>HNX</th>
<th>UPCoM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Established</td>
<td>2000</td>
<td>2005</td>
<td>2009</td>
</tr>
<tr class="even">
<td>Listing tier</td>
<td>Large-cap</td>
<td>Mid/small-cap</td>
<td>Pre-listing</td>
</tr>
<tr class="odd">
<td>Daily price limit</td>
<td><span class="math inline">\(\pm\)</span> 7%</td>
<td><span class="math inline">\(\pm\)</span> 10%</td>
<td><span class="math inline">\(\pm\)</span> 15%</td>
</tr>
<tr class="even">
<td>Tick size regime</td>
<td>Tiered by price</td>
<td>Tiered by price</td>
<td>100 VND</td>
</tr>
<tr class="odd">
<td>Trading lot</td>
<td>100 shares</td>
<td>100 shares</td>
<td>100 shares</td>
</tr>
<tr class="even">
<td>Short selling</td>
<td>Limited</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr class="odd">
<td>Foreign ownership cap</td>
<td>Industry-specific</td>
<td>Industry-specific</td>
<td>Industry-specific</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The heterogeneous price limit bands across exchanges create a natural experiment for studying limit effects. HOSE’s tighter <span class="math inline">\(\pm\)</span> 7% band means that large-cap stocks are more frequently constrained than mid-cap stocks on HNX, conditional on the same information shock. UPCoM’s wider <span class="math inline">\(\pm\)</span> 15% band provides the least constrained environment, though its stocks are also the least liquid.</p>
</section>
<section id="trading-sessions" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="trading-sessions"><span class="header-section-number">4.2.2</span> Trading Sessions</h3>
<p>Each exchange operates a structured trading day with distinct sessions. Understanding session structure is essential because price formation mechanisms differ across sessions, and certain sessions are disproportionately important for benchmark pricing.</p>
<p>The closing auction (ATC) deserves particular attention. The ATC price is the official closing price used for index calculation, NAV computation, and margin requirements. Because it is determined by a single-bid auction, it can be manipulated by strategically timed orders, a phenomenon documented in numerous emerging markets <span class="citation" data-cites="comerton2009anonymity hillion2004manipulation">(<a href="references.html#ref-comerton2009anonymity" role="doc-biblioref">Comerton-Forde and Tang 2009</a>; <a href="references.html#ref-hillion2004manipulation" role="doc-biblioref">Hillion and Suominen 2004</a>)</span>. Researchers using daily closing prices should be aware that ATC prices may not reflect the continuous-session equilibrium, particularly for less liquid stocks where a single large order can move the closing price.</p>
</section>
<section id="order-types-and-matching-rules" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="order-types-and-matching-rules"><span class="header-section-number">4.2.3</span> Order Types and Matching Rules</h3>
<p>Vietnamese exchanges support a limited set of order types compared to developed markets (<a href="#tbl-order-types" class="quarto-xref">Table&nbsp;<span>4.3</span></a>).</p>
<div id="tbl-order-types" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-order-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: Available Order Types
</figcaption>
<div aria-describedby="tbl-order-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th>Order Type</th>
<th>Description</th>
<th>Availability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Limit order (LO)</td>
<td>Specifies price and quantity</td>
<td>All sessions</td>
</tr>
<tr class="even">
<td>Market order (ATO/ATC)</td>
<td>Matches at auction price</td>
<td>Auction sessions only</td>
</tr>
<tr class="odd">
<td>Market-to-limit (MTL)</td>
<td>Converts to limit at best available</td>
<td>HNX only</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The absence of iceberg orders, stop orders, and hidden orders means that the full limit order book is visible to all participants. While this enhances pre-trade transparency, it also means that large institutional orders face significant information leakage risk, which may deter institutional participation and reduce market depth.</p>
<p>Orders are matched on a strict price-time priority basis during continuous sessions. During auction sessions, a single clearing price is determined that maximizes executed volume. If multiple prices satisfy this criterion, the price closest to the previous closing price is selected.</p>
</section>
<section id="tick-size-structure" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="tick-size-structure"><span class="header-section-number">4.2.4</span> Tick Size Structure</h3>
<p>Tick sizes on HOSE are tiered by price level, which creates discontinuities in the bid-ask spread as a percentage of price.</p>
<div class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>tick_sizes <span class="op">=</span> pd.DataFrame({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Price Range (VND)"</span>: [</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt; 10,000"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"10,000–49,900"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≥ 50,000"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tick Size (VND)"</span>: [<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Minimum Spread as </span><span class="sc">% o</span><span class="st">f Midpoint"</span>: [</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.10% at 10,000"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.10% at 50,000"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.20% at 50,000"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>tick_sizes.style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-tick-sizes" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tick-sizes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.4: Tick Size Schedule on HOSE
</figcaption>
<div aria-describedby="tbl-tick-sizes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="2">
<style type="text/css">
</style>

<table id="T_8eac6" class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th id="T_8eac6_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Price Range (VND)</th>
<th id="T_8eac6_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Tick Size (VND)</th>
<th id="T_8eac6_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Minimum Spread as % of Midpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_8eac6_row0_col0" class="data row0 col0">&lt; 10,000</td>
<td id="T_8eac6_row0_col1" class="data row0 col1">10</td>
<td id="T_8eac6_row0_col2" class="data row0 col2">0.10% at 10,000</td>
</tr>
<tr class="even">
<td id="T_8eac6_row1_col0" class="data row1 col0">10,000–49,900</td>
<td id="T_8eac6_row1_col1" class="data row1 col1">50</td>
<td id="T_8eac6_row1_col2" class="data row1 col2">0.10% at 50,000</td>
</tr>
<tr class="odd">
<td id="T_8eac6_row2_col0" class="data row2 col0">≥ 50,000</td>
<td id="T_8eac6_row2_col1" class="data row2 col1">100</td>
<td id="T_8eac6_row2_col2" class="data row2 col2">0.20% at 50,000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The jump from a 50 VND tick to a 100 VND tick at the 50,000 VND boundary means that the minimum percentage spread doubles discontinuously. This creates a “tick size cliff” that can affect the cross-sectional distribution of bid-ask spreads and, consequently, the measurement of illiquidity <span class="citation" data-cites="vo2023minimum">(<a href="references.html#ref-vo2023minimum" role="doc-biblioref">Vo and Doan 2023</a>)</span>. <span class="citation" data-cites="bessembinder2003trade">Bessembinder (<a href="references.html#ref-bessembinder2003trade" role="doc-biblioref">2003</a>)</span> document similar effects in other markets with tiered tick structures.</p>
</section>
<section id="investor-composition" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="investor-composition"><span class="header-section-number">4.2.5</span> Investor Composition</h3>
<p>The Vietnamese equity market is predominantly driven by retail investors. While foreign institutional investors account for a meaningful share of market capitalization (particularly in blue-chip stocks subject to foreign ownership limits), daily trading volume is overwhelmingly generated by domestic retail accounts.</p>
<p>This retail dominance has several consequences for microstructure. First, retail investors tend to submit smaller orders and trade more frequently, generating high message-to-trade ratios but limited depth at each price level. Second, retail order flow is more susceptible to herding and sentiment, which can amplify momentum and generate excess volatility <span class="citation" data-cites="barber2009just kaniel2012individual">(<a href="references.html#ref-barber2009just" role="doc-biblioref">Barber et al. 2009</a>; <a href="references.html#ref-kaniel2012individual" role="doc-biblioref">Kaniel et al. 2012</a>)</span>. Third, the limited institutional presence means that sophisticated liquidity provision is scarce, particularly in mid- and small-cap stocks.</p>
</section>
</section>
<section id="price-limits-and-their-consequences" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="price-limits-and-their-consequences"><span class="header-section-number">4.3</span> Price Limits and Their Consequences</h2>
<p>Vietnam enforces daily price limits on all listed equities. A stock’s price cannot move beyond a fixed percentage of the previous day’s closing price within a single trading day. The limit bands are <span class="math inline">\(\pm\)</span> 7% on HOSE, <span class="math inline">\(\pm\)</span> 10% on HNX, and <span class="math inline">\(\pm\)</span> 15% on UPCoM.</p>
<section id="theoretical-framework" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="theoretical-framework"><span class="header-section-number">4.3.1</span> Theoretical Framework</h3>
<p>Price limits were introduced with the stated goal of reducing volatility and preventing panic-driven price dislocations. However, the academic literature presents a more nuanced picture. The “magnet effect” hypothesis <span class="citation" data-cites="subrahmanyam1994circuit">(<a href="references.html#ref-subrahmanyam1994circuit" role="doc-biblioref">Subrahmanyam 1994</a>)</span> predicts that price limits actually accelerate price movement toward the limit as traders rush to execute before the limit is hit. The “delayed price discovery” hypothesis <span class="citation" data-cites="Fama1989">(<a href="references.html#ref-Fama1989" role="doc-biblioref">Fama and French 1989</a>)</span> argues that limits merely postpone inevitable price adjustments, creating volatility spillover into subsequent days.</p>
<p>Formally, let <span class="math inline">\(P_t^*\)</span> denote the equilibrium price on day <span class="math inline">\(t\)</span> and <span class="math inline">\(P_{t-1}^c\)</span> the previous closing price. The observed return is:</p>
<p><span id="eq-price-limit"><span class="math display">\[
r_t^{obs} = \begin{cases}
\bar{L} &amp; \text{if } r_t^* \geq \bar{L} \\
r_t^* &amp; \text{if } \underline{L} &lt; r_t^* &lt; \bar{L} \\
\underline{L} &amp; \text{if } r_t^* \leq \underline{L}
\end{cases}
\tag{4.1}\]</span></span></p>
<p>where <span class="math inline">\(r_t^* = \ln(P_t^* / P_{t-1}^c)\)</span> is the latent (unconstrained) return, <span class="math inline">\(\bar{L}\)</span> is the upper limit, and <span class="math inline">\(\underline{L}\)</span> is the lower limit. The observed return <span class="math inline">\(r_t^{obs}\)</span> is a censored version of the true return. This censoring has several consequences:</p>
<ol type="1">
<li><p><strong>Truncated moments</strong>: The observed variance <span class="math inline">\(\text{Var}(r_t^{obs}) &lt; \text{Var}(r_t^*)\)</span> because extreme returns are clipped. This biases downward any volatility-based risk measure.</p></li>
<li><p><strong>Artificial autocorrelation</strong>: When <span class="math inline">\(r_t^{obs} = \bar{L}\)</span> and <span class="math inline">\(r_{t+1}^{obs} &gt; 0\)</span> (continued adjustment the next day), the return series exhibits positive autocorrelation that is purely mechanical, not informational.</p></li>
<li><p><strong>Volatility spillover</strong>: Define excess volatility on day <span class="math inline">\(t+1\)</span> as <span class="math inline">\(\sigma_{t+1}^2 - E[\sigma_{t+1}^2 | \text{no limit hit on day } t]\)</span>. <span class="citation" data-cites="kim1997price">Kim and Rhee (<a href="references.html#ref-kim1997price" role="doc-biblioref">1997</a>)</span> and <span class="citation" data-cites="chu2019forecasting">Chu and Qiu (<a href="references.html#ref-chu2019forecasting" role="doc-biblioref">2019</a>)</span> document significant positive spillover, where days following limit hits exhibit abnormally high volatility.</p></li>
<li><p><strong>Biased extreme value statistics</strong>: Measures such as Value-at-Risk, Expected Shortfall, and maximum drawdown are mechanically bounded by the limit, understating true tail risk.</p></li>
</ol>
</section>
<section id="detecting-price-limit-hits" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="detecting-price-limit-hits"><span class="header-section-number">4.3.2</span> Detecting Price Limit Hits</h3>
<p>We now implement a diagnostic to detect price limit hits in the daily data.</p>
<div id="detect-limit-hits" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load daily price data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>tidy_finance <span class="op">=</span> sqlite3.<span class="ex">connect</span>(database<span class="op">=</span><span class="st">"data/tidy_finance_python.sqlite"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume prices_daily contains: symbol, date, close, exchange</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , exchange</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, close</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_daily</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>).dropna()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="d7fac3e0" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define limit bands by exchange</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>limit_bands <span class="op">=</span> {<span class="st">"HOSE"</span>: <span class="fl">0.07</span>, <span class="st">"HNX"</span>: <span class="fl">0.10</span>, <span class="st">"UPCoM"</span>: <span class="fl">0.15</span>}</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> prices_daily.sort_values([<span class="st">"symbol"</span>, <span class="st">"date"</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"prev_close"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"close"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"close"</span>] <span class="op">/</span> prices_daily[<span class="st">"prev_close"</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_band"</span>] <span class="op">=</span> prices_daily[<span class="st">"exchange"</span>].<span class="bu">map</span>(limit_bands)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A limit hit occurs when the return is within 0.1% of the theoretical limit</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>tolerance <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"upper_hit"</span>] <span class="op">=</span> (</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"ret"</span>] <span class="op">&gt;=</span> prices_daily[<span class="st">"limit_band"</span>] <span class="op">-</span> tolerance</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"lower_hit"</span>] <span class="op">=</span> (</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"ret"</span>] <span class="op">&lt;=</span> <span class="op">-</span>prices_daily[<span class="st">"limit_band"</span>] <span class="op">+</span> tolerance</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_hit"</span>] <span class="op">=</span> (</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"upper_hit"</span>] <span class="op">|</span> prices_daily[<span class="st">"lower_hit"</span>]</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="frequency-of-limit-hits" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="frequency-of-limit-hits"><span class="header-section-number">4.3.3</span> Frequency of Limit Hits</h3>
<div id="fig-limit-hit-frequency" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-limit-hit-frequency-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"year_month"</span>] <span class="op">=</span> prices_daily[<span class="st">"date"</span>].dt.to_period(<span class="st">"M"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly <span class="op">=</span> (</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year_month"</span>, <span class="st">"exchange"</span>])</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        total_obs<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"count"</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        limit_hits<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"sum"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly[<span class="st">"hit_rate"</span>] <span class="op">=</span> (</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    limit_hit_monthly[<span class="st">"limit_hits"</span>] <span class="op">/</span> limit_hit_monthly[<span class="st">"total_obs"</span>]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly[<span class="st">"date"</span>] <span class="op">=</span> limit_hit_monthly[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> limit_hit_monthly[limit_hit_monthly[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    ax.plot(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"date"</span>], subset[<span class="st">"hit_rate"</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>exchange, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.2</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Limit Hit Rate (%)"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-limit-hit-frequency-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1
</figcaption>
</figure>
</div>
</section>
<section id="volatility-spillover-test" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="volatility-spillover-test"><span class="header-section-number">4.3.4</span> Volatility Spillover Test</h3>
<p>Following <span class="citation" data-cites="kim1997price">Kim and Rhee (<a href="references.html#ref-kim1997price" role="doc-biblioref">1997</a>)</span>, we test whether days following a limit hit exhibit abnormally high volatility. Define the dummy variable <span class="math inline">\(D_t = 1\)</span> if a limit hit occurred on day <span class="math inline">\(t\)</span>, and estimate:</p>
<p><span id="eq-vol-spillover"><span class="math display">\[
\sigma_{t+1}^2 = \alpha + \beta D_t + \gamma \sigma_t^2 + \varepsilon_{t+1}
\tag{4.2}\]</span></span></p>
<p>where <span class="math inline">\(\sigma_t^2\)</span> is the squared return. A positive and significant <span class="math inline">\(\beta\)</span> indicates volatility spillover attributable to the price limit.</p>
<div id="volatility-spillover-test" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel-level volatility spillover test</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"sq_ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"ret"</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"sq_ret_lead"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"sq_ret"</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_hit_int"</span>] <span class="op">=</span> prices_daily[<span class="st">"limit_hit"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>spillover_data <span class="op">=</span> prices_daily.dropna(subset<span class="op">=</span>[<span class="st">"sq_ret_lead"</span>, <span class="st">"sq_ret"</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(spillover_data[[<span class="st">"limit_hit_int"</span>, <span class="st">"sq_ret"</span>]])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> spillover_data[<span class="st">"sq_ret_lead"</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">"cluster"</span>, cov_kwds<span class="op">=</span>{<span class="st">"groups"</span>: spillover_data[<span class="st">"symbol"</span>]})</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>spillover_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Coefficient"</span>: model.params,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Std. Error"</span>: model.bse,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"t-stat"</span>: model.tvalues,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p-value"</span>: model.pvalues</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">6</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(spillover_results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>A significant positive coefficient on the limit hit dummy confirms that Vietnamese price limits do not eliminate volatility, they merely redistribute it across days. This has direct implications for risk management: daily VaR measures computed from censored returns understate true risk exposure.</p>
</div>
</div>
</section>
<section id="return-autocorrelation-induced-by-price-limits" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="return-autocorrelation-induced-by-price-limits"><span class="header-section-number">4.3.5</span> Return Autocorrelation Induced by Price Limits</h3>
<p>Price limits mechanically induce positive autocorrelation in returns. To quantify this, we compute the first-order autocorrelation coefficient separately for stocks that hit limits frequently versus those that do not.</p>
<div id="tbl-autocorrelation-by-limit" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="8">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-autocorrelation-by-limit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.5: Return Autocorrelation by Price Limit Hit Frequency
</figcaption>
<div aria-describedby="tbl-autocorrelation-by-limit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify stocks by limit hit frequency</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stock_limit_freq <span class="op">=</span> (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        hit_rate<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"mean"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        n_obs<span class="op">=</span>(<span class="st">"ret"</span>, <span class="st">"count"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    .query(<span class="st">"n_obs &gt;= 250"</span>)  <span class="co"># At least 1 year of data</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>stock_limit_freq[<span class="st">"limit_group"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    stock_limit_freq[<span class="st">"hit_rate"</span>], q<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation by group</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_autocorr(group_symbols):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> prices_daily[prices_daily[<span class="st">"symbol"</span>].isin(group_symbols)].copy()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">"ret_lag"</span>] <span class="op">=</span> subset.groupby(<span class="st">"symbol"</span>)[<span class="st">"ret"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subset[[<span class="st">"ret"</span>, <span class="st">"ret_lag"</span>]].dropna().corr().iloc[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>autocorr_results <span class="op">=</span> []</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>]:</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    symbols <span class="op">=</span> stock_limit_freq[stock_limit_freq[<span class="st">"limit_group"</span>] <span class="op">==</span> group].index</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    ac <span class="op">=</span> compute_autocorr(symbols)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    n_stocks <span class="op">=</span> <span class="bu">len</span>(symbols)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    avg_hit_rate <span class="op">=</span> stock_limit_freq.loc[symbols, <span class="st">"hit_rate"</span>].mean()</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    autocorr_results.append({</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Group"</span>: group,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"N Stocks"</span>: n_stocks,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Avg Limit Hit Rate (%)"</span>: <span class="bu">round</span>(avg_hit_rate <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AR(1)"</span>: <span class="bu">round</span>(ac, <span class="dv">4</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(autocorr_results).style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</figure>
</div>
<p>The expected pattern is a monotonically increasing autocorrelation from the Low to High limit-hit group, confirming that the observed serial dependence in returns is at least partly an artifact of price censoring rather than genuine return predictability.</p>
</section>
</section>
<section id="liquidity-thin-trading-and-zero-returns" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="liquidity-thin-trading-and-zero-returns"><span class="header-section-number">4.4</span> Liquidity, Thin Trading, and Zero Returns</h2>
<p>Liquidity (i.e., the ability to trade quickly at low cost without moving the price) is a first-order concern in Vietnamese equities. A substantial fraction of listed firms, particularly on HNX and UPCoM, experience chronic illiquidity characterized by infrequent trading, wide bid-ask spreads, and frequent zero-return days.</p>
<section id="measuring-liquidity" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="measuring-liquidity"><span class="header-section-number">4.4.1</span> Measuring Liquidity</h3>
<p>The academic literature has developed numerous liquidity measures, each capturing a different dimension of market quality. @#tbl-liquidity-measures summarizes the measures most applicable to Vietnamese data, given typical data availability.</p>
<div id="tbl-liquidity-measures" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-liquidity-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.6: Liquidity Measures for Vietnamese Equities
</figcaption>
<div aria-describedby="tbl-liquidity-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Measure</th>
<th>Formula</th>
<th>Interpretation</th>
<th>Data Required</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Turnover ratio</td>
<td><span class="math inline">\(\text{TO}_{i,t} = \frac{\text{Volume}_{i,t}}{\text{Shares Outstanding}_{i}}\)</span></td>
<td>Trading intensity relative to float</td>
<td>Volume, shares outstanding</td>
</tr>
<tr class="even">
<td>Amihud illiquidity</td>
<td><span class="math inline">\(\text{ILLIQ}_{i,t} = \frac{1}{D} \sum_{d=1}^{D} \frac{|r_{i,d}|}{V_{i,d}}\)</span></td>
<td>Price impact per unit of volume</td>
<td>Daily returns, daily volume</td>
</tr>
<tr class="odd">
<td>Zero-return proportion</td>
<td><span class="math inline">\(\text{ZR}_{i,t} = \frac{\#\{d : r_{i,d} = 0\}}{D}\)</span></td>
<td>Frequency of non-trading or stale pricing</td>
<td>Daily returns</td>
</tr>
<tr class="even">
<td>Roll spread</td>
<td><span class="math inline">\(\hat{S}_i = 2\sqrt{-\text{Cov}(r_{i,d}, r_{i,d-1})}\)</span></td>
<td>Effective bid-ask spread estimate</td>
<td>Daily returns</td>
</tr>
<tr class="odd">
<td>Bid-ask spread</td>
<td><span class="math inline">\(\text{BA}_{i,d} = \frac{\text{Ask}_{i,d} - \text{Bid}_{i,d}}{(\text{Ask}_{i,d} + \text{Bid}_{i,d})/2}\)</span></td>
<td>Direct transaction cost</td>
<td>Quote data</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The Amihud illiquidity ratio <span class="citation" data-cites="amihud2002illiquidity">(<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">Amihud 2002</a>)</span> is particularly useful because it requires only daily return and volume data. It captures the price impact of trading (i.e., the return per unit of currency volume) and has been shown to correlate well with more sophisticated microstructure-based measures such as the effective spread <span class="citation" data-cites="goyenko2009liquidity">Goyenko and Ukhov (<a href="references.html#ref-goyenko2009stock" role="doc-biblioref">2009</a>)</span>.</p>
</section>
<section id="computing-liquidity-diagnostics" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="computing-liquidity-diagnostics"><span class="header-section-number">4.4.2</span> Computing Liquidity Diagnostics</h3>
<div id="compute-liquidity" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standard liquidity measures at the stock-month level</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"abs_ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"ret"</span>].<span class="bu">abs</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"zero_return"</span>] <span class="op">=</span> (prices_daily[<span class="st">"ret"</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"year_month"</span>] <span class="op">=</span> prices_daily[<span class="st">"date"</span>].dt.to_period(<span class="st">"M"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume volume is in shares and value is in VND</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Amihud: average |ret| / value (in billions VND)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"amihud_daily"</span>] <span class="op">=</span> np.where(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"value"</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"abs_ret"</span>] <span class="op">/</span> (prices_daily[<span class="st">"value"</span>] <span class="op">/</span> <span class="fl">1e9</span>),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    np.nan</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>liquidity_monthly <span class="op">=</span> (</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        zero_return_share<span class="op">=</span>(<span class="st">"zero_return"</span>, <span class="st">"mean"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        avg_turnover<span class="op">=</span>(<span class="st">"turnover"</span>, <span class="st">"mean"</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        amihud<span class="op">=</span>(<span class="st">"amihud_daily"</span>, <span class="st">"mean"</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        trading_days<span class="op">=</span>(<span class="st">"ret"</span>, <span class="st">"count"</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        avg_daily_value<span class="op">=</span>(<span class="st">"value"</span>, <span class="st">"mean"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Flag severely illiquid stock-months</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>liquidity_monthly[<span class="st">"illiquid_flag"</span>] <span class="op">=</span> (</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"zero_return_share"</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">|</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"trading_days"</span>] <span class="op">&lt;</span> <span class="dv">10</span>) <span class="op">|</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"avg_daily_value"</span>] <span class="op">&lt;</span> <span class="fl">1e8</span>)  <span class="co"># &lt; 100M VND/day</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cross-sectional-distribution-of-liquidity" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="cross-sectional-distribution-of-liquidity"><span class="header-section-number">4.4.3</span> Cross-Sectional Distribution of Liquidity</h3>
<div id="tbl-liquidity-distribution" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="10">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-liquidity-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.7: Cross-Sectional Distribution of Liquidity Measures (Latest Full Year)
</figcaption>
<div aria-describedby="tbl-liquidity-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>latest_year <span class="op">=</span> liquidity_monthly[<span class="st">"year_month"</span>].dt.year.<span class="bu">max</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>annual_liq <span class="op">=</span> (</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    liquidity_monthly[liquidity_monthly[<span class="st">"year_month"</span>].dt.year <span class="op">==</span> latest_year]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        zero_return_share<span class="op">=</span>(<span class="st">"zero_return_share"</span>, <span class="st">"mean"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        avg_turnover<span class="op">=</span>(<span class="st">"avg_turnover"</span>, <span class="st">"mean"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        amihud<span class="op">=</span>(<span class="st">"amihud"</span>, <span class="st">"mean"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        avg_daily_value_m<span class="op">=</span>(<span class="st">"avg_daily_value"</span>, <span class="kw">lambda</span> x: x.mean() <span class="op">/</span> <span class="fl">1e6</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> annual_liq.describe(percentiles<span class="op">=</span>[<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>]).T</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> summary_stats[</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"mean"</span>, <span class="st">"std"</span>, <span class="st">"10%"</span>, <span class="st">"25%"</span>, <span class="st">"50%"</span>, <span class="st">"75%"</span>, <span class="st">"90%"</span>]</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>].<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>summary_stats.columns <span class="op">=</span> [<span class="st">"Mean"</span>, <span class="st">"Std"</span>, <span class="st">"P10"</span>, <span class="st">"P25"</span>, <span class="st">"Median"</span>, <span class="st">"P75"</span>, <span class="st">"P90"</span>]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>summary_stats.index <span class="op">=</span> [</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Zero-Return Share"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Daily Turnover"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amihud Illiquidity"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Daily Value (M VND)"</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>summary_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</figure>
</div>
</section>
<section id="liquidity-distribution-across-exchanges" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="liquidity-distribution-across-exchanges"><span class="header-section-number">4.4.4</span> Liquidity Distribution Across Exchanges</h3>
<div id="fig-liquidity-by-exchange" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="11">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-by-exchange-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge exchange info</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>stock_exchange <span class="op">=</span> (</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    prices_daily[[<span class="st">"symbol"</span>, <span class="st">"exchange"</span>]]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates(<span class="st">"symbol"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>annual_liq_exch <span class="op">=</span> annual_liq.merge(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    stock_exchange, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">"symbol"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero-return share</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> annual_liq_exch[annual_liq_exch[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].hist(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"zero_return_share"</span>], bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>color, label<span class="op">=</span>exchange, density<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Zero-Return Share"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Amihud (log scale)</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> annual_liq_exch[annual_liq_exch[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    amihud_log <span class="op">=</span> np.log(subset[<span class="st">"amihud"</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>))</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].hist(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        amihud_log, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>color, label<span class="op">=</span>exchange, density<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Log Amihud Illiquidity"</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-liquidity-by-exchange-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2
</figcaption>
</figure>
</div>
<p>The distributions typically reveal a bimodal pattern: HOSE stocks cluster at low illiquidity values, while HNX and especially UPCoM stocks exhibit a long right tail of extreme illiquidity. This heterogeneity implies that a single liquidity filter or treatment is insufficient for the entire cross-section.</p>
</section>
<section id="time-variation-in-aggregate-liquidity" class="level3" data-number="4.4.5">
<h3 data-number="4.4.5" class="anchored" data-anchor-id="time-variation-in-aggregate-liquidity"><span class="header-section-number">4.4.5</span> Time Variation in Aggregate Liquidity</h3>
<p>Market-wide liquidity is not constant. It deteriorates during crises, policy uncertainty, and periods of capital outflow, and improves during bull markets and periods of foreign inflow. The time variation in aggregate liquidity is itself a risk factor <span class="citation" data-cites="pastor2003liquidity">(<a href="references.html#ref-pastor2003liquidity" role="doc-biblioref">Pástor and Stambaugh 2003</a>)</span>.</p>
<div id="fig-aggregate-liquidity" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="12">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aggregate-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>agg_liquidity <span class="op">=</span> (</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    liquidity_monthly</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"year_month"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        median_amihud<span class="op">=</span>(<span class="st">"amihud"</span>, <span class="st">"median"</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        median_zero_ret<span class="op">=</span>(<span class="st">"zero_return_share"</span>, <span class="st">"median"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        total_value<span class="op">=</span>(<span class="st">"avg_daily_value"</span>, <span class="st">"sum"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>agg_liquidity[<span class="st">"date"</span>] <span class="op">=</span> agg_liquidity[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"date"</span>],</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    np.log(agg_liquidity[<span class="st">"median_amihud"</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>)),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2C73D2"</span>, linewidth<span class="op">=</span><span class="fl">1.2</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">"Log Median Amihud"</span>, color<span class="op">=</span><span class="st">"#2C73D2"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">"y"</span>, labelcolor<span class="op">=</span><span class="st">"#2C73D2"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ax2.fill_between(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"date"</span>],</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"median_zero_ret"</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"#FF6B6B"</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"Median Zero-Return Share (%)"</span>, color<span class="op">=</span><span class="st">"#FF6B6B"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">"y"</span>, labelcolor<span class="op">=</span><span class="st">"#FF6B6B"</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>ax1.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-aggregate-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3
</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Practical Recommendation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before any asset pricing analysis, apply the following liquidity filter: exclude stock-months where the zero-return share exceeds 50%, where fewer than 15 trading days are observed, or where average daily trading value falls below a threshold (e.g., 100 million VND). Document the filter explicitly, and report sensitivity of results to alternative thresholds.</p>
</div>
</div>
</section>
</section>
<section id="bid-ask-spread-estimation" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="bid-ask-spread-estimation"><span class="header-section-number">4.5</span> Bid-Ask Spread Estimation</h2>
<p>In the absence of comprehensive quote data, the effective bid-ask spread can be estimated from transaction data using the method of <span class="citation" data-cites="roll1984simple">Roll (<a href="references.html#ref-roll1984simple" role="doc-biblioref">1984</a>)</span>. The Roll estimator exploits the fact that if the bid-ask bounce is the sole source of negative serial covariance in returns, then:</p>
<p><span id="eq-roll"><span class="math display">\[
\hat{S}_{\text{Roll}} = 2\sqrt{-\text{Cov}(\Delta p_t, \Delta p_{t-1})}
\tag{4.3}\]</span></span></p>
<p>where <span class="math inline">\(\Delta p_t = p_t - p_{t-1}\)</span> is the price change. When the autocovariance is positive (which occurs when information-driven serial correlation dominates the bid-ask bounce), the Roll estimator is undefined. <span class="citation" data-cites="hasbrouck2009trading">Hasbrouck (<a href="references.html#ref-hasbrouck2009trading" role="doc-biblioref">2009</a>)</span> proposes a Bayesian variant that handles this case by imposing a prior on the spread.</p>
<div id="compute-roll-spread" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Roll spread estimate at the stock-month level</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"dprice"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"close"</span>].diff()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"dprice_lag"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"dprice"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>roll_cov <span class="op">=</span> (</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> g: g[[<span class="st">"dprice"</span>, <span class="st">"dprice_lag"</span>]].dropna().cov().iloc[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"autocovariance"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Roll spread is defined only when autocovariance is negative</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>roll_cov[<span class="st">"roll_spread"</span>] <span class="op">=</span> np.where(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    roll_cov[<span class="st">"autocovariance"</span>] <span class="op">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="op">-</span>roll_cov[<span class="st">"autocovariance"</span>]),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    np.nan</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># As a percentage of price</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>roll_cov <span class="op">=</span> roll_cov.merge(</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    prices_daily.groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])[<span class="st">"close"</span>].mean()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"avg_price"</span>),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">"symbol"</span>, <span class="st">"year_month"</span>]</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>roll_cov[<span class="st">"roll_spread_pct"</span>] <span class="op">=</span> roll_cov[<span class="st">"roll_spread"</span>] <span class="op">/</span> roll_cov[<span class="st">"avg_price"</span>] <span class="op">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tbl-roll-spread-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="14">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-roll-spread-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.8: Distribution of Roll Spread Estimates (% of Price)
</figcaption>
<div aria-describedby="tbl-roll-spread-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>roll_summary <span class="op">=</span> (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    roll_cov</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .dropna(subset<span class="op">=</span>[<span class="st">"roll_spread_pct"</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"year_month"</span>)[<span class="st">"roll_spread_pct"</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    .describe(percentiles<span class="op">=</span>[<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show latest year summary</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>latest_year_roll <span class="op">=</span> roll_cov[</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    roll_cov[<span class="st">"year_month"</span>].dt.year <span class="op">==</span> roll_cov[<span class="st">"year_month"</span>].dt.year.<span class="bu">max</span>()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    latest_year_roll[<span class="st">"roll_spread_pct"</span>]</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    .describe(percentiles<span class="op">=</span>[<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>])</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</figure>
</div>
</section>
<section id="non-synchronous-trading-bias" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="non-synchronous-trading-bias"><span class="header-section-number">4.6</span> Non-Synchronous Trading Bias</h2>
<p>When stocks do not trade at the same frequency or at the same times, observed returns are misaligned. This non-synchronous trading bias, first formalized by <span class="citation" data-cites="scholes1977estimating">Scholes and Williams (<a href="references.html#ref-scholes1977estimating" role="doc-biblioref">1977</a>)</span> and <span class="citation" data-cites="lo1990econometric">Lo and MacKinlay (<a href="references.html#ref-lo1990econometric" role="doc-biblioref">1990</a>)</span>, is one of the most consequential microstructure effects for asset pricing in thin markets.</p>
<section id="the-problem" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">4.6.1</span> The Problem</h3>
<p>Suppose the true (unobserved) return process for stock <span class="math inline">\(i\)</span> follows a single-factor model:</p>
<p><span id="eq-true-factor"><span class="math display">\[
r_{i,t}^* = \alpha_i + \beta_i r_{m,t}^* + \varepsilon_{i,t}
\tag{4.4}\]</span></span></p>
<p>where <span class="math inline">\(r_{m,t}^*\)</span> is the true market return and <span class="math inline">\(\beta_i\)</span> is the true beta. If stock <span class="math inline">\(i\)</span> last traded <span class="math inline">\(k\)</span> days before the end of day <span class="math inline">\(t\)</span>, the observed return incorporates information only up to day <span class="math inline">\(t - k\)</span>. <span class="citation" data-cites="scholes1977estimating">Scholes and Williams (<a href="references.html#ref-scholes1977estimating" role="doc-biblioref">1977</a>)</span> show that the OLS estimate of beta from regressing observed returns on observed market returns is:</p>
<p><span id="eq-beta-bias"><span class="math display">\[
\hat{\beta}_i^{OLS} = \beta_i \cdot \pi_i
\tag{4.5}\]</span></span></p>
<p>where <span class="math inline">\(\pi_i\)</span> is the probability that stock <span class="math inline">\(i\)</span> trades on any given day. For a stock that trades on only 50% of days, the OLS beta is biased downward by 50%. This bias is severe in Vietnam, where many small-cap stocks trade on fewer than half of all trading days.</p>
</section>
<section id="quantifying-the-bias" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="quantifying-the-bias"><span class="header-section-number">4.6.2</span> Quantifying the Bias</h3>
<div id="fig-trading-frequency" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="15">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trading-frequency-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute trading frequency: proportion of market days with nonzero volume</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>market_days <span class="op">=</span> prices_daily.groupby(<span class="st">"year_month"</span>)[<span class="st">"date"</span>].nunique()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>trading_freq <span class="op">=</span> (</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    prices_daily[prices_daily[<span class="st">"value"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])[<span class="st">"date"</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"days_traded"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>trading_freq <span class="op">=</span> trading_freq.merge(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    market_days.reset_index().rename(columns<span class="op">=</span>{<span class="st">"date"</span>: <span class="st">"market_days"</span>}),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"year_month"</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>trading_freq[<span class="st">"trade_prob"</span>] <span class="op">=</span> trading_freq[<span class="st">"days_traded"</span>] <span class="op">/</span> trading_freq[<span class="st">"market_days"</span>]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Annual average</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>annual_trade_freq <span class="op">=</span> (</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    trading_freq</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)[<span class="st">"trade_prob"</span>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"avg_trade_prob"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>ax.hist(</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    annual_trade_freq[<span class="st">"avg_trade_prob"</span>], bins<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2C73D2"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>ax.axvline(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    annual_trade_freq[<span class="st">"avg_trade_prob"</span>].median(),</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#FF6B6B"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"Median = </span><span class="sc">{</span>annual_trade_freq[<span class="st">'avg_trade_prob'</span>]<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Average Trading Probability (Fraction of Market Days)"</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Number of Stocks"</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-trading-frequency-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4
</figcaption>
</figure>
</div>
</section>
<section id="the-dimson-beta-correction" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="the-dimson-beta-correction"><span class="header-section-number">4.6.3</span> The Dimson Beta Correction</h3>
<p><span class="citation" data-cites="dimson1979risk">Dimson (<a href="references.html#ref-dimson1979risk" role="doc-biblioref">1979</a>)</span> proposes a simple correction: include lagged and leading market returns in the beta regression:</p>
<p><span id="eq-dimson"><span class="math display">\[
r_{i,t} = \alpha_i + \sum_{k=-K}^{K} \beta_{i,k} \, r_{m,t-k} + \varepsilon_{i,t}
\tag{4.6}\]</span></span></p>
<p>The Dimson-corrected beta is <span class="math inline">\(\hat{\beta}_i^{Dimson} = \sum_{k=-K}^{K} \hat{\beta}_{i,k}\)</span>. Typically <span class="math inline">\(K = 1\)</span> or <span class="math inline">\(K = 2\)</span> is sufficient. The summed coefficients capture the full response of the stock’s observed return to market information, regardless of when the stock actually trades.</p>
<div id="dimson-beta-estimation" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Dimson betas with K=1 lag and lead</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge market return</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>market_ret <span class="op">=</span> (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"date"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> g: np.average(g[<span class="st">"ret"</span>].dropna(), weights<span class="op">=</span>g[<span class="st">"mktcap"</span>].loc[g[<span class="st">"ret"</span>].dropna().index])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> g[<span class="st">"ret"</span>].dropna().shape[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"rm"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> prices_daily.merge(market_ret, on<span class="op">=</span><span class="st">"date"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"rm_lag1"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"rm"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"rm_lead1"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"rm"</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_dimson_beta(group):</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate OLS and Dimson(K=1) betas for a single stock."""</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">"ret"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lag1"</span>, <span class="st">"rm_lead1"</span>])</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series({<span class="st">"beta_ols"</span>: np.nan, <span class="st">"beta_dimson"</span>: np.nan, <span class="st">"n_obs"</span>: <span class="bu">len</span>(g)})</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OLS beta</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    X_ols <span class="op">=</span> sm.add_constant(g[<span class="st">"rm"</span>])</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    ols_model <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], X_ols).fit()</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    beta_ols <span class="op">=</span> ols_model.params[<span class="st">"rm"</span>]</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dimson beta</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    X_dim <span class="op">=</span> sm.add_constant(g[[<span class="st">"rm_lag1"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lead1"</span>]])</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    dim_model <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], X_dim).fit()</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    beta_dimson <span class="op">=</span> dim_model.params[[<span class="st">"rm_lag1"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lead1"</span>]].<span class="bu">sum</span>()</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.Series({</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"beta_ols"</span>: beta_ols,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"beta_dimson"</span>: beta_dimson,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_obs"</span>: <span class="bu">len</span>(g)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>beta_comparison <span class="op">=</span> (</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_dimson_beta, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-beta-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="17">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-beta-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>beta_valid <span class="op">=</span> beta_comparison.dropna()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    beta_valid[<span class="st">"beta_ols"</span>], beta_valid[<span class="st">"beta_dimson"</span>],</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.3</span>, s<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"#2C73D2"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"--"</span>, color<span class="op">=</span><span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"OLS Beta"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Dimson Beta (K=1)"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-beta-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5
</figcaption>
</figure>
</div>
<p>The scatter plot should reveal a systematic pattern: Dimson betas exceed OLS betas for most stocks, with the discrepancy largest for thinly traded stocks. Points above the 45-degree line indicate stocks whose OLS betas are biased downward by non-synchronous trading.</p>
<div id="tbl-beta-bias-by-liquidity" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-beta-bias-by-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.9: Beta Bias by Trading Frequency Tercile
</figcaption>
<div aria-describedby="tbl-beta-bias-by-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>beta_with_freq <span class="op">=</span> beta_valid.merge(annual_trade_freq, on<span class="op">=</span><span class="st">"symbol"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>beta_with_freq[<span class="st">"freq_tercile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    beta_with_freq[<span class="st">"avg_trade_prob"</span>], q<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"Low (Thin)"</span>, <span class="st">"Medium"</span>, <span class="st">"High (Liquid)"</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>beta_bias_summary <span class="op">=</span> (</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    beta_with_freq</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"freq_tercile"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        n_stocks<span class="op">=</span>(<span class="st">"symbol"</span>, <span class="st">"count"</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        avg_trade_prob<span class="op">=</span>(<span class="st">"avg_trade_prob"</span>, <span class="st">"mean"</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        mean_beta_ols<span class="op">=</span>(<span class="st">"beta_ols"</span>, <span class="st">"mean"</span>),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        mean_beta_dimson<span class="op">=</span>(<span class="st">"beta_dimson"</span>, <span class="st">"mean"</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        median_beta_ols<span class="op">=</span>(<span class="st">"beta_ols"</span>, <span class="st">"median"</span>),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        median_beta_dimson<span class="op">=</span>(<span class="st">"beta_dimson"</span>, <span class="st">"median"</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>beta_bias_summary[<span class="st">"bias_pct"</span>] <span class="op">=</span> (</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    (beta_bias_summary[<span class="st">"mean_beta_dimson"</span>] <span class="op">-</span> beta_bias_summary[<span class="st">"mean_beta_ols"</span>])</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> beta_bias_summary[<span class="st">"mean_beta_dimson"</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>beta_bias_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the thinnest-traded tercile, OLS beta underestimates true systematic risk by 20-40% on average. Using uncorrected betas for cost of equity estimation or factor model tests will produce systematically incorrect results for these stocks.</p>
</div>
</div>
</section>
<section id="the-scholes-williams-estimator" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="the-scholes-williams-estimator"><span class="header-section-number">4.6.4</span> The Scholes-Williams Estimator</h3>
<p>An alternative correction, proposed by <span class="citation" data-cites="scholes1977estimating">Scholes and Williams (<a href="references.html#ref-scholes1977estimating" role="doc-biblioref">1977</a>)</span>, estimates beta as:</p>
<p><span id="eq-sw"><span class="math display">\[
\hat{\beta}_i^{SW} = \frac{\hat{\beta}_{i,-1} + \hat{\beta}_{i,0} + \hat{\beta}_{i,+1}}{1 + 2\hat{\rho}_m}
\tag{4.7}\]</span></span></p>
<p>where <span class="math inline">\(\hat{\beta}_{i,k}\)</span> is the slope from regressing <span class="math inline">\(r_{i,t}\)</span> on <span class="math inline">\(r_{m,t-k}\)</span> alone, and <span class="math inline">\(\hat{\rho}_m\)</span> is the first-order autocorrelation of the market return. The Scholes-Williams estimator is consistent under the assumption that non-trading is the sole source of serial cross-correlation, while the Dimson estimator is more robust to additional sources of lead-lag structure.</p>
<div id="scholes-williams-beta" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_sw_beta(group):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate Scholes-Williams beta."""</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">"ret"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lag1"</span>, <span class="st">"rm_lead1"</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate regressions</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    beta_lag <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm_lag1"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    beta_0 <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    beta_lead <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm_lead1"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market autocorrelation</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    rho_m <span class="op">=</span> g[<span class="st">"rm"</span>].autocorr(lag<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    beta_sw <span class="op">=</span> (beta_lag <span class="op">+</span> beta_0 <span class="op">+</span> beta_lead) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> rho_m)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> beta_sw</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>beta_comparison[<span class="st">"beta_sw"</span>] <span class="op">=</span> (</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_sw_beta, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    .values</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="implications-for-portfolio-construction" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="implications-for-portfolio-construction"><span class="header-section-number">4.7</span> Implications for Portfolio Construction</h2>
<p>The microstructure frictions documented above have direct consequences for portfolio construction, particularly for strategies that involve rebalancing across the full cross-section of listed firms.</p>
<section id="equal-weighted-vs.-value-weighted-returns" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="equal-weighted-vs.-value-weighted-returns"><span class="header-section-number">4.7.1</span> Equal-Weighted vs.&nbsp;Value-Weighted Returns</h3>
<p>Equal-weighted portfolio returns give the same weight to each stock, including illiquid small-cap stocks that may contribute stale or noisy prices. Value-weighted returns tilt toward large, liquid stocks and are less susceptible to microstructure contamination.</p>
<div id="fig-ew-vs-vw" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ew-vs-vw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>monthly_returns <span class="op">=</span> (</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        monthly_ret<span class="op">=</span>(<span class="st">"ret"</span>, <span class="kw">lambda</span> x: (<span class="dv">1</span> <span class="op">+</span> x).prod() <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        last_mktcap<span class="op">=</span>(<span class="st">"mktcap"</span>, <span class="st">"last"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>monthly_returns[<span class="st">"date"</span>] <span class="op">=</span> monthly_returns[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal-weighted</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>ew_ret <span class="op">=</span> monthly_returns.groupby(<span class="st">"date"</span>)[<span class="st">"monthly_ret"</span>].mean().reset_index(name<span class="op">=</span><span class="st">"ew"</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Value-weighted</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vw_return(group):</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> group[<span class="st">"last_mktcap"</span>] <span class="op">/</span> group[<span class="st">"last_mktcap"</span>].<span class="bu">sum</span>()</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (w <span class="op">*</span> group[<span class="st">"monthly_ret"</span>]).<span class="bu">sum</span>()</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>vw_ret <span class="op">=</span> (</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    monthly_returns.groupby(<span class="st">"date"</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(vw_return, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"vw"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>port_comp <span class="op">=</span> ew_ret.merge(vw_ret, on<span class="op">=</span><span class="st">"date"</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, label, color <span class="kw">in</span> [</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"ew"</span>, <span class="st">"Equal-Weighted"</span>, <span class="st">"#FF6B6B"</span>),</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"vw"</span>, <span class="st">"Value-Weighted"</span>, <span class="st">"#2C73D2"</span>)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    cum_ret <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> port_comp[col]).cumprod()</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    ax.plot(port_comp[<span class="st">"date"</span>], cum_ret, label<span class="op">=</span>label, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Cumulative Return (Growth of 1 VND)"</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ew-vs-vw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6
</figcaption>
</figure>
</div>
<p>A persistent divergence between equal-weighted and value-weighted cumulative returns is a hallmark of microstructure effects: the equal-weighted portfolio overstates attainable returns because it implicitly assumes costless trading in illiquid stocks.</p>
</section>
<section id="recommended-liquidity-filters" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2" class="anchored" data-anchor-id="recommended-liquidity-filters"><span class="header-section-number">4.7.2</span> Recommended Liquidity Filters</h3>
<p>Based on the diagnostics developed in this chapter, we recommend the following pre-analysis filters:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Always report results with and without liquidity filters. If results are qualitatively different, the baseline findings may be driven by microstructure artifacts rather than genuine economic effects.</p>
</div>
</div>
</section>
<section id="monthly-vs.-daily-frequency" class="level3" data-number="4.7.3">
<h3 data-number="4.7.3" class="anchored" data-anchor-id="monthly-vs.-daily-frequency"><span class="header-section-number">4.7.3</span> Monthly vs.&nbsp;Daily Frequency</h3>
<p>For most asset pricing applications, monthly return aggregation is preferable to daily analysis in Vietnam because:</p>
<ol type="1">
<li>Monthly returns smooth out intraday noise, bid-ask bounce, and price limit effects.</li>
<li>Stocks that trade infrequently within a month still produce a meaningful monthly return.</li>
<li>Factor portfolio sorts are conventionally conducted at monthly frequency.</li>
<li>Statistical tests have better size properties when microstructure noise is reduced.</li>
</ol>
<p>However, monthly aggregation does not eliminate all biases. Stocks with zero returns for an entire month still contribute stale observations. The Dimson and Scholes-Williams corrections should still be applied at monthly frequency for beta estimation.</p>
</section>
</section>
<section id="implications-for-asset-pricing-tests" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="implications-for-asset-pricing-tests"><span class="header-section-number">4.8</span> Implications for Asset Pricing Tests</h2>
<section id="factor-model-estimation" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="factor-model-estimation"><span class="header-section-number">4.8.1</span> Factor Model Estimation</h3>
<p>Standard factor model estimation assumes that returns are observed synchronously and without censoring. In Vietnam, both assumptions are violated. The practical consequences are in <a href="#tbl-assumption-violations" class="quarto-xref">Table&nbsp;<span>4.10</span></a></p>
<div id="tbl-assumption-violations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-assumption-violations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.10: Standard Assumptions and Their Violations
</figcaption>
<div aria-describedby="tbl-assumption-violations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 44%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>Assumption</th>
<th>Violation in Vietnam</th>
<th>Consequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Synchronous observation</td>
<td>Thin trading</td>
<td>Biased betas, attenuated R²</td>
</tr>
<tr class="even">
<td>Uncensored returns</td>
<td>Price limits</td>
<td>Truncated distributions, biased moments</td>
</tr>
<tr class="odd">
<td>Continuous trading</td>
<td>Discrete ticks</td>
<td>Return discreteness, bid-ask bounce</td>
</tr>
<tr class="even">
<td>No transaction costs</td>
<td>Wide spreads</td>
<td>Overstated portfolio returns</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="adjusted-testing-procedure" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="adjusted-testing-procedure"><span class="header-section-number">4.8.2</span> Adjusted Testing Procedure</h3>
<p>We recommend the following adjustments to standard asset pricing tests when applied to Vietnamese data:</p>
<ol type="1">
<li><p><strong>Beta estimation</strong>: Use Dimson (<span class="math inline">\(K \ge 1\)</span>) or Scholes-Williams betas, not OLS betas.</p></li>
<li><p><strong>Factor construction</strong>: When forming size and value portfolios, apply liquidity filters before sorting. Consider excluding the smallest quintile of stocks by market capitalization, which is most affected by thin trading.</p></li>
<li><p><strong>Return aggregation</strong>: Use monthly frequency. If daily analysis is necessary, include lagged market returns in the time-series regression.</p></li>
<li><p><strong>Robust inference</strong>: Cluster standard errors by stock to account for persistent microstructure-induced serial correlation. Use Newey-West HAC standard errors with sufficient lags.</p></li>
<li><p><strong>Price limit adjustment</strong>: For volatility analysis or risk measurement, consider the <span class="citation" data-cites="chu2019forecasting">Chu and Qiu (<a href="references.html#ref-chu2019forecasting" role="doc-biblioref">2019</a>)</span> approach of modeling the latent (uncensored) return distribution using truncated regression:</p></li>
</ol>
<p><span id="eq-truncated"><span class="math display">\[
r_{i,t}^* \sim N(\mu_i, \sigma_i^2), \quad r_{i,t}^{obs} = \max(\underline{L}, \min(\bar{L}, r_{i,t}^*))
\tag{4.8}\]</span></span></p>
<p>Estimate <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\sigma_i^2\)</span> via maximum likelihood for the truncated normal.</p>
<div id="truncated-volatility" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> truncated_normal_nll(params, returns, lower, upper):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Negative log-likelihood of truncated normal."""</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    mu, log_sigma <span class="op">=</span> params</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> np.exp(log_sigma)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interior observations</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    interior <span class="op">=</span> (returns <span class="op">&gt;</span> lower) <span class="op">&amp;</span> (returns <span class="op">&lt;</span> upper)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    ll_interior <span class="op">=</span> norm.logpdf(returns[interior], mu, sigma)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lower censored</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    ll_lower <span class="op">=</span> norm.logcdf(lower, mu, sigma)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    n_lower <span class="op">=</span> (returns <span class="op">&lt;=</span> lower).<span class="bu">sum</span>()</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Upper censored</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    ll_upper <span class="op">=</span> np.log(<span class="dv">1</span> <span class="op">-</span> norm.cdf(upper, mu, sigma) <span class="op">+</span> <span class="fl">1e-15</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    n_upper <span class="op">=</span> (returns <span class="op">&gt;=</span> upper).<span class="bu">sum</span>()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    nll <span class="op">=</span> <span class="op">-</span>(ll_interior.<span class="bu">sum</span>() <span class="op">+</span> n_lower <span class="op">*</span> ll_lower <span class="op">+</span> n_upper <span class="op">*</span> ll_upper)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nll</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_true_volatility(returns, limit_band):</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate latent volatility correcting for price limit censoring."""</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        truncated_normal_nll,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        x0<span class="op">=</span>[returns.mean(), np.log(returns.std())],</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        args<span class="op">=</span>(returns.values, <span class="op">-</span>limit_band, limit_band),</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        method<span class="op">=</span><span class="st">"Nelder-Mead"</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    mu, log_sigma <span class="op">=</span> result.x</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(log_sigma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="6" type="1">
<li><strong>Sensitivity reporting</strong>: Always report key results under alternative specifications: with and without liquidity filters, using OLS vs.&nbsp;Dimson betas, at daily vs.&nbsp;monthly frequency, and using observed vs.&nbsp;truncation-corrected volatility.</li>
</ol>
</section>
</section>
<section id="summary" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.9</span> Summary</h2>
<p>This chapter has established that Vietnamese equity markets exhibit microstructure characteristics that materially affect observed prices, returns, and risk measures. The key findings are:</p>
<ol type="1">
<li><p><strong>Price limits</strong> censor daily returns, inducing positive autocorrelation, volatility spillover, and truncated distributions. The <span class="math inline">\(\pm\)</span> 7% band on HOSE is particularly restrictive for volatile stocks.</p></li>
<li><p><strong>Thin trading and zero returns</strong> afflict a substantial fraction of listed firms. Trading probabilities below 50% are common on HNX and UPCoM, generating non-synchronous trading bias that attenuates OLS beta estimates by 20-40%.</p></li>
<li><p><strong>Illiquidity</strong> varies dramatically across the cross-section, with Amihud ratios spanning several orders of magnitude. Value-weighted portfolio returns are less contaminated than equal-weighted returns.</p></li>
<li><p><strong>The Dimson and Scholes-Williams beta corrections</strong> effectively address non-synchronous trading bias and should be used as the default beta estimator for Vietnamese equities.</p></li>
<li><p><strong>Liquidity filters</strong> should be applied before any asset pricing analysis, and results should be reported with and without these filters as a robustness check.</p></li>
</ol>
<p>Ignoring these frictions does not merely add noise to empirical results, it systematically biases estimates in predictable directions. The diagnostics and corrections presented in this chapter provide the foundation for credible empirical asset pricing in Vietnam.</p>
<!-- ## Exercises

1.  **Intraday liquidity patterns**: Using intraday data, compute the average bid-ask spread and depth at 15-minute intervals throughout the trading day. Document the U-shaped intraday liquidity pattern and discuss how it relates to the theoretical predictions of @admati1988theory.

2.  **Magnet effect test**: Test the @subrahmanyam1994circuit magnet effect hypothesis. Conditional on a stock hitting a price limit by the end of the day, does price acceleration toward the limit occur in the final 30 minutes of continuous trading? Compare the speed of price approach to the limit on limit-hit days versus non-limit-hit days.

3.  **Liquidity-adjusted factor model**: Construct a tradeable liquidity factor (IML: Illiquid-Minus-Liquid) by sorting stocks into liquidity terciles using the Amihud ratio and forming a long-short portfolio. Augment the Fama-French three-factor model with this liquidity factor and test whether it improves the pricing of Vietnamese equities.

4.  **Multi-day limit hits**: Identify episodes where the same stock hits the price limit on two or more consecutive days. How much cumulative price adjustment occurs over these multi-day limit episodes? Does the total adjustment exceed what would be expected under a one-day price change distribution?

5.  **Non-synchronous trading and momentum**: The momentum effect may be partly an artifact of non-synchronous trading: past winners may simply be stocks with more recent prices. Re-examine the momentum premium after replacing OLS returns with Dimson-adjusted returns and after excluding stocks with trading probability below 50%.

6.  **Cross-exchange comparison**: Exploit the difference in price limit bands across HOSE ($pm$ 7%), HNX ($pm$ 10%), and UPCoM ($pm$ 15%) to test the causal effect of price limit tightness on volatility spillover, zero-return frequency, and return autocorrelation. Use a difference-in-differences design if any exchange has changed its limit band during the sample period. -->


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-amihud2002illiquidity" class="csl-entry" role="listitem">
Amihud, Yakov. 2002. <span>“Illiquidity and Stock Returns: Cross-Section and Time-Series Effects.”</span> <em>Journal of Financial Markets</em> 5 (1): 31–56.
</div>
<div id="ref-bali2016empirical" class="csl-entry" role="listitem">
Bali, Turan G, Robert F Engle, and Scott Murray. 2016. <em>Empirical Asset Pricing: The Cross Section of Stock Returns</em>. John Wiley &amp; Sons.
</div>
<div id="ref-barber2009just" class="csl-entry" role="listitem">
Barber, Brad M, Yi-Tsung Lee, Yu-Jane Liu, and Terrance Odean. 2009. <span>“Just How Much Do Individual Investors Lose by Trading?”</span> <em>The Review of Financial Studies</em> 22 (2): 609–32.
</div>
<div id="ref-bessembinder2003trade" class="csl-entry" role="listitem">
Bessembinder, Hendrik. 2003. <span>“Trade Execution Costs and Market Quality After Decimalization.”</span> <em>Journal of Financial and Quantitative Analysis</em> 38 (4): 747–77.
</div>
<div id="ref-chu2019forecasting" class="csl-entry" role="listitem">
Chu, Xiaojun, and Jianying Qiu. 2019. <span>“Forecasting Volatility with Price Limit Hits—Evidence from Chinese Stock Market.”</span> <em>Emerging Markets Finance and Trade</em> 55 (5): 1034–50.
</div>
<div id="ref-comerton2009anonymity" class="csl-entry" role="listitem">
Comerton-Forde, Carole, and Kar Mei Tang. 2009. <span>“Anonymity, Liquidity and Fragmentation.”</span> <em>Journal of Financial Markets</em> 12 (3): 337–67.
</div>
<div id="ref-dimson1979risk" class="csl-entry" role="listitem">
Dimson, Elroy. 1979. <span>“Risk Measurement When Shares Are Subject to Infrequent Trading.”</span> <em>Journal of Financial Economics</em> 7 (2): 197–226.
</div>
<div id="ref-Fama1989" class="csl-entry" role="listitem">
Fama, Eugene F., and Kenneth R. French. 1989. <span>“<span class="nocase">Business conditions and expected returns on stocks and bonds</span>.”</span> <em><span>Journal of Financial Economics</span></em> 25 (1): 23–49. <a href="https://doi.org/10.1016/0304-405X(89)90095-0">https://doi.org/10.1016/0304-405X(89)90095-0</a>.
</div>
<div id="ref-glosten1985bid" class="csl-entry" role="listitem">
Glosten, Lawrence R, and Paul R Milgrom. 1985. <span>“Bid, Ask and Transaction Prices in a Specialist Market with Heterogeneously Informed Traders.”</span> <em>Journal of Financial Economics</em> 14 (1): 71–100.
</div>
<div id="ref-goyenko2009liquidity" class="csl-entry" role="listitem">
Goyenko, Ruslan Y, Craig W Holden, and Charles A Trzcinka. 2009. <span>“Do Liquidity Measures Measure Liquidity?”</span> <em>Journal of Financial Economics</em> 92 (2): 153–81.
</div>
<div id="ref-goyenko2009stock" class="csl-entry" role="listitem">
Goyenko, Ruslan Y, and Andrey D Ukhov. 2009. <span>“Stock and Bond Market Liquidity: A Long-Run Empirical Analysis.”</span> <em>Journal of Financial and Quantitative Analysis</em> 44 (1): 189–212.
</div>
<div id="ref-hasbrouck2007empirical" class="csl-entry" role="listitem">
Hasbrouck, Joel. 2007. <em>Empirical Market Microstructure: The Institutions, Economics, and Econometrics of Securities Trading</em>. Oxford University Press.
</div>
<div id="ref-hasbrouck2009trading" class="csl-entry" role="listitem">
———. 2009. <span>“Trading Costs and Returns for US Equities: Estimating Effective Costs from Daily Data.”</span> <em>The Journal of Finance</em> 64 (3): 1445–77.
</div>
<div id="ref-hillion2004manipulation" class="csl-entry" role="listitem">
Hillion, Pierre, and Matti Suominen. 2004. <span>“The Manipulation of Closing Prices.”</span> <em>Journal of Financial Markets</em> 7 (4): 351–75.
</div>
<div id="ref-huang1997components" class="csl-entry" role="listitem">
Huang, Roger D, and Hans R Stoll. 1997. <span>“The Components of the Bid-Ask Spread: A General Approach.”</span> <em>The Review of Financial Studies</em> 10 (4): 995–1034.
</div>
<div id="ref-kaniel2012individual" class="csl-entry" role="listitem">
Kaniel, Ron, Shuming Liu, Gideon Saar, and Sheridan Titman. 2012. <span>“Individual Investor Trading and Return Patterns Around Earnings Announcements.”</span> <em>The Journal of Finance</em> 67 (2): 639–80.
</div>
<div id="ref-kim1997price" class="csl-entry" role="listitem">
Kim, Kenneth A, and S Ghon Rhee. 1997. <span>“Price Limit Performance: Evidence from the Tokyo Stock Exchange.”</span> <em>The Journal of Finance</em> 52 (2): 885–901.
</div>
<div id="ref-kyle1985continuous" class="csl-entry" role="listitem">
Kyle, Albert S. 1985. <span>“Continuous Auctions and Insider Trading.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 1315–35.
</div>
<div id="ref-lo1990econometric" class="csl-entry" role="listitem">
Lo, Andrew W, and A Craig MacKinlay. 1990. <span>“An Econometric Analysis of Nonsynchronous Trading.”</span> <em>Journal of Econometrics</em> 45 (1-2): 181–211.
</div>
<div id="ref-pastor2003liquidity" class="csl-entry" role="listitem">
Pástor, L’uboš, and Robert F Stambaugh. 2003. <span>“Liquidity Risk and Expected Stock Returns.”</span> <em>Journal of Political Economy</em> 111 (3): 642–85.
</div>
<div id="ref-roll1984simple" class="csl-entry" role="listitem">
Roll, Richard. 1984. <span>“A Simple Implicit Measure of the Effective Bid-Ask Spread in an Efficient Market.”</span> <em>The Journal of Finance</em> 39 (4): 1127–39.
</div>
<div id="ref-scholes1977estimating" class="csl-entry" role="listitem">
Scholes, Myron, and Joseph Williams. 1977. <span>“Estimating Betas from Nonsynchronous Data.”</span> <em>Journal of Financial Economics</em> 5 (3): 309–27.
</div>
<div id="ref-subrahmanyam1994circuit" class="csl-entry" role="listitem">
Subrahmanyam, Avanidhar. 1994. <span>“Circuit Breakers and Market Volatility: A Theoretical Perspective.”</span> <em>The Journal of Finance</em> 49 (1): 237–54.
</div>
<div id="ref-vo2023minimum" class="csl-entry" role="listitem">
Vo, Duc Hong, and Bao Doan. 2023. <span>“Minimum Tick Size, Market Quality and Costs of Trade Execution in Vietnam.”</span> <em>Plos One</em> 18 (5): e0285821.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "© " + year;
});
</script>
<script>
(function () {
  const GA_ID = "G-LMDLDJXXSC";   // your real GA4 ID
  const CONSENT_KEY = "cookie_consent_v1";

  function log(msg) {
    console.log("[GA Loader]", msg);
  }

  function loadGtag() {
    if (window.__gtag_loaded__) {
      log("GA already loaded, skipping");
      return;
    }

    log("Loading Google Analytics...");

    window.__gtag_loaded__ = true;

    const script = document.createElement("script");
    script.async = true;
    script.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(GA_ID);

    script.onload = function () {
      log("gtag.js loaded");

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;

      gtag("js", new Date());
      gtag("config", GA_ID, {
        anonymize_ip: true,
        transport_type: "beacon"
      });

      log("GA initialized successfully");
    };

    script.onerror = function () {
      log("FAILED to load gtag.js. Likely blocked by ad blocker or network.");
    };

    document.head.appendChild(script);
  }

  function checkConsentAndLoad() {
    const consent = localStorage.getItem(CONSENT_KEY);
    log("Stored consent value = " + consent);

    if (consent === "accepted") {
      loadGtag();
    } else {
      log("Analytics blocked due to missing or declined consent");
    }
  }

  // Run on page load
  checkConsentAndLoad();

  // Listen for cookie banner decisions
  window.addEventListener("cookie-consent-changed", function (e) {
    log("Consent event received: " + e.detail);
    if (e.detail === "accepted") {
      loadGtag();
    }
  });

})();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/mikenguyen13\/tidy_finance_vn");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02_datacore_data.html" class="pagination-link" aria-label="Datacore Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datacore Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_risk_free_rate_construction.html" class="pagination-link" aria-label="Risk-Free Rate Construction in Vietnam">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk-Free Rate Construction in Vietnam</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Market Microstructure in Vietnam</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>In this chapter, we examine how the institutional design of Vietnamese equity markets, such as trading sessions, price limits, order types, and investor composition, shapes observed prices, returns, and liquidity. We quantify microstructure frictions and demonstrate why ignoring these frictions leads to biased inference in asset pricing tests.</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>Market microstructure is the study of how trading rules, order handling mechanisms, and market design affect price formation, transaction costs, and liquidity. The field, pioneered by @kyle1985continuous, @glosten1985bid, and @hasbrouck2007empirical, provides the analytical toolkit for understanding why observed prices may deviate from fundamental values and for how long.</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>In developed markets with continuous electronic trading, designated market makers, and minimal regulatory constraints on price movement, microstructure frictions are typically second-order concerns for researchers working at monthly or lower frequencies. In Vietnam's equity markets, this is emphatically not the case. Daily price limits, thin trading, a predominantly retail investor base, discrete tick sizes, and the absence of formal market-making arrangements generate frictions that propagate into monthly returns, distort factor loadings, and bias portfolio-level inference. Any serious empirical analysis of Vietnamese equities must therefore begin with a careful assessment of market microstructure.</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>This chapter provides that assessment. We first describe the institutional architecture of Vietnamese equity trading. We then develop diagnostics for the most consequential frictions, such as price limit hits, zero-return days, illiquidity, and non-synchronous trading, and quantify their severity in the cross-section of listed firms. Finally, we derive practical guidance for adjusting portfolio construction and asset pricing tests.</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## What Is Market Microstructure?</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>The textbook assumption of frictionless markets implies that prices continuously and costlessly incorporate information. Under this assumption, the observed return on any asset at any frequency equals the "true" return dictated by fundamentals. Market microstructure relaxes this assumption by recognizing that prices are generated by a specific trading process with real costs, constraints, and imperfections.</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>The canonical framework of @kyle1985continuous models a market with three types of participants:</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>an informed trader who knows the asset's fundamental value,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>noise traders who trade for liquidity reasons, and</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>a market maker who sets prices to break even in expectation.</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>The key insight is that the market maker cannot distinguish informed from uninformed order flow, so prices adjust gradually to information, creating a wedge between the transaction price and the fundamental value. The size of this wedge (the bid-ask spread) and the speed of price adjustment (market depth) are the core objects of microstructure theory.</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>@glosten1985bid extend this framework to a sequential trade setting and show that the bid-ask spread has two components: an adverse selection component (compensation for trading against informed traders) and an order processing component (compensation for the mechanical costs of trading). @huang1997components further decompose the spread into realized spread and price impact components. These decompositions are important because they reveal different sources of trading costs and have different implications for market quality.</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>For empirical asset pricing, the key question is: at what frequency and under what conditions do microstructure effects become negligible? In highly liquid markets, @bali2016empirical argue that monthly returns are largely free of microstructure contamination. In Vietnam, as we demonstrate below, this is not the case. Microstructure effects persist at monthly and even quarterly frequencies for a substantial fraction of listed firms.</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Microstructure-Asset Pricing Interface</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>The interface between microstructure and asset pricing operates through several channels. First, illiquidity itself may be a priced risk factor. @amihud2002illiquidity shows that expected illiquidity is positively related to expected stock returns, implying a liquidity premium. @pastor2003liquidity develop an equilibrium model in which liquidity risk (i.e., the covariance of a stock's liquidity with market liquidity) commands a risk premium. Second, microstructure noise in prices biases estimated betas, factor loadings, and test statistics. @scholes1977estimating first identified this bias in the context of non-synchronous trading, and @dimson1979risk proposed an aggregated-coefficients estimator to correct it. Third, price limits and other regulatory constraints censor the return distribution, creating truncation bias in volatility estimates, return moments, and extreme-value statistics <span class="co">[</span><span class="ot">@kim1997price</span><span class="co">]</span>.</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>@tbl-microstructure-interface summarizes these channels and their empirical consequences.</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Channel <span class="pp">|</span> Mechanism <span class="pp">|</span> Empirical Consequence <span class="pp">|</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="pp">|--------------------|------------------|----------------------------------|</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Illiquidity premium <span class="pp">|</span> Compensation for bearing transaction costs and inventory risk <span class="pp">|</span> Cross-sectional return predictability by liquidity measures <span class="pp">|</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Non-synchronous trading <span class="pp">|</span> Infrequent trading creates stale prices <span class="pp">|</span> Downward-biased betas, attenuated correlations, and spurious lead-lag <span class="pp">|</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Price limits <span class="pp">|</span> Regulatory censoring of daily returns <span class="pp">|</span> Truncated return distributions, volatility spillover, and artificial autocorrelation <span class="pp">|</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Discrete tick sizes <span class="pp">|</span> Prices constrained to a grid <span class="pp">|</span> Bid-ask bounce, return discreteness, biased volatility <span class="pp">|</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Investor composition <span class="pp">|</span> Retail-dominated order flow <span class="pp">|</span> Noise trading, herding, sentiment-driven pricing <span class="pp">|</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>: Channels Through Which Microstructure Affects Asset Pricing {#tbl-microstructure-interface}</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trading Architecture in Vietnam</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>Vietnam operates two stock exchanges: the Ho Chi Minh Stock Exchange (HOSE), established in 2000, and the Hanoi Stock Exchange (HNX), established in 2005. HOSE lists larger firms and accounts for the majority of market capitalization and trading volume. HNX lists smaller firms and also operates the Unlisted Public Company Market (UPCoM) for firms that have not yet met full listing requirements. All three venues operate electronic limit order book systems without designated market makers.</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exchange Characteristics</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>@tbl-exchange-comparison presents the key structural differences between HOSE, HNX, and UPCoM. These differences have direct implications for liquidity, price discovery, and the severity of microstructure frictions.</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Feature               <span class="pp">|</span> HOSE              <span class="pp">|</span> HNX               <span class="pp">|</span> UPCoM             <span class="pp">|</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------------|------------------|------------------|------------------|</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Established           <span class="pp">|</span> 2000              <span class="pp">|</span> 2005              <span class="pp">|</span> 2009              <span class="pp">|</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Listing tier          <span class="pp">|</span> Large-cap         <span class="pp">|</span> Mid/small-cap     <span class="pp">|</span> Pre-listing       <span class="pp">|</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Daily price limit     <span class="pp">|</span> $\pm$ 7%          <span class="pp">|</span> $\pm$ 10%         <span class="pp">|</span> $\pm$ 15%         <span class="pp">|</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Tick size regime      <span class="pp">|</span> Tiered by price   <span class="pp">|</span> Tiered by price   <span class="pp">|</span> 100 VND           <span class="pp">|</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Trading lot           <span class="pp">|</span> 100 shares        <span class="pp">|</span> 100 shares        <span class="pp">|</span> 100 shares        <span class="pp">|</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Short selling         <span class="pp">|</span> Limited           <span class="pp">|</span> Not available     <span class="pp">|</span> Not available     <span class="pp">|</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Foreign ownership cap <span class="pp">|</span> Industry-specific <span class="pp">|</span> Industry-specific <span class="pp">|</span> Industry-specific <span class="pp">|</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>: Exchange Comparison: HOSE, HNX, and UPCoM {#tbl-exchange-comparison}</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>The heterogeneous price limit bands across exchanges create a natural experiment for studying limit effects. HOSE's tighter $\pm$ 7% band means that large-cap stocks are more frequently constrained than mid-cap stocks on HNX, conditional on the same information shock. UPCoM's wider $\pm$ 15% band provides the least constrained environment, though its stocks are also the least liquid.</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trading Sessions</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>Each exchange operates a structured trading day with distinct sessions. Understanding session structure is essential because price formation mechanisms differ across sessions, and certain sessions are disproportionately important for benchmark pricing.</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-trading-sessions</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Trading Session Structure on HOSE"</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>sessions <span class="op">=</span> pd.DataFrame({</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Session"</span>: [</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pre-opening"</span>,</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Opening auction (ATO)"</span>,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Continuous trading (Morning)"</span>,</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lunch break"</span>,</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Continuous trading (Afternoon)"</span>,</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Closing auction (ATC)"</span>,</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Post-closing"</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time"</span>: [</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">"08:30–09:00"</span>,</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"09:00–09:15"</span>,</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"09:15–11:30"</span>,</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">"11:30–13:00"</span>,</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"13:00–14:30"</span>,</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">"14:30–14:45"</span>,</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">"14:45–15:00"</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mechanism"</span>: [</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Order entry only, no matching"</span>,</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Batch auction, single price"</span>,</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Continuous limit order matching"</span>,</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"No trading"</span>,</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Continuous limit order matching"</span>,</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Batch auction, single price"</span>,</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Put-through (negotiated) trades"</span></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Price Discovery Role"</span>: [</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Reveals pre-open demand/supply"</span>,</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sets opening price from accumulated orders"</span>,</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Primary price discovery"</span>,</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">"—"</span>,</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Primary price discovery"</span>,</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sets closing price (benchmark)"</span>,</span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Block and negotiated transactions"</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>sessions.style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>The closing auction (ATC) deserves particular attention. The ATC price is the official closing price used for index calculation, NAV computation, and margin requirements. Because it is determined by a single-bid auction, it can be manipulated by strategically timed orders, a phenomenon documented in numerous emerging markets <span class="co">[</span><span class="ot">@comerton2009anonymity; @hillion2004manipulation</span><span class="co">]</span>. Researchers using daily closing prices should be aware that ATC prices may not reflect the continuous-session equilibrium, particularly for less liquid stocks where a single large order can move the closing price.</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### Order Types and Matching Rules</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>Vietnamese exchanges support a limited set of order types compared to developed markets (@tbl-order-types).</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Order Type <span class="pp">|</span> Description <span class="pp">|</span> Availability <span class="pp">|</span></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------------------|-------------------------|-------------------------|</span></span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Limit order (LO) <span class="pp">|</span> Specifies price and quantity <span class="pp">|</span> All sessions <span class="pp">|</span></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Market order (ATO/ATC) <span class="pp">|</span> Matches at auction price <span class="pp">|</span> Auction sessions only <span class="pp">|</span></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Market-to-limit (MTL) <span class="pp">|</span> Converts to limit at best available <span class="pp">|</span> HNX only <span class="pp">|</span></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>: Available Order Types {#tbl-order-types}</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>The absence of iceberg orders, stop orders, and hidden orders means that the full limit order book is visible to all participants. While this enhances pre-trade transparency, it also means that large institutional orders face significant information leakage risk, which may deter institutional participation and reduce market depth.</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>Orders are matched on a strict price-time priority basis during continuous sessions. During auction sessions, a single clearing price is determined that maximizes executed volume. If multiple prices satisfy this criterion, the price closest to the previous closing price is selected.</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tick Size Structure</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>Tick sizes on HOSE are tiered by price level, which creates discontinuities in the bid-ask spread as a percentage of price.</span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-tick-sizes</span></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Tick Size Schedule on HOSE"</span></span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>tick_sizes <span class="op">=</span> pd.DataFrame({</span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Price Range (VND)"</span>: [</span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt; 10,000"</span>,</span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">"10,000–49,900"</span>,</span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≥ 50,000"</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tick Size (VND)"</span>: [<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Minimum Spread as </span><span class="sc">% o</span><span class="st">f Midpoint"</span>: [</span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.10% at 10,000"</span>,</span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.10% at 50,000"</span>,</span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0.20% at 50,000"</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>tick_sizes.style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>The jump from a 50 VND tick to a 100 VND tick at the 50,000 VND boundary means that the minimum percentage spread doubles discontinuously. This creates a "tick size cliff" that can affect the cross-sectional distribution of bid-ask spreads and, consequently, the measurement of illiquidity <span class="co">[</span><span class="ot">@vo2023minimum</span><span class="co">]</span>. @bessembinder2003trade document similar effects in other markets with tiered tick structures.</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### Investor Composition</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a>The Vietnamese equity market is predominantly driven by retail investors. While foreign institutional investors account for a meaningful share of market capitalization (particularly in blue-chip stocks subject to foreign ownership limits), daily trading volume is overwhelmingly generated by domestic retail accounts.</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-investor-composition</span></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Approximate Investor Composition by Trading Value on HOSE"</span></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> [</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Domestic Retail"</span>,</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Domestic Institutional"</span>,</span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Foreign Institutional"</span>,</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Foreign Retail"</span></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a>shares <span class="op">=</span> [<span class="dv">85</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">2</span>]</span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">"#2C73D2"</span>, <span class="st">"#0089BA"</span>, <span class="st">"#00B7C7"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="fl">6.5</span>, <span class="dv">4</span>))</span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.barh(categories, shares, color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">"white"</span>, height<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, share <span class="kw">in</span> <span class="bu">zip</span>(bars, shares):</span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a>    ax.text(</span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>        bar.get_width() <span class="op">+</span> <span class="dv">1</span>, bar.get_y() <span class="op">+</span> bar.get_height() <span class="op">/</span> <span class="dv">2</span>,</span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>share<span class="sc">}</span><span class="ss">%"</span>, va<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">10</span></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Share of Trading Value (%)"</span>)</span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a>This retail dominance has several consequences for microstructure. First, retail investors tend to submit smaller orders and trade more frequently, generating high message-to-trade ratios but limited depth at each price level. Second, retail order flow is more susceptible to herding and sentiment, which can amplify momentum and generate excess volatility <span class="co">[</span><span class="ot">@barber2009just; @kaniel2012individual</span><span class="co">]</span>. Third, the limited institutional presence means that sophisticated liquidity provision is scarce, particularly in mid- and small-cap stocks.</span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Price Limits and Their Consequences</span></span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>Vietnam enforces daily price limits on all listed equities. A stock's price cannot move beyond a fixed percentage of the previous day's closing price within a single trading day. The limit bands are $\pm$ 7% on HOSE, $\pm$ 10% on HNX, and $\pm$ 15% on UPCoM.</span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="fu">### Theoretical Framework</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a>Price limits were introduced with the stated goal of reducing volatility and preventing panic-driven price dislocations. However, the academic literature presents a more nuanced picture. The "magnet effect" hypothesis <span class="co">[</span><span class="ot">@subrahmanyam1994circuit</span><span class="co">]</span> predicts that price limits actually accelerate price movement toward the limit as traders rush to execute before the limit is hit. The "delayed price discovery" hypothesis <span class="co">[</span><span class="ot">@Fama1989</span><span class="co">]</span> argues that limits merely postpone inevitable price adjustments, creating volatility spillover into subsequent days.</span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a>Formally, let $P_t^*$ denote the equilibrium price on day $t$ and $P_{t-1}^c$ the previous closing price. The observed return is:</span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>r_t^{obs} = \begin{cases}</span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>\bar{L} &amp; \text{if } r_t^* \geq \bar{L} <span class="sc">\\</span></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>r_t^* &amp; \text{if } \underline{L} &lt; r_t^* &lt; \bar{L} <span class="sc">\\</span></span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>\underline{L} &amp; \text{if } r_t^* \leq \underline{L}</span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>$$ {#eq-price-limit}</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a>where $r_t^* = \ln(P_t^* / P_{t-1}^c)$ is the latent (unconstrained) return, $\bar{L}$ is the upper limit, and $\underline{L}$ is the lower limit. The observed return $r_t^{obs}$ is a censored version of the true return. This censoring has several consequences:</span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Truncated moments**: The observed variance $\text{Var}(r_t^{obs}) &lt; \text{Var}(r_t^*)$ because extreme returns are clipped. This biases downward any volatility-based risk measure.</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Artificial autocorrelation**: When $r_t^{obs} = \bar{L}$ and $r_{t+1}^{obs} &gt; 0$ (continued adjustment the next day), the return series exhibits positive autocorrelation that is purely mechanical, not informational.</span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Volatility spillover**: Define excess volatility on day $t+1$ as $\sigma_{t+1}^2 - E[\sigma_{t+1}^2 | \text{no limit hit on day } t]$. @kim1997price and @chu2019forecasting document significant positive spillover, where days following limit hits exhibit abnormally high volatility.</span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Biased extreme value statistics**: Measures such as Value-at-Risk, Expected Shortfall, and maximum drawdown are mechanically bounded by the limit, understating true tail risk.</span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detecting Price Limit Hits</span></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a>We now implement a diagnostic to detect price limit hits in the daily data.</span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: detect-limit-hits</span></span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Load daily price data</span></span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a>tidy_finance <span class="op">=</span> sqlite3.<span class="ex">connect</span>(database<span class="op">=</span><span class="st">"data/tidy_finance_python.sqlite"</span>)</span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume prices_daily contains: symbol, date, close, exchange</span></span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> pd.read_sql_query(</span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , exchange</span></span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a>    sql<span class="op">=</span><span class="st">"""</span></span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT symbol, date, close</span></span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM prices_daily</span></span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a>    con<span class="op">=</span>tidy_finance,</span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"date"</span>]</span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a>).dropna()</span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Define limit bands by exchange</span></span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a>limit_bands <span class="op">=</span> {<span class="st">"HOSE"</span>: <span class="fl">0.07</span>, <span class="st">"HNX"</span>: <span class="fl">0.10</span>, <span class="st">"UPCoM"</span>: <span class="fl">0.15</span>}</span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> prices_daily.sort_values([<span class="st">"symbol"</span>, <span class="st">"date"</span>])</span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"prev_close"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"close"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"close"</span>] <span class="op">/</span> prices_daily[<span class="st">"prev_close"</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_band"</span>] <span class="op">=</span> prices_daily[<span class="st">"exchange"</span>].<span class="bu">map</span>(limit_bands)</span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a><span class="co"># A limit hit occurs when the return is within 0.1% of the theoretical limit</span></span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a>tolerance <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"upper_hit"</span>] <span class="op">=</span> (</span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"ret"</span>] <span class="op">&gt;=</span> prices_daily[<span class="st">"limit_band"</span>] <span class="op">-</span> tolerance</span>
<span id="cb20-279"><a href="#cb20-279" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-280"><a href="#cb20-280" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"lower_hit"</span>] <span class="op">=</span> (</span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"ret"</span>] <span class="op">&lt;=</span> <span class="op">-</span>prices_daily[<span class="st">"limit_band"</span>] <span class="op">+</span> tolerance</span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-283"><a href="#cb20-283" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_hit"</span>] <span class="op">=</span> (</span>
<span id="cb20-284"><a href="#cb20-284" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"upper_hit"</span>] <span class="op">|</span> prices_daily[<span class="st">"lower_hit"</span>]</span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a><span class="fu">### Frequency of Limit Hits</span></span>
<span id="cb20-289"><a href="#cb20-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-limit-hit-frequency</span></span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Monthly Frequency of Price Limit Hits by Exchange"</span></span>
<span id="cb20-296"><a href="#cb20-296" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"year_month"</span>] <span class="op">=</span> prices_daily[<span class="st">"date"</span>].dt.to_period(<span class="st">"M"</span>)</span>
<span id="cb20-297"><a href="#cb20-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly <span class="op">=</span> (</span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"year_month"</span>, <span class="st">"exchange"</span>])</span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a>        total_obs<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"count"</span>),</span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a>        limit_hits<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"sum"</span>)</span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly[<span class="st">"hit_rate"</span>] <span class="op">=</span> (</span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a>    limit_hit_monthly[<span class="st">"limit_hits"</span>] <span class="op">/</span> limit_hit_monthly[<span class="st">"total_obs"</span>]</span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a>limit_hit_monthly[<span class="st">"date"</span>] <span class="op">=</span> limit_hit_monthly[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb20-315"><a href="#cb20-315" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb20-316"><a href="#cb20-316" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> limit_hit_monthly[limit_hit_monthly[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a>    ax.plot(</span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"date"</span>], subset[<span class="st">"hit_rate"</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>exchange, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.2</span></span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-322"><a href="#cb20-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-323"><a href="#cb20-323" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Limit Hit Rate (%)"</span>)</span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a><span class="fu">### Volatility Spillover Test</span></span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a>Following @kim1997price, we test whether days following a limit hit exhibit abnormally high volatility. Define the dummy variable $D_t = 1$ if a limit hit occurred on day $t$, and estimate:</span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a>\sigma_{t+1}^2 = \alpha + \beta D_t + \gamma \sigma_t^2 + \varepsilon_{t+1}</span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a>$$ {#eq-vol-spillover}</span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a>where $\sigma_t^2$ is the squared return. A positive and significant $\beta$ indicates volatility spillover attributable to the price limit.</span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-344"><a href="#cb20-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: volatility-spillover-test</span></span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel-level volatility spillover test</span></span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"sq_ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"ret"</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"sq_ret_lead"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"sq_ret"</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"limit_hit_int"</span>] <span class="op">=</span> prices_daily[<span class="st">"limit_hit"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a>spillover_data <span class="op">=</span> prices_daily.dropna(subset<span class="op">=</span>[<span class="st">"sq_ret_lead"</span>, <span class="st">"sq_ret"</span>])</span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(spillover_data[[<span class="st">"limit_hit_int"</span>, <span class="st">"sq_ret"</span>]])</span>
<span id="cb20-357"><a href="#cb20-357" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> spillover_data[<span class="st">"sq_ret_lead"</span>]</span>
<span id="cb20-358"><a href="#cb20-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">"cluster"</span>, cov_kwds<span class="op">=</span>{<span class="st">"groups"</span>: spillover_data[<span class="st">"symbol"</span>]})</span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a>spillover_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Coefficient"</span>: model.params,</span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Std. Error"</span>: model.bse,</span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a>    <span class="st">"t-stat"</span>: model.tvalues,</span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p-value"</span>: model.pvalues</span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">6</span>)</span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(spillover_results)</span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a>A significant positive coefficient on the limit hit dummy confirms that Vietnamese price limits do not eliminate volatility, they merely redistribute it across days. This has direct implications for risk management: daily VaR measures computed from censored returns understate true risk exposure.</span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a><span class="fu">### Return Autocorrelation Induced by Price Limits</span></span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a>Price limits mechanically induce positive autocorrelation in returns. To quantify this, we compute the first-order autocorrelation coefficient separately for stocks that hit limits frequently versus those that do not.</span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-autocorrelation-by-limit</span></span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Return Autocorrelation by Price Limit Hit Frequency"</span></span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify stocks by limit hit frequency</span></span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a>stock_limit_freq <span class="op">=</span> (</span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-391"><a href="#cb20-391" aria-hidden="true" tabindex="-1"></a>        hit_rate<span class="op">=</span>(<span class="st">"limit_hit"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-392"><a href="#cb20-392" aria-hidden="true" tabindex="-1"></a>        n_obs<span class="op">=</span>(<span class="st">"ret"</span>, <span class="st">"count"</span>)</span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a>    .query(<span class="st">"n_obs &gt;= 250"</span>)  <span class="co"># At least 1 year of data</span></span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a>stock_limit_freq[<span class="st">"limit_group"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a>    stock_limit_freq[<span class="st">"hit_rate"</span>], q<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>]</span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation by group</span></span>
<span id="cb20-403"><a href="#cb20-403" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_autocorr(group_symbols):</span>
<span id="cb20-404"><a href="#cb20-404" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> prices_daily[prices_daily[<span class="st">"symbol"</span>].isin(group_symbols)].copy()</span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">"ret_lag"</span>] <span class="op">=</span> subset.groupby(<span class="st">"symbol"</span>)[<span class="st">"ret"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subset[[<span class="st">"ret"</span>, <span class="st">"ret_lag"</span>]].dropna().corr().iloc[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a>autocorr_results <span class="op">=</span> []</span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>]:</span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a>    symbols <span class="op">=</span> stock_limit_freq[stock_limit_freq[<span class="st">"limit_group"</span>] <span class="op">==</span> group].index</span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a>    ac <span class="op">=</span> compute_autocorr(symbols)</span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a>    n_stocks <span class="op">=</span> <span class="bu">len</span>(symbols)</span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a>    avg_hit_rate <span class="op">=</span> stock_limit_freq.loc[symbols, <span class="st">"hit_rate"</span>].mean()</span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a>    autocorr_results.append({</span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Group"</span>: group,</span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a>        <span class="st">"N Stocks"</span>: n_stocks,</span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Avg Limit Hit Rate (%)"</span>: <span class="bu">round</span>(avg_hit_rate <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AR(1)"</span>: <span class="bu">round</span>(ac, <span class="dv">4</span>)</span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(autocorr_results).style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a>The expected pattern is a monotonically increasing autocorrelation from the Low to High limit-hit group, confirming that the observed serial dependence in returns is at least partly an artifact of price censoring rather than genuine return predictability.</span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Liquidity, Thin Trading, and Zero Returns</span></span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a>Liquidity (i.e., the ability to trade quickly at low cost without moving the price) is a first-order concern in Vietnamese equities. A substantial fraction of listed firms, particularly on HNX and UPCoM, experience chronic illiquidity characterized by infrequent trading, wide bid-ask spreads, and frequent zero-return days.</span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a><span class="fu">### Measuring Liquidity</span></span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a>The academic literature has developed numerous liquidity measures, each capturing a different dimension of market quality. @#tbl-liquidity-measures summarizes the measures most applicable to Vietnamese data, given typical data availability.</span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Measure <span class="pp">|</span> Formula <span class="pp">|</span> Interpretation <span class="pp">|</span> Data Required <span class="pp">|</span></span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------|------------------|------------------|------------------|</span></span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Turnover ratio <span class="pp">|</span> $\text{TO}_{i,t} = \frac{\text{Volume}_{i,t}}{\text{Shares Outstanding}_{i}}$ <span class="pp">|</span> Trading intensity relative to float <span class="pp">|</span> Volume, shares outstanding <span class="pp">|</span></span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Amihud illiquidity <span class="pp">|</span> $\text{ILLIQ}_{i,t} = \frac{1}{D} \sum_{d=1}^{D} \frac{|r_{i,d}|}{V_{i,d}}$ <span class="pp">|</span> Price impact per unit of volume <span class="pp">|</span> Daily returns, daily volume <span class="pp">|</span></span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Zero-return proportion <span class="pp">|</span> $\text{ZR}_{i,t} = \frac{\#\{d : r_{i,d} = 0<span class="sc">\}</span>}{D}$ <span class="pp">|</span> Frequency of non-trading or stale pricing <span class="pp">|</span> Daily returns <span class="pp">|</span></span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Roll spread <span class="pp">|</span> $\hat{S}_i = 2\sqrt{-\text{Cov}(r_{i,d}, r_{i,d-1})}$ <span class="pp">|</span> Effective bid-ask spread estimate <span class="pp">|</span> Daily returns <span class="pp">|</span></span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Bid-ask spread <span class="pp">|</span> $\text{BA}_{i,d} = \frac{\text{Ask}_{i,d} - \text{Bid}_{i,d}}{(\text{Ask}_{i,d} + \text{Bid}_{i,d})/2}$ <span class="pp">|</span> Direct transaction cost <span class="pp">|</span> Quote data <span class="pp">|</span></span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a>: Liquidity Measures for Vietnamese Equities {#tbl-liquidity-measures}</span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a>The Amihud illiquidity ratio <span class="co">[</span><span class="ot">@amihud2002illiquidity</span><span class="co">]</span> is particularly useful because it requires only daily return and volume data. It captures the price impact of trading (i.e., the return per unit of currency volume) and has been shown to correlate well with more sophisticated microstructure-based measures such as the effective spread <span class="co">[</span><span class="ot">see @goyenko2009liquidity and @goyenko2009stock for a comprehensive comparison</span><span class="co">]</span>.</span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Computing Liquidity Diagnostics</span></span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-liquidity</span></span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standard liquidity measures at the stock-month level</span></span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"abs_ret"</span>] <span class="op">=</span> prices_daily[<span class="st">"ret"</span>].<span class="bu">abs</span>()</span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"zero_return"</span>] <span class="op">=</span> (prices_daily[<span class="st">"ret"</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"year_month"</span>] <span class="op">=</span> prices_daily[<span class="st">"date"</span>].dt.to_period(<span class="st">"M"</span>)</span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume volume is in shares and value is in VND</span></span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a><span class="co"># Amihud: average |ret| / value (in billions VND)</span></span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"amihud_daily"</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"value"</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a>    prices_daily[<span class="st">"abs_ret"</span>] <span class="op">/</span> (prices_daily[<span class="st">"value"</span>] <span class="op">/</span> <span class="fl">1e9</span>),</span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a>    np.nan</span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a>liquidity_monthly <span class="op">=</span> (</span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a>        zero_return_share<span class="op">=</span>(<span class="st">"zero_return"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a>        avg_turnover<span class="op">=</span>(<span class="st">"turnover"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a>        amihud<span class="op">=</span>(<span class="st">"amihud_daily"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a>        trading_days<span class="op">=</span>(<span class="st">"ret"</span>, <span class="st">"count"</span>),</span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a>        avg_daily_value<span class="op">=</span>(<span class="st">"value"</span>, <span class="st">"mean"</span>)</span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Flag severely illiquid stock-months</span></span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a>liquidity_monthly[<span class="st">"illiquid_flag"</span>] <span class="op">=</span> (</span>
<span id="cb20-481"><a href="#cb20-481" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"zero_return_share"</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">|</span></span>
<span id="cb20-482"><a href="#cb20-482" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"trading_days"</span>] <span class="op">&lt;</span> <span class="dv">10</span>) <span class="op">|</span></span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a>    (liquidity_monthly[<span class="st">"avg_daily_value"</span>] <span class="op">&lt;</span> <span class="fl">1e8</span>)  <span class="co"># &lt; 100M VND/day</span></span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-Sectional Distribution of Liquidity</span></span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-liquidity-distribution</span></span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Cross-Sectional Distribution of Liquidity Measures (Latest Full Year)"</span></span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a>latest_year <span class="op">=</span> liquidity_monthly[<span class="st">"year_month"</span>].dt.year.<span class="bu">max</span>()</span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a>annual_liq <span class="op">=</span> (</span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a>    liquidity_monthly[liquidity_monthly[<span class="st">"year_month"</span>].dt.year <span class="op">==</span> latest_year]</span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a>        zero_return_share<span class="op">=</span>(<span class="st">"zero_return_share"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a>        avg_turnover<span class="op">=</span>(<span class="st">"avg_turnover"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a>        amihud<span class="op">=</span>(<span class="st">"amihud"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a>        avg_daily_value_m<span class="op">=</span>(<span class="st">"avg_daily_value"</span>, <span class="kw">lambda</span> x: x.mean() <span class="op">/</span> <span class="fl">1e6</span>)</span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> annual_liq.describe(percentiles<span class="op">=</span>[<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>]).T</span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> summary_stats[</span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"mean"</span>, <span class="st">"std"</span>, <span class="st">"10%"</span>, <span class="st">"25%"</span>, <span class="st">"50%"</span>, <span class="st">"75%"</span>, <span class="st">"90%"</span>]</span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a>].<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a>summary_stats.columns <span class="op">=</span> [<span class="st">"Mean"</span>, <span class="st">"Std"</span>, <span class="st">"P10"</span>, <span class="st">"P25"</span>, <span class="st">"Median"</span>, <span class="st">"P75"</span>, <span class="st">"P90"</span>]</span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a>summary_stats.index <span class="op">=</span> [</span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Zero-Return Share"</span>,</span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Daily Turnover"</span>,</span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amihud Illiquidity"</span>,</span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Daily Value (M VND)"</span></span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a>summary_stats</span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a><span class="fu">### Liquidity Distribution Across Exchanges</span></span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-liquidity-by-exchange</span></span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of Zero-Return Share and Amihud Illiquidity by Exchange"</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge exchange info</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a>stock_exchange <span class="op">=</span> (</span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a>    prices_daily[[<span class="st">"symbol"</span>, <span class="st">"exchange"</span>]]</span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates(<span class="st">"symbol"</span>)</span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a>annual_liq_exch <span class="op">=</span> annual_liq.merge(</span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a>    stock_exchange, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">"symbol"</span></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero-return share</span></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> annual_liq_exch[annual_liq_exch[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].hist(</span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">"zero_return_share"</span>], bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>color, label<span class="op">=</span>exchange, density<span class="op">=</span><span class="va">True</span></span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Zero-Return Share"</span>)</span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a><span class="co"># Amihud (log scale)</span></span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange, color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"HOSE"</span>, <span class="st">"HNX"</span>, <span class="st">"UPCoM"</span>], [<span class="st">"#2C73D2"</span>, <span class="st">"#FF6B6B"</span>, <span class="st">"#5DCEAF"</span>]</span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> annual_liq_exch[annual_liq_exch[<span class="st">"exchange"</span>] <span class="op">==</span> exchange]</span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a>    amihud_log <span class="op">=</span> np.log(subset[<span class="st">"amihud"</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>))</span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].hist(</span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a>        amihud_log, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>color, label<span class="op">=</span>exchange, density<span class="op">=</span><span class="va">True</span></span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Log Amihud Illiquidity"</span>)</span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-576"><a href="#cb20-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-577"><a href="#cb20-577" aria-hidden="true" tabindex="-1"></a>The distributions typically reveal a bimodal pattern: HOSE stocks cluster at low illiquidity values, while HNX and especially UPCoM stocks exhibit a long right tail of extreme illiquidity. This heterogeneity implies that a single liquidity filter or treatment is insufficient for the entire cross-section.</span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Variation in Aggregate Liquidity</span></span>
<span id="cb20-580"><a href="#cb20-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-581"><a href="#cb20-581" aria-hidden="true" tabindex="-1"></a>Market-wide liquidity is not constant. It deteriorates during crises, policy uncertainty, and periods of capital outflow, and improves during bull markets and periods of foreign inflow. The time variation in aggregate liquidity is itself a risk factor <span class="co">[</span><span class="ot">@pastor2003liquidity</span><span class="co">]</span>.</span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-aggregate-liquidity</span></span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Time Series of Aggregate Liquidity (Market-Wide Amihud Illiquidity)"</span></span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a>agg_liquidity <span class="op">=</span> (</span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a>    liquidity_monthly</span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"year_month"</span>)</span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a>        median_amihud<span class="op">=</span>(<span class="st">"amihud"</span>, <span class="st">"median"</span>),</span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a>        median_zero_ret<span class="op">=</span>(<span class="st">"zero_return_share"</span>, <span class="st">"median"</span>),</span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a>        total_value<span class="op">=</span>(<span class="st">"avg_daily_value"</span>, <span class="st">"sum"</span>)</span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a>agg_liquidity[<span class="st">"date"</span>] <span class="op">=</span> agg_liquidity[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a>ax1.plot(</span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"date"</span>],</span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a>    np.log(agg_liquidity[<span class="st">"median_amihud"</span>].clip(lower<span class="op">=</span><span class="fl">1e-10</span>)),</span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2C73D2"</span>, linewidth<span class="op">=</span><span class="fl">1.2</span></span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">"Log Median Amihud"</span>, color<span class="op">=</span><span class="st">"#2C73D2"</span>)</span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">"y"</span>, labelcolor<span class="op">=</span><span class="st">"#2C73D2"</span>)</span>
<span id="cb20-611"><a href="#cb20-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-612"><a href="#cb20-612" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a>ax2.fill_between(</span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"date"</span>],</span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a>    agg_liquidity[<span class="st">"median_zero_ret"</span>] <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"#FF6B6B"</span></span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"Median Zero-Return Share (%)"</span>, color<span class="op">=</span><span class="st">"#FF6B6B"</span>)</span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">"y"</span>, labelcolor<span class="op">=</span><span class="st">"#FF6B6B"</span>)</span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>ax1.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-625"><a href="#cb20-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-626"><a href="#cb20-626" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Recommendation</span></span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-629"><a href="#cb20-629" aria-hidden="true" tabindex="-1"></a>Before any asset pricing analysis, apply the following liquidity filter: exclude stock-months where the zero-return share exceeds 50%, where fewer than 15 trading days are observed, or where average daily trading value falls below a threshold (e.g., 100 million VND). Document the filter explicitly, and report sensitivity of results to alternative thresholds.</span>
<span id="cb20-630"><a href="#cb20-630" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-631"><a href="#cb20-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-632"><a href="#cb20-632" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bid-Ask Spread Estimation</span></span>
<span id="cb20-633"><a href="#cb20-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-634"><a href="#cb20-634" aria-hidden="true" tabindex="-1"></a>In the absence of comprehensive quote data, the effective bid-ask spread can be estimated from transaction data using the method of @roll1984simple. The Roll estimator exploits the fact that if the bid-ask bounce is the sole source of negative serial covariance in returns, then:</span>
<span id="cb20-635"><a href="#cb20-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-636"><a href="#cb20-636" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-637"><a href="#cb20-637" aria-hidden="true" tabindex="-1"></a>\hat{S}_{\text{Roll}} = 2\sqrt{-\text{Cov}(\Delta p_t, \Delta p_{t-1})}</span>
<span id="cb20-638"><a href="#cb20-638" aria-hidden="true" tabindex="-1"></a>$$ {#eq-roll}</span>
<span id="cb20-639"><a href="#cb20-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-640"><a href="#cb20-640" aria-hidden="true" tabindex="-1"></a>where $\Delta p_t = p_t - p_{t-1}$ is the price change. When the autocovariance is positive (which occurs when information-driven serial correlation dominates the bid-ask bounce), the Roll estimator is undefined. @hasbrouck2009trading proposes a Bayesian variant that handles this case by imposing a prior on the spread.</span>
<span id="cb20-641"><a href="#cb20-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-644"><a href="#cb20-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-645"><a href="#cb20-645" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-roll-spread</span></span>
<span id="cb20-646"><a href="#cb20-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-647"><a href="#cb20-647" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Roll spread estimate at the stock-month level</span></span>
<span id="cb20-648"><a href="#cb20-648" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"dprice"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"close"</span>].diff()</span>
<span id="cb20-649"><a href="#cb20-649" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"dprice_lag"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"dprice"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb20-650"><a href="#cb20-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-651"><a href="#cb20-651" aria-hidden="true" tabindex="-1"></a>roll_cov <span class="op">=</span> (</span>
<span id="cb20-652"><a href="#cb20-652" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-653"><a href="#cb20-653" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb20-654"><a href="#cb20-654" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(</span>
<span id="cb20-655"><a href="#cb20-655" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> g: g[[<span class="st">"dprice"</span>, <span class="st">"dprice_lag"</span>]].dropna().cov().iloc[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb20-656"><a href="#cb20-656" aria-hidden="true" tabindex="-1"></a>        include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb20-657"><a href="#cb20-657" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-658"><a href="#cb20-658" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"autocovariance"</span>)</span>
<span id="cb20-659"><a href="#cb20-659" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-660"><a href="#cb20-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-661"><a href="#cb20-661" aria-hidden="true" tabindex="-1"></a><span class="co"># Roll spread is defined only when autocovariance is negative</span></span>
<span id="cb20-662"><a href="#cb20-662" aria-hidden="true" tabindex="-1"></a>roll_cov[<span class="st">"roll_spread"</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-663"><a href="#cb20-663" aria-hidden="true" tabindex="-1"></a>    roll_cov[<span class="st">"autocovariance"</span>] <span class="op">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb20-664"><a href="#cb20-664" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="op">-</span>roll_cov[<span class="st">"autocovariance"</span>]),</span>
<span id="cb20-665"><a href="#cb20-665" aria-hidden="true" tabindex="-1"></a>    np.nan</span>
<span id="cb20-666"><a href="#cb20-666" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-667"><a href="#cb20-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-668"><a href="#cb20-668" aria-hidden="true" tabindex="-1"></a><span class="co"># As a percentage of price</span></span>
<span id="cb20-669"><a href="#cb20-669" aria-hidden="true" tabindex="-1"></a>roll_cov <span class="op">=</span> roll_cov.merge(</span>
<span id="cb20-670"><a href="#cb20-670" aria-hidden="true" tabindex="-1"></a>    prices_daily.groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])[<span class="st">"close"</span>].mean()</span>
<span id="cb20-671"><a href="#cb20-671" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"avg_price"</span>),</span>
<span id="cb20-672"><a href="#cb20-672" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">"symbol"</span>, <span class="st">"year_month"</span>]</span>
<span id="cb20-673"><a href="#cb20-673" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-674"><a href="#cb20-674" aria-hidden="true" tabindex="-1"></a>roll_cov[<span class="st">"roll_spread_pct"</span>] <span class="op">=</span> roll_cov[<span class="st">"roll_spread"</span>] <span class="op">/</span> roll_cov[<span class="st">"avg_price"</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-675"><a href="#cb20-675" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-676"><a href="#cb20-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-679"><a href="#cb20-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-680"><a href="#cb20-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-roll-spread-summary</span></span>
<span id="cb20-681"><a href="#cb20-681" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-682"><a href="#cb20-682" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Distribution of Roll Spread Estimates (% of Price)"</span></span>
<span id="cb20-683"><a href="#cb20-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-684"><a href="#cb20-684" aria-hidden="true" tabindex="-1"></a>roll_summary <span class="op">=</span> (</span>
<span id="cb20-685"><a href="#cb20-685" aria-hidden="true" tabindex="-1"></a>    roll_cov</span>
<span id="cb20-686"><a href="#cb20-686" aria-hidden="true" tabindex="-1"></a>    .dropna(subset<span class="op">=</span>[<span class="st">"roll_spread_pct"</span>])</span>
<span id="cb20-687"><a href="#cb20-687" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"year_month"</span>)[<span class="st">"roll_spread_pct"</span>]</span>
<span id="cb20-688"><a href="#cb20-688" aria-hidden="true" tabindex="-1"></a>    .describe(percentiles<span class="op">=</span>[<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>])</span>
<span id="cb20-689"><a href="#cb20-689" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-690"><a href="#cb20-690" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-691"><a href="#cb20-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-692"><a href="#cb20-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Show latest year summary</span></span>
<span id="cb20-693"><a href="#cb20-693" aria-hidden="true" tabindex="-1"></a>latest_year_roll <span class="op">=</span> roll_cov[</span>
<span id="cb20-694"><a href="#cb20-694" aria-hidden="true" tabindex="-1"></a>    roll_cov[<span class="st">"year_month"</span>].dt.year <span class="op">==</span> roll_cov[<span class="st">"year_month"</span>].dt.year.<span class="bu">max</span>()</span>
<span id="cb20-695"><a href="#cb20-695" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-696"><a href="#cb20-696" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb20-697"><a href="#cb20-697" aria-hidden="true" tabindex="-1"></a>    latest_year_roll[<span class="st">"roll_spread_pct"</span>]</span>
<span id="cb20-698"><a href="#cb20-698" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb20-699"><a href="#cb20-699" aria-hidden="true" tabindex="-1"></a>    .describe(percentiles<span class="op">=</span>[<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>])</span>
<span id="cb20-700"><a href="#cb20-700" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb20-701"><a href="#cb20-701" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-702"><a href="#cb20-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-703"><a href="#cb20-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-704"><a href="#cb20-704" aria-hidden="true" tabindex="-1"></a><span class="fu">## Non-Synchronous Trading Bias</span></span>
<span id="cb20-705"><a href="#cb20-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-706"><a href="#cb20-706" aria-hidden="true" tabindex="-1"></a>When stocks do not trade at the same frequency or at the same times, observed returns are misaligned. This non-synchronous trading bias, first formalized by @scholes1977estimating and @lo1990econometric, is one of the most consequential microstructure effects for asset pricing in thin markets.</span>
<span id="cb20-707"><a href="#cb20-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-708"><a href="#cb20-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Problem</span></span>
<span id="cb20-709"><a href="#cb20-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-710"><a href="#cb20-710" aria-hidden="true" tabindex="-1"></a>Suppose the true (unobserved) return process for stock $i$ follows a single-factor model:</span>
<span id="cb20-711"><a href="#cb20-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-712"><a href="#cb20-712" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-713"><a href="#cb20-713" aria-hidden="true" tabindex="-1"></a>r_{i,t}^* = \alpha_i + \beta_i r_{m,t}^* + \varepsilon_{i,t}</span>
<span id="cb20-714"><a href="#cb20-714" aria-hidden="true" tabindex="-1"></a>$$ {#eq-true-factor}</span>
<span id="cb20-715"><a href="#cb20-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-716"><a href="#cb20-716" aria-hidden="true" tabindex="-1"></a>where $r_{m,t}^*$ is the true market return and $\beta_i$ is the true beta. If stock $i$ last traded $k$ days before the end of day $t$, the observed return incorporates information only up to day $t - k$. @scholes1977estimating show that the OLS estimate of beta from regressing observed returns on observed market returns is:</span>
<span id="cb20-717"><a href="#cb20-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-718"><a href="#cb20-718" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-719"><a href="#cb20-719" aria-hidden="true" tabindex="-1"></a>\hat{\beta}_i^{OLS} = \beta_i \cdot \pi_i</span>
<span id="cb20-720"><a href="#cb20-720" aria-hidden="true" tabindex="-1"></a>$$ {#eq-beta-bias}</span>
<span id="cb20-721"><a href="#cb20-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-722"><a href="#cb20-722" aria-hidden="true" tabindex="-1"></a>where $\pi_i$ is the probability that stock $i$ trades on any given day. For a stock that trades on only 50% of days, the OLS beta is biased downward by 50%. This bias is severe in Vietnam, where many small-cap stocks trade on fewer than half of all trading days.</span>
<span id="cb20-723"><a href="#cb20-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-724"><a href="#cb20-724" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantifying the Bias</span></span>
<span id="cb20-725"><a href="#cb20-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-728"><a href="#cb20-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-729"><a href="#cb20-729" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-trading-frequency</span></span>
<span id="cb20-730"><a href="#cb20-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-731"><a href="#cb20-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of Daily Trading Frequency Across Listed Stocks"</span></span>
<span id="cb20-732"><a href="#cb20-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-733"><a href="#cb20-733" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute trading frequency: proportion of market days with nonzero volume</span></span>
<span id="cb20-734"><a href="#cb20-734" aria-hidden="true" tabindex="-1"></a>market_days <span class="op">=</span> prices_daily.groupby(<span class="st">"year_month"</span>)[<span class="st">"date"</span>].nunique()</span>
<span id="cb20-735"><a href="#cb20-735" aria-hidden="true" tabindex="-1"></a>trading_freq <span class="op">=</span> (</span>
<span id="cb20-736"><a href="#cb20-736" aria-hidden="true" tabindex="-1"></a>    prices_daily[prices_daily[<span class="st">"value"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb20-737"><a href="#cb20-737" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])[<span class="st">"date"</span>]</span>
<span id="cb20-738"><a href="#cb20-738" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb20-739"><a href="#cb20-739" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"days_traded"</span>)</span>
<span id="cb20-740"><a href="#cb20-740" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-741"><a href="#cb20-741" aria-hidden="true" tabindex="-1"></a>trading_freq <span class="op">=</span> trading_freq.merge(</span>
<span id="cb20-742"><a href="#cb20-742" aria-hidden="true" tabindex="-1"></a>    market_days.reset_index().rename(columns<span class="op">=</span>{<span class="st">"date"</span>: <span class="st">"market_days"</span>}),</span>
<span id="cb20-743"><a href="#cb20-743" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"year_month"</span></span>
<span id="cb20-744"><a href="#cb20-744" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-745"><a href="#cb20-745" aria-hidden="true" tabindex="-1"></a>trading_freq[<span class="st">"trade_prob"</span>] <span class="op">=</span> trading_freq[<span class="st">"days_traded"</span>] <span class="op">/</span> trading_freq[<span class="st">"market_days"</span>]</span>
<span id="cb20-746"><a href="#cb20-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-747"><a href="#cb20-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Annual average</span></span>
<span id="cb20-748"><a href="#cb20-748" aria-hidden="true" tabindex="-1"></a>annual_trade_freq <span class="op">=</span> (</span>
<span id="cb20-749"><a href="#cb20-749" aria-hidden="true" tabindex="-1"></a>    trading_freq</span>
<span id="cb20-750"><a href="#cb20-750" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)[<span class="st">"trade_prob"</span>]</span>
<span id="cb20-751"><a href="#cb20-751" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb20-752"><a href="#cb20-752" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"avg_trade_prob"</span>)</span>
<span id="cb20-753"><a href="#cb20-753" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-754"><a href="#cb20-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-755"><a href="#cb20-755" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb20-756"><a href="#cb20-756" aria-hidden="true" tabindex="-1"></a>ax.hist(</span>
<span id="cb20-757"><a href="#cb20-757" aria-hidden="true" tabindex="-1"></a>    annual_trade_freq[<span class="st">"avg_trade_prob"</span>], bins<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb20-758"><a href="#cb20-758" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2C73D2"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, alpha<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb20-759"><a href="#cb20-759" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-760"><a href="#cb20-760" aria-hidden="true" tabindex="-1"></a>ax.axvline(</span>
<span id="cb20-761"><a href="#cb20-761" aria-hidden="true" tabindex="-1"></a>    annual_trade_freq[<span class="st">"avg_trade_prob"</span>].median(),</span>
<span id="cb20-762"><a href="#cb20-762" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#FF6B6B"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb20-763"><a href="#cb20-763" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"Median = </span><span class="sc">{</span>annual_trade_freq[<span class="st">'avg_trade_prob'</span>]<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb20-764"><a href="#cb20-764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-765"><a href="#cb20-765" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Average Trading Probability (Fraction of Market Days)"</span>)</span>
<span id="cb20-766"><a href="#cb20-766" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Number of Stocks"</span>)</span>
<span id="cb20-767"><a href="#cb20-767" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-768"><a href="#cb20-768" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-769"><a href="#cb20-769" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-770"><a href="#cb20-770" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-771"><a href="#cb20-771" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-772"><a href="#cb20-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-773"><a href="#cb20-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-774"><a href="#cb20-774" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Dimson Beta Correction</span></span>
<span id="cb20-775"><a href="#cb20-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-776"><a href="#cb20-776" aria-hidden="true" tabindex="-1"></a>@dimson1979risk proposes a simple correction: include lagged and leading market returns in the beta regression:</span>
<span id="cb20-777"><a href="#cb20-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-778"><a href="#cb20-778" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-779"><a href="#cb20-779" aria-hidden="true" tabindex="-1"></a>r_{i,t} = \alpha_i + \sum_{k=-K}^{K} \beta_{i,k} \, r_{m,t-k} + \varepsilon_{i,t}</span>
<span id="cb20-780"><a href="#cb20-780" aria-hidden="true" tabindex="-1"></a>$$ {#eq-dimson}</span>
<span id="cb20-781"><a href="#cb20-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-782"><a href="#cb20-782" aria-hidden="true" tabindex="-1"></a>The Dimson-corrected beta is $\hat{\beta}_i^{Dimson} = \sum_{k=-K}^{K} \hat{\beta}_{i,k}$. Typically $K = 1$ or $K = 2$ is sufficient. The summed coefficients capture the full response of the stock's observed return to market information, regardless of when the stock actually trades.</span>
<span id="cb20-783"><a href="#cb20-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-786"><a href="#cb20-786" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-787"><a href="#cb20-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dimson-beta-estimation</span></span>
<span id="cb20-788"><a href="#cb20-788" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-789"><a href="#cb20-789" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Dimson betas with K=1 lag and lead</span></span>
<span id="cb20-790"><a href="#cb20-790" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge market return</span></span>
<span id="cb20-791"><a href="#cb20-791" aria-hidden="true" tabindex="-1"></a>market_ret <span class="op">=</span> (</span>
<span id="cb20-792"><a href="#cb20-792" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-793"><a href="#cb20-793" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"date"</span>)</span>
<span id="cb20-794"><a href="#cb20-794" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(</span>
<span id="cb20-795"><a href="#cb20-795" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> g: np.average(g[<span class="st">"ret"</span>].dropna(), weights<span class="op">=</span>g[<span class="st">"mktcap"</span>].loc[g[<span class="st">"ret"</span>].dropna().index])</span>
<span id="cb20-796"><a href="#cb20-796" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> g[<span class="st">"ret"</span>].dropna().shape[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan,</span>
<span id="cb20-797"><a href="#cb20-797" aria-hidden="true" tabindex="-1"></a>        include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb20-798"><a href="#cb20-798" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-799"><a href="#cb20-799" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"rm"</span>)</span>
<span id="cb20-800"><a href="#cb20-800" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-801"><a href="#cb20-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-802"><a href="#cb20-802" aria-hidden="true" tabindex="-1"></a>prices_daily <span class="op">=</span> prices_daily.merge(market_ret, on<span class="op">=</span><span class="st">"date"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb20-803"><a href="#cb20-803" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"rm_lag1"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"rm"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb20-804"><a href="#cb20-804" aria-hidden="true" tabindex="-1"></a>prices_daily[<span class="st">"rm_lead1"</span>] <span class="op">=</span> prices_daily.groupby(<span class="st">"symbol"</span>)[<span class="st">"rm"</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-805"><a href="#cb20-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-806"><a href="#cb20-806" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_dimson_beta(group):</span>
<span id="cb20-807"><a href="#cb20-807" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate OLS and Dimson(K=1) betas for a single stock."""</span></span>
<span id="cb20-808"><a href="#cb20-808" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">"ret"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lag1"</span>, <span class="st">"rm_lead1"</span>])</span>
<span id="cb20-809"><a href="#cb20-809" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb20-810"><a href="#cb20-810" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series({<span class="st">"beta_ols"</span>: np.nan, <span class="st">"beta_dimson"</span>: np.nan, <span class="st">"n_obs"</span>: <span class="bu">len</span>(g)})</span>
<span id="cb20-811"><a href="#cb20-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-812"><a href="#cb20-812" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OLS beta</span></span>
<span id="cb20-813"><a href="#cb20-813" aria-hidden="true" tabindex="-1"></a>    X_ols <span class="op">=</span> sm.add_constant(g[<span class="st">"rm"</span>])</span>
<span id="cb20-814"><a href="#cb20-814" aria-hidden="true" tabindex="-1"></a>    ols_model <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], X_ols).fit()</span>
<span id="cb20-815"><a href="#cb20-815" aria-hidden="true" tabindex="-1"></a>    beta_ols <span class="op">=</span> ols_model.params[<span class="st">"rm"</span>]</span>
<span id="cb20-816"><a href="#cb20-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-817"><a href="#cb20-817" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dimson beta</span></span>
<span id="cb20-818"><a href="#cb20-818" aria-hidden="true" tabindex="-1"></a>    X_dim <span class="op">=</span> sm.add_constant(g[[<span class="st">"rm_lag1"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lead1"</span>]])</span>
<span id="cb20-819"><a href="#cb20-819" aria-hidden="true" tabindex="-1"></a>    dim_model <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], X_dim).fit()</span>
<span id="cb20-820"><a href="#cb20-820" aria-hidden="true" tabindex="-1"></a>    beta_dimson <span class="op">=</span> dim_model.params[[<span class="st">"rm_lag1"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lead1"</span>]].<span class="bu">sum</span>()</span>
<span id="cb20-821"><a href="#cb20-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-822"><a href="#cb20-822" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.Series({</span>
<span id="cb20-823"><a href="#cb20-823" aria-hidden="true" tabindex="-1"></a>        <span class="st">"beta_ols"</span>: beta_ols,</span>
<span id="cb20-824"><a href="#cb20-824" aria-hidden="true" tabindex="-1"></a>        <span class="st">"beta_dimson"</span>: beta_dimson,</span>
<span id="cb20-825"><a href="#cb20-825" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_obs"</span>: <span class="bu">len</span>(g)</span>
<span id="cb20-826"><a href="#cb20-826" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-827"><a href="#cb20-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-828"><a href="#cb20-828" aria-hidden="true" tabindex="-1"></a>beta_comparison <span class="op">=</span> (</span>
<span id="cb20-829"><a href="#cb20-829" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-830"><a href="#cb20-830" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb20-831"><a href="#cb20-831" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_dimson_beta, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-832"><a href="#cb20-832" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-833"><a href="#cb20-833" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-834"><a href="#cb20-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-835"><a href="#cb20-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-838"><a href="#cb20-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-839"><a href="#cb20-839" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-beta-comparison</span></span>
<span id="cb20-840"><a href="#cb20-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-841"><a href="#cb20-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "OLS Beta vs. Dimson-Corrected Beta"</span></span>
<span id="cb20-842"><a href="#cb20-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-843"><a href="#cb20-843" aria-hidden="true" tabindex="-1"></a>beta_valid <span class="op">=</span> beta_comparison.dropna()</span>
<span id="cb20-844"><a href="#cb20-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-845"><a href="#cb20-845" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb20-846"><a href="#cb20-846" aria-hidden="true" tabindex="-1"></a>ax.scatter(</span>
<span id="cb20-847"><a href="#cb20-847" aria-hidden="true" tabindex="-1"></a>    beta_valid[<span class="st">"beta_ols"</span>], beta_valid[<span class="st">"beta_dimson"</span>],</span>
<span id="cb20-848"><a href="#cb20-848" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.3</span>, s<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"#2C73D2"</span></span>
<span id="cb20-849"><a href="#cb20-849" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-850"><a href="#cb20-850" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [</span>
<span id="cb20-851"><a href="#cb20-851" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(ax.get_xlim()[<span class="dv">0</span>], ax.get_ylim()[<span class="dv">0</span>]),</span>
<span id="cb20-852"><a href="#cb20-852" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(ax.get_xlim()[<span class="dv">1</span>], ax.get_ylim()[<span class="dv">1</span>])</span>
<span id="cb20-853"><a href="#cb20-853" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-854"><a href="#cb20-854" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">"--"</span>, color<span class="op">=</span><span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-855"><a href="#cb20-855" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"OLS Beta"</span>)</span>
<span id="cb20-856"><a href="#cb20-856" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Dimson Beta (K=1)"</span>)</span>
<span id="cb20-857"><a href="#cb20-857" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb20-858"><a href="#cb20-858" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-859"><a href="#cb20-859" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-860"><a href="#cb20-860" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-861"><a href="#cb20-861" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-862"><a href="#cb20-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-863"><a href="#cb20-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-864"><a href="#cb20-864" aria-hidden="true" tabindex="-1"></a>The scatter plot should reveal a systematic pattern: Dimson betas exceed OLS betas for most stocks, with the discrepancy largest for thinly traded stocks. Points above the 45-degree line indicate stocks whose OLS betas are biased downward by non-synchronous trading.</span>
<span id="cb20-865"><a href="#cb20-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-868"><a href="#cb20-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-869"><a href="#cb20-869" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-beta-bias-by-liquidity</span></span>
<span id="cb20-870"><a href="#cb20-870" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-871"><a href="#cb20-871" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Beta Bias by Trading Frequency Tercile"</span></span>
<span id="cb20-872"><a href="#cb20-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-873"><a href="#cb20-873" aria-hidden="true" tabindex="-1"></a>beta_with_freq <span class="op">=</span> beta_valid.merge(annual_trade_freq, on<span class="op">=</span><span class="st">"symbol"</span>)</span>
<span id="cb20-874"><a href="#cb20-874" aria-hidden="true" tabindex="-1"></a>beta_with_freq[<span class="st">"freq_tercile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb20-875"><a href="#cb20-875" aria-hidden="true" tabindex="-1"></a>    beta_with_freq[<span class="st">"avg_trade_prob"</span>], q<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb20-876"><a href="#cb20-876" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"Low (Thin)"</span>, <span class="st">"Medium"</span>, <span class="st">"High (Liquid)"</span>]</span>
<span id="cb20-877"><a href="#cb20-877" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-878"><a href="#cb20-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-879"><a href="#cb20-879" aria-hidden="true" tabindex="-1"></a>beta_bias_summary <span class="op">=</span> (</span>
<span id="cb20-880"><a href="#cb20-880" aria-hidden="true" tabindex="-1"></a>    beta_with_freq</span>
<span id="cb20-881"><a href="#cb20-881" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"freq_tercile"</span>)</span>
<span id="cb20-882"><a href="#cb20-882" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-883"><a href="#cb20-883" aria-hidden="true" tabindex="-1"></a>        n_stocks<span class="op">=</span>(<span class="st">"symbol"</span>, <span class="st">"count"</span>),</span>
<span id="cb20-884"><a href="#cb20-884" aria-hidden="true" tabindex="-1"></a>        avg_trade_prob<span class="op">=</span>(<span class="st">"avg_trade_prob"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-885"><a href="#cb20-885" aria-hidden="true" tabindex="-1"></a>        mean_beta_ols<span class="op">=</span>(<span class="st">"beta_ols"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-886"><a href="#cb20-886" aria-hidden="true" tabindex="-1"></a>        mean_beta_dimson<span class="op">=</span>(<span class="st">"beta_dimson"</span>, <span class="st">"mean"</span>),</span>
<span id="cb20-887"><a href="#cb20-887" aria-hidden="true" tabindex="-1"></a>        median_beta_ols<span class="op">=</span>(<span class="st">"beta_ols"</span>, <span class="st">"median"</span>),</span>
<span id="cb20-888"><a href="#cb20-888" aria-hidden="true" tabindex="-1"></a>        median_beta_dimson<span class="op">=</span>(<span class="st">"beta_dimson"</span>, <span class="st">"median"</span>)</span>
<span id="cb20-889"><a href="#cb20-889" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-890"><a href="#cb20-890" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb20-891"><a href="#cb20-891" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-892"><a href="#cb20-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-893"><a href="#cb20-893" aria-hidden="true" tabindex="-1"></a>beta_bias_summary[<span class="st">"bias_pct"</span>] <span class="op">=</span> (</span>
<span id="cb20-894"><a href="#cb20-894" aria-hidden="true" tabindex="-1"></a>    (beta_bias_summary[<span class="st">"mean_beta_dimson"</span>] <span class="op">-</span> beta_bias_summary[<span class="st">"mean_beta_ols"</span>])</span>
<span id="cb20-895"><a href="#cb20-895" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> beta_bias_summary[<span class="st">"mean_beta_dimson"</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-896"><a href="#cb20-896" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb20-897"><a href="#cb20-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-898"><a href="#cb20-898" aria-hidden="true" tabindex="-1"></a>beta_bias_summary</span>
<span id="cb20-899"><a href="#cb20-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-900"><a href="#cb20-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-901"><a href="#cb20-901" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb20-902"><a href="#cb20-902" aria-hidden="true" tabindex="-1"></a>For the thinnest-traded tercile, OLS beta underestimates true systematic risk by 20-40% on average. Using uncorrected betas for cost of equity estimation or factor model tests will produce systematically incorrect results for these stocks.</span>
<span id="cb20-903"><a href="#cb20-903" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-904"><a href="#cb20-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-905"><a href="#cb20-905" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Scholes-Williams Estimator</span></span>
<span id="cb20-906"><a href="#cb20-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-907"><a href="#cb20-907" aria-hidden="true" tabindex="-1"></a>An alternative correction, proposed by @scholes1977estimating, estimates beta as:</span>
<span id="cb20-908"><a href="#cb20-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-909"><a href="#cb20-909" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-910"><a href="#cb20-910" aria-hidden="true" tabindex="-1"></a>\hat{\beta}_i^{SW} = \frac{\hat{\beta}_{i,-1} + \hat{\beta}_{i,0} + \hat{\beta}_{i,+1}}{1 + 2\hat{\rho}_m}</span>
<span id="cb20-911"><a href="#cb20-911" aria-hidden="true" tabindex="-1"></a>$$ {#eq-sw}</span>
<span id="cb20-912"><a href="#cb20-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-913"><a href="#cb20-913" aria-hidden="true" tabindex="-1"></a>where $\hat{\beta}_{i,k}$ is the slope from regressing $r_{i,t}$ on $r_{m,t-k}$ alone, and $\hat{\rho}_m$ is the first-order autocorrelation of the market return. The Scholes-Williams estimator is consistent under the assumption that non-trading is the sole source of serial cross-correlation, while the Dimson estimator is more robust to additional sources of lead-lag structure.</span>
<span id="cb20-914"><a href="#cb20-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-917"><a href="#cb20-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-918"><a href="#cb20-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: scholes-williams-beta</span></span>
<span id="cb20-919"><a href="#cb20-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-920"><a href="#cb20-920" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_sw_beta(group):</span>
<span id="cb20-921"><a href="#cb20-921" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate Scholes-Williams beta."""</span></span>
<span id="cb20-922"><a href="#cb20-922" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[<span class="st">"ret"</span>, <span class="st">"rm"</span>, <span class="st">"rm_lag1"</span>, <span class="st">"rm_lead1"</span>])</span>
<span id="cb20-923"><a href="#cb20-923" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb20-924"><a href="#cb20-924" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb20-925"><a href="#cb20-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-926"><a href="#cb20-926" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate regressions</span></span>
<span id="cb20-927"><a href="#cb20-927" aria-hidden="true" tabindex="-1"></a>    beta_lag <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm_lag1"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb20-928"><a href="#cb20-928" aria-hidden="true" tabindex="-1"></a>    beta_0 <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb20-929"><a href="#cb20-929" aria-hidden="true" tabindex="-1"></a>    beta_lead <span class="op">=</span> sm.OLS(g[<span class="st">"ret"</span>], sm.add_constant(g[<span class="st">"rm_lead1"</span>])).fit().params.iloc[<span class="dv">1</span>]</span>
<span id="cb20-930"><a href="#cb20-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-931"><a href="#cb20-931" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market autocorrelation</span></span>
<span id="cb20-932"><a href="#cb20-932" aria-hidden="true" tabindex="-1"></a>    rho_m <span class="op">=</span> g[<span class="st">"rm"</span>].autocorr(lag<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-933"><a href="#cb20-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-934"><a href="#cb20-934" aria-hidden="true" tabindex="-1"></a>    beta_sw <span class="op">=</span> (beta_lag <span class="op">+</span> beta_0 <span class="op">+</span> beta_lead) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> rho_m)</span>
<span id="cb20-935"><a href="#cb20-935" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> beta_sw</span>
<span id="cb20-936"><a href="#cb20-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-937"><a href="#cb20-937" aria-hidden="true" tabindex="-1"></a>beta_comparison[<span class="st">"beta_sw"</span>] <span class="op">=</span> (</span>
<span id="cb20-938"><a href="#cb20-938" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-939"><a href="#cb20-939" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"symbol"</span>)</span>
<span id="cb20-940"><a href="#cb20-940" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(estimate_sw_beta, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-941"><a href="#cb20-941" aria-hidden="true" tabindex="-1"></a>    .values</span>
<span id="cb20-942"><a href="#cb20-942" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-943"><a href="#cb20-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-944"><a href="#cb20-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-945"><a href="#cb20-945" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implications for Portfolio Construction</span></span>
<span id="cb20-946"><a href="#cb20-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-947"><a href="#cb20-947" aria-hidden="true" tabindex="-1"></a>The microstructure frictions documented above have direct consequences for portfolio construction, particularly for strategies that involve rebalancing across the full cross-section of listed firms.</span>
<span id="cb20-948"><a href="#cb20-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-949"><a href="#cb20-949" aria-hidden="true" tabindex="-1"></a><span class="fu">### Equal-Weighted vs. Value-Weighted Returns</span></span>
<span id="cb20-950"><a href="#cb20-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-951"><a href="#cb20-951" aria-hidden="true" tabindex="-1"></a>Equal-weighted portfolio returns give the same weight to each stock, including illiquid small-cap stocks that may contribute stale or noisy prices. Value-weighted returns tilt toward large, liquid stocks and are less susceptible to microstructure contamination.</span>
<span id="cb20-952"><a href="#cb20-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-955"><a href="#cb20-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-956"><a href="#cb20-956" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ew-vs-vw</span></span>
<span id="cb20-957"><a href="#cb20-957" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-958"><a href="#cb20-958" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cumulative Returns: Equal-Weighted vs. Value-Weighted Market Portfolio"</span></span>
<span id="cb20-959"><a href="#cb20-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-960"><a href="#cb20-960" aria-hidden="true" tabindex="-1"></a>monthly_returns <span class="op">=</span> (</span>
<span id="cb20-961"><a href="#cb20-961" aria-hidden="true" tabindex="-1"></a>    prices_daily</span>
<span id="cb20-962"><a href="#cb20-962" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"symbol"</span>, <span class="st">"year_month"</span>])</span>
<span id="cb20-963"><a href="#cb20-963" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-964"><a href="#cb20-964" aria-hidden="true" tabindex="-1"></a>        monthly_ret<span class="op">=</span>(<span class="st">"ret"</span>, <span class="kw">lambda</span> x: (<span class="dv">1</span> <span class="op">+</span> x).prod() <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb20-965"><a href="#cb20-965" aria-hidden="true" tabindex="-1"></a>        last_mktcap<span class="op">=</span>(<span class="st">"mktcap"</span>, <span class="st">"last"</span>)</span>
<span id="cb20-966"><a href="#cb20-966" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-967"><a href="#cb20-967" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-968"><a href="#cb20-968" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-969"><a href="#cb20-969" aria-hidden="true" tabindex="-1"></a>monthly_returns[<span class="st">"date"</span>] <span class="op">=</span> monthly_returns[<span class="st">"year_month"</span>].dt.to_timestamp()</span>
<span id="cb20-970"><a href="#cb20-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-971"><a href="#cb20-971" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal-weighted</span></span>
<span id="cb20-972"><a href="#cb20-972" aria-hidden="true" tabindex="-1"></a>ew_ret <span class="op">=</span> monthly_returns.groupby(<span class="st">"date"</span>)[<span class="st">"monthly_ret"</span>].mean().reset_index(name<span class="op">=</span><span class="st">"ew"</span>)</span>
<span id="cb20-973"><a href="#cb20-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-974"><a href="#cb20-974" aria-hidden="true" tabindex="-1"></a><span class="co"># Value-weighted</span></span>
<span id="cb20-975"><a href="#cb20-975" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vw_return(group):</span>
<span id="cb20-976"><a href="#cb20-976" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> group[<span class="st">"last_mktcap"</span>] <span class="op">/</span> group[<span class="st">"last_mktcap"</span>].<span class="bu">sum</span>()</span>
<span id="cb20-977"><a href="#cb20-977" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (w <span class="op">*</span> group[<span class="st">"monthly_ret"</span>]).<span class="bu">sum</span>()</span>
<span id="cb20-978"><a href="#cb20-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-979"><a href="#cb20-979" aria-hidden="true" tabindex="-1"></a>vw_ret <span class="op">=</span> (</span>
<span id="cb20-980"><a href="#cb20-980" aria-hidden="true" tabindex="-1"></a>    monthly_returns.groupby(<span class="st">"date"</span>)</span>
<span id="cb20-981"><a href="#cb20-981" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(vw_return, include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-982"><a href="#cb20-982" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"vw"</span>)</span>
<span id="cb20-983"><a href="#cb20-983" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-984"><a href="#cb20-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-985"><a href="#cb20-985" aria-hidden="true" tabindex="-1"></a>port_comp <span class="op">=</span> ew_ret.merge(vw_ret, on<span class="op">=</span><span class="st">"date"</span>)</span>
<span id="cb20-986"><a href="#cb20-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-987"><a href="#cb20-987" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb20-988"><a href="#cb20-988" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, label, color <span class="kw">in</span> [</span>
<span id="cb20-989"><a href="#cb20-989" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"ew"</span>, <span class="st">"Equal-Weighted"</span>, <span class="st">"#FF6B6B"</span>),</span>
<span id="cb20-990"><a href="#cb20-990" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"vw"</span>, <span class="st">"Value-Weighted"</span>, <span class="st">"#2C73D2"</span>)</span>
<span id="cb20-991"><a href="#cb20-991" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb20-992"><a href="#cb20-992" aria-hidden="true" tabindex="-1"></a>    cum_ret <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> port_comp[col]).cumprod()</span>
<span id="cb20-993"><a href="#cb20-993" aria-hidden="true" tabindex="-1"></a>    ax.plot(port_comp[<span class="st">"date"</span>], cum_ret, label<span class="op">=</span>label, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb20-994"><a href="#cb20-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-995"><a href="#cb20-995" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Cumulative Return (Growth of 1 VND)"</span>)</span>
<span id="cb20-996"><a href="#cb20-996" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb20-997"><a href="#cb20-997" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-998"><a href="#cb20-998" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-999"><a href="#cb20-999" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-1000"><a href="#cb20-1000" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-1001"><a href="#cb20-1001" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-1002"><a href="#cb20-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1003"><a href="#cb20-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1004"><a href="#cb20-1004" aria-hidden="true" tabindex="-1"></a>A persistent divergence between equal-weighted and value-weighted cumulative returns is a hallmark of microstructure effects: the equal-weighted portfolio overstates attainable returns because it implicitly assumes costless trading in illiquid stocks.</span>
<span id="cb20-1005"><a href="#cb20-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1006"><a href="#cb20-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended Liquidity Filters</span></span>
<span id="cb20-1007"><a href="#cb20-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1008"><a href="#cb20-1008" aria-hidden="true" tabindex="-1"></a>Based on the diagnostics developed in this chapter, we recommend the following pre-analysis filters:</span>
<span id="cb20-1009"><a href="#cb20-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1012"><a href="#cb20-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1013"><a href="#cb20-1013" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-recommended-filters</span></span>
<span id="cb20-1014"><a href="#cb20-1014" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-1015"><a href="#cb20-1015" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Recommended Liquidity Filters for Asset Pricing Research"</span></span>
<span id="cb20-1016"><a href="#cb20-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1017"><a href="#cb20-1017" aria-hidden="true" tabindex="-1"></a>filters <span class="op">=</span> pd.DataFrame({</span>
<span id="cb20-1018"><a href="#cb20-1018" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Filter"</span>: [</span>
<span id="cb20-1019"><a href="#cb20-1019" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Minimum trading days per month"</span>,</span>
<span id="cb20-1020"><a href="#cb20-1020" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Maximum zero-return share per month"</span>,</span>
<span id="cb20-1021"><a href="#cb20-1021" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Minimum average daily value (VND)"</span>,</span>
<span id="cb20-1022"><a href="#cb20-1022" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Minimum listing age"</span>,</span>
<span id="cb20-1023"><a href="#cb20-1023" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Exclude UPCoM stocks"</span></span>
<span id="cb20-1024"><a href="#cb20-1024" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-1025"><a href="#cb20-1025" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Threshold"</span>: [</span>
<span id="cb20-1026"><a href="#cb20-1026" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≥ 15 days"</span>,</span>
<span id="cb20-1027"><a href="#cb20-1027" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≤ 50%"</span>,</span>
<span id="cb20-1028"><a href="#cb20-1028" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≥ 100 million"</span>,</span>
<span id="cb20-1029"><a href="#cb20-1029" aria-hidden="true" tabindex="-1"></a>        <span class="st">"≥ 6 months"</span>,</span>
<span id="cb20-1030"><a href="#cb20-1030" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Optional but recommended"</span></span>
<span id="cb20-1031"><a href="#cb20-1031" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb20-1032"><a href="#cb20-1032" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rationale"</span>: [</span>
<span id="cb20-1033"><a href="#cb20-1033" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ensures sufficient price observations for return computation"</span>,</span>
<span id="cb20-1034"><a href="#cb20-1034" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Removes stocks with predominantly stale prices"</span>,</span>
<span id="cb20-1035"><a href="#cb20-1035" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ensures rebalancing is approximately feasible"</span>,</span>
<span id="cb20-1036"><a href="#cb20-1036" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Avoids IPO effects and thin early trading"</span>,</span>
<span id="cb20-1037"><a href="#cb20-1037" aria-hidden="true" tabindex="-1"></a>        <span class="st">"UPCoM stocks have minimal disclosure and extreme illiquidity"</span></span>
<span id="cb20-1038"><a href="#cb20-1038" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-1039"><a href="#cb20-1039" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-1040"><a href="#cb20-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1041"><a href="#cb20-1041" aria-hidden="true" tabindex="-1"></a>filters.style.hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb20-1042"><a href="#cb20-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1043"><a href="#cb20-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1044"><a href="#cb20-1044" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb20-1045"><a href="#cb20-1045" aria-hidden="true" tabindex="-1"></a>Always report results with and without liquidity filters. If results are qualitatively different, the baseline findings may be driven by microstructure artifacts rather than genuine economic effects.</span>
<span id="cb20-1046"><a href="#cb20-1046" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-1047"><a href="#cb20-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1048"><a href="#cb20-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monthly vs. Daily Frequency</span></span>
<span id="cb20-1049"><a href="#cb20-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1050"><a href="#cb20-1050" aria-hidden="true" tabindex="-1"></a>For most asset pricing applications, monthly return aggregation is preferable to daily analysis in Vietnam because:</span>
<span id="cb20-1051"><a href="#cb20-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1052"><a href="#cb20-1052" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Monthly returns smooth out intraday noise, bid-ask bounce, and price limit effects.</span>
<span id="cb20-1053"><a href="#cb20-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Stocks that trade infrequently within a month still produce a meaningful monthly return.</span>
<span id="cb20-1054"><a href="#cb20-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Factor portfolio sorts are conventionally conducted at monthly frequency.</span>
<span id="cb20-1055"><a href="#cb20-1055" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Statistical tests have better size properties when microstructure noise is reduced.</span>
<span id="cb20-1056"><a href="#cb20-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1057"><a href="#cb20-1057" aria-hidden="true" tabindex="-1"></a>However, monthly aggregation does not eliminate all biases. Stocks with zero returns for an entire month still contribute stale observations. The Dimson and Scholes-Williams corrections should still be applied at monthly frequency for beta estimation.</span>
<span id="cb20-1058"><a href="#cb20-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1059"><a href="#cb20-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implications for Asset Pricing Tests</span></span>
<span id="cb20-1060"><a href="#cb20-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1061"><a href="#cb20-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">### Factor Model Estimation</span></span>
<span id="cb20-1062"><a href="#cb20-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1063"><a href="#cb20-1063" aria-hidden="true" tabindex="-1"></a>Standard factor model estimation assumes that returns are observed synchronously and without censoring. In Vietnam, both assumptions are violated. The practical consequences are in @tbl-assumption-violations</span>
<span id="cb20-1064"><a href="#cb20-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1065"><a href="#cb20-1065" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Assumption <span class="pp">|</span> Violation in Vietnam <span class="pp">|</span> Consequence <span class="pp">|</span></span>
<span id="cb20-1066"><a href="#cb20-1066" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------------|--------------------------------|---------------------|</span></span>
<span id="cb20-1067"><a href="#cb20-1067" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Synchronous observation <span class="pp">|</span> Thin trading <span class="pp">|</span> Biased betas, attenuated R² <span class="pp">|</span></span>
<span id="cb20-1068"><a href="#cb20-1068" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Uncensored returns <span class="pp">|</span> Price limits <span class="pp">|</span> Truncated distributions, biased moments <span class="pp">|</span></span>
<span id="cb20-1069"><a href="#cb20-1069" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Continuous trading <span class="pp">|</span> Discrete ticks <span class="pp">|</span> Return discreteness, bid-ask bounce <span class="pp">|</span></span>
<span id="cb20-1070"><a href="#cb20-1070" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> No transaction costs <span class="pp">|</span> Wide spreads <span class="pp">|</span> Overstated portfolio returns <span class="pp">|</span></span>
<span id="cb20-1071"><a href="#cb20-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1072"><a href="#cb20-1072" aria-hidden="true" tabindex="-1"></a>: Standard Assumptions and Their Violations {#tbl-assumption-violations}</span>
<span id="cb20-1073"><a href="#cb20-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1074"><a href="#cb20-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adjusted Testing Procedure</span></span>
<span id="cb20-1075"><a href="#cb20-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1076"><a href="#cb20-1076" aria-hidden="true" tabindex="-1"></a>We recommend the following adjustments to standard asset pricing tests when applied to Vietnamese data:</span>
<span id="cb20-1077"><a href="#cb20-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1078"><a href="#cb20-1078" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Beta estimation**: Use Dimson ($K \ge 1$) or Scholes-Williams betas, not OLS betas.</span>
<span id="cb20-1079"><a href="#cb20-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1080"><a href="#cb20-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Factor construction**: When forming size and value portfolios, apply liquidity filters before sorting. Consider excluding the smallest quintile of stocks by market capitalization, which is most affected by thin trading.</span>
<span id="cb20-1081"><a href="#cb20-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1082"><a href="#cb20-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Return aggregation**: Use monthly frequency. If daily analysis is necessary, include lagged market returns in the time-series regression.</span>
<span id="cb20-1083"><a href="#cb20-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1084"><a href="#cb20-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Robust inference**: Cluster standard errors by stock to account for persistent microstructure-induced serial correlation. Use Newey-West HAC standard errors with sufficient lags.</span>
<span id="cb20-1085"><a href="#cb20-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1086"><a href="#cb20-1086" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Price limit adjustment**: For volatility analysis or risk measurement, consider the @chu2019forecasting approach of modeling the latent (uncensored) return distribution using truncated regression:</span>
<span id="cb20-1087"><a href="#cb20-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1088"><a href="#cb20-1088" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-1089"><a href="#cb20-1089" aria-hidden="true" tabindex="-1"></a>r_{i,t}^* \sim N(\mu_i, \sigma_i^2), \quad r_{i,t}^{obs} = \max(\underline{L}, \min(\bar{L}, r_{i,t}^*))</span>
<span id="cb20-1090"><a href="#cb20-1090" aria-hidden="true" tabindex="-1"></a>$$ {#eq-truncated}</span>
<span id="cb20-1091"><a href="#cb20-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1092"><a href="#cb20-1092" aria-hidden="true" tabindex="-1"></a>Estimate $\mu_i$ and $\sigma_i^2$ via maximum likelihood for the truncated normal.</span>
<span id="cb20-1093"><a href="#cb20-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1096"><a href="#cb20-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1097"><a href="#cb20-1097" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: truncated-volatility</span></span>
<span id="cb20-1098"><a href="#cb20-1098" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb20-1099"><a href="#cb20-1099" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb20-1100"><a href="#cb20-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1101"><a href="#cb20-1101" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> truncated_normal_nll(params, returns, lower, upper):</span>
<span id="cb20-1102"><a href="#cb20-1102" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Negative log-likelihood of truncated normal."""</span></span>
<span id="cb20-1103"><a href="#cb20-1103" aria-hidden="true" tabindex="-1"></a>    mu, log_sigma <span class="op">=</span> params</span>
<span id="cb20-1104"><a href="#cb20-1104" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> np.exp(log_sigma)</span>
<span id="cb20-1105"><a href="#cb20-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1106"><a href="#cb20-1106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interior observations</span></span>
<span id="cb20-1107"><a href="#cb20-1107" aria-hidden="true" tabindex="-1"></a>    interior <span class="op">=</span> (returns <span class="op">&gt;</span> lower) <span class="op">&amp;</span> (returns <span class="op">&lt;</span> upper)</span>
<span id="cb20-1108"><a href="#cb20-1108" aria-hidden="true" tabindex="-1"></a>    ll_interior <span class="op">=</span> norm.logpdf(returns[interior], mu, sigma)</span>
<span id="cb20-1109"><a href="#cb20-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1110"><a href="#cb20-1110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lower censored</span></span>
<span id="cb20-1111"><a href="#cb20-1111" aria-hidden="true" tabindex="-1"></a>    ll_lower <span class="op">=</span> norm.logcdf(lower, mu, sigma)</span>
<span id="cb20-1112"><a href="#cb20-1112" aria-hidden="true" tabindex="-1"></a>    n_lower <span class="op">=</span> (returns <span class="op">&lt;=</span> lower).<span class="bu">sum</span>()</span>
<span id="cb20-1113"><a href="#cb20-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1114"><a href="#cb20-1114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Upper censored</span></span>
<span id="cb20-1115"><a href="#cb20-1115" aria-hidden="true" tabindex="-1"></a>    ll_upper <span class="op">=</span> np.log(<span class="dv">1</span> <span class="op">-</span> norm.cdf(upper, mu, sigma) <span class="op">+</span> <span class="fl">1e-15</span>)</span>
<span id="cb20-1116"><a href="#cb20-1116" aria-hidden="true" tabindex="-1"></a>    n_upper <span class="op">=</span> (returns <span class="op">&gt;=</span> upper).<span class="bu">sum</span>()</span>
<span id="cb20-1117"><a href="#cb20-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1118"><a href="#cb20-1118" aria-hidden="true" tabindex="-1"></a>    nll <span class="op">=</span> <span class="op">-</span>(ll_interior.<span class="bu">sum</span>() <span class="op">+</span> n_lower <span class="op">*</span> ll_lower <span class="op">+</span> n_upper <span class="op">*</span> ll_upper)</span>
<span id="cb20-1119"><a href="#cb20-1119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nll</span>
<span id="cb20-1120"><a href="#cb20-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1121"><a href="#cb20-1121" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_true_volatility(returns, limit_band):</span>
<span id="cb20-1122"><a href="#cb20-1122" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Estimate latent volatility correcting for price limit censoring."""</span></span>
<span id="cb20-1123"><a href="#cb20-1123" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(</span>
<span id="cb20-1124"><a href="#cb20-1124" aria-hidden="true" tabindex="-1"></a>        truncated_normal_nll,</span>
<span id="cb20-1125"><a href="#cb20-1125" aria-hidden="true" tabindex="-1"></a>        x0<span class="op">=</span>[returns.mean(), np.log(returns.std())],</span>
<span id="cb20-1126"><a href="#cb20-1126" aria-hidden="true" tabindex="-1"></a>        args<span class="op">=</span>(returns.values, <span class="op">-</span>limit_band, limit_band),</span>
<span id="cb20-1127"><a href="#cb20-1127" aria-hidden="true" tabindex="-1"></a>        method<span class="op">=</span><span class="st">"Nelder-Mead"</span></span>
<span id="cb20-1128"><a href="#cb20-1128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1129"><a href="#cb20-1129" aria-hidden="true" tabindex="-1"></a>    mu, log_sigma <span class="op">=</span> result.x</span>
<span id="cb20-1130"><a href="#cb20-1130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(log_sigma)</span>
<span id="cb20-1131"><a href="#cb20-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1132"><a href="#cb20-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1133"><a href="#cb20-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Sensitivity reporting**: Always report key results under alternative specifications: with and without liquidity filters, using OLS vs. Dimson betas, at daily vs. monthly frequency, and using observed vs. truncation-corrected volatility.</span>
<span id="cb20-1134"><a href="#cb20-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1135"><a href="#cb20-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb20-1136"><a href="#cb20-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1137"><a href="#cb20-1137" aria-hidden="true" tabindex="-1"></a>This chapter has established that Vietnamese equity markets exhibit microstructure characteristics that materially affect observed prices, returns, and risk measures. The key findings are:</span>
<span id="cb20-1138"><a href="#cb20-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1139"><a href="#cb20-1139" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Price limits** censor daily returns, inducing positive autocorrelation, volatility spillover, and truncated distributions. The $\pm$ 7% band on HOSE is particularly restrictive for volatile stocks.</span>
<span id="cb20-1140"><a href="#cb20-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1141"><a href="#cb20-1141" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Thin trading and zero returns** afflict a substantial fraction of listed firms. Trading probabilities below 50% are common on HNX and UPCoM, generating non-synchronous trading bias that attenuates OLS beta estimates by 20-40%.</span>
<span id="cb20-1142"><a href="#cb20-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1143"><a href="#cb20-1143" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Illiquidity** varies dramatically across the cross-section, with Amihud ratios spanning several orders of magnitude. Value-weighted portfolio returns are less contaminated than equal-weighted returns.</span>
<span id="cb20-1144"><a href="#cb20-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1145"><a href="#cb20-1145" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**The Dimson and Scholes-Williams beta corrections** effectively address non-synchronous trading bias and should be used as the default beta estimator for Vietnamese equities.</span>
<span id="cb20-1146"><a href="#cb20-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1147"><a href="#cb20-1147" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Liquidity filters** should be applied before any asset pricing analysis, and results should be reported with and without these filters as a robustness check.</span>
<span id="cb20-1148"><a href="#cb20-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1149"><a href="#cb20-1149" aria-hidden="true" tabindex="-1"></a>Ignoring these frictions does not merely add noise to empirical results, it systematically biases estimates in predictable directions. The diagnostics and corrections presented in this chapter provide the foundation for credible empirical asset pricing in Vietnam.</span>
<span id="cb20-1150"><a href="#cb20-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1151"><a href="#cb20-1151" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Exercises</span></span>
<span id="cb20-1152"><a href="#cb20-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1153"><a href="#cb20-1153" aria-hidden="true" tabindex="-1"></a><span class="co">1.  **Intraday liquidity patterns**: Using intraday data, compute the average bid-ask spread and depth at 15-minute intervals throughout the trading day. Document the U-shaped intraday liquidity pattern and discuss how it relates to the theoretical predictions of @admati1988theory.</span></span>
<span id="cb20-1154"><a href="#cb20-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1155"><a href="#cb20-1155" aria-hidden="true" tabindex="-1"></a><span class="co">2.  **Magnet effect test**: Test the @subrahmanyam1994circuit magnet effect hypothesis. Conditional on a stock hitting a price limit by the end of the day, does price acceleration toward the limit occur in the final 30 minutes of continuous trading? Compare the speed of price approach to the limit on limit-hit days versus non-limit-hit days.</span></span>
<span id="cb20-1156"><a href="#cb20-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1157"><a href="#cb20-1157" aria-hidden="true" tabindex="-1"></a><span class="co">3.  **Liquidity-adjusted factor model**: Construct a tradeable liquidity factor (IML: Illiquid-Minus-Liquid) by sorting stocks into liquidity terciles using the Amihud ratio and forming a long-short portfolio. Augment the Fama-French three-factor model with this liquidity factor and test whether it improves the pricing of Vietnamese equities.</span></span>
<span id="cb20-1158"><a href="#cb20-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1159"><a href="#cb20-1159" aria-hidden="true" tabindex="-1"></a><span class="co">4.  **Multi-day limit hits**: Identify episodes where the same stock hits the price limit on two or more consecutive days. How much cumulative price adjustment occurs over these multi-day limit episodes? Does the total adjustment exceed what would be expected under a one-day price change distribution?</span></span>
<span id="cb20-1160"><a href="#cb20-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1161"><a href="#cb20-1161" aria-hidden="true" tabindex="-1"></a><span class="co">5.  **Non-synchronous trading and momentum**: The momentum effect may be partly an artifact of non-synchronous trading: past winners may simply be stocks with more recent prices. Re-examine the momentum premium after replacing OLS returns with Dimson-adjusted returns and after excluding stocks with trading probability below 50%.</span></span>
<span id="cb20-1162"><a href="#cb20-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1163"><a href="#cb20-1163" aria-hidden="true" tabindex="-1"></a><span class="co">6.  **Cross-exchange comparison**: Exploit the difference in price limit bands across HOSE ($pm$ 7%), HNX ($pm$ 10%), and UPCoM ($pm$ 15%) to test the causal effect of price limit tightness on volatility spillover, zero-return frequency, and return autocorrelation. Use a difference-in-differences design if any exchange has changed its limit band during the sample period. --&gt;</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/03_market_microstructure.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>