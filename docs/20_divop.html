<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Measuring Divergence of Investor Opinion – Applying Tidy Finance with Python to Vietnam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./50_conclusion.html" rel="next">
<link href="./19_pe_ratio.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d8431037eefe704a1e7a103aa5b75ea7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-50a4fa9e9ef121803c2355a2deb1af4d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="18&nbsp; Measuring Divergence of Investor Opinion – Applying Tidy Finance with Python to Vietnam">
<meta property="og:description" content="">
<meta property="og:site_name" content="Applying Tidy Finance with Python to Vietnam">
<meta name="twitter:title" content="18&nbsp; Measuring Divergence of Investor Opinion – Applying Tidy Finance with Python to Vietnam">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./20_divop.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applying Tidy Finance with Python to Vietnam</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Institutional Background and Market Structure of Vietnam’s Equity Market</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Accessing and Managing VN Financial Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Datacore Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_momemtum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_event_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_divop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-theoretical-framework" id="toc-sec-theoretical-framework" class="nav-link active" data-scroll-target="#sec-theoretical-framework"><span class="header-section-number">19</span> Theoretical Framework</a>
  <ul class="collapse">
  <li><a href="#the-miller-1977-overpricing-hypothesis" id="toc-the-miller-1977-overpricing-hypothesis" class="nav-link" data-scroll-target="#the-miller-1977-overpricing-hypothesis"><span class="header-section-number">19.1</span> The Miller (1977) Overpricing Hypothesis</a></li>
  <li><a href="#alternative-theoretical-perspectives" id="toc-alternative-theoretical-perspectives" class="nav-link" data-scroll-target="#alternative-theoretical-perspectives"><span class="header-section-number">19.2</span> Alternative Theoretical Perspectives</a></li>
  <li><a href="#relevance-to-the-vietnamese-market" id="toc-relevance-to-the-vietnamese-market" class="nav-link" data-scroll-target="#relevance-to-the-vietnamese-market"><span class="header-section-number">19.3</span> Relevance to the Vietnamese Market</a></li>
  </ul></li>
  <li><a href="#sec-data" id="toc-sec-data" class="nav-link" data-scroll-target="#sec-data"><span class="header-section-number">20</span> Data Sources and Sample Construction</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources"><span class="header-section-number">20.1</span> Data Sources</a></li>
  <li><a href="#sample-construction" id="toc-sample-construction" class="nav-link" data-scroll-target="#sample-construction"><span class="header-section-number">20.2</span> Sample Construction</a></li>
  <li><a href="#sec-corp-actions" id="toc-sec-corp-actions" class="nav-link" data-scroll-target="#sec-corp-actions"><span class="header-section-number">20.3</span> Corporate Action Adjustments</a></li>
  <li><a href="#sec-calendar" id="toc-sec-calendar" class="nav-link" data-scroll-target="#sec-calendar"><span class="header-section-number">20.4</span> Trading Calendar Construction</a></li>
  </ul></li>
  <li><a href="#sec-volume-based" id="toc-sec-volume-based" class="nav-link" data-scroll-target="#sec-volume-based"><span class="header-section-number">21</span> Volume-Based DIVOP Proxies</a>
  <ul class="collapse">
  <li><a href="#theoretical-motivation" id="toc-theoretical-motivation" class="nav-link" data-scroll-target="#theoretical-motivation"><span class="header-section-number">21.1</span> Theoretical Motivation</a></li>
  <li><a href="#sec-dto" id="toc-sec-dto" class="nav-link" data-scroll-target="#sec-dto"><span class="header-section-number">21.2</span> Unexplained Volume (DTO)</a>
  <ul class="collapse">
  <li><a href="#construction-methodology" id="toc-construction-methodology" class="nav-link" data-scroll-target="#construction-methodology"><span class="header-section-number">21.2.1</span> Construction Methodology</a></li>
  <li><a href="#vietnam-specific-considerations-for-dto" id="toc-vietnam-specific-considerations-for-dto" class="nav-link" data-scroll-target="#vietnam-specific-considerations-for-dto"><span class="header-section-number">21.2.2</span> Vietnam-Specific Considerations for DTO</a></li>
  </ul></li>
  <li><a href="#sec-suv" id="toc-sec-suv" class="nav-link" data-scroll-target="#sec-suv"><span class="header-section-number">21.3</span> Standardized Unexplained Volume (SUV)</a>
  <ul class="collapse">
  <li><a href="#construction-methodology-1" id="toc-construction-methodology-1" class="nav-link" data-scroll-target="#construction-methodology-1"><span class="header-section-number">21.3.1</span> Construction Methodology</a></li>
  <li><a href="#interpreting-the-suv-regression-coefficients" id="toc-interpreting-the-suv-regression-coefficients" class="nav-link" data-scroll-target="#interpreting-the-suv-regression-coefficients"><span class="header-section-number">21.3.2</span> Interpreting the SUV Regression Coefficients</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-volatility" id="toc-sec-volatility" class="nav-link" data-scroll-target="#sec-volatility"><span class="header-section-number">22</span> Volatility-Based DIVOP Proxies</a>
  <ul class="collapse">
  <li><a href="#sec-total-vol" id="toc-sec-total-vol" class="nav-link" data-scroll-target="#sec-total-vol"><span class="header-section-number">22.1</span> Total Return Volatility</a>
  <ul class="collapse">
  <li><a href="#theoretical-motivation-1" id="toc-theoretical-motivation-1" class="nav-link" data-scroll-target="#theoretical-motivation-1"><span class="header-section-number">22.1.1</span> Theoretical Motivation</a></li>
  <li><a href="#construction" id="toc-construction" class="nav-link" data-scroll-target="#construction"><span class="header-section-number">22.1.2</span> Construction</a></li>
  </ul></li>
  <li><a href="#sec-ivol" id="toc-sec-ivol" class="nav-link" data-scroll-target="#sec-ivol"><span class="header-section-number">22.2</span> Idiosyncratic Volatility (IVOL)</a>
  <ul class="collapse">
  <li><a href="#vietnam-specific-considerations-for-volatility" id="toc-vietnam-specific-considerations-for-volatility" class="nav-link" data-scroll-target="#vietnam-specific-considerations-for-volatility"><span class="header-section-number">22.2.1</span> Vietnam-Specific Considerations for Volatility</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-spread" id="toc-sec-spread" class="nav-link" data-scroll-target="#sec-spread"><span class="header-section-number">23</span> Spread-Based and Liquidity DIVOP Proxies</a>
  <ul class="collapse">
  <li><a href="#sec-baspread" id="toc-sec-baspread" class="nav-link" data-scroll-target="#sec-baspread"><span class="header-section-number">23.1</span> Bid-Ask Spread (BASPREAD)</a>
  <ul class="collapse">
  <li><a href="#theoretical-motivation-2" id="toc-theoretical-motivation-2" class="nav-link" data-scroll-target="#theoretical-motivation-2"><span class="header-section-number">23.1.1</span> Theoretical Motivation</a></li>
  <li><a href="#construction-1" id="toc-construction-1" class="nav-link" data-scroll-target="#construction-1"><span class="header-section-number">23.1.2</span> Construction</a></li>
  </ul></li>
  <li><a href="#sec-amihud" id="toc-sec-amihud" class="nav-link" data-scroll-target="#sec-amihud"><span class="header-section-number">23.2</span> Amihud Illiquidity (ILLIQ)</a>
  <ul class="collapse">
  <li><a href="#vietnam-specific-considerations-for-spread-and-liquidity" id="toc-vietnam-specific-considerations-for-spread-and-liquidity" class="nav-link" data-scroll-target="#vietnam-specific-considerations-for-spread-and-liquidity"><span class="header-section-number">23.2.1</span> Vietnam-Specific Considerations for Spread and Liquidity</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-analyst" id="toc-sec-analyst" class="nav-link" data-scroll-target="#sec-analyst"><span class="header-section-number">24</span> Analyst Forecast Dispersion</a>
  <ul class="collapse">
  <li><a href="#theoretical-motivation-3" id="toc-theoretical-motivation-3" class="nav-link" data-scroll-target="#theoretical-motivation-3"><span class="header-section-number">24.1</span> Theoretical Motivation</a></li>
  <li><a href="#data-challenges-in-vietnam" id="toc-data-challenges-in-vietnam" class="nav-link" data-scroll-target="#data-challenges-in-vietnam"><span class="header-section-number">24.2</span> Data Challenges in Vietnam</a></li>
  <li><a href="#construction-methodology-2" id="toc-construction-methodology-2" class="nav-link" data-scroll-target="#construction-methodology-2"><span class="header-section-number">24.3</span> Construction Methodology</a></li>
  <li><a href="#scaling-considerations" id="toc-scaling-considerations" class="nav-link" data-scroll-target="#scaling-considerations"><span class="header-section-number">24.4</span> Scaling Considerations</a></li>
  </ul></li>
  <li><a href="#sec-correlation" id="toc-sec-correlation" class="nav-link" data-scroll-target="#sec-correlation"><span class="header-section-number">25</span> Cross-Sectional Correlations Among DIVOP Proxies</a>
  <ul class="collapse">
  <li><a href="#expected-correlation-patterns" id="toc-expected-correlation-patterns" class="nav-link" data-scroll-target="#expected-correlation-patterns"><span class="header-section-number">25.0.1</span> Expected Correlation Patterns</a></li>
  </ul></li>
  <li><a href="#sec-empirical" id="toc-sec-empirical" class="nav-link" data-scroll-target="#sec-empirical"><span class="header-section-number">26</span> Descriptive Statistics and Cross-Sectional Properties</a>
  <ul class="collapse">
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics"><span class="header-section-number">26.1</span> Summary Statistics</a></li>
  <li><a href="#divop-by-firm-characteristics" id="toc-divop-by-firm-characteristics" class="nav-link" data-scroll-target="#divop-by-firm-characteristics"><span class="header-section-number">26.2</span> DIVOP by Firm Characteristics</a></li>
  <li><a href="#time-series-evolution" id="toc-time-series-evolution" class="nav-link" data-scroll-target="#time-series-evolution"><span class="header-section-number">26.3</span> Time-Series Evolution</a></li>
  </ul></li>
  <li><a href="#sec-pipeline" id="toc-sec-pipeline" class="nav-link" data-scroll-target="#sec-pipeline"><span class="header-section-number">27</span> Putting It All Together</a></li>
  <li><a href="#sec-applications" id="toc-sec-applications" class="nav-link" data-scroll-target="#sec-applications"><span class="header-section-number">28</span> Empirical Applications</a>
  <ul class="collapse">
  <li><a href="#application-1-divop-and-the-cross-section-of-returns" id="toc-application-1-divop-and-the-cross-section-of-returns" class="nav-link" data-scroll-target="#application-1-divop-and-the-cross-section-of-returns"><span class="header-section-number">28.1</span> Application 1: DIVOP and the Cross-Section of Returns</a></li>
  <li><a href="#application-2-divop-and-earnings-announcements" id="toc-application-2-divop-and-earnings-announcements" class="nav-link" data-scroll-target="#application-2-divop-and-earnings-announcements"><span class="header-section-number">28.2</span> Application 2: DIVOP and Earnings Announcements</a></li>
  <li><a href="#application-3-composite-divop-index-via-pca" id="toc-application-3-composite-divop-index-via-pca" class="nav-link" data-scroll-target="#application-3-composite-divop-index-via-pca"><span class="header-section-number">28.3</span> Application 3: Composite DIVOP Index via PCA</a></li>
  </ul></li>
  <li><a href="#conclusion-and-practical-recommendations" id="toc-conclusion-and-practical-recommendations" class="nav-link" data-scroll-target="#conclusion-and-practical-recommendations"><span class="header-section-number">29</span> Conclusion and Practical Recommendations</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/20_divop.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A foundational question in financial economics concerns how differences in investor beliefs affect asset prices and trading activity. In markets where investors hold heterogeneous expectations about a firm’s future cash flows, the aggregation of these divergent views into a single market price becomes a non-trivial exercise with profound implications for asset valuation, return predictability, and market efficiency. The concept of <strong>divergence of investor opinion</strong> (hereafter DIVOP) has emerged as a central construct in both the accounting and finance literatures, serving as a lens through which researchers examine the information environment of firms, the dynamics of uncertainty resolution, and the nature of market reactions to news.</p>
<p>The theoretical foundations of the DIVOP literature trace back to <span class="citation" data-cites="miller1977risk">Miller (<a href="references.html#ref-miller1977risk" role="doc-biblioref">1977</a>)</span>, who proposed that when investors disagree about the value of a security and short-sale constraints prevent pessimistic investors from fully expressing their views, the market price will reflect the valuation of the most optimistic investors. This leads to systematic overpricing that is increasing in the degree of opinion divergence. The overpricing persists until information events, such as earnings announcements, reduce disagreement and prices converge toward fundamental values <span class="citation" data-cites="berkman2009sell">(<a href="references.html#ref-berkman2009sell" role="doc-biblioref">Berkman et al. 2009</a>)</span>. <span class="citation" data-cites="varian1985divergence">Varian (<a href="references.html#ref-varian1985divergence" role="doc-biblioref">1985</a>)</span> offers an alternative perspective in which divergence of opinion represents an additional risk factor, leading to <em>higher</em> rather than lower expected returns, creating a theoretical tension that has motivated extensive empirical investigation.</p>
<p>The empirical literature on DIVOP has expanded considerably since these seminal contributions. Researchers have documented that divergence of opinion helps explain a range of asset pricing anomalies, including post-earnings announcement drift <span class="citation" data-cites="garfinkel2006volume anderson2007opinion">(<a href="references.html#ref-garfinkel2006volume" role="doc-biblioref">Garfinkel and Sokobin 2006</a>; <a href="references.html#ref-anderson2007opinion" role="doc-biblioref">K. L. Anderson, Harris, and So 2007</a>)</span>, the cross-sectional return difference between value and growth stocks <span class="citation" data-cites="doukas2004divergent">(<a href="references.html#ref-doukas2004divergent" role="doc-biblioref">Doukas, Kim, and Pantzalis 2004</a>)</span>, short- and long-run post-IPO returns <span class="citation" data-cites="houge2001divergence">(<a href="references.html#ref-houge2001divergence" role="doc-biblioref">Houge et al. 2001</a>)</span>, pre- and post-acquisition stock returns <span class="citation" data-cites="alexandridis2007divergence">(<a href="references.html#ref-alexandridis2007divergence" role="doc-biblioref">Alexandridis, Antoniou, and Petmezas 2007</a>)</span>, takeover premia <span class="citation" data-cites="chatterjee2012takeovers">(<a href="references.html#ref-chatterjee2012takeovers" role="doc-biblioref">Chatterjee, John, and Yan 2012</a>)</span>, and the broad cross-section of stock returns <span class="citation" data-cites="diether2002differences doukas2006divergence">(<a href="references.html#ref-diether2002differences" role="doc-biblioref">Diether, Malloy, and Scherbina 2002</a>; <a href="references.html#ref-doukas2006divergence" role="doc-biblioref">Doukas, Kim, and Pantzalis 2006</a>)</span>. The explanatory power of DIVOP has been demonstrated using a rich set of empirical proxies, ranging from analyst forecast dispersion and abnormal trading volume to bid-ask spreads and idiosyncratic volatility.</p>
<p>Despite the maturity of the DIVOP literature in developed markets, particularly the United States, its application to emerging markets remains remarkably thin. This gap is especially notable given that the theoretical conditions under which divergence of opinion matters most (namely, binding short-sale constraints, information asymmetry, and heterogeneous investor sophistication) are arguably <em>more</em> prevalent in emerging markets than in their developed counterparts. The Vietnamese equity market presents a compelling laboratory for studying investor disagreement. The market is characterized by several features that amplify the relevance of the DIVOP framework:</p>
<ol type="1">
<li><p><strong>Binding short-sale constraints.</strong> Short selling was not permitted in Vietnam until January 2025, and even after its introduction, the mechanism remains restricted to a limited set of securities with significant regulatory constraints on execution. This closely mirrors the theoretical setting of <span class="citation" data-cites="miller1977risk">Miller (<a href="references.html#ref-miller1977risk" role="doc-biblioref">1977</a>)</span> where pessimistic investors are unable to fully express their views through short positions.</p></li>
<li><p><strong>Dominance of retail investors.</strong> Individual investors account for approximately 80-85% of daily trading volume on HOSE and HNX, compared to roughly 25% in the United States. Retail investors are more susceptible to behavioral biases, sentiment-driven trading, and information processing limitations that naturally give rise to heterogeneous beliefs <span class="citation" data-cites="phan2023role">(<a href="references.html#ref-phan2023role" role="doc-biblioref">Phan et al. 2023</a>)</span>.</p></li>
<li><p><strong>Information asymmetry and transparency challenges.</strong> Despite improvements in disclosure standards, Vietnam’s regulatory framework for corporate reporting remains less stringent than those in developed markets. Selective disclosure, delayed filing of financial statements, and limited enforcement of insider trading regulations create an environment in which investors operate with substantially different information sets <span class="citation" data-cites="vo2017further">(<a href="references.html#ref-vo2017further" role="doc-biblioref">Vo and Phan 2017</a>)</span>.</p></li>
<li><p><strong>Foreign ownership limits.</strong> Caps on foreign ownership (currently 49% for most sectors, with exceptions) create a segmented market where domestic and foreign investors may hold systematically different views about firm value, amplifying the divergence of opinion.</p></li>
<li><p><strong>Thin analyst coverage.</strong> Whereas a typical S&amp;P 500 firm is followed by 15-25 sell-side analysts, coverage of Vietnamese equities is concentrated among a relatively small number of domestic brokerages and a handful of international research houses. This limits the informativeness of traditional analyst-based DIVOP measures and necessitates greater reliance on market-based proxies.</p></li>
</ol>
<p>This chapter provides a methodology for constructing multiple proxies for divergence of investor opinion adapted to the institutional characteristics of the Vietnamese market. We draw on the methodological frameworks established by <span class="citation" data-cites="garfinkel2009measuring">Garfinkel (<a href="references.html#ref-garfinkel2009measuring" role="doc-biblioref">2009</a>)</span> and <span class="citation" data-cites="diether2002differences">Diether, Malloy, and Scherbina (<a href="references.html#ref-diether2002differences" role="doc-biblioref">2002</a>)</span>, while introducing modifications that account for the microstructure of Vietnamese exchanges, the <span class="math inline">\(T+2\)</span> settlement cycle, the absence (until recently) of short selling, and the availability of data through domestic financial platforms. Specifically, we construct and analyze the following DIVOP proxies:</p>
<ul>
<li><strong>Unexplained Volume (DTO):</strong> Market-adjusted turnover detrended by its rolling median, capturing abnormal trading activity attributable to disagreement after controlling for liquidity and market-wide effects.</li>
<li><strong>Standardized Unexplained Volume (SUV):</strong> A regression-based measure that explicitly controls for the informedness and liquidity components of volume by modeling turnover as a function of signed returns.</li>
<li><strong>Stock Return Volatility (VOLATILITY):</strong> The standard deviation of daily returns over a rolling estimation window, serving as a proxy for the dispersion of investor valuations.</li>
<li><strong>Bid-Ask Spread (BASPREAD):</strong> The proportional quoted spread, reflecting the adverse selection component associated with heterogeneous information among market participants.</li>
<li><strong>Analyst Forecast Dispersion (DISP):</strong> The cross-sectional standard deviation of individual analyst earnings forecasts, directly measuring disagreement among informed market participants.</li>
<li><strong>Idiosyncratic Volatility (IVOL):</strong> The residual volatility from a factor model regression, isolating the firm-specific component of return variation that reflects divergent investor interpretations of firm-level information.</li>
<li><strong>Amihud Illiquidity (ILLIQ):</strong> The price impact ratio proposed by <span class="citation" data-cites="amihud2002illiquidity">Amihud (<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">2002</a>)</span>, which captures the information asymmetry dimension of disagreement through the price response to order flow.</li>
</ul>
<p>For each proxy, we describe the theoretical motivation, the data requirements, the construction methodology adapted for Vietnamese data, the empirical properties observed in the Vietnamese cross-section, and the practical considerations that researchers should bear in mind when employing these measures. We pay particular attention to issues that are specific to emerging markets, including thin trading, corporate action adjustments, exchange-specific microstructure effects, and the interplay between foreign ownership constraints and measures of investor disagreement.</p>
<hr>
<section id="sec-theoretical-framework" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Theoretical Framework</h1>
<section id="the-miller-1977-overpricing-hypothesis" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="the-miller-1977-overpricing-hypothesis"><span class="header-section-number">19.1</span> The Miller (1977) Overpricing Hypothesis</h2>
<p>The canonical model of divergence of opinion and asset pricing begins with <span class="citation" data-cites="miller1977risk">Miller (<a href="references.html#ref-miller1977risk" role="doc-biblioref">1977</a>)</span>. Miller’s central insight is simple: in a market where investors hold heterogeneous beliefs about the future payoffs of a risky asset and short-sale constraints prevent some investors from acting on their pessimistic views, the equilibrium price will be set by the subset of investors who are most optimistic about the asset’s value. The severity of overpricing is increasing in both the degree of opinion divergence and the stringency of short-sale constraints. Formally, if investor <span class="math inline">\(i\)</span> assigns a valuation <span class="math inline">\(V_i\)</span> to a security, the market price <span class="math inline">\(P\)</span> satisfies:</p>
<p><span class="math display">\[
P = E[V_i \mid V_i \geq V^*]
\]</span></p>
<p>where <span class="math inline">\(V^*\)</span> is the marginal investor’s valuation, which exceeds the unconditional mean valuation <span class="math inline">\(E[V_i]\)</span> whenever short-sale constraints bind for some investors. The degree of overpricing is:</p>
<p><span class="math display">\[
\text{Overpricing} = P - E[V_i] = E[V_i \mid V_i \geq V^*] - E[V_i]
\]</span></p>
<p>which is positive and increasing in the dispersion of the distribution of <span class="math inline">\(V_i\)</span> (i.e., divergence of opinion) and in <span class="math inline">\(V^*\)</span> (i.e., the severity of short-sale constraints).</p>
<p>Miller’s model generates several testable predictions:</p>
<ul>
<li><strong>Cross-sectional prediction:</strong> Stocks with <strong>higher divergence of opinion should have <em>lower</em> subsequent returns</strong> as prices gradually correct toward fundamental values.</li>
<li><strong>Time-series prediction:</strong> Information events that reduce disagreement (e.g., earnings announcements) should be associated with negative abnormal returns for high-DIVOP stocks, as the “optimism premium” dissipates.</li>
<li><strong>Interaction prediction:</strong> The overpricing effect should be strongest among stocks that simultaneously exhibit high divergence of opinion <em>and</em> binding short-sale constraints.</li>
</ul>
</section>
<section id="alternative-theoretical-perspectives" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="alternative-theoretical-perspectives"><span class="header-section-number">19.2</span> Alternative Theoretical Perspectives</h2>
<p><span class="citation" data-cites="varian1985divergence">Varian (<a href="references.html#ref-varian1985divergence" role="doc-biblioref">1985</a>)</span> proposes an alternative framework in which divergence of opinion acts as a risk factor. If investors are risk-averse and disagreement represents genuine uncertainty about future payoffs, then <strong>higher dispersion of beliefs should be associated with <em>higher</em> expected returns</strong> as compensation for bearing the additional risk. This creates a sharp empirical dichotomy: the Miller hypothesis predicts a negative DIVOP-return relation, whereas the Varian model predicts a positive relation.</p>
<p>The distinction between these theories hinges critically on the market microstructure and institutional setting (@tbl-divop-theories).</p>
<div id="tbl-divop-theories" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-divop-theories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;19.1: Summary of theoretical predictions for the DIVOP-return relation under different assumptions
</figcaption>
<div aria-describedby="tbl-divop-theories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Theoretical Framework</th>
<th style="text-align: left;">Short-Sale Constraints</th>
<th style="text-align: left;">DIVOP-Return Relation</th>
<th style="text-align: left;">Key Mechanism</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="citation" data-cites="miller1977risk">Miller (<a href="references.html#ref-miller1977risk" role="doc-biblioref">1977</a>)</span></td>
<td style="text-align: left;">Binding</td>
<td style="text-align: left;">Negative</td>
<td style="text-align: left;">Optimistic bias in price</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="citation" data-cites="varian1985divergence">Varian (<a href="references.html#ref-varian1985divergence" role="doc-biblioref">1985</a>)</span></td>
<td style="text-align: left;">Non-binding</td>
<td style="text-align: left;">Positive</td>
<td style="text-align: left;">Risk premium for uncertainty</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="citation" data-cites="hong2003differences">Hong and Stein (<a href="references.html#ref-hong2003differences" role="doc-biblioref">2003</a>)</span></td>
<td style="text-align: left;">Binding, gradual info</td>
<td style="text-align: left;">Negative, time-varying</td>
<td style="text-align: left;">Slow diffusion of bearish views</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="citation" data-cites="scheinkman2003overconfidence">Scheinkman and Xiong (<a href="references.html#ref-scheinkman2003overconfidence" role="doc-biblioref">2003</a>)</span></td>
<td style="text-align: left;">Binding, overconfidence</td>
<td style="text-align: left;">Negative</td>
<td style="text-align: left;">Speculative bubble premium</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p><span class="citation" data-cites="hong2003differences">Hong and Stein (<a href="references.html#ref-hong2003differences" role="doc-biblioref">2003</a>)</span> extend Miller’s framework by incorporating gradual information diffusion. In their model, bearish information is impounded into prices more slowly than bullish information because short-sale constraints raise the cost of acting on negative views. This generates momentum-like patterns in which high-DIVOP stocks exhibit positive short-run returns (as optimists push prices up) followed by negative long-run returns (as bearish information eventually reaches the market).</p>
<p><span class="citation" data-cites="scheinkman2003overconfidence">Scheinkman and Xiong (<a href="references.html#ref-scheinkman2003overconfidence" role="doc-biblioref">2003</a>)</span> introduce an additional dimension by noting that when investors are overconfident about their private signals <em>and</em> short-sale constraints bind, stock prices contain a “speculative bubble” component that reflects the option value of reselling the asset to a future investor who may be even more optimistic. This model predicts that both high trading volume and high price volatility should be associated with overpricing, providing a theoretical basis for using volume-based and volatility-based DIVOP proxies.</p>
</section>
<section id="relevance-to-the-vietnamese-market" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="relevance-to-the-vietnamese-market"><span class="header-section-number">19.3</span> Relevance to the Vietnamese Market</h2>
<p>The Vietnamese equity market provides an unusually clean setting for testing the Miller hypothesis. Vietnam’s equity market operated without any short-selling mechanism from its inception in 2000 through January 2025, which was a full quarter-century in which the first necessary condition of Miller’s model (binding short-sale constraints) was satisfied by regulation rather than by market frictions. Even after the introduction of covered short selling in 2025, the mechanism remains restricted to securities meeting specific liquidity and market capitalization thresholds, and the regulatory environment imposes borrowing requirements that significantly raise the cost of shorting relative to developed markets.</p>
<p>The dominance of retail investors amplifies the second necessary condition (i.e., heterogeneous beliefs). Research on the Vietnamese market has documented significant herding behavior <span class="citation" data-cites="vo2017further vo2015foreign">(<a href="references.html#ref-vo2017further" role="doc-biblioref">Vo and Phan 2017</a>; <a href="references.html#ref-vo2015foreign" role="doc-biblioref">Vo 2015</a>)</span>, sentiment-driven trading <span class="citation" data-cites="phan2023role nguyen2018search">(<a href="references.html#ref-phan2023role" role="doc-biblioref">Phan et al. 2023</a>; <a href="references.html#ref-nguyen2018search" role="doc-biblioref">Nguyen and Pham 2018</a>)</span>, and information asymmetry between domestic and foreign investors <span class="citation" data-cites="vo2017foreign">(<a href="references.html#ref-vo2017foreign" role="doc-biblioref">Vo 2017</a>)</span>. These behavioral characteristics naturally generate wider dispersion of investor valuations compared to markets dominated by institutional investors with access to similar analytical frameworks and information sources.</p>
<p><a href="#tbl-divop-vietnam-us" class="quarto-xref">Table&nbsp;<span>19.2</span></a> compares key institutional features relevant to the DIVOP framework between Vietnam and the United States.</p>
<div id="tbl-divop-vietnam-us" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-divop-vietnam-us-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;19.2: Institutional comparison of Vietnam and the United States relevant to divergence of opinion
</figcaption>
<div aria-describedby="tbl-divop-vietnam-us-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Vietnam (HOSE/HNX)</th>
<th style="text-align: left;">United States (NYSE/NASDAQ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Short selling</td>
<td style="text-align: left;">Introduced Jan 2025 (limited)</td>
<td style="text-align: left;">Permitted (Reg SHO since 2005)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Retail investor share of volume</td>
<td style="text-align: left;">~80-85%</td>
<td style="text-align: left;">~25%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Settlement cycle</td>
<td style="text-align: left;">T+2 (T+1 planned for 2026)</td>
<td style="text-align: left;">T+1 (since May 2024)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Daily price limits</td>
<td style="text-align: left;"><span class="math inline">\(\pm\)</span> 7% (HOSE), <span class="math inline">\(\pm\)</span> 10% (HNX)</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Foreign ownership cap</td>
<td style="text-align: left;">49% (most sectors)</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="even">
<td style="text-align: left;">Average analyst coverage (VN30)</td>
<td style="text-align: left;">5-10 analysts</td>
<td style="text-align: left;">15-25 analysts</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mandatory quarterly reporting</td>
<td style="text-align: left;">Yes (since 2012)</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Options/derivatives market</td>
<td style="text-align: left;">VN30 Index Futures (since 2017)</td>
<td style="text-align: left;">Extensive options/futures</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The presence of daily price limits (<span class="math inline">\(\pm\)</span> 7% on HOSE and <span class="math inline">\(\pm\)</span> 10% on HNX) creates an additional mechanism through which divergence of opinion can be amplified. When a stock hits its price limit, investors who wish to trade in the direction of the limit are unable to do so, leading to accumulated unfilled orders and delayed price discovery. This institutional feature may create short-term spikes in measured DIVOP that reflect limit-induced friction rather than genuine disagreement. We address this issue in our empirical methodology by flagging limit-hit days and conducting robustness checks that exclude these observations.</p>
</section>
</section>
<section id="sec-data" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Data Sources and Sample Construction</h1>
<section id="data-sources" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="data-sources"><span class="header-section-number">20.1</span> Data Sources</h2>
<p>The construction of DIVOP proxies for the Vietnamese market requires daily stock-level trading data and, for the analyst dispersion measures, individual analyst forecast data. We source all data from <a href="https://datacore.vn/en">DataCore.vn</a>, which provides coverage of all securities listed on HOSE, HNX, and the UPCoM (Unlisted Public Company Market) exchange. <a href="#tbl-divop-data-sources" class="quarto-xref">Table&nbsp;<span>20.1</span></a> summarizes the datasets and key variables used in this study.</p>
<div id="tbl-divop-data-sources" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-divop-data-sources-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;20.1: Data sources and key variables for DIVOP proxy construction
</figcaption>
<div aria-describedby="tbl-divop-data-sources-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Key Variables</th>
<th style="text-align: left;">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Daily Stock Trading</td>
<td style="text-align: left;">Close price, high, low, open, volume, shares outstanding, adjusted price, bid, ask</td>
<td style="text-align: left;">Daily</td>
</tr>
<tr class="even">
<td style="text-align: left;">Corporate Actions</td>
<td style="text-align: left;">Dividends, stock splits, bonus issues, rights offerings</td>
<td style="text-align: left;">Event-based</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Company Information</td>
<td style="text-align: left;">Exchange code, industry classification (ICB), listing date, delisting date</td>
<td style="text-align: left;">Static/Periodic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Analyst Forecasts</td>
<td style="text-align: left;">Individual analyst EPS forecasts, announcement dates, fiscal period end, analyst ID, broker name</td>
<td style="text-align: left;">Per estimate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Market Index</td>
<td style="text-align: left;">VN-Index daily returns, VN30 returns, HNX-Index returns</td>
<td style="text-align: left;">Daily</td>
</tr>
<tr class="even">
<td style="text-align: left;">Foreign Ownership</td>
<td style="text-align: left;">Foreign buy/sell volume, foreign ownership percentage, remaining foreign room</td>
<td style="text-align: left;">Daily</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="sample-construction" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="sample-construction"><span class="header-section-number">20.2</span> Sample Construction</h2>
<p>We construct our sample using the following filters, applied sequentially:</p>
<div id="sample-construction" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="im">as</span> scipy_stats</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration Parameters</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Users can modify these parameters to adjust the methodology</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>CONFIG <span class="op">=</span> {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample period</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'beg_date'</span>: <span class="st">'2007-01-01'</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'end_date'</span>: <span class="st">'2024-12-31'</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimation windows (in trading days)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'est_window'</span>: <span class="dv">60</span>,          <span class="co"># Rolling window for SUV and volatility</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'detrend_window'</span>: <span class="dv">180</span>,     <span class="co"># Window for DTO detrending median</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lag'</span>: <span class="dv">7</span>,                  <span class="co"># Lag for DTO detrending</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gap'</span>: <span class="dv">5</span>,                  <span class="co"># Gap between estimation period and event date</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filters</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_price'</span>: <span class="dv">1000</span>,         <span class="co"># Minimum price in VND</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_volume_days'</span>: <span class="fl">0.8</span>,    <span class="co"># Min fraction of non-zero volume days in window</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_analysts'</span>: <span class="dv">3</span>,         <span class="co"># Minimum number of analysts for DISP</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_spread_pct'</span>: <span class="fl">0.50</span>,    <span class="co"># Maximum bid-ask spread as fraction of midpoint</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast_carry_days'</span>: <span class="dv">105</span>,<span class="co"># Days to carry forward stale analyst forecasts</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exchange identifiers</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exchanges'</span>: [<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price limit thresholds (for flagging)</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price_limit_hose'</span>: <span class="fl">0.07</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price_limit_hnx'</span>: <span class="fl">0.10</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Configuration parameters loaded successfully."</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample period: </span><span class="sc">{</span>CONFIG[<span class="st">'beg_date'</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>CONFIG[<span class="st">'end_date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimation window: </span><span class="sc">{</span>CONFIG[<span class="st">'est_window'</span>]<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Detrending window: </span><span class="sc">{</span>CONFIG[<span class="st">'detrend_window'</span>]<span class="sc">}</span><span class="ss"> trading days"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Configuration parameters loaded successfully.
Sample period: 2007-01-01 to 2024-12-31
Estimation window: 60 trading days
Detrending window: 180 trading days</code></pre>
</div>
</div>
<p>The sample universe includes all common stocks (ordinary shares) listed on HOSE and HNX during the period January 2007 through December 2024. We begin in 2007 rather than at market inception (2000 for HOSE, 2005 for HNX) for two reasons. First, the early years of the Vietnamese market were characterized by an extremely small number of listed firms (fewer than 30 on HOSE through 2005), making cross-sectional analysis unreliable. Second, data quality and consistency improve substantially after the market expansion of 2006-2007, during which the number of listed firms on HOSE grew from approximately 40 to over 100.</p>
<p>We apply the following filters to construct the analysis sample:</p>
<ol type="1">
<li><p><strong>Security type filter.</strong> We retain only common stocks (ordinary shares), excluding preferred shares, exchange-traded funds (ETFs), covered warrants, and certificates of deposit. This is analogous to the standard filter in the U.S. literature that restricts to CRSP share codes 10 and 11.</p></li>
<li><p><strong>Exchange filter.</strong> We include stocks listed on HOSE and HNX but exclude UPCoM securities in our baseline analysis. UPCoM is a registration-based trading venue with less stringent listing requirements and substantially lower liquidity, which may introduce noise into volume-based and spread-based measures. We include UPCoM in robustness checks.</p></li>
<li><p><strong>Price filter.</strong> We exclude stock-day observations with closing prices below 1,000 VND. This threshold serves the same purpose as the “penny stock” exclusion common in U.S. studies (typically $1 or $5 thresholds) and helps mitigate the influence of extreme percentage returns and spreads at very low price levels.</p></li>
<li><p><strong>Minimum trading activity.</strong> For volume-based measures, we require that a stock has non-zero trading volume on at least 80% of trading days within each estimation window. This filter eliminates the most thinly traded securities for which turnover-based measures would be unreliable.</p></li>
</ol>
<div id="load-and-filter" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_daily_data(config):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Load daily stock trading data from DataCore.vn.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    In practice, this function connects to the DataCore API or reads</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    from a local database/CSV. Here we document the expected schema.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected columns:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    - ticker: str, stock ticker symbol (e.g., 'VCB', 'HPG', 'VNM')</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - date: datetime, trading date</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - open, high, low, close: float, daily OHLC prices (VND)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - volume: int, trading volume (shares)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - shares_outstanding: int, total shares outstanding</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    - adjusted_close: float, price adjusted for corporate actions</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    - adj_factor: float, cumulative adjustment factor</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    - bid, ask: float, best bid/ask at close</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">    - exchange: str, exchange code ('HOSE', 'HNX', 'UPCOM')</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">    - industry_icb: str, ICB industry classification code</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">    - foreign_buy_vol, foreign_sell_vol: int, foreign investor volumes</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">    - foreign_ownership_pct: float, foreign ownership percentage</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace with actual DataCore API call:</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># from datacore import Client</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># client = Client(api_key='YOUR_KEY')</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df = client.daily_stock(</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     start=config['beg_date'], end=config['end_date'],</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     exchanges=config['exchanges']</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># )</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Connect to DataCore.vn and load daily stock data."</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Expected schema: ticker, date, open, high, low, close, volume,"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  shares_outstanding, adjusted_close, adj_factor, bid, ask,"</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  exchange, industry_icb, foreign_buy_vol, foreign_sell_vol,"</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  foreign_ownership_pct"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Replace with actual data</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_sample_filters(df, config):</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Apply sequential sample construction filters."""</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Sample Construction ==="</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    n0 <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Date filter</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[(df[<span class="st">'date'</span>] <span class="op">&gt;=</span> config[<span class="st">'beg_date'</span>]) <span class="op">&amp;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'date'</span>] <span class="op">&lt;=</span> config[<span class="st">'end_date'</span>])].copy()</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[1] Date filter: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs (from </span><span class="sc">{</span>n0<span class="sc">:,}</span><span class="ss">)"</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exchange filter</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'exchange'</span>].isin(config[<span class="st">'exchanges'</span>])].copy()</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[2] Exchange filter (</span><span class="sc">{</span>config[<span class="st">'exchanges'</span>]<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price filter</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'close'</span>] <span class="op">&gt;=</span> config[<span class="st">'min_price'</span>]].copy()</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[3] Price &gt;= </span><span class="sc">{</span>config[<span class="st">'min_price'</span>]<span class="sc">:,}</span><span class="ss"> VND: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute daily return from adjusted prices</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].pct_change()</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag price limit hits</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'limit_hit'</span>] <span class="op">=</span> (</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        ((df[<span class="st">'exchange'</span>] <span class="op">==</span> <span class="st">'HOSE'</span>) <span class="op">&amp;</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>         (df[<span class="st">'ret'</span>].<span class="bu">abs</span>() <span class="op">&gt;=</span> config[<span class="st">'price_limit_hose'</span>] <span class="op">-</span> <span class="fl">0.001</span>)) <span class="op">|</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        ((df[<span class="st">'exchange'</span>] <span class="op">==</span> <span class="st">'HNX'</span>) <span class="op">&amp;</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>         (df[<span class="st">'ret'</span>].<span class="bu">abs</span>() <span class="op">&gt;=</span> config[<span class="st">'price_limit_hnx'</span>] <span class="op">-</span> <span class="fl">0.001</span>))</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    n_tickers <span class="op">=</span> df[<span class="st">'ticker'</span>].nunique()</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Final sample: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> stock-day obs, "</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>n_tickers<span class="sc">}</span><span class="ss"> unique tickers"</span>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Limit-hit days: </span><span class="sc">{</span>df[<span class="st">'limit_hit'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> "</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"(</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>df[<span class="st">'limit_hit'</span>]<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-corp-actions" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="sec-corp-actions"><span class="header-section-number">20.3</span> Corporate Action Adjustments</h2>
<p>Proper adjustment for corporate actions is critical for volume-based DIVOP measures, as events such as stock splits, bonus share issues, and rights offerings change the number of shares outstanding and can create artificial spikes in measured turnover. We need to use cumulative adjustment factors that account for stock dividends (bonus shares), stock splits, rights offerings, and cash dividends (price adjustment only). We use these to construct adjusted volume and adjusted shares outstanding:</p>
<p><span class="math display">\[
\text{AdjVolume}_{i,t} = \text{Volume}_{i,t} \times \text{CumAdjFactor}_{i,t}
\]</span></p>
<p><span class="math display">\[
\text{AdjSharesOut}_{i,t} = \text{SharesOut}_{i,t} \times \text{CumAdjFactor}_{i,t}
\]</span></p>
<p>This ensures that the turnover ratio is consistent across corporate action events.</p>
<div id="corp-action" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjust_for_corporate_actions(df):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Apply cumulative adjustment factors to volume and shares outstanding."""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'adj_volume'</span>] <span class="op">=</span> df[<span class="st">'volume'</span>] <span class="op">*</span> df[<span class="st">'adj_factor'</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'adj_shares_out'</span>] <span class="op">=</span> df[<span class="st">'shares_outstanding'</span>] <span class="op">*</span> df[<span class="st">'adj_factor'</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Daily turnover ratio</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'turnover'</span>] <span class="op">=</span> np.where(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'adj_shares_out'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'adj_volume'</span>] <span class="op">/</span> df[<span class="st">'adj_shares_out'</span>],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        np.nan</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag extreme turnover (&gt; 50% of float)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    extreme <span class="op">=</span> df[<span class="st">'turnover'</span>] <span class="op">&gt;</span> <span class="fl">0.50</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> extreme.<span class="bu">any</span>():</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: </span><span class="sc">{</span>extreme<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> obs with turnover &gt; 50%, set to NaN"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        df.loc[extreme, <span class="st">'turnover'</span>] <span class="op">=</span> np.nan</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-calendar" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="sec-calendar"><span class="header-section-number">20.4</span> Trading Calendar Construction</h2>
<p>The rolling regression approach for SUV and volatility requires a trading calendar that ensures each estimation window contains exactly the specified number of trading days. We construct this directly from observed trading dates.</p>
<div id="trading-calendar" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_trading_calendar(df, config):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Map each trading date to its estimation window [est_start, est_end].</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For date t, the estimation window runs from</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    t - gap - est_window to t - gap - 1 (in trading-day terms).</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'date'</span>].unique())</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> pd.Series(trading_dates)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> config[<span class="st">'gap'</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> est_window <span class="op">+</span> gap</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(offset, <span class="bu">len</span>(trading_dates)):</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        records.append({</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'date'</span>: trading_dates.iloc[i],</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'est_start'</span>: trading_dates.iloc[i <span class="op">-</span> gap <span class="op">-</span> est_window],</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'est_end'</span>: trading_dates.iloc[i <span class="op">-</span> gap <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Trading calendar: </span><span class="sc">{</span><span class="bu">len</span>(calendar)<span class="sc">}</span><span class="ss"> dates, "</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>calendar[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>calendar[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> calendar</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-volume-based" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Volume-Based DIVOP Proxies</h1>
<section id="theoretical-motivation" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="theoretical-motivation"><span class="header-section-number">21.1</span> Theoretical Motivation</h2>
<p>Trading volume has long been recognized as a natural proxy for divergence of investor opinion. In the rational expectations framework of <span class="citation" data-cites="milgrom1982information">Milgrom and Stokey (<a href="references.html#ref-milgrom1982information" role="doc-biblioref">1982</a>)</span>, trade occurs only when investors disagree about the value of a security (i.e., a “no-trade theorem” that implies, by contrapositive, that observed trading volume must reflect some form of heterogeneous beliefs). <span class="citation" data-cites="harris1993differences">Harris and Raviv (<a href="references.html#ref-harris1993differences" role="doc-biblioref">1993</a>)</span> and <span class="citation" data-cites="kandel1995differential">Kandel and Pearson (<a href="references.html#ref-kandel1995differential" role="doc-biblioref">1995</a>)</span> formalize this intuition, showing that trading volume is positively related to the dispersion of investors’ prior beliefs and to the degree to which public information is differentially interpreted.</p>
<p>The challenge in using raw trading volume as a DIVOP proxy is that volume is also driven by factors unrelated to disagreement, including portfolio rebalancing, liquidity needs, tax-loss selling, and index reconstitution effects. <span class="citation" data-cites="garfinkel2009measuring">Garfinkel (<a href="references.html#ref-garfinkel2009measuring" role="doc-biblioref">2009</a>)</span> proposes two approaches to extract the disagreement component from raw volume. The first, <strong>Unexplained Volume (DTO)</strong>, removes market-wide volume effects and secular trends. The second, <strong>Standardized Unexplained Volume (SUV)</strong>, additionally controls for the information content of returns through a cross-sectional regression, isolating the “pure disagreement” component of trading activity.</p>
</section>
<section id="sec-dto" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="sec-dto"><span class="header-section-number">21.2</span> Unexplained Volume (DTO)</h2>
<section id="construction-methodology" class="level3" data-number="21.2.1">
<h3 data-number="21.2.1" class="anchored" data-anchor-id="construction-methodology"><span class="header-section-number">21.2.1</span> Construction Methodology</h3>
<p>The construction of the Unexplained Volume measure proceeds in four steps.</p>
<p><strong>Step 1: Compute firm-level daily turnover.</strong> For each stock <span class="math inline">\(i\)</span> on day <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[
\text{Turn}_{i,t} = \frac{\text{AdjVolume}_{i,t}}{\text{AdjSharesOut}_{i,t}}
\]</span></p>
<p><strong>Step 2: Compute market-wide turnover.</strong> We calculate aggregate turnover across all common stocks as a value-weighted average:</p>
<p><span class="math display">\[
\text{MktTurn}_{t} = \frac{\sum_{i} \text{AdjVolume}_{i,t}}{\sum_{i} \text{AdjSharesOut}_{i,t}}
\]</span></p>
<p>Unlike the U.S. methodology that computes market turnover across NYSE/AMEX stocks only and applies a scaling adjustment for NASDAQ securities <span class="citation" data-cites="anderson2005market">(following <a href="references.html#ref-anderson2005market" role="doc-biblioref">A.-M. Anderson and Dyl 2005</a>)</span>, we compute market turnover across all HOSE and HNX common stocks without any exchange-specific volume scaling. Both Vietnamese exchanges operate as order-driven markets (HOSE uses continuous order matching; HNX uses a combination of continuous matching and periodic call auctions) without the dealer-market double-counting issue that necessitates the NASDAQ volume adjustment in U.S. studies.</p>
<p><strong>Step 3: Compute market-adjusted turnover.</strong></p>
<p><span class="math display">\[
\text{MATO}_{i,t} = \text{Turn}_{i,t} - \text{MktTurn}_{t}
\]</span></p>
<p><strong>Step 4: Detrend by rolling median.</strong> To remove secular trends in firm-specific trading activity:</p>
<p><span class="math display">\[
\text{DTO}_{i,t} = \text{MATO}_{i,t} - \text{Median}_{180}(\text{MATO}_{i,t-7})
\]</span></p>
<p>where <span class="math inline">\(\text{Median}_{180}(\text{MATO}_{i,t-7})\)</span> is the median of market-adjusted turnover over the 180-trading-day window ending 7 days before date <span class="math inline">\(t\)</span>. The 7-day lag prevents the current day’s turnover from influencing its own detrending baseline.</p>
<div id="dto-construction" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_market_turnover(df):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute daily market-wide turnover across all stocks."""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    mkt_turn <span class="op">=</span> df.groupby(<span class="st">'date'</span>).<span class="bu">apply</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x[<span class="st">'adj_volume'</span>].<span class="bu">sum</span>() <span class="op">/</span> x[<span class="st">'adj_shares_out'</span>].<span class="bu">sum</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x[<span class="st">'adj_shares_out'</span>].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    mkt_turn.columns <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'market_turnover'</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mkt_turn</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_dto(df, config):</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Construct Unexplained Volume (DTO).</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Steps:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Subtract market turnover -&gt; MATO</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Rolling 180-day median of MATO (lagged 7 days) -&gt; trend</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">    3. DTO = MATO - trend</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    detrend_window <span class="op">=</span> config[<span class="st">'detrend_window'</span>]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    lag <span class="op">=</span> config[<span class="st">'lag'</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market turnover</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    mkt_turn <span class="op">=</span> compute_market_turnover(df)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(mkt_turn, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market-adjusted turnover</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mato'</span>] <span class="op">=</span> df[<span class="st">'turnover'</span>] <span class="op">-</span> df[<span class="st">'market_turnover'</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rolling median with lag, computed per stock</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _rolling_median_lagged(group):</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        mato <span class="op">=</span> group[<span class="st">'mato'</span>]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        med <span class="op">=</span> mato.rolling(</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            window<span class="op">=</span>detrend_window,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            min_periods<span class="op">=</span><span class="bu">int</span>(detrend_window <span class="op">*</span> <span class="fl">0.5</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        ).median()</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> med.shift(lag)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mato_trend'</span>] <span class="op">=</span> (</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        df.groupby(<span class="st">'ticker'</span>, group_keys<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>          .<span class="bu">apply</span>(<span class="kw">lambda</span> g: _rolling_median_lagged(g))</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DTO</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dto'</span>] <span class="op">=</span> df[<span class="st">'mato'</span>] <span class="op">-</span> df[<span class="st">'mato_trend'</span>]</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DTO construction complete."</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Non-missing: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">, Std: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>std()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="vietnam-specific-considerations-for-dto" class="level3" data-number="21.2.2">
<h3 data-number="21.2.2" class="anchored" data-anchor-id="vietnam-specific-considerations-for-dto"><span class="header-section-number">21.2.2</span> Vietnam-Specific Considerations for DTO</h3>
<p>Several features of the Vietnamese market require attention when constructing DTO:</p>
<ol type="1">
<li><p><strong>No NASDAQ-type volume adjustment needed.</strong> Both HOSE and HNX are order-driven auction markets. The double-counting adjustment applied to NASDAQ securities in the U.S. literature is not necessary.</p></li>
<li><p><strong>Thinly traded stocks.</strong> A substantial fraction of listed Vietnamese stocks, particularly on HNX, may have zero volume on many trading days. For stocks with intermittent trading, the rolling median may be biased toward zero, making DTO less informative. We require at least 80% non-zero volume days in each estimation window.</p></li>
<li><p><strong>Price limit effects on volume.</strong> When a stock hits its daily price limit, unfilled orders accumulate and recorded volume may understate true clearing volume. The following day often shows a “catch-up” effect. Researchers should consider flagging limit-hit days.</p></li>
<li><p><strong>Foreign investor trading decomposition.</strong> DataCore provides volume by investor type (foreign versus domestic). Researchers may wish to construct separate DTO measures for foreign and domestic volume, or use the foreign-to-domestic volume ratio as an additional dimension of disagreement.</p></li>
</ol>
</section>
</section>
<section id="sec-suv" class="level2" data-number="21.3">
<h2 data-number="21.3" class="anchored" data-anchor-id="sec-suv"><span class="header-section-number">21.3</span> Standardized Unexplained Volume (SUV)</h2>
<section id="construction-methodology-1" class="level3" data-number="21.3.1">
<h3 data-number="21.3.1" class="anchored" data-anchor-id="construction-methodology-1"><span class="header-section-number">21.3.1</span> Construction Methodology</h3>
<p>The Standardized Unexplained Volume measure, proposed by <span class="citation" data-cites="garfinkel2009measuring">Garfinkel (<a href="references.html#ref-garfinkel2009measuring" role="doc-biblioref">2009</a>)</span>, isolates the disagreement component of volume by explicitly controlling for the information content of returns. The insight is that trading volume has both a <strong>liquidity</strong> component and an <strong>informedness</strong> component correlated with the magnitude and sign of returns. By regressing turnover on signed returns and extracting the standardized residual, SUV captures volume attributable to disagreement after controlling for both liquidity trends and information-driven trading.</p>
<p>For each stock <span class="math inline">\(i\)</span>, on each trading date <span class="math inline">\(t\)</span>, we estimate using data from the estimation window <span class="math inline">\([\tau_1, \tau_2]\)</span>:</p>
<p><span id="eq-suv-regression"><span class="math display">\[
\text{Turn}_{i,s} = \alpha_i + \beta_i^{+} \cdot \text{RetPos}_{i,s} + \beta_i^{-} \cdot \text{RetNeg}_{i,s} + \epsilon_{i,s}, \quad s \in [\tau_1, \tau_2]
\tag{21.1}\]</span></span></p>
<p>where <span class="math inline">\(\text{RetPos}_{i,s} = |r_{i,s}| \cdot \mathbf{1}(r_{i,s} &gt; 0)\)</span> and <span class="math inline">\(\text{RetNeg}_{i,s} = |r_{i,s}| \cdot \mathbf{1}(r_{i,s} &lt; 0)\)</span>.</p>
<p>The Standardized Unexplained Volume on date <span class="math inline">\(t\)</span> is:</p>
<p><span id="eq-suv"><span class="math display">\[
\text{SUV}_{i,t} = \frac{\text{Turn}_{i,t} - \hat{\text{Turn}}_{i,t}}{\hat{\sigma}_{\epsilon,i}}
\tag{21.2}\]</span></span></p>
<p>where <span class="math inline">\(\hat{\text{Turn}}_{i,t}\)</span> is the predicted turnover and <span class="math inline">\(\hat{\sigma}_{\epsilon,i}\)</span> is the RMSE from <a href="#eq-suv-regression" class="quarto-xref">Equation&nbsp;<span>21.1</span></a>.</p>
<p>The asymmetric specification with separate coefficients for positive and negative returns reflects that the volume-return relation differs by return sign. In the U.S., buying pressure tends to generate more volume than selling pressure due to short-sale frictions. In Vietnam, where short selling was unavailable until 2025, this asymmetry should be even more pronounced because all selling activity was constrained to existing shareholders.</p>
<div id="suv-construction" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_suv(df, calendar, config):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute Standardized Unexplained Volume via rolling regressions.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For each stock-date, regress Turn on RetPos and RetNeg over the</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    estimation window, then compute SUV = (actual - predicted) / RMSE.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    min_obs <span class="op">=</span> <span class="bu">int</span>(est_window <span class="op">*</span> config[<span class="st">'min_volume_days'</span>])</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare signed return components</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret_pos'</span>] <span class="op">=</span> np.where(df[<span class="st">'ret'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]), <span class="fl">0.0</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret_neg'</span>] <span class="op">=</span> np.where(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ret'</span>] <span class="op">&lt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> df[<span class="st">'ret'</span>].notna(), np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]), <span class="fl">0.0</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> {t: g <span class="cf">for</span> t, g <span class="kw">in</span> df.groupby(<span class="st">'ticker'</span>)}</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, cal_row <span class="kw">in</span> calendar.iterrows():</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> cal_row[<span class="st">'date'</span>]</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        est_s, est_e <span class="op">=</span> cal_row[<span class="st">'est_start'</span>], cal_row[<span class="st">'est_end'</span>]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker, tdata <span class="kw">in</span> grouped.items():</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Estimation window</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            est <span class="op">=</span> tdata[</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                (tdata[<span class="st">'date'</span>] <span class="op">&gt;=</span> est_s) <span class="op">&amp;</span> (tdata[<span class="st">'date'</span>] <span class="op">&lt;=</span> est_e)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            ].dropna(subset<span class="op">=</span>[<span class="st">'turnover'</span>, <span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>])</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> min_obs:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Event date</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>            evt <span class="op">=</span> tdata[tdata[<span class="st">'date'</span>] <span class="op">==</span> dt]</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> evt.empty <span class="kw">or</span> evt[<span class="st">'turnover'</span>].isna().<span class="bu">all</span>():</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># OLS: Turn = alpha + beta_pos * RetPos + beta_neg * RetNeg</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> est[[<span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>]].values</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> est[<span class="st">'turnover'</span>].values</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            reg <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            y_hat <span class="op">=</span> reg.predict(X)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            rmse <span class="op">=</span> np.sqrt(np.mean((y <span class="op">-</span> y_hat) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rmse <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Predict and standardize for event date</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            X_evt <span class="op">=</span> evt[[<span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>]].values</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> reg.predict(X_evt)[<span class="dv">0</span>]</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>            actual <span class="op">=</span> evt[<span class="st">'turnover'</span>].values[<span class="dv">0</span>]</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>            suv <span class="op">=</span> (actual <span class="op">-</span> pred) <span class="op">/</span> rmse</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">'ticker'</span>: ticker, <span class="st">'date'</span>: dt,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">'suv'</span>: suv,</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">'predicted_turnover'</span>: pred,</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">'rmse_turn'</span>: rmse,</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">'n_est'</span>: <span class="bu">len</span>(est),</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">'alpha_turn'</span>: reg.intercept_,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>                <span class="st">'beta_pos'</span>: reg.coef_[<span class="dv">0</span>],</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>                <span class="st">'beta_neg'</span>: reg.coef_[<span class="dv">1</span>],</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    suv_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"SUV: </span><span class="sc">{</span><span class="bu">len</span>(suv_df)<span class="sc">:,}</span><span class="ss"> stock-date obs"</span>)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>suv_df[<span class="st">'suv'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Median: </span><span class="sc">{</span>suv_df[<span class="st">'suv'</span>]<span class="sc">.</span>median()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> suv_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="interpreting-the-suv-regression-coefficients" class="level3" data-number="21.3.2">
<h3 data-number="21.3.2" class="anchored" data-anchor-id="interpreting-the-suv-regression-coefficients"><span class="header-section-number">21.3.2</span> Interpreting the SUV Regression Coefficients</h3>
<p>The estimated coefficients from <a href="#eq-suv-regression" class="quarto-xref">Equation&nbsp;<span>21.1</span></a> are informative about market microstructure. <span class="citation" data-cites="garfinkel2009measuring">Garfinkel (<a href="references.html#ref-garfinkel2009measuring" role="doc-biblioref">2009</a>)</span> reports <span class="math inline">\(\hat{\beta}^{+} &gt; \hat{\beta}^{-}\)</span> for most U.S. stocks. In Vietnam, we expect this asymmetry to be even stronger because:</p>
<ul>
<li><strong>No short selling (pre-2025):</strong> All selling is by existing shareholders, limiting volume response to negative returns.</li>
<li><strong>T+2 settlement:</strong> Investors cannot immediately reinvest sale proceeds, further dampening sell-side volume.</li>
<li><strong>Price limits:</strong> The <span class="math inline">\(\pm\)</span> 7% (HOSE) and <span class="math inline">\(\pm\)</span> 10% (HNX) daily limits truncate the return distribution, compressing the range of both regressors.</li>
</ul>
<p>Researchers should report summary statistics of <span class="math inline">\((\hat{\alpha}, \hat{\beta}^{+}, \hat{\beta}^{-}, R^2)\)</span> across the cross-section and over time.</p>
<div id="suv-diagnostics" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> suv_diagnostics(suv_df):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Report cross-sectional summary of SUV regression parameters."""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== SUV Regression Diagnostics ==="</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [<span class="st">'alpha_turn'</span>, <span class="st">'beta_pos'</span>, <span class="st">'beta_neg'</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(suv_df[params].describe(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        percentiles<span class="op">=</span>[<span class="fl">.05</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.95</span>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ).T.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asymmetry test</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> suv_df[<span class="st">'beta_pos'</span>] <span class="op">-</span> suv_df[<span class="st">'beta_neg'</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">beta_pos - beta_neg: mean = </span><span class="sc">{</span>diff<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">, "</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"frac &gt; 0 = </span><span class="sc">{</span>(diff <span class="op">&gt;</span> <span class="dv">0</span>)<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
</section>
<section id="sec-volatility" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Volatility-Based DIVOP Proxies</h1>
<section id="sec-total-vol" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="sec-total-vol"><span class="header-section-number">22.1</span> Total Return Volatility</h2>
<section id="theoretical-motivation-1" class="level3" data-number="22.1.1">
<h3 data-number="22.1.1" class="anchored" data-anchor-id="theoretical-motivation-1"><span class="header-section-number">22.1.1</span> Theoretical Motivation</h3>
<p>Stock return volatility serves as a proxy for divergence of opinion through several channels. <span class="citation" data-cites="shalen1993volume">Shalen (<a href="references.html#ref-shalen1993volume" role="doc-biblioref">1993</a>)</span> develops a model in which both volume and volatility are increasing in the dispersion of investor beliefs. <span class="citation" data-cites="scheinkman2003overconfidence">Scheinkman and Xiong (<a href="references.html#ref-scheinkman2003overconfidence" role="doc-biblioref">2003</a>)</span> predict that higher volatility reflects the speculative trading component driven by overconfident investors who disagree about value. Empirically, <span class="citation" data-cites="boehme2006short">Boehme, Danielsen, and Sorescu (<a href="references.html#ref-boehme2006short" role="doc-biblioref">2006</a>)</span> and <span class="citation" data-cites="chatterjee2012takeovers">Chatterjee, John, and Yan (<a href="references.html#ref-chatterjee2012takeovers" role="doc-biblioref">2012</a>)</span> use idiosyncratic volatility as a DIVOP proxy and find it positively correlated with other disagreement measures and negatively associated with subsequent returns when short-sale constraints bind.</p>
</section>
<section id="construction" class="level3" data-number="22.1.2">
<h3 data-number="22.1.2" class="anchored" data-anchor-id="construction"><span class="header-section-number">22.1.2</span> Construction</h3>
<p>Total return volatility is the standard deviation of daily returns over the rolling estimation window:</p>
<p><span id="eq-volatility"><span class="math display">\[
\text{VOLATILITY}_{i,t} = \sqrt{\frac{1}{N_i - 1} \sum_{s \in [\tau_1, \tau_2]} (r_{i,s} - \bar{r}_i)^2}
\tag{22.1}\]</span></span></p>
<p>where <span class="math inline">\(N_i\)</span> is the number of non-missing return observations for stock <span class="math inline">\(i\)</span> in the window <span class="math inline">\([\tau_1, \tau_2]\)</span>.</p>
</section>
</section>
<section id="sec-ivol" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="sec-ivol"><span class="header-section-number">22.2</span> Idiosyncratic Volatility (IVOL)</h2>
<p>Idiosyncratic volatility isolates firm-specific return variation by removing the systematic component explained by market movements. We compute IVOL from the residuals of a market model:</p>
<p><span id="eq-market-model"><span class="math display">\[
r_{i,s} = \alpha_i + \beta_i \cdot r_{m,s} + \epsilon_{i,s}, \quad s \in [\tau_1, \tau_2]
\tag{22.2}\]</span></span></p>
<p><span id="eq-ivol"><span class="math display">\[
\text{IVOL}_{i,t} = \text{Std}(\hat{\epsilon}_{i,s})
\tag{22.3}\]</span></span></p>
<p>Researchers may extend this to a <span class="citation" data-cites="fama1993common">Fama and French (<a href="references.html#ref-fama1993common" role="doc-biblioref">1993</a>)</span> three-factor or five-factor model using Vietnamese factor portfolios constructed elsewhere in this book. A richer factor model yields IVOL estimates that better isolate truly idiosyncratic disagreement, at the cost of requiring factor portfolio construction.</p>
<div id="volatility-construction" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_volatility(df, calendar, config):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute total return volatility and idiosyncratic volatility</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    via rolling estimation windows.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Total vol = std(returns) in window.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    IVOL = std(residuals) from market model regression.</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    min_obs <span class="op">=</span> <span class="bu">int</span>(est_window <span class="op">*</span> config[<span class="st">'min_volume_days'</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value-weighted market return</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _vw_ret(g):</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> g.dropna(subset<span class="op">=</span>[<span class="st">'ret'</span>])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> valid.empty:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> valid[<span class="st">'adj_shares_out'</span>] <span class="op">*</span> valid[<span class="st">'close'</span>]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.average(valid[<span class="st">'ret'</span>], weights<span class="op">=</span>w)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    mkt_ret <span class="op">=</span> df.groupby(<span class="st">'date'</span>).<span class="bu">apply</span>(_vw_ret).reset_index()</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    mkt_ret.columns <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'mkt_ret'</span>]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(mkt_ret, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> {t: g <span class="cf">for</span> t, g <span class="kw">in</span> df.groupby(<span class="st">'ticker'</span>)}</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, cal_row <span class="kw">in</span> calendar.iterrows():</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> cal_row[<span class="st">'date'</span>]</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        est_s, est_e <span class="op">=</span> cal_row[<span class="st">'est_start'</span>], cal_row[<span class="st">'est_end'</span>]</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker, tdata <span class="kw">in</span> grouped.items():</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            est <span class="op">=</span> tdata[</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                (tdata[<span class="st">'date'</span>] <span class="op">&gt;=</span> est_s) <span class="op">&amp;</span> (tdata[<span class="st">'date'</span>] <span class="op">&lt;=</span> est_e)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            ].dropna(subset<span class="op">=</span>[<span class="st">'ret'</span>, <span class="st">'mkt_ret'</span>])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> min_obs:</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Total volatility</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            total_vol <span class="op">=</span> est[<span class="st">'ret'</span>].std()</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Market model -&gt; IVOL</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> est[[<span class="st">'mkt_ret'</span>]].values</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> est[<span class="st">'ret'</span>].values</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            reg <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            resid <span class="op">=</span> y <span class="op">-</span> reg.predict(X)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>            ivol <span class="op">=</span> np.std(resid, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">'ticker'</span>: ticker, <span class="st">'date'</span>: dt,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">'total_volatility'</span>: total_vol,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">'idio_volatility'</span>: ivol,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">'market_beta'</span>: reg.coef_[<span class="dv">0</span>],</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">'market_alpha'</span>: reg.intercept_,</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">'r_squared_mm'</span>: reg.score(X, y),</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">'n_vol'</span>: <span class="bu">len</span>(est),</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    vol_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Volatility: </span><span class="sc">{</span><span class="bu">len</span>(vol_df)<span class="sc">:,}</span><span class="ss"> stock-date obs"</span>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Total vol (ann. mean): "</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>vol_df[<span class="st">'total_volatility'</span>]<span class="sc">.</span>mean() <span class="op">*</span> np<span class="sc">.</span>sqrt(<span class="dv">252</span>)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  IVOL (ann. mean): "</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>vol_df[<span class="st">'idio_volatility'</span>]<span class="sc">.</span>mean() <span class="op">*</span> np<span class="sc">.</span>sqrt(<span class="dv">252</span>)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vol_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="vietnam-specific-considerations-for-volatility" class="level3" data-number="22.2.1">
<h3 data-number="22.2.1" class="anchored" data-anchor-id="vietnam-specific-considerations-for-volatility"><span class="header-section-number">22.2.1</span> Vietnam-Specific Considerations for Volatility</h3>
<ol type="1">
<li><p><strong>Price limits compress measured volatility.</strong> Daily limits of <span class="math inline">\(\pm\)</span> 7% (HOSE) and <span class="math inline">\(\pm\)</span> 10% (HNX) mechanically truncate the return distribution, leading to underestimation of true volatility. On limit-hit days, the true equilibrium return may exceed the observed return. Researchers should be aware that volatility-based DIVOP measures may be downward-biased for stocks that frequently hit limits.</p></li>
<li><p><strong>VN-Index concentration.</strong> The VN-Index is highly concentrated, the top 10 stocks often account for 50-60% of index weight. For small- and mid-cap stocks, an equal-weighted market return or a composite HOSE+HNX index may provide a better market factor in <a href="#eq-market-model" class="quarto-xref">Equation&nbsp;<span>22.2</span></a>.</p></li>
<li><p><strong>Thin trading and non-synchronous returns.</strong> For thinly traded stocks, consecutive zero-return days can depress measured volatility. The <span class="citation" data-cites="dimson1979risk">Dimson (<a href="references.html#ref-dimson1979risk" role="doc-biblioref">1979</a>)</span> adjustment (including lagged and lead market returns in the market model) may help correct for non-synchronous trading bias in the beta estimate, though its effect on IVOL is typically small.</p></li>
</ol>
</section>
</section>
</section>
<section id="sec-spread" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> Spread-Based and Liquidity DIVOP Proxies</h1>
<section id="sec-baspread" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="sec-baspread"><span class="header-section-number">23.1</span> Bid-Ask Spread (BASPREAD)</h2>
<section id="theoretical-motivation-2" class="level3" data-number="23.1.1">
<h3 data-number="23.1.1" class="anchored" data-anchor-id="theoretical-motivation-2"><span class="header-section-number">23.1.1</span> Theoretical Motivation</h3>
<p>The bid-ask spread reflects the adverse selection costs faced by limit order providers. When investors hold heterogeneous beliefs, each trade is more likely to convey private information, raising the adverse selection component of the spread. <span class="citation" data-cites="handa2003quote">Handa, Schwartz, and Tiwari (<a href="references.html#ref-handa2003quote" role="doc-biblioref">2003</a>)</span> show that in order-driven markets the spread widens when divergence of opinion increases because limit order providers face greater risk of being picked off by informed traders. <span class="citation" data-cites="chung2014simple">Chung and Zhang (<a href="references.html#ref-chung2014simple" role="doc-biblioref">2014</a>)</span> demonstrate that closing bid-ask spreads from daily data provide a reliable approximation to intraday effective spreads.</p>
</section>
<section id="construction-1" class="level3" data-number="23.1.2">
<h3 data-number="23.1.2" class="anchored" data-anchor-id="construction-1"><span class="header-section-number">23.1.2</span> Construction</h3>
<p>We compute the proportional bid-ask spread using end-of-day quote data:</p>
<p><span id="eq-baspread"><span class="math display">\[
\text{BASPREAD}_{i,t} = \frac{\text{Ask}_{i,t} - \text{Bid}_{i,t}}{\text{Midpoint}_{i,t}}
\tag{23.1}\]</span></span></p>
<p>where <span class="math inline">\(\text{Midpoint}_{i,t} = (\text{Ask}_{i,t} + \text{Bid}_{i,t}) / 2\)</span>. When end-of-day bid and ask are unavailable, we use the daily high-low range as a fallback. Following <span class="citation" data-cites="chung2014simple">Chung and Zhang (<a href="references.html#ref-chung2014simple" role="doc-biblioref">2014</a>)</span>, we delete observations where both Bid and Ask are zero, and where the spread exceeds 50% of the midpoint.</p>
</section>
</section>
<section id="sec-amihud" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="sec-amihud"><span class="header-section-number">23.2</span> Amihud Illiquidity (ILLIQ)</h2>
<p>The <span class="citation" data-cites="amihud2002illiquidity">Amihud (<a href="references.html#ref-amihud2002illiquidity" role="doc-biblioref">2002</a>)</span> ratio measures the price impact of order flow:</p>
<p><span id="eq-amihud"><span class="math display">\[
\text{ILLIQ}_{i,t} = \frac{|r_{i,t}|}{\text{DolVol}_{i,t}}
\tag{23.2}\]</span></span></p>
<p>where <span class="math inline">\(\text{DolVol}_{i,t} = \text{Volume}_{i,t} \times \text{Price}_{i,t}\)</span> (in billions VND for scaling). Higher ILLIQ reflects greater information asymmetry. We average daily ratios over monthly horizons and use the log transformation due to heavy right skew.</p>
<div id="spread-illiq" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_spread_and_illiq(df, config):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute bid-ask spread (BASPREAD) and Amihud illiquidity."""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Bid-Ask Spread ---</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint_ba'</span>] <span class="op">=</span> (df[<span class="st">'ask'</span>] <span class="op">+</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread_ba'</span>] <span class="op">=</span> np.where(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'midpoint_ba'</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">-</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> df[<span class="st">'midpoint_ba'</span>], np.nan</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback: high/low range</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint_hl'</span>] <span class="op">=</span> (df[<span class="st">'high'</span>] <span class="op">+</span> df[<span class="st">'low'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread_hl'</span>] <span class="op">=</span> np.where(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'high'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'low'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'midpoint_hl'</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'high'</span>] <span class="op">-</span> df[<span class="st">'low'</span>]) <span class="op">/</span> df[<span class="st">'midpoint_hl'</span>], np.nan</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread'</span>] <span class="op">=</span> df[<span class="st">'baspread_ba'</span>].fillna(df[<span class="st">'baspread_hl'</span>])</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint'</span>] <span class="op">=</span> df[<span class="st">'midpoint_ba'</span>].fillna(df[<span class="st">'midpoint_hl'</span>])</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chung &amp; Zhang (2009) filters</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    bad <span class="op">=</span> (df[<span class="st">'baspread'</span>].isna()) <span class="op">|</span> <span class="op">\</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>          (df[<span class="st">'baspread'</span>] <span class="op">&gt;</span> config[<span class="st">'max_spread_pct'</span>]) <span class="op">|</span> <span class="op">\</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>          (df[<span class="st">'baspread'</span>] <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    df.loc[bad, <span class="st">'baspread'</span>] <span class="op">=</span> np.nan</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Amihud Illiquidity ---</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dollar_vol'</span>] <span class="op">=</span> df[<span class="st">'volume'</span>] <span class="op">*</span> df[<span class="st">'close'</span>] <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'amihud_daily'</span>] <span class="op">=</span> np.where(</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'dollar_vol'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]) <span class="op">/</span> df[<span class="st">'dollar_vol'</span>], np.nan</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"BASPREAD: </span><span class="sc">{</span>df[<span class="st">'baspread'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> valid obs, "</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean = </span><span class="sc">{</span>df[<span class="st">'baspread'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"AMIHUD: </span><span class="sc">{</span>df[<span class="st">'amihud_daily'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> valid obs, "</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean = </span><span class="sc">{</span>df[<span class="st">'amihud_daily'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_amihud_monthly(df):</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Monthly Amihud = mean daily |ret|/dollar_vol (min 15 days)."""</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    agg <span class="op">=</span> df.groupby([<span class="st">'ticker'</span>, <span class="st">'ym'</span>]).agg(</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        illiq_mean<span class="op">=</span>(<span class="st">'amihud_daily'</span>, <span class="st">'mean'</span>),</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        n_days<span class="op">=</span>(<span class="st">'amihud_daily'</span>, <span class="st">'count'</span>),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    agg <span class="op">=</span> agg[agg[<span class="st">'n_days'</span>] <span class="op">&gt;=</span> <span class="dv">15</span>].copy()</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    agg[<span class="st">'log_illiq'</span>] <span class="op">=</span> np.log(agg[<span class="st">'illiq_mean'</span>] <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agg</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="vietnam-specific-considerations-for-spread-and-liquidity" class="level3" data-number="23.2.1">
<h3 data-number="23.2.1" class="anchored" data-anchor-id="vietnam-specific-considerations-for-spread-and-liquidity"><span class="header-section-number">23.2.1</span> Vietnam-Specific Considerations for Spread and Liquidity</h3>
<ol type="1">
<li><p><strong>Tick size schedule.</strong> Vietnam uses variable tick sizes: 10 VND (prices &lt; 10,000), 50 VND (10,000–49,950), and 100 VND (≥ 50,000) on HOSE. These impose a floor on quoted spreads for low-priced stocks. Researchers should be cautious interpreting cross-price-decile spread variation as reflecting opinion divergence rather than tick-size mechanics.</p></li>
<li><p><strong>Order-driven market structure.</strong> Both HOSE and HNX are pure order-driven markets where public limit orders provide liquidity. This makes the <span class="citation" data-cites="chung2014simple">Chung and Zhang (<a href="references.html#ref-chung2014simple" role="doc-biblioref">2014</a>)</span> CRSP-based spread approximation appropriate.</p></li>
<li><p><strong>Lot size requirements.</strong> HOSE requires 100-share standard lots for continuous trading. For high-priced stocks, the standard lot represents a large capital commitment, potentially inflating quoted spreads relative to effective trading costs.</p></li>
<li><p><strong>Call auction effects.</strong> Opening and closing sessions on HOSE use periodic call auctions, which can produce bid-ask quotes that differ substantially from continuous-trading spreads.</p></li>
</ol>
</section>
</section>
</section>
<section id="sec-analyst" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> Analyst Forecast Dispersion</h1>
<section id="theoretical-motivation-3" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="theoretical-motivation-3"><span class="header-section-number">24.1</span> Theoretical Motivation</h2>
<p>Analyst forecast dispersion, the cross-sectional standard deviation of individual analysts’ earnings forecasts, is the most direct measure of divergence of opinion. Unlike market-based proxies that capture disagreement indirectly, forecast dispersion directly measures disagreement among informed market participants. <span class="citation" data-cites="abarbanell1995analysts">Abarbanell, Lanen, and Verrecchia (<a href="references.html#ref-abarbanell1995analysts" role="doc-biblioref">1995</a>)</span> establish the theoretical basis, and <span class="citation" data-cites="diether2002differences">Diether, Malloy, and Scherbina (<a href="references.html#ref-diether2002differences" role="doc-biblioref">2002</a>)</span> demonstrate that stocks with higher analyst forecast dispersion earn lower subsequent returns, consistent with the Miller overpricing hypothesis.</p>
</section>
<section id="data-challenges-in-vietnam" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="data-challenges-in-vietnam"><span class="header-section-number">24.2</span> Data Challenges in Vietnam</h2>
<p>Constructing analyst forecast dispersion in Vietnam presents substantial challenges relative to the U.S.:</p>
<ul>
<li><strong>Coverage breadth.</strong> While I/B/E/S covers over 4,000 U.S. companies, only 100–150 Vietnamese firms typically have coverage by at least 3 analysts, concentrated among VN30 constituents.</li>
<li><strong>Data sources.</strong> Analyst forecasts are available from DataCore.vn, FiinPro, Bloomberg, and Refinitiv. The choice of source affects coverage and timeliness.</li>
<li><strong>Forecast staleness.</strong> With limited coverage, forecasts may go unrevised for months. Following I/B/E/S methodology, we carry each forecast forward for a maximum of 105 days.</li>
</ul>
</section>
<section id="construction-methodology-2" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="construction-methodology-2"><span class="header-section-number">24.3</span> Construction Methodology</h2>
<p>The construction proceeds as follows:</p>
<ol type="1">
<li><strong>Clean individual forecasts.</strong> Remove observations where the announcement date precedes the review date. Keep only annual EPS forecasts. For each analyst-ticker-fiscal period, retain only the latest forecast per calendar month.</li>
<li><strong>Handle stopped and excluded estimates.</strong> Remove forecasts where the analyst has left the brokerage or the estimate has been excluded from consensus.</li>
<li><strong>Carry forward with staleness control.</strong> Each forecast is valid until the earlier of: (a) the next forecast by the same analyst, (b) 105 days after the announcement, or (c) the actual earnings announcement date.</li>
<li><strong>Expand to monthly frequency.</strong> For each ticker-month, identify all valid outstanding forecasts and compute dispersion.</li>
<li><strong>Compute scaled measures:</strong></li>
</ol>
<p><span class="math display">\[
\text{DISP1}_{i,m} = \frac{\text{Std}(\hat{\text{EPS}}_{i,m}^{(a)})}{|\text{Mean}(\hat{\text{EPS}}_{i,m}^{(a)})|}
\qquad
\text{DISP2}_{i,m} = \frac{\text{Std}(\hat{\text{EPS}}_{i,m}^{(a)})}{\bar{P}_{i,m}}
\]</span></p>
<div id="analyst-dispersion" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_analyst_dispersion(forecasts_df, price_df, config):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Construct analyst forecast dispersion measures.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    forecasts_df : pd.DataFrame</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual analyst forecasts with: ticker, analyst_id, broker,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">        fpedats, anndats, revdats, value (EPS), anndats_act.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">    price_df : pd.DataFrame</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Monthly price: ticker, month, mean_price.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    config : dict</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">        With min_analysts, forecast_carry_days.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    carry_days <span class="op">=</span> config[<span class="st">'forecast_carry_days'</span>]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    min_analysts <span class="op">=</span> config[<span class="st">'min_analysts'</span>]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> forecasts_df.copy()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'anndats'</span>] <span class="op">&lt;=</span> df[<span class="st">'revdats'</span>]].copy()</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'fpedats'</span>, <span class="st">'anndats'</span>, <span class="st">'value'</span>])</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Latest forecast per analyst-month</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'anndats'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'fpedats'</span>, <span class="st">'analyst_id'</span>, <span class="st">'ym'</span>, <span class="st">'anndats'</span>, <span class="st">'revdats'</span>]</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.groupby([<span class="st">'ticker'</span>, <span class="st">'fpedats'</span>, <span class="st">'analyst_id'</span>, <span class="st">'ym'</span>]).tail(<span class="dv">1</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carry-forward end date</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'fpedats'</span>, <span class="st">'anndats'</span>],</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        ascending<span class="op">=</span>[<span class="va">True</span>, <span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'next_ann'</span>] <span class="op">=</span> df.groupby(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'fpedats'</span>]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    )[<span class="st">'anndats'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _carry_end(row):</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        candidates <span class="op">=</span> [row[<span class="st">'anndats'</span>] <span class="op">+</span> pd.Timedelta(days<span class="op">=</span>carry_days)]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row.get(<span class="st">'next_ann'</span>)):</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            candidates.append(row[<span class="st">'next_ann'</span>])</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row.get(<span class="st">'anndats_act'</span>)):</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            candidates.append(row[<span class="st">'anndats_act'</span>])</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(candidates)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'carry_end'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(_carry_end, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly expansion</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    months <span class="op">=</span> pd.period_range(config[<span class="st">'beg_date'</span>], config[<span class="st">'end_date'</span>], freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> months:</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        me <span class="op">=</span> month.to_timestamp(how<span class="op">=</span><span class="st">'end'</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> df[(df[<span class="st">'anndats'</span>] <span class="op">&lt;=</span> me) <span class="op">&amp;</span> (df[<span class="st">'carry_end'</span>] <span class="op">&gt;</span> me)].copy()</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid[valid[<span class="st">'fpedats'</span>] <span class="op">&gt;</span> me]</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid.sort_values([<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'anndats'</span>])</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid.groupby([<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>]).tail(<span class="dv">1</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        disp <span class="op">=</span> valid.groupby(<span class="st">'ticker'</span>).agg(</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>            n_analysts<span class="op">=</span>(<span class="st">'analyst_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>            mean_fcst<span class="op">=</span>(<span class="st">'value'</span>, <span class="st">'mean'</span>),</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>            std_fcst<span class="op">=</span>(<span class="st">'value'</span>, <span class="st">'std'</span>),</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>        ).reset_index()</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        disp[<span class="st">'month'</span>] <span class="op">=</span> month</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>        records.append(disp)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> records:</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    disp_df <span class="op">=</span> pd.concat(records, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scaled measures</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp1'</span>] <span class="op">=</span> np.where(</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'mean_fcst'</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'std_fcst'</span>] <span class="op">/</span> disp_df[<span class="st">'mean_fcst'</span>].<span class="bu">abs</span>(), np.nan</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>    disp_df <span class="op">=</span> disp_df.merge(price_df, on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'month'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp2'</span>] <span class="op">=</span> np.where(</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'mean_price'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'std_fcst'</span>] <span class="op">/</span> disp_df[<span class="st">'mean_price'</span>], np.nan</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp_raw'</span>] <span class="op">=</span> disp_df[<span class="st">'std_fcst'</span>]</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> disp_df[disp_df[<span class="st">'n_analysts'</span>] <span class="op">&gt;=</span> min_analysts].copy()</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DISP: </span><span class="sc">{</span><span class="bu">len</span>(out)<span class="sc">:,}</span><span class="ss"> ticker-months (&gt;= </span><span class="sc">{</span>min_analysts<span class="sc">}</span><span class="ss"> analysts)"</span>)</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean analysts: </span><span class="sc">{</span>out[<span class="st">'n_analysts'</span>]<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="scaling-considerations" class="level2" data-number="24.4">
<h2 data-number="24.4" class="anchored" data-anchor-id="scaling-considerations"><span class="header-section-number">24.4</span> Scaling Considerations</h2>
<p>Following <span class="citation" data-cites="cheong2011eps">Cheong and Thomas (<a href="references.html#ref-cheong2011eps" role="doc-biblioref">2011</a>)</span>, we note that each scaling choice has pitfalls. DISP1 (scaled by absolute mean forecast) can produce extreme values when the mean forecast approaches zero—common for Vietnamese firms near breakeven. DISP2 (scaled by price) introduces a mechanical negative correlation between price and scaled dispersion. We recommend reporting all three versions (DISP1, DISP2, and unscaled DISP_RAW with <span class="math inline">\(\ln(\text{Price})\)</span> as an additional control), and winsorizing DISP1 at the 1st and 99th percentiles.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Caution on Analyst Dispersion in Thin-Coverage Markets
</div>
</div>
<div class="callout-body-container callout-body">
<p>With typical coverage of 5–10 analysts per firm in Vietnam (versus 15–25 in the U.S.), forecast dispersion is estimated with substantially greater noise. A dispersion measure from 3 analysts has a very different sampling distribution than one from 20. Always include the number of analysts as a control and test robustness with varying minimum-analyst thresholds (3, 5, 7).</p>
</div>
</div>
</section>
</section>
<section id="sec-correlation" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> Cross-Sectional Correlations Among DIVOP Proxies</h1>
<p>An important empirical question is the degree to which the various DIVOP proxies capture the same underlying construct. If divergence of opinion is a well-defined latent variable, we expect positive correlations among all proxies, though correlations need not be high since each captures a different facet of disagreement.</p>
<div id="correlation-analysis" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_divop_correlations(merged_df, proxies<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute and visualize Spearman correlations among DIVOP proxies.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    We use rank correlations because many proxies are right-skewed.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> proxies <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        proxies <span class="op">=</span> [</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'dto'</span>, <span class="st">'suv'</span>, <span class="st">'total_volatility'</span>, <span class="st">'idio_volatility'</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'baspread'</span>, <span class="st">'amihud_daily'</span>, <span class="st">'disp1'</span>, <span class="st">'disp2'</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    available <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> merged_df[available].dropna()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(available)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    rho_mat <span class="op">=</span> np.eye(n)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    p_mat <span class="op">=</span> np.zeros((n, n))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, n):</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            rho, p <span class="op">=</span> scipy_stats.spearmanr(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                data[available[i]], data[available[j]]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            rho_mat[i, j] <span class="op">=</span> rho_mat[j, i] <span class="op">=</span> rho</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            p_mat[i, j] <span class="op">=</span> p_mat[j, i] <span class="op">=</span> p</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {<span class="st">'dto'</span>: <span class="st">'DTO'</span>, <span class="st">'suv'</span>: <span class="st">'SUV'</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">'total_volatility'</span>: <span class="st">'VOL'</span>, <span class="st">'idio_volatility'</span>: <span class="st">'IVOL'</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">'baspread'</span>: <span class="st">'SPREAD'</span>, <span class="st">'amihud_daily'</span>: <span class="st">'ILLIQ'</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>              <span class="st">'disp1'</span>: <span class="st">'DISP1'</span>, <span class="st">'disp2'</span>: <span class="st">'DISP2'</span>}</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    pretty <span class="op">=</span> [labels.get(c, c) <span class="cf">for</span> c <span class="kw">in</span> available]</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    corr_df <span class="op">=</span> pd.DataFrame(rho_mat, index<span class="op">=</span>pretty, columns<span class="op">=</span>pretty)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones_like(corr_df, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        corr_df, mask<span class="op">=</span>mask, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.3f'</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, center<span class="op">=</span><span class="dv">0</span>, vmin<span class="op">=-</span><span class="fl">0.4</span>, vmax<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        cbar_kws<span class="op">=</span>{<span class="st">'shrink'</span>: <span class="fl">0.8</span>, <span class="st">'label'</span>: <span class="st">'Spearman ρ'</span>}, ax<span class="op">=</span>ax</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Spearman Correlations Among DIVOP Proxies</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Vietnamese Equity Market'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'divop_correlations.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="expected-correlation-patterns" class="level3" data-number="25.0.1">
<h3 data-number="25.0.1" class="anchored" data-anchor-id="expected-correlation-patterns"><span class="header-section-number">25.0.1</span> Expected Correlation Patterns</h3>
<p>Based on U.S. evidence and theory, we expect:</p>
<div id="tbl-expected-corr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-expected-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;25.1: Expected correlation structure among DIVOP proxies
</figcaption>
<div aria-describedby="tbl-expected-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Pair</th>
<th style="text-align: left;">Expected</th>
<th style="text-align: left;">Rationale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DTO × SUV</td>
<td style="text-align: left;">High positive</td>
<td style="text-align: left;">Both capture abnormal volume; SUV refines DTO</td>
</tr>
<tr class="even">
<td style="text-align: left;">VOL × IVOL</td>
<td style="text-align: left;">High positive</td>
<td style="text-align: left;">IVOL is a subset of total volatility</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPREAD × ILLIQ</td>
<td style="text-align: left;">Moderate-high positive</td>
<td style="text-align: left;">Both capture information asymmetry</td>
</tr>
<tr class="even">
<td style="text-align: left;">Volume × Volatility</td>
<td style="text-align: left;">Moderate positive</td>
<td style="text-align: left;"><span class="citation" data-cites="shalen1993volume">Shalen (<a href="references.html#ref-shalen1993volume" role="doc-biblioref">1993</a>)</span> links both to belief dispersion</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Analyst × Market-based</td>
<td style="text-align: left;">Weak-moderate positive</td>
<td style="text-align: left;">Different investor populations</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="sec-empirical" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> Descriptive Statistics and Cross-Sectional Properties</h1>
<section id="summary-statistics" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="summary-statistics"><span class="header-section-number">26.1</span> Summary Statistics</h2>
<div id="descriptive-stats" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> descriptive_statistics(merged_df):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive descriptive statistics for DIVOP proxies."""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dto'</span>: <span class="st">'Unexplained Volume (DTO)'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'suv'</span>: <span class="st">'Std Unexplained Volume (SUV)'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_volatility'</span>: <span class="st">'Total Return Volatility'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'idio_volatility'</span>: <span class="st">'Idiosyncratic Volatility'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'baspread'</span>: <span class="st">'Bid-Ask Spread'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'amihud_daily'</span>: <span class="st">'Amihud Illiquidity'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'disp1'</span>: <span class="st">'Analyst Disp (mean-scaled)'</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'disp2'</span>: <span class="st">'Analyst Disp (price-scaled)'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> proxies.items() <span class="cf">if</span> k <span class="kw">in</span> merged_df.columns}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col, label <span class="kw">in</span> avail.items():</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> merged_df[col].dropna()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        rows.append({</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Proxy'</span>: label, <span class="st">'N'</span>: <span class="ss">f'</span><span class="sc">{</span><span class="bu">len</span>(s)<span class="sc">:,}</span><span class="ss">'</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mean'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">'</span>, <span class="st">'Std'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>std()<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'P5'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>quantile(<span class="fl">.05</span>)<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Median'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>median()<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'P95'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>quantile(<span class="fl">.95</span>)<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Skew'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>skew()<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kurt'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>kurtosis()<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> pd.DataFrame(rows).set_index(<span class="st">'Proxy'</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Descriptive Statistics of DIVOP Proxies"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Vietnamese Equity Market, HOSE and HNX"</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(stats.to_string())</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="divop-by-firm-characteristics" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="divop-by-firm-characteristics"><span class="header-section-number">26.2</span> DIVOP by Firm Characteristics</h2>
<div id="by-characteristics" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_by_size(merged_df):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Mean DIVOP proxies by market-cap quintile."""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mkt_cap'</span>] <span class="op">=</span> df[<span class="st">'close'</span>] <span class="op">*</span> df[<span class="st">'shares_outstanding'</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'size_q'</span>] <span class="op">=</span> df.groupby(<span class="st">'date'</span>)[<span class="st">'mkt_cap'</span>].transform(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: pd.qcut(x, <span class="dv">5</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            labels<span class="op">=</span>[<span class="st">'Q1 Small'</span>,<span class="st">'Q2'</span>,<span class="st">'Q3'</span>,<span class="st">'Q4'</span>,<span class="st">'Q5 Large'</span>],</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>            duplicates<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> df.columns]</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> df.groupby(<span class="st">'size_q'</span>)[avail].mean()</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Mean DIVOP by Size Quintile ==="</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tab.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tab</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_by_exchange(merged_df):</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compare mean DIVOP across HOSE and HNX."""</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> merged_df.groupby(<span class="st">'exchange'</span>)[avail].mean()</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Mean DIVOP by Exchange ==="</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tab.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tab</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="time-series-evolution" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="time-series-evolution"><span class="header-section-number">26.3</span> Time-Series Evolution</h2>
<div id="time-series-plot" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_divop_timeseries(merged_df):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Plot monthly cross-sectional median DIVOP with crisis shading."""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'baspread'</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> df.columns]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    monthly <span class="op">=</span> df.groupby(<span class="st">'ym'</span>)[avail].median()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    monthly.index <span class="op">=</span> monthly.index.to_timestamp()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="bu">len</span>(avail), <span class="dv">1</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="fl">3.5</span><span class="op">*</span><span class="bu">len</span>(avail)), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(avail) <span class="op">==</span> <span class="dv">1</span>: axes <span class="op">=</span> [axes]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {<span class="st">'dto'</span>:<span class="st">'DTO'</span>,<span class="st">'suv'</span>:<span class="st">'SUV'</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">'total_volatility'</span>:<span class="st">'Volatility'</span>,<span class="st">'baspread'</span>:<span class="st">'Spread'</span>}</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#1976D2'</span>,<span class="st">'#388E3C'</span>,<span class="st">'#F57C00'</span>,<span class="st">'#D32F2F'</span>]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (proxy, ax) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(avail, axes)):</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        ax.plot(monthly.index, monthly[proxy],</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>colors[i], linewidth<span class="op">=</span><span class="fl">1.3</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(labels.get(proxy, proxy), fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s, e, c <span class="kw">in</span> [(<span class="st">'2008-01'</span>,<span class="st">'2009-06'</span>,<span class="st">'red'</span>),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">'2020-01'</span>,<span class="st">'2020-12'</span>,<span class="st">'orange'</span>),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">'2022-09'</span>,<span class="st">'2023-06'</span>,<span class="st">'purple'</span>)]:</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>            ax.axvspan(pd.Timestamp(s), pd.Timestamp(e),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span>c)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Time-Series of DIVOP Proxies</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Monthly Cross-Sectional Median, HOSE &amp; HNX'</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    axes[<span class="op">-</span><span class="dv">1</span>].legend(handles<span class="op">=</span>[</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'GFC 2008-09'</span>),</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'orange'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'COVID-19'</span>),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'purple'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'Bond Crisis 2022-23'</span>),</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    ], loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'divop_timeseries.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-pipeline" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> Putting It All Together</h1>
<div id="merge-all" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_divop_dataset(config):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Master pipeline: load data, construct all DIVOP proxies,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    merge into a single stock-date panel.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_daily_data(config)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> apply_sample_filters(df, config)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> adjust_for_corporate_actions(df)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> build_trading_calendar(df, config)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> compute_dto(df, config)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    suv_df <span class="op">=</span> compute_suv(df, calendar, config)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    vol_df <span class="op">=</span> compute_volatility(df, calendar, config)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> compute_spread_and_illiq(df, config)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'ret'</span>,<span class="st">'close'</span>,<span class="st">'volume'</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">'shares_outstanding'</span>,<span class="st">'exchange'</span>,<span class="st">'industry_icb'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'foreign_ownership_pct'</span>,<span class="st">'turnover'</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'mato'</span>,<span class="st">'dto'</span>,<span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>,<span class="st">'limit_hit'</span>]].copy()</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> suv_df.empty:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> base.merge(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            suv_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'suv'</span>,<span class="st">'predicted_turnover'</span>]],</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'date'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> vol_df.empty:</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> base.merge(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>            vol_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'total_volatility'</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'idio_volatility'</span>,<span class="st">'market_beta'</span>]],</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'date'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Final DIVOP Dataset ==="</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Shape: </span><span class="sc">{</span>base<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tickers: </span><span class="sc">{</span>base[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-applications" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> Empirical Applications</h1>
<section id="application-1-divop-and-the-cross-section-of-returns" class="level2" data-number="28.1">
<h2 data-number="28.1" class="anchored" data-anchor-id="application-1-divop-and-the-cross-section-of-returns"><span class="header-section-number">28.1</span> Application 1: DIVOP and the Cross-Section of Returns</h2>
<p>The fundamental test of the Miller hypothesis is whether stocks with higher divergence of opinion earn lower subsequent returns. We implement Fama-MacBeth cross-sectional regressions:</p>
<p><span class="math display">\[
r_{i,t+1:t+h} = \gamma_{0,t} + \gamma_{1,t} \cdot \text{DIVOP}_{i,t} + \gamma_{2,t}' \mathbf{X}_{i,t} + \varepsilon_{i,t}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}_{i,t}\)</span> includes controls for market beta, log market capitalization, and log book-to-market ratio. The Miller hypothesis predicts <span class="math inline">\(\bar{\gamma}_1 &lt; 0\)</span>.</p>
<div id="fama-macbeth" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fama_macbeth_divop(merged_df, divop_proxy<span class="op">=</span><span class="st">'suv'</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                        controls<span class="op">=</span><span class="va">None</span>, horizon<span class="op">=</span><span class="dv">21</span>):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Fama-MacBeth cross-sectional regressions.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Miller predicts gamma_1 &lt; 0; Varian predicts gamma_1 &gt; 0.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> controls <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        controls <span class="op">=</span> [<span class="st">'market_beta'</span>, <span class="st">'log_mktcap'</span>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'fwd_ret'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'ret'</span>].transform(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.shift(<span class="op">-</span><span class="dv">1</span>).rolling(horizon).<span class="bu">sum</span>().shift(<span class="op">-</span>(horizon<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_mktcap'</span>] <span class="op">=</span> np.log(</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'close'</span>] <span class="op">*</span> df[<span class="st">'shares_outstanding'</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    reg_vars <span class="op">=</span> [<span class="st">'fwd_ret'</span>, divop_proxy] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>               [c <span class="cf">for</span> c <span class="kw">in</span> controls <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    df_reg <span class="op">=</span> df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>] <span class="op">+</span> reg_vars].dropna()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> numpy.linalg <span class="im">import</span> lstsq</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> date, cross <span class="kw">in</span> df_reg.groupby(<span class="st">'date'</span>):</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(cross) <span class="op">&lt;</span> <span class="dv">30</span>: <span class="cf">continue</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> cross[<span class="st">'fwd_ret'</span>].values</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        X_cols <span class="op">=</span> [divop_proxy] <span class="op">+</span> [c <span class="cf">for</span> c <span class="kw">in</span> controls <span class="cf">if</span> c <span class="kw">in</span> cross.columns]</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.column_stack([np.ones(<span class="bu">len</span>(cross)), cross[X_cols].values])</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            coefs, _, _, _ <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">'date'</span>: date, <span class="st">'intercept'</span>: coefs[<span class="dv">0</span>],</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'gamma_</span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss">'</span>: coefs[<span class="dv">1</span>], <span class="st">'n'</span>: <span class="bu">len</span>(cross),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>: <span class="cf">continue</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    fm <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    gc <span class="op">=</span> <span class="ss">f'gamma_</span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> fm[gc].mean()</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    se <span class="op">=</span> fm[gc].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(fm))</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> mu <span class="op">/</span> se</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Fama-MacBeth: </span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss"> -&gt; "</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>horizon<span class="sc">}</span><span class="ss">-day fwd returns ==="</span>)</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean gamma: </span><span class="sc">{</span>mu<span class="sc">:.6f}</span><span class="ss">, t-stat: </span><span class="sc">{</span>t<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.96</span>:   <span class="bu">print</span>(<span class="st">"  -&gt; Supports Miller (1977)"</span>)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> t <span class="op">&gt;</span> <span class="fl">1.96</span>:   <span class="bu">print</span>(<span class="st">"  -&gt; Supports Varian (1985)"</span>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:            <span class="bu">print</span>(<span class="st">"  -&gt; Inconclusive at 5%"</span>)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="application-2-divop-and-earnings-announcements" class="level2" data-number="28.2">
<h2 data-number="28.2" class="anchored" data-anchor-id="application-2-divop-and-earnings-announcements"><span class="header-section-number">28.2</span> Application 2: DIVOP and Earnings Announcements</h2>
<p>Following <span class="citation" data-cites="berkman2009sell">Berkman et al. (<a href="references.html#ref-berkman2009sell" role="doc-biblioref">2009</a>)</span>, we test whether high-DIVOP stocks experience negative abnormal returns around earnings announcements, as uncertainty resolution reduces the optimism premium.</p>
<div id="ea-event" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_earnings_event(merged_df, ea_dates_df,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                          divop_proxy<span class="op">=</span><span class="st">'suv'</span>, window<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Sort stocks into DIVOP quintiles pre-EA, compute CAR in window.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Miller predicts: Q5 (high DIVOP) has lower CAR than Q1 (low DIVOP).</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    ea <span class="op">=</span> ea_dates_df.copy()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-EA DIVOP value (5 days before)</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    ea[<span class="st">'pre_date'</span>] <span class="op">=</span> ea[<span class="st">'ea_date'</span>] <span class="op">-</span> pd.Timedelta(days<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    ea <span class="op">=</span> ea.merge(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,divop_proxy]].rename(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>{<span class="st">'date'</span>:<span class="st">'pre_date'</span>}),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'pre_date'</span>], how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    ea[<span class="st">'divop_q'</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        ea[divop_proxy], <span class="dv">5</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">'Q1 Low'</span>,<span class="st">'Q2'</span>,<span class="st">'Q3'</span>,<span class="st">'Q4'</span>,<span class="st">'Q5 High'</span>],</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        duplicates<span class="op">=</span><span class="st">'drop'</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== EA Event Study by </span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss"> quintile ==="</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Window: (</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">) days"</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Miller predicts: Q5 has lower CAR than Q1"</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ea</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="application-3-composite-divop-index-via-pca" class="level2" data-number="28.3">
<h2 data-number="28.3" class="anchored" data-anchor-id="application-3-composite-divop-index-via-pca"><span class="header-section-number">28.3</span> Application 3: Composite DIVOP Index via PCA</h2>
<p>When a single summary measure of disagreement is needed, PCA on the battery of standardized proxies extracts the common “disagreement factor.”</p>
<div id="pca-composite" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> composite_divop_pca(merged_df, proxies<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extract first principal component from standardized DIVOP proxies."""</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> proxies <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> merged_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>] <span class="op">+</span> avail].dropna()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> scaler.fit_transform(data[avail])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    factors <span class="op">=</span> pca.fit_transform(X)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'divop_composite'</span>] <span class="op">=</span> factors[:, <span class="dv">0</span>]</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure positive correlation with inputs</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> avail:</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[<span class="st">'divop_composite'</span>].corr(data[col]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">'divop_composite'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    loadings <span class="op">=</span> pd.DataFrame(</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        pca.components_.T, index<span class="op">=</span>avail,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="st">'PC1'</span>,<span class="st">'PC2'</span>,<span class="st">'PC3'</span>]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== PCA Composite DIVOP ==="</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Variance explained: "</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>pca<span class="sc">.</span>explained_variance_ratio_[:<span class="dv">3</span>]<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Loadings:</span><span class="ch">\n</span><span class="sc">{</span>loadings<span class="sc">.</span>to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'divop_composite'</span>]], loadings</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="conclusion-and-practical-recommendations" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> Conclusion and Practical Recommendations</h1>
<p>This chapter has provided a comprehensive methodology for constructing seven distinct proxies for divergence of investor opinion adapted to the Vietnamese equity market. We conclude with practical recommendations:</p>
<p><strong>1. Prefer multiple proxies.</strong> No single DIVOP measure is without limitations. We recommend constructing and reporting results for at least three proxies spanning different economic channels (volume, volatility, spreads or analyst-based).</p>
<p><strong>2. Account for Vietnam-specific microstructure.</strong> Daily price limits, T+2 settlement, foreign ownership constraints, and the order-driven market structure all affect DIVOP properties. Flag limit-hit days, include exchange fixed effects, and control for foreign ownership.</p>
<p><strong>3. Vietnam as a natural laboratory for Miller (1977).</strong> The absence of short selling through 2024 and the dominance of retail investors create conditions that closely match Miller’s theoretical setting. The introduction of short selling in 2025 creates a natural experiment for examining how relaxation of short-sale constraints affects the DIVOP-return relation.</p>
<p><strong>4. Control for analyst coverage when using DISP measures.</strong> With typical coverage of 5–10 analysts per firm, forecast dispersion is estimated with greater noise than in developed markets. Always include the number of analysts as a control variable and conduct robustness checks with varying minimum-analyst thresholds.</p>
<p><strong>5. Consider constructing a composite index.</strong> When researchers need a single summary measure of disagreement, the PCA-based composite index described in <a href="#sec-applications" class="quarto-xref"><span>Chapter 28</span></a> provides a principled approach to aggregating information across the individual proxies. The first principal component typically explains 30-50% of the common variation in the battery of DIVOP measures.</p>
<p><strong>6. Winsorize aggressively.</strong> Several DIVOP proxies (particularly DISP1, Amihud ILLIQ, and SUV) exhibit extreme outliers in the Vietnamese data. Winsorization at the 1st and 99th percentiles (or even 2nd and 98th for DISP1) is essential for obtaining reliable regression results.</p>
<p><strong>7. Be cautious about causal inference.</strong> DIVOP proxies are endogenous, they respond to the same firm characteristics (size, leverage, growth) that also affect returns. Researchers should use appropriate controls, consider instrumental variables where feasible, and be explicit about the limitations of their identification strategy.</p>
<p>The DIVOP framework is particularly relevant for the Vietnamese market at this point in its development. As the market matures toward potential FTSE Emerging Market reclassification, as short selling becomes more widely available, and as institutional investor participation grows, the dynamics of opinion divergence and its pricing implications are likely to evolve significantly. The methodology presented in this chapter provides researchers with the tools to document and analyze these changes as they unfold.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-abarbanell1995analysts" class="csl-entry" role="listitem">
Abarbanell, Jeffery S, William N Lanen, and Robert E Verrecchia. 1995. <span>“Analysts’ Forecasts as Proxies for Investor Beliefs in Empirical Research.”</span> <em>Journal of Accounting and Economics</em> 20 (1): 31–60.
</div>
<div id="ref-alexandridis2007divergence" class="csl-entry" role="listitem">
Alexandridis, George, Antonios Antoniou, and Dimitris Petmezas. 2007. <span>“Divergence of Opinion and Post-Acquisition Performance.”</span> <em>Journal of Business Finance &amp; Accounting</em> 34 (3-4): 439–60.
</div>
<div id="ref-amihud2002illiquidity" class="csl-entry" role="listitem">
Amihud, Yakov. 2002. <span>“Illiquidity and Stock Returns: Cross-Section and Time-Series Effects.”</span> <em>Journal of Financial Markets</em> 5 (1): 31–56.
</div>
<div id="ref-anderson2005market" class="csl-entry" role="listitem">
Anderson, Anne-Marie, and Edward A Dyl. 2005. <span>“Market Structure and Trading Volume.”</span> <em>Journal of Financial Research</em> 28 (1): 115–31.
</div>
<div id="ref-anderson2007opinion" class="csl-entry" role="listitem">
Anderson, Kirsten L, Jeffrey H Harris, and Eric C So. 2007. <span>“Opinion Divergence and Post-Earnings Announcement Drift.”</span> <em>Available at SSRN 969736</em>.
</div>
<div id="ref-berkman2009sell" class="csl-entry" role="listitem">
Berkman, Henk, Valentin Dimitrov, Prem C Jain, Paul D Koch, and Sheri Tice. 2009. <span>“Sell on the News: Differences of Opinion, Short-Sales Constraints, and Returns Around Earnings Announcements.”</span> <em>Journal of Financial Economics</em> 92 (3): 376–99.
</div>
<div id="ref-boehme2006short" class="csl-entry" role="listitem">
Boehme, Rodney D, Bartley R Danielsen, and Sorin M Sorescu. 2006. <span>“Short-Sale Constraints, Differences of Opinion, and Overvaluation.”</span> <em>Journal of Financial and Quantitative Analysis</em> 41 (2): 455–87.
</div>
<div id="ref-chatterjee2012takeovers" class="csl-entry" role="listitem">
Chatterjee, Sris, Kose John, and An Yan. 2012. <span>“Takeovers and Divergence of Investor Opinion.”</span> <em>The Review of Financial Studies</em> 25 (1): 227–77.
</div>
<div id="ref-cheong2011eps" class="csl-entry" role="listitem">
Cheong, Foong Soon, and Jacob Thomas. 2011. <span>“Why Do EPS Forecast Error and Dispersion Not Vary with Scale? Implications for Analyst and Managerial Behavior.”</span> <em>Journal of Accounting Research</em> 49 (2): 359–401.
</div>
<div id="ref-chung2014simple" class="csl-entry" role="listitem">
Chung, Kee H, and Hao Zhang. 2014. <span>“A Simple Approximation of Intraday Spreads Using Daily Data.”</span> <em>Journal of Financial Markets</em> 17: 94–120.
</div>
<div id="ref-diether2002differences" class="csl-entry" role="listitem">
Diether, Karl B, Christopher J Malloy, and Anna Scherbina. 2002. <span>“Differences of Opinion and the Cross Section of Stock Returns.”</span> <em>The Journal of Finance</em> 57 (5): 2113–41.
</div>
<div id="ref-dimson1979risk" class="csl-entry" role="listitem">
Dimson, Elroy. 1979. <span>“Risk Measurement When Shares Are Subject to Infrequent Trading.”</span> <em>Journal of Financial Economics</em> 7 (2): 197–226.
</div>
<div id="ref-doukas2006divergence" class="csl-entry" role="listitem">
Doukas, John A, Chansog Francis Kim, and Christos Pantzalis. 2006. <span>“Divergence of Opinion and Equity Returns.”</span> <em>Journal of Financial and Quantitative Analysis</em> 41 (3): 573–606.
</div>
<div id="ref-doukas2004divergent" class="csl-entry" role="listitem">
Doukas, John A, Chansog Kim, and Christos Pantzalis. 2004. <span>“Divergent Opinions and the Performance of Value Stocks.”</span> <em>Financial Analysts Journal</em> 60 (6): 55–64.
</div>
<div id="ref-fama1993common" class="csl-entry" role="listitem">
Fama, Eugene F., and Kenneth R. French. 1993. <span>“<span class="nocase">Common risk factors in the returns on stocks and bonds</span>.”</span> <em><span>Journal of Financial Economics</span></em> 33 (1): 3–56. <a href="https://doi.org/10.1016/0304-405X(93)90023-5">https://doi.org/10.1016/0304-405X(93)90023-5</a>.
</div>
<div id="ref-garfinkel2009measuring" class="csl-entry" role="listitem">
Garfinkel, Jon A. 2009. <span>“Measuring Investors’ Opinion Divergence.”</span> <em>Journal of Accounting Research</em> 47 (5): 1317–48.
</div>
<div id="ref-garfinkel2006volume" class="csl-entry" role="listitem">
Garfinkel, Jon A, and Jonathan Sokobin. 2006. <span>“Volume, Opinion Divergence, and Returns: A Study of Post–Earnings Announcement Drift.”</span> <em>Journal of Accounting Research</em> 44 (1): 85–112.
</div>
<div id="ref-handa2003quote" class="csl-entry" role="listitem">
Handa, Puneet, Robert Schwartz, and Ashish Tiwari. 2003. <span>“Quote Setting and Price Formation in an Order Driven Market.”</span> <em>Journal of Financial Markets</em> 6 (4): 461–89.
</div>
<div id="ref-harris1993differences" class="csl-entry" role="listitem">
Harris, Milton, and Artur Raviv. 1993. <span>“Differences of Opinion Make a Horse Race.”</span> <em>The Review of Financial Studies</em> 6 (3): 473–506.
</div>
<div id="ref-hong2003differences" class="csl-entry" role="listitem">
Hong, Harrison, and Jeremy C Stein. 2003. <span>“Differences of Opinion, Short-Sales Constraints, and Market Crashes.”</span> <em>The Review of Financial Studies</em> 16 (2): 487–525.
</div>
<div id="ref-houge2001divergence" class="csl-entry" role="listitem">
Houge, Todd, Tim Loughran, Gerry Suchanek, and Xuemin Yan. 2001. <span>“Divergence of Opinion, Uncertainty, and the Quality of Initial Public Offerings.”</span> <em>Financial Management</em>, 5–23.
</div>
<div id="ref-kandel1995differential" class="csl-entry" role="listitem">
Kandel, Eugene, and Neil D Pearson. 1995. <span>“Differential Interpretation of Public Signals and Trade in Speculative Markets.”</span> <em>Journal of Political Economy</em> 103 (4): 831–72.
</div>
<div id="ref-milgrom1982information" class="csl-entry" role="listitem">
Milgrom, Paul, and Nancy Stokey. 1982. <span>“Information, Trade and Common Knowledge.”</span> <em>Journal of Economic Theory</em> 26 (1): 17–27.
</div>
<div id="ref-miller1977risk" class="csl-entry" role="listitem">
Miller, Edward M. 1977. <span>“Risk, Uncertainty, and Divergence of Opinion.”</span> <em>The Journal of Finance</em> 32 (4): 1151–68.
</div>
<div id="ref-nguyen2018search" class="csl-entry" role="listitem">
Nguyen, Du D, and Minh C Pham. 2018. <span>“Search-Based Sentiment and Stock Market Reactions: An Empirical Evidence in Vietnam.”</span> <em>The Journal of Asian Finance, Economics and Business</em> 5 (4): 45–56.
</div>
<div id="ref-phan2023role" class="csl-entry" role="listitem">
Phan, Thi Nha Truc, Philippe Bertrand, Hong Hai Phan, and Xuan Vinh Vo. 2023. <span>“The Role of Investor Behavior in Emerging Stock Markets: Evidence from Vietnam.”</span> <em>The Quarterly Review of Economics and Finance</em> 87: 367–76.
</div>
<div id="ref-scheinkman2003overconfidence" class="csl-entry" role="listitem">
Scheinkman, Jose A, and Wei Xiong. 2003. <span>“Overconfidence and Speculative Bubbles.”</span> <em>Journal of Political Economy</em> 111 (6): 1183–1220.
</div>
<div id="ref-shalen1993volume" class="csl-entry" role="listitem">
Shalen, Catherine T. 1993. <span>“Volume, Volatility, and the Dispersion of Beliefs.”</span> <em>The Review of Financial Studies</em> 6 (2): 405–34.
</div>
<div id="ref-varian1985divergence" class="csl-entry" role="listitem">
Varian, Hal R. 1985. <span>“Divergence of Opinion in Complete Markets: A Note.”</span> <em>The Journal of Finance</em> 40 (1): 309–17.
</div>
<div id="ref-vo2015foreign" class="csl-entry" role="listitem">
Vo, Xuan Vinh. 2015. <span>“Foreign Ownership and Stock Return Volatility–Evidence from Vietnam.”</span> <em>Journal of Multinational Financial Management</em> 30: 101–9.
</div>
<div id="ref-vo2017foreign" class="csl-entry" role="listitem">
———. 2017. <span>“Do Foreign Investors Improve Stock Price Informativeness in Emerging Equity Markets? Evidence from Vietnam.”</span> <em>Research in International Business and Finance</em> 42: 986–91.
</div>
<div id="ref-vo2017further" class="csl-entry" role="listitem">
Vo, Xuan Vinh, and Dang Bao Anh Phan. 2017. <span>“Further Evidence on the Herd Behavior in Vietnam Stock Market.”</span> <em>Journal of Behavioral and Experimental Finance</em> 13: 33–41.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "© " + year;
});
</script>
<script>
(function () {
  const GA_ID = "G-LMDLDJXXSC";   // your real GA4 ID
  const CONSENT_KEY = "cookie_consent_v1";

  function log(msg) {
    console.log("[GA Loader]", msg);
  }

  function loadGtag() {
    if (window.__gtag_loaded__) {
      log("GA already loaded, skipping");
      return;
    }

    log("Loading Google Analytics...");

    window.__gtag_loaded__ = true;

    const script = document.createElement("script");
    script.async = true;
    script.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(GA_ID);

    script.onload = function () {
      log("gtag.js loaded");

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;

      gtag("js", new Date());
      gtag("config", GA_ID, {
        anonymize_ip: true,
        transport_type: "beacon"
      });

      log("GA initialized successfully");
    };

    script.onerror = function () {
      log("FAILED to load gtag.js. Likely blocked by ad blocker or network.");
    };

    document.head.appendChild(script);
  }

  function checkConsentAndLoad() {
    const consent = localStorage.getItem(CONSENT_KEY);
    log("Stored consent value = " + consent);

    if (consent === "accepted") {
      loadGtag();
    } else {
      log("Analytics blocked due to missing or declined consent");
    }
  }

  // Run on page load
  checkConsentAndLoad();

  // Listen for cookie banner decisions
  window.addEventListener("cookie-consent-changed", function (e) {
    log("Consent event received: " + e.detail);
    if (e.detail === "accepted") {
      loadGtag();
    }
  });

})();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/mikenguyen13\/tidy_finance_vn");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./19_pe_ratio.html" class="pagination-link" aria-label="P/E Ratio">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./50_conclusion.html" class="pagination-link" aria-label="Conclusion">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Conclusion</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Measuring Divergence of Investor Opinion</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>A foundational question in financial economics concerns how differences in investor beliefs affect asset prices and trading activity. In markets where investors hold heterogeneous expectations about a firm's future cash flows, the aggregation of these divergent views into a single market price becomes a non-trivial exercise with profound implications for asset valuation, return predictability, and market efficiency. The concept of **divergence of investor opinion** (hereafter DIVOP) has emerged as a central construct in both the accounting and finance literatures, serving as a lens through which researchers examine the information environment of firms, the dynamics of uncertainty resolution, and the nature of market reactions to news.</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>The theoretical foundations of the DIVOP literature trace back to @miller1977risk, who proposed that when investors disagree about the value of a security and short-sale constraints prevent pessimistic investors from fully expressing their views, the market price will reflect the valuation of the most optimistic investors. This leads to systematic overpricing that is increasing in the degree of opinion divergence. The overpricing persists until information events, such as earnings announcements, reduce disagreement and prices converge toward fundamental values <span class="co">[</span><span class="ot">@berkman2009sell</span><span class="co">]</span>. @varian1985divergence offers an alternative perspective in which divergence of opinion represents an additional risk factor, leading to *higher* rather than lower expected returns, creating a theoretical tension that has motivated extensive empirical investigation.</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>The empirical literature on DIVOP has expanded considerably since these seminal contributions. Researchers have documented that divergence of opinion helps explain a range of asset pricing anomalies, including post-earnings announcement drift <span class="co">[</span><span class="ot">@garfinkel2006volume; @anderson2007opinion</span><span class="co">]</span>, the cross-sectional return difference between value and growth stocks <span class="co">[</span><span class="ot">@doukas2004divergent</span><span class="co">]</span>, short- and long-run post-IPO returns <span class="co">[</span><span class="ot">@houge2001divergence</span><span class="co">]</span>, pre- and post-acquisition stock returns <span class="co">[</span><span class="ot">@alexandridis2007divergence</span><span class="co">]</span>, takeover premia <span class="co">[</span><span class="ot">@chatterjee2012takeovers</span><span class="co">]</span>, and the broad cross-section of stock returns <span class="co">[</span><span class="ot">@diether2002differences; @doukas2006divergence</span><span class="co">]</span>. The explanatory power of DIVOP has been demonstrated using a rich set of empirical proxies, ranging from analyst forecast dispersion and abnormal trading volume to bid-ask spreads and idiosyncratic volatility.</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>Despite the maturity of the DIVOP literature in developed markets, particularly the United States, its application to emerging markets remains remarkably thin. This gap is especially notable given that the theoretical conditions under which divergence of opinion matters most (namely, binding short-sale constraints, information asymmetry, and heterogeneous investor sophistication) are arguably *more* prevalent in emerging markets than in their developed counterparts. The Vietnamese equity market presents a compelling laboratory for studying investor disagreement. The market is characterized by several features that amplify the relevance of the DIVOP framework:</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Binding short-sale constraints.** Short selling was not permitted in Vietnam until January 2025, and even after its introduction, the mechanism remains restricted to a limited set of securities with significant regulatory constraints on execution. This closely mirrors the theoretical setting of @miller1977risk where pessimistic investors are unable to fully express their views through short positions.</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Dominance of retail investors.** Individual investors account for approximately 80-85% of daily trading volume on HOSE and HNX, compared to roughly 25% in the United States. Retail investors are more susceptible to behavioral biases, sentiment-driven trading, and information processing limitations that naturally give rise to heterogeneous beliefs <span class="co">[</span><span class="ot">@phan2023role</span><span class="co">]</span>.</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Information asymmetry and transparency challenges.** Despite improvements in disclosure standards, Vietnam's regulatory framework for corporate reporting remains less stringent than those in developed markets. Selective disclosure, delayed filing of financial statements, and limited enforcement of insider trading regulations create an environment in which investors operate with substantially different information sets <span class="co">[</span><span class="ot">@vo2017further</span><span class="co">]</span>.</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Foreign ownership limits.** Caps on foreign ownership (currently 49% for most sectors, with exceptions) create a segmented market where domestic and foreign investors may hold systematically different views about firm value, amplifying the divergence of opinion.</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Thin analyst coverage.** Whereas a typical S&amp;P 500 firm is followed by 15-25 sell-side analysts, coverage of Vietnamese equities is concentrated among a relatively small number of domestic brokerages and a handful of international research houses. This limits the informativeness of traditional analyst-based DIVOP measures and necessitates greater reliance on market-based proxies.</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>This chapter provides a methodology for constructing multiple proxies for divergence of investor opinion adapted to the institutional characteristics of the Vietnamese market. We draw on the methodological frameworks established by @garfinkel2009measuring and @diether2002differences, while introducing modifications that account for the microstructure of Vietnamese exchanges, the $T+2$ settlement cycle, the absence (until recently) of short selling, and the availability of data through domestic financial platforms. Specifically, we construct and analyze the following DIVOP proxies:</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Unexplained Volume (DTO):** Market-adjusted turnover detrended by its rolling median, capturing abnormal trading activity attributable to disagreement after controlling for liquidity and market-wide effects.</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Standardized Unexplained Volume (SUV):** A regression-based measure that explicitly controls for the informedness and liquidity components of volume by modeling turnover as a function of signed returns.</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Stock Return Volatility (VOLATILITY):** The standard deviation of daily returns over a rolling estimation window, serving as a proxy for the dispersion of investor valuations.</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Bid-Ask Spread (BASPREAD):** The proportional quoted spread, reflecting the adverse selection component associated with heterogeneous information among market participants.</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Analyst Forecast Dispersion (DISP):** The cross-sectional standard deviation of individual analyst earnings forecasts, directly measuring disagreement among informed market participants.</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Idiosyncratic Volatility (IVOL):** The residual volatility from a factor model regression, isolating the firm-specific component of return variation that reflects divergent investor interpretations of firm-level information.</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Amihud Illiquidity (ILLIQ):** The price impact ratio proposed by @amihud2002illiquidity, which captures the information asymmetry dimension of disagreement through the price response to order flow.</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>For each proxy, we describe the theoretical motivation, the data requirements, the construction methodology adapted for Vietnamese data, the empirical properties observed in the Vietnamese cross-section, and the practical considerations that researchers should bear in mind when employing these measures. We pay particular attention to issues that are specific to emerging markets, including thin trading, corporate action adjustments, exchange-specific microstructure effects, and the interplay between foreign ownership constraints and measures of investor disagreement.</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Theoretical Framework {#sec-theoretical-framework}</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Miller (1977) Overpricing Hypothesis</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>The canonical model of divergence of opinion and asset pricing begins with @miller1977risk. Miller's central insight is simple: in a market where investors hold heterogeneous beliefs about the future payoffs of a risky asset and short-sale constraints prevent some investors from acting on their pessimistic views, the equilibrium price will be set by the subset of investors who are most optimistic about the asset's value. The severity of overpricing is increasing in both the degree of opinion divergence and the stringency of short-sale constraints. Formally, if investor $i$ assigns a valuation $V_i$ to a security, the market price $P$ satisfies:</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>P = E<span class="co">[</span><span class="ot">V_i \mid V_i \geq V^*</span><span class="co">]</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>where $V^*$ is the marginal investor's valuation, which exceeds the unconditional mean valuation $E<span class="co">[</span><span class="ot">V_i</span><span class="co">]</span>$ whenever short-sale constraints bind for some investors. The degree of overpricing is:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>\text{Overpricing} = P - E<span class="co">[</span><span class="ot">V_i</span><span class="co">]</span> = E<span class="co">[</span><span class="ot">V_i \mid V_i \geq V^*</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">V_i</span><span class="co">]</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>which is positive and increasing in the dispersion of the distribution of $V_i$ (i.e., divergence of opinion) and in $V^*$ (i.e., the severity of short-sale constraints).</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>Miller's model generates several testable predictions:</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Cross-sectional prediction:** Stocks with **higher divergence of opinion should have *lower* subsequent returns** as prices gradually correct toward fundamental values.</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time-series prediction:** Information events that reduce disagreement (e.g., earnings announcements) should be associated with negative abnormal returns for high-DIVOP stocks, as the "optimism premium" dissipates.</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interaction prediction:** The overpricing effect should be strongest among stocks that simultaneously exhibit high divergence of opinion *and* binding short-sale constraints.</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alternative Theoretical Perspectives</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>@varian1985divergence proposes an alternative framework in which divergence of opinion acts as a risk factor. If investors are risk-averse and disagreement represents genuine uncertainty about future payoffs, then **higher dispersion of beliefs should be associated with *higher* expected returns** as compensation for bearing the additional risk. This creates a sharp empirical dichotomy: the Miller hypothesis predicts a negative DIVOP-return relation, whereas the Varian model predicts a positive relation.</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>The distinction between these theories hinges critically on the market microstructure and institutional setting (\@tbl-divop-theories).</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Theoretical Framework <span class="pp">|</span> Short-Sale Constraints <span class="pp">|</span> DIVOP-Return Relation <span class="pp">|</span> Key Mechanism <span class="pp">|</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="pp">|:-----------------|:-----------------|:-----------------|:-----------------|</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> @miller1977risk <span class="pp">|</span> Binding <span class="pp">|</span> Negative <span class="pp">|</span> Optimistic bias in price <span class="pp">|</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> @varian1985divergence <span class="pp">|</span> Non-binding <span class="pp">|</span> Positive <span class="pp">|</span> Risk premium for uncertainty <span class="pp">|</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> @hong2003differences <span class="pp">|</span> Binding, gradual info <span class="pp">|</span> Negative, time-varying <span class="pp">|</span> Slow diffusion of bearish views <span class="pp">|</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> @scheinkman2003overconfidence <span class="pp">|</span> Binding, overconfidence <span class="pp">|</span> Negative <span class="pp">|</span> Speculative bubble premium <span class="pp">|</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>: Summary of theoretical predictions for the DIVOP-return relation under different assumptions {#tbl-divop-theories}</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>@hong2003differences extend Miller's framework by incorporating gradual information diffusion. In their model, bearish information is impounded into prices more slowly than bullish information because short-sale constraints raise the cost of acting on negative views. This generates momentum-like patterns in which high-DIVOP stocks exhibit positive short-run returns (as optimists push prices up) followed by negative long-run returns (as bearish information eventually reaches the market).</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>@scheinkman2003overconfidence introduce an additional dimension by noting that when investors are overconfident about their private signals *and* short-sale constraints bind, stock prices contain a "speculative bubble" component that reflects the option value of reselling the asset to a future investor who may be even more optimistic. This model predicts that both high trading volume and high price volatility should be associated with overpricing, providing a theoretical basis for using volume-based and volatility-based DIVOP proxies.</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## Relevance to the Vietnamese Market</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>The Vietnamese equity market provides an unusually clean setting for testing the Miller hypothesis. Vietnam's equity market operated without any short-selling mechanism from its inception in 2000 through January 2025, which was a full quarter-century in which the first necessary condition of Miller's model (binding short-sale constraints) was satisfied by regulation rather than by market frictions. Even after the introduction of covered short selling in 2025, the mechanism remains restricted to securities meeting specific liquidity and market capitalization thresholds, and the regulatory environment imposes borrowing requirements that significantly raise the cost of shorting relative to developed markets.</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>The dominance of retail investors amplifies the second necessary condition (i.e., heterogeneous beliefs). Research on the Vietnamese market has documented significant herding behavior <span class="co">[</span><span class="ot">@vo2017further; @vo2015foreign</span><span class="co">]</span>, sentiment-driven trading <span class="co">[</span><span class="ot">@phan2023role; @nguyen2018search</span><span class="co">]</span>, and information asymmetry between domestic and foreign investors <span class="co">[</span><span class="ot">@vo2017foreign</span><span class="co">]</span>. These behavioral characteristics naturally generate wider dispersion of investor valuations compared to markets dominated by institutional investors with access to similar analytical frameworks and information sources.</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>@tbl-divop-vietnam-us compares key institutional features relevant to the DIVOP framework between Vietnam and the United States.</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Feature <span class="pp">|</span> Vietnam (HOSE/HNX) <span class="pp">|</span> United States (NYSE/NASDAQ) <span class="pp">|</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="pp">|:-----------------------|:-----------------------|:-----------------------|</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Short selling <span class="pp">|</span> Introduced Jan 2025 (limited) <span class="pp">|</span> Permitted (Reg SHO since 2005) <span class="pp">|</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Retail investor share of volume <span class="pp">|</span> \~80-85% <span class="pp">|</span> \~25% <span class="pp">|</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Settlement cycle <span class="pp">|</span> T+2 (T+1 planned for 2026) <span class="pp">|</span> T+1 (since May 2024) <span class="pp">|</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Daily price limits <span class="pp">|</span> $\pm$ 7% (HOSE), $\pm$ 10% (HNX) <span class="pp">|</span> None <span class="pp">|</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Foreign ownership cap <span class="pp">|</span> 49% (most sectors) <span class="pp">|</span> None <span class="pp">|</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Average analyst coverage (VN30) <span class="pp">|</span> 5-10 analysts <span class="pp">|</span> 15-25 analysts <span class="pp">|</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Mandatory quarterly reporting <span class="pp">|</span> Yes (since 2012) <span class="pp">|</span> Yes <span class="pp">|</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Options/derivatives market <span class="pp">|</span> VN30 Index Futures (since 2017) <span class="pp">|</span> Extensive options/futures <span class="pp">|</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>: Institutional comparison of Vietnam and the United States relevant to divergence of opinion {#tbl-divop-vietnam-us}</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>The presence of daily price limits ($\pm$ 7% on HOSE and $\pm$ 10% on HNX) creates an additional mechanism through which divergence of opinion can be amplified. When a stock hits its price limit, investors who wish to trade in the direction of the limit are unable to do so, leading to accumulated unfilled orders and delayed price discovery. This institutional feature may create short-term spikes in measured DIVOP that reflect limit-induced friction rather than genuine disagreement. We address this issue in our empirical methodology by flagging limit-hit days and conducting robustness checks that exclude these observations.</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Sources and Sample Construction {#sec-data}</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Sources</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>The construction of DIVOP proxies for the Vietnamese market requires daily stock-level trading data and, for the analyst dispersion measures, individual analyst forecast data. We source all data from <span class="co">[</span><span class="ot">DataCore.vn</span><span class="co">](https://datacore.vn/en)</span>, which provides coverage of all securities listed on HOSE, HNX, and the UPCoM (Unlisted Public Company Market) exchange. @tbl-divop-data-sources summarizes the datasets and key variables used in this study.</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Dataset <span class="pp">|</span> Key Variables <span class="pp">|</span> Frequency <span class="pp">|</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a><span class="pp">|:-----------------------|:-----------------------|:-----------------------|</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Daily Stock Trading <span class="pp">|</span> Close price, high, low, open, volume, shares outstanding, adjusted price, bid, ask <span class="pp">|</span> Daily <span class="pp">|</span></span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Corporate Actions <span class="pp">|</span> Dividends, stock splits, bonus issues, rights offerings <span class="pp">|</span> Event-based <span class="pp">|</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Company Information <span class="pp">|</span> Exchange code, industry classification (ICB), listing date, delisting date <span class="pp">|</span> Static/Periodic <span class="pp">|</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Analyst Forecasts <span class="pp">|</span> Individual analyst EPS forecasts, announcement dates, fiscal period end, analyst ID, broker name <span class="pp">|</span> Per estimate <span class="pp">|</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Market Index <span class="pp">|</span> VN-Index daily returns, VN30 returns, HNX-Index returns <span class="pp">|</span> Daily <span class="pp">|</span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Foreign Ownership <span class="pp">|</span> Foreign buy/sell volume, foreign ownership percentage, remaining foreign room <span class="pp">|</span> Daily <span class="pp">|</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>: Data sources and key variables for DIVOP proxy construction {#tbl-divop-data-sources}</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sample Construction</span></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>We construct our sample using the following filters, applied sequentially:</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sample-construction</span></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Sample construction and initial data loading"</span></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="im">as</span> scipy_stats</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration Parameters</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Users can modify these parameters to adjust the methodology</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>CONFIG <span class="op">=</span> {</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample period</span></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">'beg_date'</span>: <span class="st">'2007-01-01'</span>,</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>    <span class="st">'end_date'</span>: <span class="st">'2024-12-31'</span>,</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimation windows (in trading days)</span></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>    <span class="st">'est_window'</span>: <span class="dv">60</span>,          <span class="co"># Rolling window for SUV and volatility</span></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>    <span class="st">'detrend_window'</span>: <span class="dv">180</span>,     <span class="co"># Window for DTO detrending median</span></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lag'</span>: <span class="dv">7</span>,                  <span class="co"># Lag for DTO detrending</span></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gap'</span>: <span class="dv">5</span>,                  <span class="co"># Gap between estimation period and event date</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filters</span></span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_price'</span>: <span class="dv">1000</span>,         <span class="co"># Minimum price in VND</span></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_volume_days'</span>: <span class="fl">0.8</span>,    <span class="co"># Min fraction of non-zero volume days in window</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_analysts'</span>: <span class="dv">3</span>,         <span class="co"># Minimum number of analysts for DISP</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_spread_pct'</span>: <span class="fl">0.50</span>,    <span class="co"># Maximum bid-ask spread as fraction of midpoint</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast_carry_days'</span>: <span class="dv">105</span>,<span class="co"># Days to carry forward stale analyst forecasts</span></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exchange identifiers</span></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exchanges'</span>: [<span class="st">'HOSE'</span>, <span class="st">'HNX'</span>],</span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price limit thresholds (for flagging)</span></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price_limit_hose'</span>: <span class="fl">0.07</span>,</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price_limit_hnx'</span>: <span class="fl">0.10</span>,</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Configuration parameters loaded successfully."</span>)</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample period: </span><span class="sc">{</span>CONFIG[<span class="st">'beg_date'</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>CONFIG[<span class="st">'end_date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimation window: </span><span class="sc">{</span>CONFIG[<span class="st">'est_window'</span>]<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Detrending window: </span><span class="sc">{</span>CONFIG[<span class="st">'detrend_window'</span>]<span class="sc">}</span><span class="ss"> trading days"</span>)</span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a>The sample universe includes all common stocks (ordinary shares) listed on HOSE and HNX during the period January 2007 through December 2024. We begin in 2007 rather than at market inception (2000 for HOSE, 2005 for HNX) for two reasons. First, the early years of the Vietnamese market were characterized by an extremely small number of listed firms (fewer than 30 on HOSE through 2005), making cross-sectional analysis unreliable. Second, data quality and consistency improve substantially after the market expansion of 2006-2007, during which the number of listed firms on HOSE grew from approximately 40 to over 100.</span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>We apply the following filters to construct the analysis sample:</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Security type filter.** We retain only common stocks (ordinary shares), excluding preferred shares, exchange-traded funds (ETFs), covered warrants, and certificates of deposit. This is analogous to the standard filter in the U.S. literature that restricts to CRSP share codes 10 and 11.</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Exchange filter.** We include stocks listed on HOSE and HNX but exclude UPCoM securities in our baseline analysis. UPCoM is a registration-based trading venue with less stringent listing requirements and substantially lower liquidity, which may introduce noise into volume-based and spread-based measures. We include UPCoM in robustness checks.</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Price filter.** We exclude stock-day observations with closing prices below 1,000 VND. This threshold serves the same purpose as the "penny stock" exclusion common in U.S. studies (typically \$1 or \$5 thresholds) and helps mitigate the influence of extreme percentage returns and spreads at very low price levels.</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Minimum trading activity.** For volume-based measures, we require that a stock has non-zero trading volume on at least 80% of trading days within each estimation window. This filter eliminates the most thinly traded securities for which turnover-based measures would be unreliable.</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-and-filter</span></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Load and filter daily stock data"</span></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_daily_data(config):</span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a><span class="co">    Load daily stock trading data from DataCore.vn.</span></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a><span class="co">    In practice, this function connects to the DataCore API or reads</span></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a><span class="co">    from a local database/CSV. Here we document the expected schema.</span></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected columns:</span></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="co">    - ticker: str, stock ticker symbol (e.g., 'VCB', 'HPG', 'VNM')</span></span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a><span class="co">    - date: datetime, trading date</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a><span class="co">    - open, high, low, close: float, daily OHLC prices (VND)</span></span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a><span class="co">    - volume: int, trading volume (shares)</span></span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a><span class="co">    - shares_outstanding: int, total shares outstanding</span></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a><span class="co">    - adjusted_close: float, price adjusted for corporate actions</span></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a><span class="co">    - adj_factor: float, cumulative adjustment factor</span></span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a><span class="co">    - bid, ask: float, best bid/ask at close</span></span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a><span class="co">    - exchange: str, exchange code ('HOSE', 'HNX', 'UPCOM')</span></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a><span class="co">    - industry_icb: str, ICB industry classification code</span></span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a><span class="co">    - foreign_buy_vol, foreign_sell_vol: int, foreign investor volumes</span></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="co">    - foreign_ownership_pct: float, foreign ownership percentage</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace with actual DataCore API call:</span></span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a>    <span class="co"># from datacore import Client</span></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a>    <span class="co"># client = Client(api_key='YOUR_KEY')</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df = client.daily_stock(</span></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     start=config['beg_date'], end=config['end_date'],</span></span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     exchanges=config['exchanges']</span></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># )</span></span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Connect to DataCore.vn and load daily stock data."</span>)</span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Expected schema: ticker, date, open, high, low, close, volume,"</span>)</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  shares_outstanding, adjusted_close, adj_factor, bid, ask,"</span>)</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  exchange, industry_icb, foreign_buy_vol, foreign_sell_vol,"</span>)</span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  foreign_ownership_pct"</span>)</span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Replace with actual data</span></span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_sample_filters(df, config):</span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Apply sequential sample construction filters."""</span></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Sample Construction ==="</span>)</span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a>    n0 <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Date filter</span></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[(df[<span class="st">'date'</span>] <span class="op">&gt;=</span> config[<span class="st">'beg_date'</span>]) <span class="op">&amp;</span></span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'date'</span>] <span class="op">&lt;=</span> config[<span class="st">'end_date'</span>])].copy()</span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[1] Date filter: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs (from </span><span class="sc">{</span>n0<span class="sc">:,}</span><span class="ss">)"</span>)</span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exchange filter</span></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'exchange'</span>].isin(config[<span class="st">'exchanges'</span>])].copy()</span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[2] Exchange filter (</span><span class="sc">{</span>config[<span class="st">'exchanges'</span>]<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price filter</span></span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'close'</span>] <span class="op">&gt;=</span> config[<span class="st">'min_price'</span>]].copy()</span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[3] Price &gt;= </span><span class="sc">{</span>config[<span class="st">'min_price'</span>]<span class="sc">:,}</span><span class="ss"> VND: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute daily return from adjusted prices</span></span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'adjusted_close'</span>].pct_change()</span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag price limit hits</span></span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'limit_hit'</span>] <span class="op">=</span> (</span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a>        ((df[<span class="st">'exchange'</span>] <span class="op">==</span> <span class="st">'HOSE'</span>) <span class="op">&amp;</span></span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a>         (df[<span class="st">'ret'</span>].<span class="bu">abs</span>() <span class="op">&gt;=</span> config[<span class="st">'price_limit_hose'</span>] <span class="op">-</span> <span class="fl">0.001</span>)) <span class="op">|</span></span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a>        ((df[<span class="st">'exchange'</span>] <span class="op">==</span> <span class="st">'HNX'</span>) <span class="op">&amp;</span></span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a>         (df[<span class="st">'ret'</span>].<span class="bu">abs</span>() <span class="op">&gt;=</span> config[<span class="st">'price_limit_hnx'</span>] <span class="op">-</span> <span class="fl">0.001</span>))</span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a>    n_tickers <span class="op">=</span> df[<span class="st">'ticker'</span>].nunique()</span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Final sample: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> stock-day obs, "</span></span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>n_tickers<span class="sc">}</span><span class="ss"> unique tickers"</span>)</span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Limit-hit days: </span><span class="sc">{</span>df[<span class="st">'limit_hit'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> "</span></span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"(</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>df[<span class="st">'limit_hit'</span>]<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Corporate Action Adjustments {#sec-corp-actions}</span></span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a>Proper adjustment for corporate actions is critical for volume-based DIVOP measures, as events such as stock splits, bonus share issues, and rights offerings change the number of shares outstanding and can create artificial spikes in measured turnover. We need to use cumulative adjustment factors that account for stock dividends (bonus shares), stock splits, rights offerings, and cash dividends (price adjustment only). We use these to construct adjusted volume and adjusted shares outstanding:</span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a>\text{AdjVolume}_{i,t} = \text{Volume}_{i,t} \times \text{CumAdjFactor}_{i,t}</span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a>\text{AdjSharesOut}_{i,t} = \text{SharesOut}_{i,t} \times \text{CumAdjFactor}_{i,t}</span>
<span id="cb20-279"><a href="#cb20-279" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-280"><a href="#cb20-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a>This ensures that the turnover ratio is consistent across corporate action events.</span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: corp-action</span></span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Corporate action adjustment"</span></span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-289"><a href="#cb20-289" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjust_for_corporate_actions(df):</span>
<span id="cb20-290"><a href="#cb20-290" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Apply cumulative adjustment factors to volume and shares outstanding."""</span></span>
<span id="cb20-291"><a href="#cb20-291" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'adj_volume'</span>] <span class="op">=</span> df[<span class="st">'volume'</span>] <span class="op">*</span> df[<span class="st">'adj_factor'</span>]</span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'adj_shares_out'</span>] <span class="op">=</span> df[<span class="st">'shares_outstanding'</span>] <span class="op">*</span> df[<span class="st">'adj_factor'</span>]</span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Daily turnover ratio</span></span>
<span id="cb20-296"><a href="#cb20-296" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'turnover'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-297"><a href="#cb20-297" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'adj_shares_out'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'adj_volume'</span>] <span class="op">/</span> df[<span class="st">'adj_shares_out'</span>],</span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a>        np.nan</span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag extreme turnover (&gt; 50% of float)</span></span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a>    extreme <span class="op">=</span> df[<span class="st">'turnover'</span>] <span class="op">&gt;</span> <span class="fl">0.50</span></span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> extreme.<span class="bu">any</span>():</span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: </span><span class="sc">{</span>extreme<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> obs with turnover &gt; 50%, set to NaN"</span>)</span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a>        df.loc[extreme, <span class="st">'turnover'</span>] <span class="op">=</span> np.nan</span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trading Calendar Construction {#sec-calendar}</span></span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a>The rolling regression approach for SUV and volatility requires a trading calendar that ensures each estimation window contains exactly the specified number of trading days. We construct this directly from observed trading dates.</span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: trading-calendar</span></span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Build trading calendar for rolling estimation windows"</span></span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_trading_calendar(df, config):</span>
<span id="cb20-322"><a href="#cb20-322" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-323"><a href="#cb20-323" aria-hidden="true" tabindex="-1"></a><span class="co">    Map each trading date to its estimation window [est_start, est_end].</span></span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a><span class="co">    For date t, the estimation window runs from</span></span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a><span class="co">    t - gap - est_window to t - gap - 1 (in trading-day terms).</span></span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'date'</span>].unique())</span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a>    trading_dates <span class="op">=</span> pd.Series(trading_dates)</span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> config[<span class="st">'gap'</span>]</span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> est_window <span class="op">+</span> gap</span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(offset, <span class="bu">len</span>(trading_dates)):</span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a>        records.append({</span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a>            <span class="st">'date'</span>: trading_dates.iloc[i],</span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a>            <span class="st">'est_start'</span>: trading_dates.iloc[i <span class="op">-</span> gap <span class="op">-</span> est_window],</span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a>            <span class="st">'est_end'</span>: trading_dates.iloc[i <span class="op">-</span> gap <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-342"><a href="#cb20-342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-343"><a href="#cb20-343" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb20-344"><a href="#cb20-344" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Trading calendar: </span><span class="sc">{</span><span class="bu">len</span>(calendar)<span class="sc">}</span><span class="ss"> dates, "</span></span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>calendar[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>calendar[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> calendar</span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a><span class="fu"># Volume-Based DIVOP Proxies {#sec-volume-based}</span></span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a><span class="fu">## Theoretical Motivation</span></span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a>Trading volume has long been recognized as a natural proxy for divergence of investor opinion. In the rational expectations framework of @milgrom1982information, trade occurs only when investors disagree about the value of a security (i.e., a "no-trade theorem" that implies, by contrapositive, that observed trading volume must reflect some form of heterogeneous beliefs). @harris1993differences and @kandel1995differential formalize this intuition, showing that trading volume is positively related to the dispersion of investors' prior beliefs and to the degree to which public information is differentially interpreted.</span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a>The challenge in using raw trading volume as a DIVOP proxy is that volume is also driven by factors unrelated to disagreement, including portfolio rebalancing, liquidity needs, tax-loss selling, and index reconstitution effects. @garfinkel2009measuring proposes two approaches to extract the disagreement component from raw volume. The first, **Unexplained Volume (DTO)**, removes market-wide volume effects and secular trends. The second, **Standardized Unexplained Volume (SUV)**, additionally controls for the information content of returns through a cross-sectional regression, isolating the "pure disagreement" component of trading activity.</span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-357"><a href="#cb20-357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Unexplained Volume (DTO) {#sec-dto}</span></span>
<span id="cb20-358"><a href="#cb20-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a><span class="fu">### Construction Methodology</span></span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a>The construction of the Unexplained Volume measure proceeds in four steps.</span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a>**Step 1: Compute firm-level daily turnover.** For each stock $i$ on day $t$:</span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a>\text{Turn}_{i,t} = \frac{\text{AdjVolume}_{i,t}}{\text{AdjSharesOut}_{i,t}}</span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a>**Step 2: Compute market-wide turnover.** We calculate aggregate turnover across all common stocks as a value-weighted average:</span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a>\text{MktTurn}_{t} = \frac{\sum_{i} \text{AdjVolume}_{i,t}}{\sum_{i} \text{AdjSharesOut}_{i,t}}</span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a>Unlike the U.S. methodology that computes market turnover across NYSE/AMEX stocks only and applies a scaling adjustment for NASDAQ securities <span class="co">[</span><span class="ot">following @anderson2005market</span><span class="co">]</span>, we compute market turnover across all HOSE and HNX common stocks without any exchange-specific volume scaling. Both Vietnamese exchanges operate as order-driven markets (HOSE uses continuous order matching; HNX uses a combination of continuous matching and periodic call auctions) without the dealer-market double-counting issue that necessitates the NASDAQ volume adjustment in U.S. studies.</span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a>**Step 3: Compute market-adjusted turnover.**</span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-379"><a href="#cb20-379" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-380"><a href="#cb20-380" aria-hidden="true" tabindex="-1"></a>\text{MATO}_{i,t} = \text{Turn}_{i,t} - \text{MktTurn}_{t}</span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a>**Step 4: Detrend by rolling median.** To remove secular trends in firm-specific trading activity:</span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a>\text{DTO}_{i,t} = \text{MATO}_{i,t} - \text{Median}_{180}(\text{MATO}_{i,t-7})</span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a>where $\text{Median}_{180}(\text{MATO}_{i,t-7})$ is the median of market-adjusted turnover over the 180-trading-day window ending 7 days before date $t$. The 7-day lag prevents the current day's turnover from influencing its own detrending baseline.</span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dto-construction</span></span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct the Unexplained Volume (DTO) measure"</span></span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_market_turnover(df):</span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute daily market-wide turnover across all stocks."""</span></span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a>    mkt_turn <span class="op">=</span> df.groupby(<span class="st">'date'</span>).<span class="bu">apply</span>(</span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x[<span class="st">'adj_volume'</span>].<span class="bu">sum</span>() <span class="op">/</span> x[<span class="st">'adj_shares_out'</span>].<span class="bu">sum</span>()</span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x[<span class="st">'adj_shares_out'</span>].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb20-403"><a href="#cb20-403" aria-hidden="true" tabindex="-1"></a>    mkt_turn.columns <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'market_turnover'</span>]</span>
<span id="cb20-404"><a href="#cb20-404" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mkt_turn</span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_dto(df, config):</span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a><span class="co">    Construct Unexplained Volume (DTO).</span></span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a><span class="co">    Steps:</span></span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Subtract market turnover -&gt; MATO</span></span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Rolling 180-day median of MATO (lagged 7 days) -&gt; trend</span></span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a><span class="co">    3. DTO = MATO - trend</span></span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a>    detrend_window <span class="op">=</span> config[<span class="st">'detrend_window'</span>]</span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a>    lag <span class="op">=</span> config[<span class="st">'lag'</span>]</span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market turnover</span></span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a>    mkt_turn <span class="op">=</span> compute_market_turnover(df)</span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(mkt_turn, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market-adjusted turnover</span></span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mato'</span>] <span class="op">=</span> df[<span class="st">'turnover'</span>] <span class="op">-</span> df[<span class="st">'market_turnover'</span>]</span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rolling median with lag, computed per stock</span></span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _rolling_median_lagged(group):</span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a>        mato <span class="op">=</span> group[<span class="st">'mato'</span>]</span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a>        med <span class="op">=</span> mato.rolling(</span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a>            window<span class="op">=</span>detrend_window,</span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a>            min_periods<span class="op">=</span><span class="bu">int</span>(detrend_window <span class="op">*</span> <span class="fl">0.5</span>)</span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a>        ).median()</span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> med.shift(lag)</span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mato_trend'</span>] <span class="op">=</span> (</span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a>        df.groupby(<span class="st">'ticker'</span>, group_keys<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a>          .<span class="bu">apply</span>(<span class="kw">lambda</span> g: _rolling_median_lagged(g))</span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DTO</span></span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dto'</span>] <span class="op">=</span> df[<span class="st">'mato'</span>] <span class="op">-</span> df[<span class="st">'mato_trend'</span>]</span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DTO construction complete."</span>)</span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Non-missing: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">, Std: </span><span class="sc">{</span>df[<span class="st">'dto'</span>]<span class="sc">.</span>std()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb20-448"><a href="#cb20-448" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb20-449"><a href="#cb20-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vietnam-Specific Considerations for DTO</span></span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>Several features of the Vietnamese market require attention when constructing DTO:</span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**No NASDAQ-type volume adjustment needed.** Both HOSE and HNX are order-driven auction markets. The double-counting adjustment applied to NASDAQ securities in the U.S. literature is not necessary.</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Thinly traded stocks.** A substantial fraction of listed Vietnamese stocks, particularly on HNX, may have zero volume on many trading days. For stocks with intermittent trading, the rolling median may be biased toward zero, making DTO less informative. We require at least 80% non-zero volume days in each estimation window.</span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Price limit effects on volume.** When a stock hits its daily price limit, unfilled orders accumulate and recorded volume may understate true clearing volume. The following day often shows a "catch-up" effect. Researchers should consider flagging limit-hit days.</span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Foreign investor trading decomposition.** DataCore provides volume by investor type (foreign versus domestic). Researchers may wish to construct separate DTO measures for foreign and domestic volume, or use the foreign-to-domestic volume ratio as an additional dimension of disagreement.</span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a><span class="fu">## Standardized Unexplained Volume (SUV) {#sec-suv}</span></span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a><span class="fu">### Construction Methodology</span></span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a>The Standardized Unexplained Volume measure, proposed by @garfinkel2009measuring, isolates the disagreement component of volume by explicitly controlling for the information content of returns. The insight is that trading volume has both a **liquidity** component and an **informedness** component correlated with the magnitude and sign of returns. By regressing turnover on signed returns and extracting the standardized residual, SUV captures volume attributable to disagreement after controlling for both liquidity trends and information-driven trading.</span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>For each stock $i$, on each trading date $t$, we estimate using data from the estimation window $<span class="co">[</span><span class="ot">\tau_1, \tau_2</span><span class="co">]</span>$:</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a>\text{Turn}_{i,s} = \alpha_i + \beta_i^{+} \cdot \text{RetPos}_{i,s} + \beta_i^{-} \cdot \text{RetNeg}_{i,s} + \epsilon_{i,s}, \quad s \in <span class="co">[</span><span class="ot">\tau_1, \tau_2</span><span class="co">]</span></span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a>$$ {#eq-suv-regression}</span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a>where $\text{RetPos}_{i,s} = |r_{i,s}| \cdot \mathbf{1}(r_{i,s} &gt; 0)$ and $\text{RetNeg}_{i,s} = |r_{i,s}| \cdot \mathbf{1}(r_{i,s} &lt; 0)$.</span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a>The Standardized Unexplained Volume on date $t$ is:</span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a>\text{SUV}_{i,t} = \frac{\text{Turn}_{i,t} - \hat{\text{Turn}}_{i,t}}{\hat{\sigma}_{\epsilon,i}}</span>
<span id="cb20-481"><a href="#cb20-481" aria-hidden="true" tabindex="-1"></a>$$ {#eq-suv}</span>
<span id="cb20-482"><a href="#cb20-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a>where $\hat{\text{Turn}}_{i,t}$ is the predicted turnover and $\hat{\sigma}_{\epsilon,i}$ is the RMSE from @eq-suv-regression.</span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a>The asymmetric specification with separate coefficients for positive and negative returns reflects that the volume-return relation differs by return sign. In the U.S., buying pressure tends to generate more volume than selling pressure due to short-sale frictions. In Vietnam, where short selling was unavailable until 2025, this asymmetry should be even more pronounced because all selling activity was constrained to existing shareholders.</span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: suv-construction</span></span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct Standardized Unexplained Volume (SUV)"</span></span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_suv(df, calendar, config):</span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute Standardized Unexplained Volume via rolling regressions.</span></span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a><span class="co">    For each stock-date, regress Turn on RetPos and RetNeg over the</span></span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a><span class="co">    estimation window, then compute SUV = (actual - predicted) / RMSE.</span></span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a>    min_obs <span class="op">=</span> <span class="bu">int</span>(est_window <span class="op">*</span> config[<span class="st">'min_volume_days'</span>])</span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare signed return components</span></span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret_pos'</span>] <span class="op">=</span> np.where(df[<span class="st">'ret'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]), <span class="fl">0.0</span>)</span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ret_neg'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ret'</span>] <span class="op">&lt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> df[<span class="st">'ret'</span>].notna(), np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]), <span class="fl">0.0</span></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> {t: g <span class="cf">for</span> t, g <span class="kw">in</span> df.groupby(<span class="st">'ticker'</span>)}</span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, cal_row <span class="kw">in</span> calendar.iterrows():</span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> cal_row[<span class="st">'date'</span>]</span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a>        est_s, est_e <span class="op">=</span> cal_row[<span class="st">'est_start'</span>], cal_row[<span class="st">'est_end'</span>]</span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker, tdata <span class="kw">in</span> grouped.items():</span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Estimation window</span></span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a>            est <span class="op">=</span> tdata[</span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a>                (tdata[<span class="st">'date'</span>] <span class="op">&gt;=</span> est_s) <span class="op">&amp;</span> (tdata[<span class="st">'date'</span>] <span class="op">&lt;=</span> est_e)</span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a>            ].dropna(subset<span class="op">=</span>[<span class="st">'turnover'</span>, <span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>])</span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> min_obs:</span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Event date</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a>            evt <span class="op">=</span> tdata[tdata[<span class="st">'date'</span>] <span class="op">==</span> dt]</span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> evt.empty <span class="kw">or</span> evt[<span class="st">'turnover'</span>].isna().<span class="bu">all</span>():</span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a>            <span class="co"># OLS: Turn = alpha + beta_pos * RetPos + beta_neg * RetNeg</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> est[[<span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>]].values</span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> est[<span class="st">'turnover'</span>].values</span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a>            reg <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a>            y_hat <span class="op">=</span> reg.predict(X)</span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a>            rmse <span class="op">=</span> np.sqrt(np.mean((y <span class="op">-</span> y_hat) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rmse <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Predict and standardize for event date</span></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a>            X_evt <span class="op">=</span> evt[[<span class="st">'ret_pos'</span>, <span class="st">'ret_neg'</span>]].values</span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> reg.predict(X_evt)[<span class="dv">0</span>]</span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a>            actual <span class="op">=</span> evt[<span class="st">'turnover'</span>].values[<span class="dv">0</span>]</span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a>            suv <span class="op">=</span> (actual <span class="op">-</span> pred) <span class="op">/</span> rmse</span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a>                <span class="st">'ticker'</span>: ticker, <span class="st">'date'</span>: dt,</span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a>                <span class="st">'suv'</span>: suv,</span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a>                <span class="st">'predicted_turnover'</span>: pred,</span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a>                <span class="st">'rmse_turn'</span>: rmse,</span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a>                <span class="st">'n_est'</span>: <span class="bu">len</span>(est),</span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a>                <span class="st">'alpha_turn'</span>: reg.intercept_,</span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a>                <span class="st">'beta_pos'</span>: reg.coef_[<span class="dv">0</span>],</span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a>                <span class="st">'beta_neg'</span>: reg.coef_[<span class="dv">1</span>],</span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a>    suv_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"SUV: </span><span class="sc">{</span><span class="bu">len</span>(suv_df)<span class="sc">:,}</span><span class="ss"> stock-date obs"</span>)</span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>suv_df[<span class="st">'suv'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Median: </span><span class="sc">{</span>suv_df[<span class="st">'suv'</span>]<span class="sc">.</span>median()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> suv_df</span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting the SUV Regression Coefficients</span></span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a>The estimated coefficients from @eq-suv-regression are informative about market microstructure. @garfinkel2009measuring reports $\hat{\beta}^{+} &gt; \hat{\beta}^{-}$ for most U.S. stocks. In Vietnam, we expect this asymmetry to be even stronger because:</span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**No short selling (pre-2025):** All selling is by existing shareholders, limiting volume response to negative returns.</span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**T+2 settlement:** Investors cannot immediately reinvest sale proceeds, further dampening sell-side volume.</span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Price limits:** The $\pm$ 7% (HOSE) and $\pm$ 10% (HNX) daily limits truncate the return distribution, compressing the range of both regressors.</span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a>Researchers should report summary statistics of $(\hat{\alpha}, \hat{\beta}^{+}, \hat{\beta}^{-}, R^2)$ across the cross-section and over time.</span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: suv-diagnostics</span></span>
<span id="cb20-580"><a href="#cb20-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Diagnostic statistics for SUV turnover regressions"</span></span>
<span id="cb20-581"><a href="#cb20-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> suv_diagnostics(suv_df):</span>
<span id="cb20-583"><a href="#cb20-583" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Report cross-sectional summary of SUV regression parameters."""</span></span>
<span id="cb20-584"><a href="#cb20-584" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== SUV Regression Diagnostics ==="</span>)</span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [<span class="st">'alpha_turn'</span>, <span class="st">'beta_pos'</span>, <span class="st">'beta_neg'</span>]</span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(suv_df[params].describe(</span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a>        percentiles<span class="op">=</span>[<span class="fl">.05</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.95</span>]</span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a>    ).T.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asymmetry test</span></span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> suv_df[<span class="st">'beta_pos'</span>] <span class="op">-</span> suv_df[<span class="st">'beta_neg'</span>]</span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">beta_pos - beta_neg: mean = </span><span class="sc">{</span>diff<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">, "</span></span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"frac &gt; 0 = </span><span class="sc">{</span>(diff <span class="op">&gt;</span> <span class="dv">0</span>)<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a><span class="fu"># Volatility-Based DIVOP Proxies {#sec-volatility}</span></span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a><span class="fu">## Total Return Volatility {#sec-total-vol}</span></span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### Theoretical Motivation</span></span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a>Stock return volatility serves as a proxy for divergence of opinion through several channels. @shalen1993volume develops a model in which both volume and volatility are increasing in the dispersion of investor beliefs. @scheinkman2003overconfidence predict that higher volatility reflects the speculative trading component driven by overconfident investors who disagree about value. Empirically, @boehme2006short and @chatterjee2012takeovers use idiosyncratic volatility as a DIVOP proxy and find it positively correlated with other disagreement measures and negatively associated with subsequent returns when short-sale constraints bind.</span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a><span class="fu">### Construction</span></span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a>Total return volatility is the standard deviation of daily returns over the rolling estimation window:</span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a>\text{VOLATILITY}_{i,t} = \sqrt{\frac{1}{N_i - 1} \sum_{s \in [\tau_1, \tau_2]} (r_{i,s} - \bar{r}_i)^2}</span>
<span id="cb20-611"><a href="#cb20-611" aria-hidden="true" tabindex="-1"></a>$$ {#eq-volatility}</span>
<span id="cb20-612"><a href="#cb20-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a>where $N_i$ is the number of non-missing return observations for stock $i$ in the window $<span class="co">[</span><span class="ot">\tau_1, \tau_2</span><span class="co">]</span>$.</span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a><span class="fu">## Idiosyncratic Volatility (IVOL) {#sec-ivol}</span></span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a>Idiosyncratic volatility isolates firm-specific return variation by removing the systematic component explained by market movements. We compute IVOL from the residuals of a market model:</span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a>r_{i,s} = \alpha_i + \beta_i \cdot r_{m,s} + \epsilon_{i,s}, \quad s \in <span class="co">[</span><span class="ot">\tau_1, \tau_2</span><span class="co">]</span></span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>$$ {#eq-market-model}</span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a>\text{IVOL}_{i,t} = \text{Std}(\hat{\epsilon}_{i,s})</span>
<span id="cb20-625"><a href="#cb20-625" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ivol}</span>
<span id="cb20-626"><a href="#cb20-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a>Researchers may extend this to a @fama1993common three-factor or five-factor model using Vietnamese factor portfolios constructed elsewhere in this book. A richer factor model yields IVOL estimates that better isolate truly idiosyncratic disagreement, at the cost of requiring factor portfolio construction.</span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-631"><a href="#cb20-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-632"><a href="#cb20-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: volatility-construction</span></span>
<span id="cb20-633"><a href="#cb20-633" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct total and idiosyncratic volatility"</span></span>
<span id="cb20-634"><a href="#cb20-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-635"><a href="#cb20-635" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_volatility(df, calendar, config):</span>
<span id="cb20-636"><a href="#cb20-636" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-637"><a href="#cb20-637" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute total return volatility and idiosyncratic volatility</span></span>
<span id="cb20-638"><a href="#cb20-638" aria-hidden="true" tabindex="-1"></a><span class="co">    via rolling estimation windows.</span></span>
<span id="cb20-639"><a href="#cb20-639" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-640"><a href="#cb20-640" aria-hidden="true" tabindex="-1"></a><span class="co">    Total vol = std(returns) in window.</span></span>
<span id="cb20-641"><a href="#cb20-641" aria-hidden="true" tabindex="-1"></a><span class="co">    IVOL = std(residuals) from market model regression.</span></span>
<span id="cb20-642"><a href="#cb20-642" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-643"><a href="#cb20-643" aria-hidden="true" tabindex="-1"></a>    est_window <span class="op">=</span> config[<span class="st">'est_window'</span>]</span>
<span id="cb20-644"><a href="#cb20-644" aria-hidden="true" tabindex="-1"></a>    min_obs <span class="op">=</span> <span class="bu">int</span>(est_window <span class="op">*</span> config[<span class="st">'min_volume_days'</span>])</span>
<span id="cb20-645"><a href="#cb20-645" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-646"><a href="#cb20-646" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value-weighted market return</span></span>
<span id="cb20-647"><a href="#cb20-647" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _vw_ret(g):</span>
<span id="cb20-648"><a href="#cb20-648" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> g.dropna(subset<span class="op">=</span>[<span class="st">'ret'</span>])</span>
<span id="cb20-649"><a href="#cb20-649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> valid.empty:</span>
<span id="cb20-650"><a href="#cb20-650" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb20-651"><a href="#cb20-651" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> valid[<span class="st">'adj_shares_out'</span>] <span class="op">*</span> valid[<span class="st">'close'</span>]</span>
<span id="cb20-652"><a href="#cb20-652" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.average(valid[<span class="st">'ret'</span>], weights<span class="op">=</span>w)</span>
<span id="cb20-653"><a href="#cb20-653" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-654"><a href="#cb20-654" aria-hidden="true" tabindex="-1"></a>    mkt_ret <span class="op">=</span> df.groupby(<span class="st">'date'</span>).<span class="bu">apply</span>(_vw_ret).reset_index()</span>
<span id="cb20-655"><a href="#cb20-655" aria-hidden="true" tabindex="-1"></a>    mkt_ret.columns <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'mkt_ret'</span>]</span>
<span id="cb20-656"><a href="#cb20-656" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(mkt_ret, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb20-657"><a href="#cb20-657" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-658"><a href="#cb20-658" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb20-659"><a href="#cb20-659" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> {t: g <span class="cf">for</span> t, g <span class="kw">in</span> df.groupby(<span class="st">'ticker'</span>)}</span>
<span id="cb20-660"><a href="#cb20-660" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-661"><a href="#cb20-661" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, cal_row <span class="kw">in</span> calendar.iterrows():</span>
<span id="cb20-662"><a href="#cb20-662" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> cal_row[<span class="st">'date'</span>]</span>
<span id="cb20-663"><a href="#cb20-663" aria-hidden="true" tabindex="-1"></a>        est_s, est_e <span class="op">=</span> cal_row[<span class="st">'est_start'</span>], cal_row[<span class="st">'est_end'</span>]</span>
<span id="cb20-664"><a href="#cb20-664" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-665"><a href="#cb20-665" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker, tdata <span class="kw">in</span> grouped.items():</span>
<span id="cb20-666"><a href="#cb20-666" aria-hidden="true" tabindex="-1"></a>            est <span class="op">=</span> tdata[</span>
<span id="cb20-667"><a href="#cb20-667" aria-hidden="true" tabindex="-1"></a>                (tdata[<span class="st">'date'</span>] <span class="op">&gt;=</span> est_s) <span class="op">&amp;</span> (tdata[<span class="st">'date'</span>] <span class="op">&lt;=</span> est_e)</span>
<span id="cb20-668"><a href="#cb20-668" aria-hidden="true" tabindex="-1"></a>            ].dropna(subset<span class="op">=</span>[<span class="st">'ret'</span>, <span class="st">'mkt_ret'</span>])</span>
<span id="cb20-669"><a href="#cb20-669" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-670"><a href="#cb20-670" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> min_obs:</span>
<span id="cb20-671"><a href="#cb20-671" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb20-672"><a href="#cb20-672" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-673"><a href="#cb20-673" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Total volatility</span></span>
<span id="cb20-674"><a href="#cb20-674" aria-hidden="true" tabindex="-1"></a>            total_vol <span class="op">=</span> est[<span class="st">'ret'</span>].std()</span>
<span id="cb20-675"><a href="#cb20-675" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-676"><a href="#cb20-676" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Market model -&gt; IVOL</span></span>
<span id="cb20-677"><a href="#cb20-677" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> est[[<span class="st">'mkt_ret'</span>]].values</span>
<span id="cb20-678"><a href="#cb20-678" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> est[<span class="st">'ret'</span>].values</span>
<span id="cb20-679"><a href="#cb20-679" aria-hidden="true" tabindex="-1"></a>            reg <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb20-680"><a href="#cb20-680" aria-hidden="true" tabindex="-1"></a>            resid <span class="op">=</span> y <span class="op">-</span> reg.predict(X)</span>
<span id="cb20-681"><a href="#cb20-681" aria-hidden="true" tabindex="-1"></a>            ivol <span class="op">=</span> np.std(resid, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-682"><a href="#cb20-682" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-683"><a href="#cb20-683" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb20-684"><a href="#cb20-684" aria-hidden="true" tabindex="-1"></a>                <span class="st">'ticker'</span>: ticker, <span class="st">'date'</span>: dt,</span>
<span id="cb20-685"><a href="#cb20-685" aria-hidden="true" tabindex="-1"></a>                <span class="st">'total_volatility'</span>: total_vol,</span>
<span id="cb20-686"><a href="#cb20-686" aria-hidden="true" tabindex="-1"></a>                <span class="st">'idio_volatility'</span>: ivol,</span>
<span id="cb20-687"><a href="#cb20-687" aria-hidden="true" tabindex="-1"></a>                <span class="st">'market_beta'</span>: reg.coef_[<span class="dv">0</span>],</span>
<span id="cb20-688"><a href="#cb20-688" aria-hidden="true" tabindex="-1"></a>                <span class="st">'market_alpha'</span>: reg.intercept_,</span>
<span id="cb20-689"><a href="#cb20-689" aria-hidden="true" tabindex="-1"></a>                <span class="st">'r_squared_mm'</span>: reg.score(X, y),</span>
<span id="cb20-690"><a href="#cb20-690" aria-hidden="true" tabindex="-1"></a>                <span class="st">'n_vol'</span>: <span class="bu">len</span>(est),</span>
<span id="cb20-691"><a href="#cb20-691" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-692"><a href="#cb20-692" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-693"><a href="#cb20-693" aria-hidden="true" tabindex="-1"></a>    vol_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb20-694"><a href="#cb20-694" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Volatility: </span><span class="sc">{</span><span class="bu">len</span>(vol_df)<span class="sc">:,}</span><span class="ss"> stock-date obs"</span>)</span>
<span id="cb20-695"><a href="#cb20-695" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Total vol (ann. mean): "</span></span>
<span id="cb20-696"><a href="#cb20-696" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>vol_df[<span class="st">'total_volatility'</span>]<span class="sc">.</span>mean() <span class="op">*</span> np<span class="sc">.</span>sqrt(<span class="dv">252</span>)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-697"><a href="#cb20-697" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  IVOL (ann. mean): "</span></span>
<span id="cb20-698"><a href="#cb20-698" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>vol_df[<span class="st">'idio_volatility'</span>]<span class="sc">.</span>mean() <span class="op">*</span> np<span class="sc">.</span>sqrt(<span class="dv">252</span>)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-699"><a href="#cb20-699" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vol_df</span>
<span id="cb20-700"><a href="#cb20-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-701"><a href="#cb20-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-702"><a href="#cb20-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vietnam-Specific Considerations for Volatility</span></span>
<span id="cb20-703"><a href="#cb20-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-704"><a href="#cb20-704" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Price limits compress measured volatility.** Daily limits of $\pm$ 7% (HOSE) and $\pm$ 10% (HNX) mechanically truncate the return distribution, leading to underestimation of true volatility. On limit-hit days, the true equilibrium return may exceed the observed return. Researchers should be aware that volatility-based DIVOP measures may be downward-biased for stocks that frequently hit limits.</span>
<span id="cb20-705"><a href="#cb20-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-706"><a href="#cb20-706" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**VN-Index concentration.** The VN-Index is highly concentrated, the top 10 stocks often account for 50-60% of index weight. For small- and mid-cap stocks, an equal-weighted market return or a composite HOSE+HNX index may provide a better market factor in @eq-market-model.</span>
<span id="cb20-707"><a href="#cb20-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-708"><a href="#cb20-708" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Thin trading and non-synchronous returns.** For thinly traded stocks, consecutive zero-return days can depress measured volatility. The @dimson1979risk adjustment (including lagged and lead market returns in the market model) may help correct for non-synchronous trading bias in the beta estimate, though its effect on IVOL is typically small.</span>
<span id="cb20-709"><a href="#cb20-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-710"><a href="#cb20-710" aria-hidden="true" tabindex="-1"></a><span class="fu"># Spread-Based and Liquidity DIVOP Proxies {#sec-spread}</span></span>
<span id="cb20-711"><a href="#cb20-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-712"><a href="#cb20-712" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bid-Ask Spread (BASPREAD) {#sec-baspread}</span></span>
<span id="cb20-713"><a href="#cb20-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-714"><a href="#cb20-714" aria-hidden="true" tabindex="-1"></a><span class="fu">### Theoretical Motivation</span></span>
<span id="cb20-715"><a href="#cb20-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-716"><a href="#cb20-716" aria-hidden="true" tabindex="-1"></a>The bid-ask spread reflects the adverse selection costs faced by limit order providers. When investors hold heterogeneous beliefs, each trade is more likely to convey private information, raising the adverse selection component of the spread. @handa2003quote show that in order-driven markets the spread widens when divergence of opinion increases because limit order providers face greater risk of being picked off by informed traders. @chung2014simple demonstrate that closing bid-ask spreads from daily data provide a reliable approximation to intraday effective spreads.</span>
<span id="cb20-717"><a href="#cb20-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-718"><a href="#cb20-718" aria-hidden="true" tabindex="-1"></a><span class="fu">### Construction</span></span>
<span id="cb20-719"><a href="#cb20-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-720"><a href="#cb20-720" aria-hidden="true" tabindex="-1"></a>We compute the proportional bid-ask spread using end-of-day quote data:</span>
<span id="cb20-721"><a href="#cb20-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-722"><a href="#cb20-722" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-723"><a href="#cb20-723" aria-hidden="true" tabindex="-1"></a>\text{BASPREAD}_{i,t} = \frac{\text{Ask}_{i,t} - \text{Bid}_{i,t}}{\text{Midpoint}_{i,t}}</span>
<span id="cb20-724"><a href="#cb20-724" aria-hidden="true" tabindex="-1"></a>$$ {#eq-baspread}</span>
<span id="cb20-725"><a href="#cb20-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-726"><a href="#cb20-726" aria-hidden="true" tabindex="-1"></a>where $\text{Midpoint}_{i,t} = (\text{Ask}_{i,t} + \text{Bid}_{i,t}) / 2$. When end-of-day bid and ask are unavailable, we use the daily high-low range as a fallback. Following @chung2014simple, we delete observations where both Bid and Ask are zero, and where the spread exceeds 50% of the midpoint.</span>
<span id="cb20-727"><a href="#cb20-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-728"><a href="#cb20-728" aria-hidden="true" tabindex="-1"></a><span class="fu">## Amihud Illiquidity (ILLIQ) {#sec-amihud}</span></span>
<span id="cb20-729"><a href="#cb20-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-730"><a href="#cb20-730" aria-hidden="true" tabindex="-1"></a>The @amihud2002illiquidity ratio measures the price impact of order flow:</span>
<span id="cb20-731"><a href="#cb20-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-732"><a href="#cb20-732" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-733"><a href="#cb20-733" aria-hidden="true" tabindex="-1"></a>\text{ILLIQ}_{i,t} = \frac{|r_{i,t}|}{\text{DolVol}_{i,t}}</span>
<span id="cb20-734"><a href="#cb20-734" aria-hidden="true" tabindex="-1"></a>$$ {#eq-amihud}</span>
<span id="cb20-735"><a href="#cb20-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-736"><a href="#cb20-736" aria-hidden="true" tabindex="-1"></a>where $\text{DolVol}_{i,t} = \text{Volume}_{i,t} \times \text{Price}_{i,t}$ (in billions VND for scaling). Higher ILLIQ reflects greater information asymmetry. We average daily ratios over monthly horizons and use the log transformation due to heavy right skew.</span>
<span id="cb20-737"><a href="#cb20-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-740"><a href="#cb20-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-741"><a href="#cb20-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: spread-illiq</span></span>
<span id="cb20-742"><a href="#cb20-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct bid-ask spread and Amihud illiquidity"</span></span>
<span id="cb20-743"><a href="#cb20-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-744"><a href="#cb20-744" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_spread_and_illiq(df, config):</span>
<span id="cb20-745"><a href="#cb20-745" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute bid-ask spread (BASPREAD) and Amihud illiquidity."""</span></span>
<span id="cb20-746"><a href="#cb20-746" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb20-747"><a href="#cb20-747" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-748"><a href="#cb20-748" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Bid-Ask Spread ---</span></span>
<span id="cb20-749"><a href="#cb20-749" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint_ba'</span>] <span class="op">=</span> (df[<span class="st">'ask'</span>] <span class="op">+</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb20-750"><a href="#cb20-750" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread_ba'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-751"><a href="#cb20-751" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'midpoint_ba'</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb20-752"><a href="#cb20-752" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'ask'</span>] <span class="op">-</span> df[<span class="st">'bid'</span>]) <span class="op">/</span> df[<span class="st">'midpoint_ba'</span>], np.nan</span>
<span id="cb20-753"><a href="#cb20-753" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-754"><a href="#cb20-754" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-755"><a href="#cb20-755" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback: high/low range</span></span>
<span id="cb20-756"><a href="#cb20-756" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint_hl'</span>] <span class="op">=</span> (df[<span class="st">'high'</span>] <span class="op">+</span> df[<span class="st">'low'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb20-757"><a href="#cb20-757" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread_hl'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-758"><a href="#cb20-758" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'high'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'low'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'midpoint_hl'</span>] <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb20-759"><a href="#cb20-759" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'high'</span>] <span class="op">-</span> df[<span class="st">'low'</span>]) <span class="op">/</span> df[<span class="st">'midpoint_hl'</span>], np.nan</span>
<span id="cb20-760"><a href="#cb20-760" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-761"><a href="#cb20-761" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-762"><a href="#cb20-762" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'baspread'</span>] <span class="op">=</span> df[<span class="st">'baspread_ba'</span>].fillna(df[<span class="st">'baspread_hl'</span>])</span>
<span id="cb20-763"><a href="#cb20-763" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'midpoint'</span>] <span class="op">=</span> df[<span class="st">'midpoint_ba'</span>].fillna(df[<span class="st">'midpoint_hl'</span>])</span>
<span id="cb20-764"><a href="#cb20-764" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-765"><a href="#cb20-765" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chung &amp; Zhang (2009) filters</span></span>
<span id="cb20-766"><a href="#cb20-766" aria-hidden="true" tabindex="-1"></a>    bad <span class="op">=</span> (df[<span class="st">'baspread'</span>].isna()) <span class="op">|</span> <span class="op">\</span></span>
<span id="cb20-767"><a href="#cb20-767" aria-hidden="true" tabindex="-1"></a>          (df[<span class="st">'baspread'</span>] <span class="op">&gt;</span> config[<span class="st">'max_spread_pct'</span>]) <span class="op">|</span> <span class="op">\</span></span>
<span id="cb20-768"><a href="#cb20-768" aria-hidden="true" tabindex="-1"></a>          (df[<span class="st">'baspread'</span>] <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb20-769"><a href="#cb20-769" aria-hidden="true" tabindex="-1"></a>    df.loc[bad, <span class="st">'baspread'</span>] <span class="op">=</span> np.nan</span>
<span id="cb20-770"><a href="#cb20-770" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-771"><a href="#cb20-771" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Amihud Illiquidity ---</span></span>
<span id="cb20-772"><a href="#cb20-772" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dollar_vol'</span>] <span class="op">=</span> df[<span class="st">'volume'</span>] <span class="op">*</span> df[<span class="st">'close'</span>] <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb20-773"><a href="#cb20-773" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'amihud_daily'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-774"><a href="#cb20-774" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'dollar_vol'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb20-775"><a href="#cb20-775" aria-hidden="true" tabindex="-1"></a>        np.<span class="bu">abs</span>(df[<span class="st">'ret'</span>]) <span class="op">/</span> df[<span class="st">'dollar_vol'</span>], np.nan</span>
<span id="cb20-776"><a href="#cb20-776" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-777"><a href="#cb20-777" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-778"><a href="#cb20-778" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"BASPREAD: </span><span class="sc">{</span>df[<span class="st">'baspread'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> valid obs, "</span></span>
<span id="cb20-779"><a href="#cb20-779" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean = </span><span class="sc">{</span>df[<span class="st">'baspread'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb20-780"><a href="#cb20-780" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"AMIHUD: </span><span class="sc">{</span>df[<span class="st">'amihud_daily'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> valid obs, "</span></span>
<span id="cb20-781"><a href="#cb20-781" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean = </span><span class="sc">{</span>df[<span class="st">'amihud_daily'</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb20-782"><a href="#cb20-782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb20-783"><a href="#cb20-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-784"><a href="#cb20-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-785"><a href="#cb20-785" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_amihud_monthly(df):</span>
<span id="cb20-786"><a href="#cb20-786" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Monthly Amihud = mean daily |ret|/dollar_vol (min 15 days)."""</span></span>
<span id="cb20-787"><a href="#cb20-787" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb20-788"><a href="#cb20-788" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb20-789"><a href="#cb20-789" aria-hidden="true" tabindex="-1"></a>    agg <span class="op">=</span> df.groupby([<span class="st">'ticker'</span>, <span class="st">'ym'</span>]).agg(</span>
<span id="cb20-790"><a href="#cb20-790" aria-hidden="true" tabindex="-1"></a>        illiq_mean<span class="op">=</span>(<span class="st">'amihud_daily'</span>, <span class="st">'mean'</span>),</span>
<span id="cb20-791"><a href="#cb20-791" aria-hidden="true" tabindex="-1"></a>        n_days<span class="op">=</span>(<span class="st">'amihud_daily'</span>, <span class="st">'count'</span>),</span>
<span id="cb20-792"><a href="#cb20-792" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb20-793"><a href="#cb20-793" aria-hidden="true" tabindex="-1"></a>    agg <span class="op">=</span> agg[agg[<span class="st">'n_days'</span>] <span class="op">&gt;=</span> <span class="dv">15</span>].copy()</span>
<span id="cb20-794"><a href="#cb20-794" aria-hidden="true" tabindex="-1"></a>    agg[<span class="st">'log_illiq'</span>] <span class="op">=</span> np.log(agg[<span class="st">'illiq_mean'</span>] <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb20-795"><a href="#cb20-795" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agg</span>
<span id="cb20-796"><a href="#cb20-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-797"><a href="#cb20-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-798"><a href="#cb20-798" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vietnam-Specific Considerations for Spread and Liquidity</span></span>
<span id="cb20-799"><a href="#cb20-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-800"><a href="#cb20-800" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Tick size schedule.** Vietnam uses variable tick sizes: 10 VND (prices <span class="sc">\&lt;</span> 10,000), 50 VND (10,000--49,950), and 100 VND (≥ 50,000) on HOSE. These impose a floor on quoted spreads for low-priced stocks. Researchers should be cautious interpreting cross-price-decile spread variation as reflecting opinion divergence rather than tick-size mechanics.</span>
<span id="cb20-801"><a href="#cb20-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-802"><a href="#cb20-802" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Order-driven market structure.** Both HOSE and HNX are pure order-driven markets where public limit orders provide liquidity. This makes the @chung2014simple CRSP-based spread approximation appropriate.</span>
<span id="cb20-803"><a href="#cb20-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-804"><a href="#cb20-804" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Lot size requirements.** HOSE requires 100-share standard lots for continuous trading. For high-priced stocks, the standard lot represents a large capital commitment, potentially inflating quoted spreads relative to effective trading costs.</span>
<span id="cb20-805"><a href="#cb20-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-806"><a href="#cb20-806" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Call auction effects.** Opening and closing sessions on HOSE use periodic call auctions, which can produce bid-ask quotes that differ substantially from continuous-trading spreads.</span>
<span id="cb20-807"><a href="#cb20-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-808"><a href="#cb20-808" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analyst Forecast Dispersion {#sec-analyst}</span></span>
<span id="cb20-809"><a href="#cb20-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-810"><a href="#cb20-810" aria-hidden="true" tabindex="-1"></a><span class="fu">## Theoretical Motivation</span></span>
<span id="cb20-811"><a href="#cb20-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-812"><a href="#cb20-812" aria-hidden="true" tabindex="-1"></a>Analyst forecast dispersion, the cross-sectional standard deviation of individual analysts' earnings forecasts, is the most direct measure of divergence of opinion. Unlike market-based proxies that capture disagreement indirectly, forecast dispersion directly measures disagreement among informed market participants. @abarbanell1995analysts establish the theoretical basis, and @diether2002differences demonstrate that stocks with higher analyst forecast dispersion earn lower subsequent returns, consistent with the Miller overpricing hypothesis.</span>
<span id="cb20-813"><a href="#cb20-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-814"><a href="#cb20-814" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Challenges in Vietnam</span></span>
<span id="cb20-815"><a href="#cb20-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-816"><a href="#cb20-816" aria-hidden="true" tabindex="-1"></a>Constructing analyst forecast dispersion in Vietnam presents substantial challenges relative to the U.S.:</span>
<span id="cb20-817"><a href="#cb20-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-818"><a href="#cb20-818" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Coverage breadth.** While I/B/E/S covers over 4,000 U.S. companies, only 100--150 Vietnamese firms typically have coverage by at least 3 analysts, concentrated among VN30 constituents.</span>
<span id="cb20-819"><a href="#cb20-819" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data sources.** Analyst forecasts are available from DataCore.vn, FiinPro, Bloomberg, and Refinitiv. The choice of source affects coverage and timeliness.</span>
<span id="cb20-820"><a href="#cb20-820" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Forecast staleness.** With limited coverage, forecasts may go unrevised for months. Following I/B/E/S methodology, we carry each forecast forward for a maximum of 105 days.</span>
<span id="cb20-821"><a href="#cb20-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-822"><a href="#cb20-822" aria-hidden="true" tabindex="-1"></a><span class="fu">## Construction Methodology</span></span>
<span id="cb20-823"><a href="#cb20-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-824"><a href="#cb20-824" aria-hidden="true" tabindex="-1"></a>The construction proceeds as follows:</span>
<span id="cb20-825"><a href="#cb20-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-826"><a href="#cb20-826" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Clean individual forecasts.** Remove observations where the announcement date precedes the review date. Keep only annual EPS forecasts. For each analyst-ticker-fiscal period, retain only the latest forecast per calendar month.</span>
<span id="cb20-827"><a href="#cb20-827" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Handle stopped and excluded estimates.** Remove forecasts where the analyst has left the brokerage or the estimate has been excluded from consensus.</span>
<span id="cb20-828"><a href="#cb20-828" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Carry forward with staleness control.** Each forecast is valid until the earlier of: (a) the next forecast by the same analyst, (b) 105 days after the announcement, or (c) the actual earnings announcement date.</span>
<span id="cb20-829"><a href="#cb20-829" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Expand to monthly frequency.** For each ticker-month, identify all valid outstanding forecasts and compute dispersion.</span>
<span id="cb20-830"><a href="#cb20-830" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Compute scaled measures:**</span>
<span id="cb20-831"><a href="#cb20-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-832"><a href="#cb20-832" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-833"><a href="#cb20-833" aria-hidden="true" tabindex="-1"></a>\text{DISP1}_{i,m} = \frac{\text{Std}(\hat{\text{EPS}}_{i,m}^{(a)})}{|\text{Mean}(\hat{\text{EPS}}_{i,m}^{(a)})|}</span>
<span id="cb20-834"><a href="#cb20-834" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb20-835"><a href="#cb20-835" aria-hidden="true" tabindex="-1"></a>\text{DISP2}_{i,m} = \frac{\text{Std}(\hat{\text{EPS}}_{i,m}^{(a)})}{\bar{P}_{i,m}}</span>
<span id="cb20-836"><a href="#cb20-836" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-837"><a href="#cb20-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-840"><a href="#cb20-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-841"><a href="#cb20-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: analyst-dispersion</span></span>
<span id="cb20-842"><a href="#cb20-842" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct analyst forecast dispersion (DISP1, DISP2)"</span></span>
<span id="cb20-843"><a href="#cb20-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-844"><a href="#cb20-844" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_analyst_dispersion(forecasts_df, price_df, config):</span>
<span id="cb20-845"><a href="#cb20-845" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-846"><a href="#cb20-846" aria-hidden="true" tabindex="-1"></a><span class="co">    Construct analyst forecast dispersion measures.</span></span>
<span id="cb20-847"><a href="#cb20-847" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-848"><a href="#cb20-848" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb20-849"><a href="#cb20-849" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb20-850"><a href="#cb20-850" aria-hidden="true" tabindex="-1"></a><span class="co">    forecasts_df : pd.DataFrame</span></span>
<span id="cb20-851"><a href="#cb20-851" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual analyst forecasts with: ticker, analyst_id, broker,</span></span>
<span id="cb20-852"><a href="#cb20-852" aria-hidden="true" tabindex="-1"></a><span class="co">        fpedats, anndats, revdats, value (EPS), anndats_act.</span></span>
<span id="cb20-853"><a href="#cb20-853" aria-hidden="true" tabindex="-1"></a><span class="co">    price_df : pd.DataFrame</span></span>
<span id="cb20-854"><a href="#cb20-854" aria-hidden="true" tabindex="-1"></a><span class="co">        Monthly price: ticker, month, mean_price.</span></span>
<span id="cb20-855"><a href="#cb20-855" aria-hidden="true" tabindex="-1"></a><span class="co">    config : dict</span></span>
<span id="cb20-856"><a href="#cb20-856" aria-hidden="true" tabindex="-1"></a><span class="co">        With min_analysts, forecast_carry_days.</span></span>
<span id="cb20-857"><a href="#cb20-857" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-858"><a href="#cb20-858" aria-hidden="true" tabindex="-1"></a>    carry_days <span class="op">=</span> config[<span class="st">'forecast_carry_days'</span>]</span>
<span id="cb20-859"><a href="#cb20-859" aria-hidden="true" tabindex="-1"></a>    min_analysts <span class="op">=</span> config[<span class="st">'min_analysts'</span>]</span>
<span id="cb20-860"><a href="#cb20-860" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-861"><a href="#cb20-861" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> forecasts_df.copy()</span>
<span id="cb20-862"><a href="#cb20-862" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'anndats'</span>] <span class="op">&lt;=</span> df[<span class="st">'revdats'</span>]].copy()</span>
<span id="cb20-863"><a href="#cb20-863" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'fpedats'</span>, <span class="st">'anndats'</span>, <span class="st">'value'</span>])</span>
<span id="cb20-864"><a href="#cb20-864" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-865"><a href="#cb20-865" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Latest forecast per analyst-month</span></span>
<span id="cb20-866"><a href="#cb20-866" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'anndats'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb20-867"><a href="#cb20-867" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(</span>
<span id="cb20-868"><a href="#cb20-868" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'fpedats'</span>, <span class="st">'analyst_id'</span>, <span class="st">'ym'</span>, <span class="st">'anndats'</span>, <span class="st">'revdats'</span>]</span>
<span id="cb20-869"><a href="#cb20-869" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-870"><a href="#cb20-870" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.groupby([<span class="st">'ticker'</span>, <span class="st">'fpedats'</span>, <span class="st">'analyst_id'</span>, <span class="st">'ym'</span>]).tail(<span class="dv">1</span>)</span>
<span id="cb20-871"><a href="#cb20-871" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-872"><a href="#cb20-872" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carry-forward end date</span></span>
<span id="cb20-873"><a href="#cb20-873" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(</span>
<span id="cb20-874"><a href="#cb20-874" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'fpedats'</span>, <span class="st">'anndats'</span>],</span>
<span id="cb20-875"><a href="#cb20-875" aria-hidden="true" tabindex="-1"></a>        ascending<span class="op">=</span>[<span class="va">True</span>, <span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb20-876"><a href="#cb20-876" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-877"><a href="#cb20-877" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'next_ann'</span>] <span class="op">=</span> df.groupby(</span>
<span id="cb20-878"><a href="#cb20-878" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'fpedats'</span>]</span>
<span id="cb20-879"><a href="#cb20-879" aria-hidden="true" tabindex="-1"></a>    )[<span class="st">'anndats'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-880"><a href="#cb20-880" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-881"><a href="#cb20-881" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _carry_end(row):</span>
<span id="cb20-882"><a href="#cb20-882" aria-hidden="true" tabindex="-1"></a>        candidates <span class="op">=</span> [row[<span class="st">'anndats'</span>] <span class="op">+</span> pd.Timedelta(days<span class="op">=</span>carry_days)]</span>
<span id="cb20-883"><a href="#cb20-883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row.get(<span class="st">'next_ann'</span>)):</span>
<span id="cb20-884"><a href="#cb20-884" aria-hidden="true" tabindex="-1"></a>            candidates.append(row[<span class="st">'next_ann'</span>])</span>
<span id="cb20-885"><a href="#cb20-885" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.notna(row.get(<span class="st">'anndats_act'</span>)):</span>
<span id="cb20-886"><a href="#cb20-886" aria-hidden="true" tabindex="-1"></a>            candidates.append(row[<span class="st">'anndats_act'</span>])</span>
<span id="cb20-887"><a href="#cb20-887" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(candidates)</span>
<span id="cb20-888"><a href="#cb20-888" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-889"><a href="#cb20-889" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'carry_end'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(_carry_end, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-890"><a href="#cb20-890" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-891"><a href="#cb20-891" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly expansion</span></span>
<span id="cb20-892"><a href="#cb20-892" aria-hidden="true" tabindex="-1"></a>    months <span class="op">=</span> pd.period_range(config[<span class="st">'beg_date'</span>], config[<span class="st">'end_date'</span>], freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb20-893"><a href="#cb20-893" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb20-894"><a href="#cb20-894" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> months:</span>
<span id="cb20-895"><a href="#cb20-895" aria-hidden="true" tabindex="-1"></a>        me <span class="op">=</span> month.to_timestamp(how<span class="op">=</span><span class="st">'end'</span>)</span>
<span id="cb20-896"><a href="#cb20-896" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> df[(df[<span class="st">'anndats'</span>] <span class="op">&lt;=</span> me) <span class="op">&amp;</span> (df[<span class="st">'carry_end'</span>] <span class="op">&gt;</span> me)].copy()</span>
<span id="cb20-897"><a href="#cb20-897" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid[valid[<span class="st">'fpedats'</span>] <span class="op">&gt;</span> me]</span>
<span id="cb20-898"><a href="#cb20-898" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid.sort_values([<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>, <span class="st">'anndats'</span>])</span>
<span id="cb20-899"><a href="#cb20-899" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> valid.groupby([<span class="st">'ticker'</span>, <span class="st">'analyst_id'</span>]).tail(<span class="dv">1</span>)</span>
<span id="cb20-900"><a href="#cb20-900" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-901"><a href="#cb20-901" aria-hidden="true" tabindex="-1"></a>        disp <span class="op">=</span> valid.groupby(<span class="st">'ticker'</span>).agg(</span>
<span id="cb20-902"><a href="#cb20-902" aria-hidden="true" tabindex="-1"></a>            n_analysts<span class="op">=</span>(<span class="st">'analyst_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb20-903"><a href="#cb20-903" aria-hidden="true" tabindex="-1"></a>            mean_fcst<span class="op">=</span>(<span class="st">'value'</span>, <span class="st">'mean'</span>),</span>
<span id="cb20-904"><a href="#cb20-904" aria-hidden="true" tabindex="-1"></a>            std_fcst<span class="op">=</span>(<span class="st">'value'</span>, <span class="st">'std'</span>),</span>
<span id="cb20-905"><a href="#cb20-905" aria-hidden="true" tabindex="-1"></a>        ).reset_index()</span>
<span id="cb20-906"><a href="#cb20-906" aria-hidden="true" tabindex="-1"></a>        disp[<span class="st">'month'</span>] <span class="op">=</span> month</span>
<span id="cb20-907"><a href="#cb20-907" aria-hidden="true" tabindex="-1"></a>        records.append(disp)</span>
<span id="cb20-908"><a href="#cb20-908" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-909"><a href="#cb20-909" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> records:</span>
<span id="cb20-910"><a href="#cb20-910" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb20-911"><a href="#cb20-911" aria-hidden="true" tabindex="-1"></a>    disp_df <span class="op">=</span> pd.concat(records, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-912"><a href="#cb20-912" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-913"><a href="#cb20-913" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scaled measures</span></span>
<span id="cb20-914"><a href="#cb20-914" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp1'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-915"><a href="#cb20-915" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'mean_fcst'</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb20-916"><a href="#cb20-916" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'std_fcst'</span>] <span class="op">/</span> disp_df[<span class="st">'mean_fcst'</span>].<span class="bu">abs</span>(), np.nan</span>
<span id="cb20-917"><a href="#cb20-917" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-918"><a href="#cb20-918" aria-hidden="true" tabindex="-1"></a>    disp_df <span class="op">=</span> disp_df.merge(price_df, on<span class="op">=</span>[<span class="st">'ticker'</span>, <span class="st">'month'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb20-919"><a href="#cb20-919" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp2'</span>] <span class="op">=</span> np.where(</span>
<span id="cb20-920"><a href="#cb20-920" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'mean_price'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb20-921"><a href="#cb20-921" aria-hidden="true" tabindex="-1"></a>        disp_df[<span class="st">'std_fcst'</span>] <span class="op">/</span> disp_df[<span class="st">'mean_price'</span>], np.nan</span>
<span id="cb20-922"><a href="#cb20-922" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-923"><a href="#cb20-923" aria-hidden="true" tabindex="-1"></a>    disp_df[<span class="st">'disp_raw'</span>] <span class="op">=</span> disp_df[<span class="st">'std_fcst'</span>]</span>
<span id="cb20-924"><a href="#cb20-924" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-925"><a href="#cb20-925" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> disp_df[disp_df[<span class="st">'n_analysts'</span>] <span class="op">&gt;=</span> min_analysts].copy()</span>
<span id="cb20-926"><a href="#cb20-926" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DISP: </span><span class="sc">{</span><span class="bu">len</span>(out)<span class="sc">:,}</span><span class="ss"> ticker-months (&gt;= </span><span class="sc">{</span>min_analysts<span class="sc">}</span><span class="ss"> analysts)"</span>)</span>
<span id="cb20-927"><a href="#cb20-927" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean analysts: </span><span class="sc">{</span>out[<span class="st">'n_analysts'</span>]<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb20-928"><a href="#cb20-928" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb20-929"><a href="#cb20-929" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-930"><a href="#cb20-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-931"><a href="#cb20-931" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scaling Considerations</span></span>
<span id="cb20-932"><a href="#cb20-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-933"><a href="#cb20-933" aria-hidden="true" tabindex="-1"></a>Following @cheong2011eps, we note that each scaling choice has pitfalls. DISP1 (scaled by absolute mean forecast) can produce extreme values when the mean forecast approaches zero---common for Vietnamese firms near breakeven. DISP2 (scaled by price) introduces a mechanical negative correlation between price and scaled dispersion. We recommend reporting all three versions (DISP1, DISP2, and unscaled DISP_RAW with $\ln(\text{Price})$ as an additional control), and winsorizing DISP1 at the 1st and 99th percentiles.</span>
<span id="cb20-934"><a href="#cb20-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-935"><a href="#cb20-935" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb20-936"><a href="#cb20-936" aria-hidden="true" tabindex="-1"></a><span class="fu">## Caution on Analyst Dispersion in Thin-Coverage Markets</span></span>
<span id="cb20-937"><a href="#cb20-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-938"><a href="#cb20-938" aria-hidden="true" tabindex="-1"></a>With typical coverage of 5--10 analysts per firm in Vietnam (versus 15--25 in the U.S.), forecast dispersion is estimated with substantially greater noise. A dispersion measure from 3 analysts has a very different sampling distribution than one from 20. Always include the number of analysts as a control and test robustness with varying minimum-analyst thresholds (3, 5, 7).</span>
<span id="cb20-939"><a href="#cb20-939" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-940"><a href="#cb20-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-941"><a href="#cb20-941" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cross-Sectional Correlations Among DIVOP Proxies {#sec-correlation}</span></span>
<span id="cb20-942"><a href="#cb20-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-943"><a href="#cb20-943" aria-hidden="true" tabindex="-1"></a>An important empirical question is the degree to which the various DIVOP proxies capture the same underlying construct. If divergence of opinion is a well-defined latent variable, we expect positive correlations among all proxies, though correlations need not be high since each captures a different facet of disagreement.</span>
<span id="cb20-944"><a href="#cb20-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-947"><a href="#cb20-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-948"><a href="#cb20-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: correlation-analysis</span></span>
<span id="cb20-949"><a href="#cb20-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Spearman rank correlations among DIVOP proxies"</span></span>
<span id="cb20-950"><a href="#cb20-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-951"><a href="#cb20-951" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_divop_correlations(merged_df, proxies<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb20-952"><a href="#cb20-952" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-953"><a href="#cb20-953" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute and visualize Spearman correlations among DIVOP proxies.</span></span>
<span id="cb20-954"><a href="#cb20-954" aria-hidden="true" tabindex="-1"></a><span class="co">    We use rank correlations because many proxies are right-skewed.</span></span>
<span id="cb20-955"><a href="#cb20-955" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-956"><a href="#cb20-956" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> proxies <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb20-957"><a href="#cb20-957" aria-hidden="true" tabindex="-1"></a>        proxies <span class="op">=</span> [</span>
<span id="cb20-958"><a href="#cb20-958" aria-hidden="true" tabindex="-1"></a>            <span class="st">'dto'</span>, <span class="st">'suv'</span>, <span class="st">'total_volatility'</span>, <span class="st">'idio_volatility'</span>,</span>
<span id="cb20-959"><a href="#cb20-959" aria-hidden="true" tabindex="-1"></a>            <span class="st">'baspread'</span>, <span class="st">'amihud_daily'</span>, <span class="st">'disp1'</span>, <span class="st">'disp2'</span></span>
<span id="cb20-960"><a href="#cb20-960" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb20-961"><a href="#cb20-961" aria-hidden="true" tabindex="-1"></a>    available <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb20-962"><a href="#cb20-962" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> merged_df[available].dropna()</span>
<span id="cb20-963"><a href="#cb20-963" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-964"><a href="#cb20-964" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(available)</span>
<span id="cb20-965"><a href="#cb20-965" aria-hidden="true" tabindex="-1"></a>    rho_mat <span class="op">=</span> np.eye(n)</span>
<span id="cb20-966"><a href="#cb20-966" aria-hidden="true" tabindex="-1"></a>    p_mat <span class="op">=</span> np.zeros((n, n))</span>
<span id="cb20-967"><a href="#cb20-967" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb20-968"><a href="#cb20-968" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, n):</span>
<span id="cb20-969"><a href="#cb20-969" aria-hidden="true" tabindex="-1"></a>            rho, p <span class="op">=</span> scipy_stats.spearmanr(</span>
<span id="cb20-970"><a href="#cb20-970" aria-hidden="true" tabindex="-1"></a>                data[available[i]], data[available[j]]</span>
<span id="cb20-971"><a href="#cb20-971" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb20-972"><a href="#cb20-972" aria-hidden="true" tabindex="-1"></a>            rho_mat[i, j] <span class="op">=</span> rho_mat[j, i] <span class="op">=</span> rho</span>
<span id="cb20-973"><a href="#cb20-973" aria-hidden="true" tabindex="-1"></a>            p_mat[i, j] <span class="op">=</span> p_mat[j, i] <span class="op">=</span> p</span>
<span id="cb20-974"><a href="#cb20-974" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-975"><a href="#cb20-975" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {<span class="st">'dto'</span>: <span class="st">'DTO'</span>, <span class="st">'suv'</span>: <span class="st">'SUV'</span>,</span>
<span id="cb20-976"><a href="#cb20-976" aria-hidden="true" tabindex="-1"></a>              <span class="st">'total_volatility'</span>: <span class="st">'VOL'</span>, <span class="st">'idio_volatility'</span>: <span class="st">'IVOL'</span>,</span>
<span id="cb20-977"><a href="#cb20-977" aria-hidden="true" tabindex="-1"></a>              <span class="st">'baspread'</span>: <span class="st">'SPREAD'</span>, <span class="st">'amihud_daily'</span>: <span class="st">'ILLIQ'</span>,</span>
<span id="cb20-978"><a href="#cb20-978" aria-hidden="true" tabindex="-1"></a>              <span class="st">'disp1'</span>: <span class="st">'DISP1'</span>, <span class="st">'disp2'</span>: <span class="st">'DISP2'</span>}</span>
<span id="cb20-979"><a href="#cb20-979" aria-hidden="true" tabindex="-1"></a>    pretty <span class="op">=</span> [labels.get(c, c) <span class="cf">for</span> c <span class="kw">in</span> available]</span>
<span id="cb20-980"><a href="#cb20-980" aria-hidden="true" tabindex="-1"></a>    corr_df <span class="op">=</span> pd.DataFrame(rho_mat, index<span class="op">=</span>pretty, columns<span class="op">=</span>pretty)</span>
<span id="cb20-981"><a href="#cb20-981" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-982"><a href="#cb20-982" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb20-983"><a href="#cb20-983" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb20-984"><a href="#cb20-984" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones_like(corr_df, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-985"><a href="#cb20-985" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(</span>
<span id="cb20-986"><a href="#cb20-986" aria-hidden="true" tabindex="-1"></a>        corr_df, mask<span class="op">=</span>mask, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.3f'</span>,</span>
<span id="cb20-987"><a href="#cb20-987" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, center<span class="op">=</span><span class="dv">0</span>, vmin<span class="op">=-</span><span class="fl">0.4</span>, vmax<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb20-988"><a href="#cb20-988" aria-hidden="true" tabindex="-1"></a>        square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb20-989"><a href="#cb20-989" aria-hidden="true" tabindex="-1"></a>        cbar_kws<span class="op">=</span>{<span class="st">'shrink'</span>: <span class="fl">0.8</span>, <span class="st">'label'</span>: <span class="st">'Spearman ρ'</span>}, ax<span class="op">=</span>ax</span>
<span id="cb20-990"><a href="#cb20-990" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-991"><a href="#cb20-991" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Spearman Correlations Among DIVOP Proxies</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb20-992"><a href="#cb20-992" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Vietnamese Equity Market'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-993"><a href="#cb20-993" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-994"><a href="#cb20-994" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'divop_correlations.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb20-995"><a href="#cb20-995" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-996"><a href="#cb20-996" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-997"><a href="#cb20-997" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr_df</span>
<span id="cb20-998"><a href="#cb20-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-999"><a href="#cb20-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1000"><a href="#cb20-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1001"><a href="#cb20-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Expected Correlation Patterns</span></span>
<span id="cb20-1002"><a href="#cb20-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1003"><a href="#cb20-1003" aria-hidden="true" tabindex="-1"></a>Based on U.S. evidence and theory, we expect:</span>
<span id="cb20-1004"><a href="#cb20-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1005"><a href="#cb20-1005" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Pair <span class="pp">|</span> Expected <span class="pp">|</span> Rationale <span class="pp">|</span></span>
<span id="cb20-1006"><a href="#cb20-1006" aria-hidden="true" tabindex="-1"></a><span class="pp">|:-----------------------|:-----------------------|:-----------------------|</span></span>
<span id="cb20-1007"><a href="#cb20-1007" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> DTO × SUV <span class="pp">|</span> High positive <span class="pp">|</span> Both capture abnormal volume; SUV refines DTO <span class="pp">|</span></span>
<span id="cb20-1008"><a href="#cb20-1008" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> VOL × IVOL <span class="pp">|</span> High positive <span class="pp">|</span> IVOL is a subset of total volatility <span class="pp">|</span></span>
<span id="cb20-1009"><a href="#cb20-1009" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> SPREAD × ILLIQ <span class="pp">|</span> Moderate-high positive <span class="pp">|</span> Both capture information asymmetry <span class="pp">|</span></span>
<span id="cb20-1010"><a href="#cb20-1010" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Volume × Volatility <span class="pp">|</span> Moderate positive <span class="pp">|</span> @shalen1993volume links both to belief dispersion <span class="pp">|</span></span>
<span id="cb20-1011"><a href="#cb20-1011" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Analyst × Market-based <span class="pp">|</span> Weak-moderate positive <span class="pp">|</span> Different investor populations <span class="pp">|</span></span>
<span id="cb20-1012"><a href="#cb20-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1013"><a href="#cb20-1013" aria-hidden="true" tabindex="-1"></a>: Expected correlation structure among DIVOP proxies {#tbl-expected-corr}</span>
<span id="cb20-1014"><a href="#cb20-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1015"><a href="#cb20-1015" aria-hidden="true" tabindex="-1"></a><span class="fu"># Descriptive Statistics and Cross-Sectional Properties {#sec-empirical}</span></span>
<span id="cb20-1016"><a href="#cb20-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1017"><a href="#cb20-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary Statistics</span></span>
<span id="cb20-1018"><a href="#cb20-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1021"><a href="#cb20-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1022"><a href="#cb20-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: descriptive-stats</span></span>
<span id="cb20-1023"><a href="#cb20-1023" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Descriptive statistics for all DIVOP proxies"</span></span>
<span id="cb20-1024"><a href="#cb20-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1025"><a href="#cb20-1025" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> descriptive_statistics(merged_df):</span>
<span id="cb20-1026"><a href="#cb20-1026" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive descriptive statistics for DIVOP proxies."""</span></span>
<span id="cb20-1027"><a href="#cb20-1027" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> {</span>
<span id="cb20-1028"><a href="#cb20-1028" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dto'</span>: <span class="st">'Unexplained Volume (DTO)'</span>,</span>
<span id="cb20-1029"><a href="#cb20-1029" aria-hidden="true" tabindex="-1"></a>        <span class="st">'suv'</span>: <span class="st">'Std Unexplained Volume (SUV)'</span>,</span>
<span id="cb20-1030"><a href="#cb20-1030" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_volatility'</span>: <span class="st">'Total Return Volatility'</span>,</span>
<span id="cb20-1031"><a href="#cb20-1031" aria-hidden="true" tabindex="-1"></a>        <span class="st">'idio_volatility'</span>: <span class="st">'Idiosyncratic Volatility'</span>,</span>
<span id="cb20-1032"><a href="#cb20-1032" aria-hidden="true" tabindex="-1"></a>        <span class="st">'baspread'</span>: <span class="st">'Bid-Ask Spread'</span>,</span>
<span id="cb20-1033"><a href="#cb20-1033" aria-hidden="true" tabindex="-1"></a>        <span class="st">'amihud_daily'</span>: <span class="st">'Amihud Illiquidity'</span>,</span>
<span id="cb20-1034"><a href="#cb20-1034" aria-hidden="true" tabindex="-1"></a>        <span class="st">'disp1'</span>: <span class="st">'Analyst Disp (mean-scaled)'</span>,</span>
<span id="cb20-1035"><a href="#cb20-1035" aria-hidden="true" tabindex="-1"></a>        <span class="st">'disp2'</span>: <span class="st">'Analyst Disp (price-scaled)'</span>,</span>
<span id="cb20-1036"><a href="#cb20-1036" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-1037"><a href="#cb20-1037" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> proxies.items() <span class="cf">if</span> k <span class="kw">in</span> merged_df.columns}</span>
<span id="cb20-1038"><a href="#cb20-1038" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb20-1039"><a href="#cb20-1039" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col, label <span class="kw">in</span> avail.items():</span>
<span id="cb20-1040"><a href="#cb20-1040" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> merged_df[col].dropna()</span>
<span id="cb20-1041"><a href="#cb20-1041" aria-hidden="true" tabindex="-1"></a>        rows.append({</span>
<span id="cb20-1042"><a href="#cb20-1042" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Proxy'</span>: label, <span class="st">'N'</span>: <span class="ss">f'</span><span class="sc">{</span><span class="bu">len</span>(s)<span class="sc">:,}</span><span class="ss">'</span>,</span>
<span id="cb20-1043"><a href="#cb20-1043" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mean'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">'</span>, <span class="st">'Std'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>std()<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb20-1044"><a href="#cb20-1044" aria-hidden="true" tabindex="-1"></a>            <span class="st">'P5'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>quantile(<span class="fl">.05</span>)<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb20-1045"><a href="#cb20-1045" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Median'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>median()<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb20-1046"><a href="#cb20-1046" aria-hidden="true" tabindex="-1"></a>            <span class="st">'P95'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>quantile(<span class="fl">.95</span>)<span class="sc">:.6f}</span><span class="ss">'</span>,</span>
<span id="cb20-1047"><a href="#cb20-1047" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Skew'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>skew()<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb20-1048"><a href="#cb20-1048" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kurt'</span>: <span class="ss">f'</span><span class="sc">{</span>s<span class="sc">.</span>kurtosis()<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb20-1049"><a href="#cb20-1049" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-1050"><a href="#cb20-1050" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> pd.DataFrame(rows).set_index(<span class="st">'Proxy'</span>)</span>
<span id="cb20-1051"><a href="#cb20-1051" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb20-1052"><a href="#cb20-1052" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Descriptive Statistics of DIVOP Proxies"</span>)</span>
<span id="cb20-1053"><a href="#cb20-1053" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Vietnamese Equity Market, HOSE and HNX"</span>)</span>
<span id="cb20-1054"><a href="#cb20-1054" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb20-1055"><a href="#cb20-1055" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(stats.to_string())</span>
<span id="cb20-1056"><a href="#cb20-1056" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb20-1057"><a href="#cb20-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1058"><a href="#cb20-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1059"><a href="#cb20-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">## DIVOP by Firm Characteristics</span></span>
<span id="cb20-1060"><a href="#cb20-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1063"><a href="#cb20-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1064"><a href="#cb20-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: by-characteristics</span></span>
<span id="cb20-1065"><a href="#cb20-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "DIVOP by size, exchange, and foreign ownership"</span></span>
<span id="cb20-1066"><a href="#cb20-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1067"><a href="#cb20-1067" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_by_size(merged_df):</span>
<span id="cb20-1068"><a href="#cb20-1068" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Mean DIVOP proxies by market-cap quintile."""</span></span>
<span id="cb20-1069"><a href="#cb20-1069" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb20-1070"><a href="#cb20-1070" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mkt_cap'</span>] <span class="op">=</span> df[<span class="st">'close'</span>] <span class="op">*</span> df[<span class="st">'shares_outstanding'</span>]</span>
<span id="cb20-1071"><a href="#cb20-1071" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'size_q'</span>] <span class="op">=</span> df.groupby(<span class="st">'date'</span>)[<span class="st">'mkt_cap'</span>].transform(</span>
<span id="cb20-1072"><a href="#cb20-1072" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: pd.qcut(x, <span class="dv">5</span>,</span>
<span id="cb20-1073"><a href="#cb20-1073" aria-hidden="true" tabindex="-1"></a>            labels<span class="op">=</span>[<span class="st">'Q1 Small'</span>,<span class="st">'Q2'</span>,<span class="st">'Q3'</span>,<span class="st">'Q4'</span>,<span class="st">'Q5 Large'</span>],</span>
<span id="cb20-1074"><a href="#cb20-1074" aria-hidden="true" tabindex="-1"></a>            duplicates<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb20-1075"><a href="#cb20-1075" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1076"><a href="#cb20-1076" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb20-1077"><a href="#cb20-1077" aria-hidden="true" tabindex="-1"></a>               <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb20-1078"><a href="#cb20-1078" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> df.columns]</span>
<span id="cb20-1079"><a href="#cb20-1079" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> df.groupby(<span class="st">'size_q'</span>)[avail].mean()</span>
<span id="cb20-1080"><a href="#cb20-1080" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Mean DIVOP by Size Quintile ==="</span>)</span>
<span id="cb20-1081"><a href="#cb20-1081" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tab.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb20-1082"><a href="#cb20-1082" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tab</span>
<span id="cb20-1083"><a href="#cb20-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1084"><a href="#cb20-1084" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_by_exchange(merged_df):</span>
<span id="cb20-1085"><a href="#cb20-1085" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compare mean DIVOP across HOSE and HNX."""</span></span>
<span id="cb20-1086"><a href="#cb20-1086" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb20-1087"><a href="#cb20-1087" aria-hidden="true" tabindex="-1"></a>               <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb20-1088"><a href="#cb20-1088" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb20-1089"><a href="#cb20-1089" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> merged_df.groupby(<span class="st">'exchange'</span>)[avail].mean()</span>
<span id="cb20-1090"><a href="#cb20-1090" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Mean DIVOP by Exchange ==="</span>)</span>
<span id="cb20-1091"><a href="#cb20-1091" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tab.to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>))</span>
<span id="cb20-1092"><a href="#cb20-1092" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tab</span>
<span id="cb20-1093"><a href="#cb20-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1094"><a href="#cb20-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1095"><a href="#cb20-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time-Series Evolution</span></span>
<span id="cb20-1096"><a href="#cb20-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1099"><a href="#cb20-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1100"><a href="#cb20-1100" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: time-series-plot</span></span>
<span id="cb20-1101"><a href="#cb20-1101" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Time-series evolution of DIVOP proxies"</span></span>
<span id="cb20-1102"><a href="#cb20-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1103"><a href="#cb20-1103" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_divop_timeseries(merged_df):</span>
<span id="cb20-1104"><a href="#cb20-1104" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Plot monthly cross-sectional median DIVOP with crisis shading."""</span></span>
<span id="cb20-1105"><a href="#cb20-1105" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb20-1106"><a href="#cb20-1106" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'ym'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb20-1107"><a href="#cb20-1107" aria-hidden="true" tabindex="-1"></a>    proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'baspread'</span>]</span>
<span id="cb20-1108"><a href="#cb20-1108" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> df.columns]</span>
<span id="cb20-1109"><a href="#cb20-1109" aria-hidden="true" tabindex="-1"></a>    monthly <span class="op">=</span> df.groupby(<span class="st">'ym'</span>)[avail].median()</span>
<span id="cb20-1110"><a href="#cb20-1110" aria-hidden="true" tabindex="-1"></a>    monthly.index <span class="op">=</span> monthly.index.to_timestamp()</span>
<span id="cb20-1111"><a href="#cb20-1111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1112"><a href="#cb20-1112" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="bu">len</span>(avail), <span class="dv">1</span>,</span>
<span id="cb20-1113"><a href="#cb20-1113" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="fl">3.5</span><span class="op">*</span><span class="bu">len</span>(avail)), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-1114"><a href="#cb20-1114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(avail) <span class="op">==</span> <span class="dv">1</span>: axes <span class="op">=</span> [axes]</span>
<span id="cb20-1115"><a href="#cb20-1115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1116"><a href="#cb20-1116" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {<span class="st">'dto'</span>:<span class="st">'DTO'</span>,<span class="st">'suv'</span>:<span class="st">'SUV'</span>,</span>
<span id="cb20-1117"><a href="#cb20-1117" aria-hidden="true" tabindex="-1"></a>              <span class="st">'total_volatility'</span>:<span class="st">'Volatility'</span>,<span class="st">'baspread'</span>:<span class="st">'Spread'</span>}</span>
<span id="cb20-1118"><a href="#cb20-1118" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#1976D2'</span>,<span class="st">'#388E3C'</span>,<span class="st">'#F57C00'</span>,<span class="st">'#D32F2F'</span>]</span>
<span id="cb20-1119"><a href="#cb20-1119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1120"><a href="#cb20-1120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (proxy, ax) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(avail, axes)):</span>
<span id="cb20-1121"><a href="#cb20-1121" aria-hidden="true" tabindex="-1"></a>        ax.plot(monthly.index, monthly[proxy],</span>
<span id="cb20-1122"><a href="#cb20-1122" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>colors[i], linewidth<span class="op">=</span><span class="fl">1.3</span>)</span>
<span id="cb20-1123"><a href="#cb20-1123" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(labels.get(proxy, proxy), fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb20-1124"><a href="#cb20-1124" aria-hidden="true" tabindex="-1"></a>        ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb20-1125"><a href="#cb20-1125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s, e, c <span class="kw">in</span> [(<span class="st">'2008-01'</span>,<span class="st">'2009-06'</span>,<span class="st">'red'</span>),</span>
<span id="cb20-1126"><a href="#cb20-1126" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">'2020-01'</span>,<span class="st">'2020-12'</span>,<span class="st">'orange'</span>),</span>
<span id="cb20-1127"><a href="#cb20-1127" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">'2022-09'</span>,<span class="st">'2023-06'</span>,<span class="st">'purple'</span>)]:</span>
<span id="cb20-1128"><a href="#cb20-1128" aria-hidden="true" tabindex="-1"></a>            ax.axvspan(pd.Timestamp(s), pd.Timestamp(e),</span>
<span id="cb20-1129"><a href="#cb20-1129" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span>c)</span>
<span id="cb20-1130"><a href="#cb20-1130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1131"><a href="#cb20-1131" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(</span>
<span id="cb20-1132"><a href="#cb20-1132" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Time-Series of DIVOP Proxies</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb20-1133"><a href="#cb20-1133" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Monthly Cross-Sectional Median, HOSE &amp; HNX'</span>,</span>
<span id="cb20-1134"><a href="#cb20-1134" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-1135"><a href="#cb20-1135" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb20-1136"><a href="#cb20-1136" aria-hidden="true" tabindex="-1"></a>    axes[<span class="op">-</span><span class="dv">1</span>].legend(handles<span class="op">=</span>[</span>
<span id="cb20-1137"><a href="#cb20-1137" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'GFC 2008-09'</span>),</span>
<span id="cb20-1138"><a href="#cb20-1138" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'orange'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'COVID-19'</span>),</span>
<span id="cb20-1139"><a href="#cb20-1139" aria-hidden="true" tabindex="-1"></a>        Patch(facecolor<span class="op">=</span><span class="st">'purple'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'Bond Crisis 2022-23'</span>),</span>
<span id="cb20-1140"><a href="#cb20-1140" aria-hidden="true" tabindex="-1"></a>    ], loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb20-1141"><a href="#cb20-1141" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-1142"><a href="#cb20-1142" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'divop_timeseries.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb20-1143"><a href="#cb20-1143" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-1144"><a href="#cb20-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1145"><a href="#cb20-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1146"><a href="#cb20-1146" aria-hidden="true" tabindex="-1"></a><span class="fu"># Putting It All Together {#sec-pipeline}</span></span>
<span id="cb20-1147"><a href="#cb20-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1150"><a href="#cb20-1150" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1151"><a href="#cb20-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: merge-all</span></span>
<span id="cb20-1152"><a href="#cb20-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Master pipeline: build full DIVOP dataset"</span></span>
<span id="cb20-1153"><a href="#cb20-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1154"><a href="#cb20-1154" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_divop_dataset(config):</span>
<span id="cb20-1155"><a href="#cb20-1155" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-1156"><a href="#cb20-1156" aria-hidden="true" tabindex="-1"></a><span class="co">    Master pipeline: load data, construct all DIVOP proxies,</span></span>
<span id="cb20-1157"><a href="#cb20-1157" aria-hidden="true" tabindex="-1"></a><span class="co">    merge into a single stock-date panel.</span></span>
<span id="cb20-1158"><a href="#cb20-1158" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-1159"><a href="#cb20-1159" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_daily_data(config)</span>
<span id="cb20-1160"><a href="#cb20-1160" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> apply_sample_filters(df, config)</span>
<span id="cb20-1161"><a href="#cb20-1161" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> adjust_for_corporate_actions(df)</span>
<span id="cb20-1162"><a href="#cb20-1162" aria-hidden="true" tabindex="-1"></a>    calendar <span class="op">=</span> build_trading_calendar(df, config)</span>
<span id="cb20-1163"><a href="#cb20-1163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1164"><a href="#cb20-1164" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> compute_dto(df, config)</span>
<span id="cb20-1165"><a href="#cb20-1165" aria-hidden="true" tabindex="-1"></a>    suv_df <span class="op">=</span> compute_suv(df, calendar, config)</span>
<span id="cb20-1166"><a href="#cb20-1166" aria-hidden="true" tabindex="-1"></a>    vol_df <span class="op">=</span> compute_volatility(df, calendar, config)</span>
<span id="cb20-1167"><a href="#cb20-1167" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> compute_spread_and_illiq(df, config)</span>
<span id="cb20-1168"><a href="#cb20-1168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1169"><a href="#cb20-1169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge</span></span>
<span id="cb20-1170"><a href="#cb20-1170" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'ret'</span>,<span class="st">'close'</span>,<span class="st">'volume'</span>,</span>
<span id="cb20-1171"><a href="#cb20-1171" aria-hidden="true" tabindex="-1"></a>                <span class="st">'shares_outstanding'</span>,<span class="st">'exchange'</span>,<span class="st">'industry_icb'</span>,</span>
<span id="cb20-1172"><a href="#cb20-1172" aria-hidden="true" tabindex="-1"></a>                <span class="st">'foreign_ownership_pct'</span>,<span class="st">'turnover'</span>,</span>
<span id="cb20-1173"><a href="#cb20-1173" aria-hidden="true" tabindex="-1"></a>                <span class="st">'mato'</span>,<span class="st">'dto'</span>,<span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>,<span class="st">'limit_hit'</span>]].copy()</span>
<span id="cb20-1174"><a href="#cb20-1174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1175"><a href="#cb20-1175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> suv_df.empty:</span>
<span id="cb20-1176"><a href="#cb20-1176" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> base.merge(</span>
<span id="cb20-1177"><a href="#cb20-1177" aria-hidden="true" tabindex="-1"></a>            suv_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'suv'</span>,<span class="st">'predicted_turnover'</span>]],</span>
<span id="cb20-1178"><a href="#cb20-1178" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'date'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb20-1179"><a href="#cb20-1179" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> vol_df.empty:</span>
<span id="cb20-1180"><a href="#cb20-1180" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> base.merge(</span>
<span id="cb20-1181"><a href="#cb20-1181" aria-hidden="true" tabindex="-1"></a>            vol_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'total_volatility'</span>,</span>
<span id="cb20-1182"><a href="#cb20-1182" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'idio_volatility'</span>,<span class="st">'market_beta'</span>]],</span>
<span id="cb20-1183"><a href="#cb20-1183" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'date'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb20-1184"><a href="#cb20-1184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1185"><a href="#cb20-1185" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Final DIVOP Dataset ==="</span>)</span>
<span id="cb20-1186"><a href="#cb20-1186" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Shape: </span><span class="sc">{</span>base<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-1187"><a href="#cb20-1187" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tickers: </span><span class="sc">{</span>base[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-1188"><a href="#cb20-1188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base</span>
<span id="cb20-1189"><a href="#cb20-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1190"><a href="#cb20-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1191"><a href="#cb20-1191" aria-hidden="true" tabindex="-1"></a><span class="fu"># Empirical Applications {#sec-applications}</span></span>
<span id="cb20-1192"><a href="#cb20-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1193"><a href="#cb20-1193" aria-hidden="true" tabindex="-1"></a><span class="fu">## Application 1: DIVOP and the Cross-Section of Returns</span></span>
<span id="cb20-1194"><a href="#cb20-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1195"><a href="#cb20-1195" aria-hidden="true" tabindex="-1"></a>The fundamental test of the Miller hypothesis is whether stocks with higher divergence of opinion earn lower subsequent returns. We implement Fama-MacBeth cross-sectional regressions:</span>
<span id="cb20-1196"><a href="#cb20-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1197"><a href="#cb20-1197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-1198"><a href="#cb20-1198" aria-hidden="true" tabindex="-1"></a>r_{i,t+1:t+h} = \gamma_{0,t} + \gamma_{1,t} \cdot \text{DIVOP}_{i,t} + \gamma_{2,t}' \mathbf{X}_{i,t} + \varepsilon_{i,t}</span>
<span id="cb20-1199"><a href="#cb20-1199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb20-1200"><a href="#cb20-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1201"><a href="#cb20-1201" aria-hidden="true" tabindex="-1"></a>where $\mathbf{X}_{i,t}$ includes controls for market beta, log market capitalization, and log book-to-market ratio. The Miller hypothesis predicts $\bar{\gamma}_1 &lt; 0$.</span>
<span id="cb20-1202"><a href="#cb20-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1205"><a href="#cb20-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1206"><a href="#cb20-1206" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fama-macbeth</span></span>
<span id="cb20-1207"><a href="#cb20-1207" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Fama-MacBeth regressions of returns on DIVOP"</span></span>
<span id="cb20-1208"><a href="#cb20-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1209"><a href="#cb20-1209" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fama_macbeth_divop(merged_df, divop_proxy<span class="op">=</span><span class="st">'suv'</span>,</span>
<span id="cb20-1210"><a href="#cb20-1210" aria-hidden="true" tabindex="-1"></a>                        controls<span class="op">=</span><span class="va">None</span>, horizon<span class="op">=</span><span class="dv">21</span>):</span>
<span id="cb20-1211"><a href="#cb20-1211" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-1212"><a href="#cb20-1212" aria-hidden="true" tabindex="-1"></a><span class="co">    Fama-MacBeth cross-sectional regressions.</span></span>
<span id="cb20-1213"><a href="#cb20-1213" aria-hidden="true" tabindex="-1"></a><span class="co">    Miller predicts gamma_1 &lt; 0; Varian predicts gamma_1 &gt; 0.</span></span>
<span id="cb20-1214"><a href="#cb20-1214" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-1215"><a href="#cb20-1215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> controls <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb20-1216"><a href="#cb20-1216" aria-hidden="true" tabindex="-1"></a>        controls <span class="op">=</span> [<span class="st">'market_beta'</span>, <span class="st">'log_mktcap'</span>]</span>
<span id="cb20-1217"><a href="#cb20-1217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1218"><a href="#cb20-1218" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb20-1219"><a href="#cb20-1219" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'ticker'</span>, <span class="st">'date'</span>])</span>
<span id="cb20-1220"><a href="#cb20-1220" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'fwd_ret'</span>] <span class="op">=</span> df.groupby(<span class="st">'ticker'</span>)[<span class="st">'ret'</span>].transform(</span>
<span id="cb20-1221"><a href="#cb20-1221" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.shift(<span class="op">-</span><span class="dv">1</span>).rolling(horizon).<span class="bu">sum</span>().shift(<span class="op">-</span>(horizon<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb20-1222"><a href="#cb20-1222" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1223"><a href="#cb20-1223" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'log_mktcap'</span>] <span class="op">=</span> np.log(</span>
<span id="cb20-1224"><a href="#cb20-1224" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'close'</span>] <span class="op">*</span> df[<span class="st">'shares_outstanding'</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb20-1225"><a href="#cb20-1225" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1226"><a href="#cb20-1226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1227"><a href="#cb20-1227" aria-hidden="true" tabindex="-1"></a>    reg_vars <span class="op">=</span> [<span class="st">'fwd_ret'</span>, divop_proxy] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb20-1228"><a href="#cb20-1228" aria-hidden="true" tabindex="-1"></a>               [c <span class="cf">for</span> c <span class="kw">in</span> controls <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb20-1229"><a href="#cb20-1229" aria-hidden="true" tabindex="-1"></a>    df_reg <span class="op">=</span> df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>] <span class="op">+</span> reg_vars].dropna()</span>
<span id="cb20-1230"><a href="#cb20-1230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1231"><a href="#cb20-1231" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> numpy.linalg <span class="im">import</span> lstsq</span>
<span id="cb20-1232"><a href="#cb20-1232" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb20-1233"><a href="#cb20-1233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> date, cross <span class="kw">in</span> df_reg.groupby(<span class="st">'date'</span>):</span>
<span id="cb20-1234"><a href="#cb20-1234" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(cross) <span class="op">&lt;</span> <span class="dv">30</span>: <span class="cf">continue</span></span>
<span id="cb20-1235"><a href="#cb20-1235" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> cross[<span class="st">'fwd_ret'</span>].values</span>
<span id="cb20-1236"><a href="#cb20-1236" aria-hidden="true" tabindex="-1"></a>        X_cols <span class="op">=</span> [divop_proxy] <span class="op">+</span> [c <span class="cf">for</span> c <span class="kw">in</span> controls <span class="cf">if</span> c <span class="kw">in</span> cross.columns]</span>
<span id="cb20-1237"><a href="#cb20-1237" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.column_stack([np.ones(<span class="bu">len</span>(cross)), cross[X_cols].values])</span>
<span id="cb20-1238"><a href="#cb20-1238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb20-1239"><a href="#cb20-1239" aria-hidden="true" tabindex="-1"></a>            coefs, _, _, _ <span class="op">=</span> lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb20-1240"><a href="#cb20-1240" aria-hidden="true" tabindex="-1"></a>            results.append({</span>
<span id="cb20-1241"><a href="#cb20-1241" aria-hidden="true" tabindex="-1"></a>                <span class="st">'date'</span>: date, <span class="st">'intercept'</span>: coefs[<span class="dv">0</span>],</span>
<span id="cb20-1242"><a href="#cb20-1242" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'gamma_</span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss">'</span>: coefs[<span class="dv">1</span>], <span class="st">'n'</span>: <span class="bu">len</span>(cross),</span>
<span id="cb20-1243"><a href="#cb20-1243" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-1244"><a href="#cb20-1244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>: <span class="cf">continue</span></span>
<span id="cb20-1245"><a href="#cb20-1245" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1246"><a href="#cb20-1246" aria-hidden="true" tabindex="-1"></a>    fm <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb20-1247"><a href="#cb20-1247" aria-hidden="true" tabindex="-1"></a>    gc <span class="op">=</span> <span class="ss">f'gamma_</span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-1248"><a href="#cb20-1248" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> fm[gc].mean()</span>
<span id="cb20-1249"><a href="#cb20-1249" aria-hidden="true" tabindex="-1"></a>    se <span class="op">=</span> fm[gc].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(fm))</span>
<span id="cb20-1250"><a href="#cb20-1250" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> mu <span class="op">/</span> se</span>
<span id="cb20-1251"><a href="#cb20-1251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1252"><a href="#cb20-1252" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Fama-MacBeth: </span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss"> -&gt; "</span></span>
<span id="cb20-1253"><a href="#cb20-1253" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>horizon<span class="sc">}</span><span class="ss">-day fwd returns ==="</span>)</span>
<span id="cb20-1254"><a href="#cb20-1254" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean gamma: </span><span class="sc">{</span>mu<span class="sc">:.6f}</span><span class="ss">, t-stat: </span><span class="sc">{</span>t<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb20-1255"><a href="#cb20-1255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.96</span>:   <span class="bu">print</span>(<span class="st">"  -&gt; Supports Miller (1977)"</span>)</span>
<span id="cb20-1256"><a href="#cb20-1256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> t <span class="op">&gt;</span> <span class="fl">1.96</span>:   <span class="bu">print</span>(<span class="st">"  -&gt; Supports Varian (1985)"</span>)</span>
<span id="cb20-1257"><a href="#cb20-1257" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:            <span class="bu">print</span>(<span class="st">"  -&gt; Inconclusive at 5%"</span>)</span>
<span id="cb20-1258"><a href="#cb20-1258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fm</span>
<span id="cb20-1259"><a href="#cb20-1259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1260"><a href="#cb20-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1261"><a href="#cb20-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">## Application 2: DIVOP and Earnings Announcements</span></span>
<span id="cb20-1262"><a href="#cb20-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1263"><a href="#cb20-1263" aria-hidden="true" tabindex="-1"></a>Following @berkman2009sell, we test whether high-DIVOP stocks experience negative abnormal returns around earnings announcements, as uncertainty resolution reduces the optimism premium.</span>
<span id="cb20-1264"><a href="#cb20-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1267"><a href="#cb20-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1268"><a href="#cb20-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ea-event</span></span>
<span id="cb20-1269"><a href="#cb20-1269" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Event study: DIVOP and earnings announcement returns"</span></span>
<span id="cb20-1270"><a href="#cb20-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1271"><a href="#cb20-1271" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> divop_earnings_event(merged_df, ea_dates_df,</span>
<span id="cb20-1272"><a href="#cb20-1272" aria-hidden="true" tabindex="-1"></a>                          divop_proxy<span class="op">=</span><span class="st">'suv'</span>, window<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)):</span>
<span id="cb20-1273"><a href="#cb20-1273" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-1274"><a href="#cb20-1274" aria-hidden="true" tabindex="-1"></a><span class="co">    Sort stocks into DIVOP quintiles pre-EA, compute CAR in window.</span></span>
<span id="cb20-1275"><a href="#cb20-1275" aria-hidden="true" tabindex="-1"></a><span class="co">    Miller predicts: Q5 (high DIVOP) has lower CAR than Q1 (low DIVOP).</span></span>
<span id="cb20-1276"><a href="#cb20-1276" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-1277"><a href="#cb20-1277" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> merged_df.copy()</span>
<span id="cb20-1278"><a href="#cb20-1278" aria-hidden="true" tabindex="-1"></a>    ea <span class="op">=</span> ea_dates_df.copy()</span>
<span id="cb20-1279"><a href="#cb20-1279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1280"><a href="#cb20-1280" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-EA DIVOP value (5 days before)</span></span>
<span id="cb20-1281"><a href="#cb20-1281" aria-hidden="true" tabindex="-1"></a>    ea[<span class="st">'pre_date'</span>] <span class="op">=</span> ea[<span class="st">'ea_date'</span>] <span class="op">-</span> pd.Timedelta(days<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb20-1282"><a href="#cb20-1282" aria-hidden="true" tabindex="-1"></a>    ea <span class="op">=</span> ea.merge(</span>
<span id="cb20-1283"><a href="#cb20-1283" aria-hidden="true" tabindex="-1"></a>        df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,divop_proxy]].rename(</span>
<span id="cb20-1284"><a href="#cb20-1284" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>{<span class="st">'date'</span>:<span class="st">'pre_date'</span>}),</span>
<span id="cb20-1285"><a href="#cb20-1285" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>[<span class="st">'ticker'</span>,<span class="st">'pre_date'</span>], how<span class="op">=</span><span class="st">'inner'</span></span>
<span id="cb20-1286"><a href="#cb20-1286" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1287"><a href="#cb20-1287" aria-hidden="true" tabindex="-1"></a>    ea[<span class="st">'divop_q'</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb20-1288"><a href="#cb20-1288" aria-hidden="true" tabindex="-1"></a>        ea[divop_proxy], <span class="dv">5</span>,</span>
<span id="cb20-1289"><a href="#cb20-1289" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">'Q1 Low'</span>,<span class="st">'Q2'</span>,<span class="st">'Q3'</span>,<span class="st">'Q4'</span>,<span class="st">'Q5 High'</span>],</span>
<span id="cb20-1290"><a href="#cb20-1290" aria-hidden="true" tabindex="-1"></a>        duplicates<span class="op">=</span><span class="st">'drop'</span></span>
<span id="cb20-1291"><a href="#cb20-1291" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1292"><a href="#cb20-1292" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1293"><a href="#cb20-1293" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== EA Event Study by </span><span class="sc">{</span>divop_proxy<span class="sc">}</span><span class="ss"> quintile ==="</span>)</span>
<span id="cb20-1294"><a href="#cb20-1294" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Window: (</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">) days"</span>)</span>
<span id="cb20-1295"><a href="#cb20-1295" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Miller predicts: Q5 has lower CAR than Q1"</span>)</span>
<span id="cb20-1296"><a href="#cb20-1296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ea</span>
<span id="cb20-1297"><a href="#cb20-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1298"><a href="#cb20-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1299"><a href="#cb20-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Application 3: Composite DIVOP Index via PCA</span></span>
<span id="cb20-1300"><a href="#cb20-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1301"><a href="#cb20-1301" aria-hidden="true" tabindex="-1"></a>When a single summary measure of disagreement is needed, PCA on the battery of standardized proxies extracts the common "disagreement factor."</span>
<span id="cb20-1302"><a href="#cb20-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1305"><a href="#cb20-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb20-1306"><a href="#cb20-1306" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pca-composite</span></span>
<span id="cb20-1307"><a href="#cb20-1307" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Composite DIVOP index via PCA"</span></span>
<span id="cb20-1308"><a href="#cb20-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1309"><a href="#cb20-1309" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb20-1310"><a href="#cb20-1310" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb20-1311"><a href="#cb20-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1312"><a href="#cb20-1312" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> composite_divop_pca(merged_df, proxies<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb20-1313"><a href="#cb20-1313" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extract first principal component from standardized DIVOP proxies."""</span></span>
<span id="cb20-1314"><a href="#cb20-1314" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> proxies <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb20-1315"><a href="#cb20-1315" aria-hidden="true" tabindex="-1"></a>        proxies <span class="op">=</span> [<span class="st">'dto'</span>,<span class="st">'suv'</span>,<span class="st">'total_volatility'</span>,<span class="st">'idio_volatility'</span>,</span>
<span id="cb20-1316"><a href="#cb20-1316" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'baspread'</span>,<span class="st">'amihud_daily'</span>]</span>
<span id="cb20-1317"><a href="#cb20-1317" aria-hidden="true" tabindex="-1"></a>    avail <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> proxies <span class="cf">if</span> p <span class="kw">in</span> merged_df.columns]</span>
<span id="cb20-1318"><a href="#cb20-1318" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> merged_df[[<span class="st">'ticker'</span>,<span class="st">'date'</span>] <span class="op">+</span> avail].dropna()</span>
<span id="cb20-1319"><a href="#cb20-1319" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1320"><a href="#cb20-1320" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb20-1321"><a href="#cb20-1321" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> scaler.fit_transform(data[avail])</span>
<span id="cb20-1322"><a href="#cb20-1322" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1323"><a href="#cb20-1323" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb20-1324"><a href="#cb20-1324" aria-hidden="true" tabindex="-1"></a>    factors <span class="op">=</span> pca.fit_transform(X)</span>
<span id="cb20-1325"><a href="#cb20-1325" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'divop_composite'</span>] <span class="op">=</span> factors[:, <span class="dv">0</span>]</span>
<span id="cb20-1326"><a href="#cb20-1326" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1327"><a href="#cb20-1327" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure positive correlation with inputs</span></span>
<span id="cb20-1328"><a href="#cb20-1328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> avail:</span>
<span id="cb20-1329"><a href="#cb20-1329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[<span class="st">'divop_composite'</span>].corr(data[col]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb20-1330"><a href="#cb20-1330" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">'divop_composite'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb20-1331"><a href="#cb20-1331" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb20-1332"><a href="#cb20-1332" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1333"><a href="#cb20-1333" aria-hidden="true" tabindex="-1"></a>    loadings <span class="op">=</span> pd.DataFrame(</span>
<span id="cb20-1334"><a href="#cb20-1334" aria-hidden="true" tabindex="-1"></a>        pca.components_.T, index<span class="op">=</span>avail,</span>
<span id="cb20-1335"><a href="#cb20-1335" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="st">'PC1'</span>,<span class="st">'PC2'</span>,<span class="st">'PC3'</span>]</span>
<span id="cb20-1336"><a href="#cb20-1336" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-1337"><a href="#cb20-1337" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-1338"><a href="#cb20-1338" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== PCA Composite DIVOP ==="</span>)</span>
<span id="cb20-1339"><a href="#cb20-1339" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Variance explained: "</span></span>
<span id="cb20-1340"><a href="#cb20-1340" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>pca<span class="sc">.</span>explained_variance_ratio_[:<span class="dv">3</span>]<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-1341"><a href="#cb20-1341" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Loadings:</span><span class="ch">\n</span><span class="sc">{</span>loadings<span class="sc">.</span>to_string(float_format<span class="op">=</span><span class="st">'</span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-1342"><a href="#cb20-1342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[[<span class="st">'ticker'</span>,<span class="st">'date'</span>,<span class="st">'divop_composite'</span>]], loadings</span>
<span id="cb20-1343"><a href="#cb20-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-1344"><a href="#cb20-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1345"><a href="#cb20-1345" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion and Practical Recommendations</span></span>
<span id="cb20-1346"><a href="#cb20-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1347"><a href="#cb20-1347" aria-hidden="true" tabindex="-1"></a>This chapter has provided a comprehensive methodology for constructing seven distinct proxies for divergence of investor opinion adapted to the Vietnamese equity market. We conclude with practical recommendations:</span>
<span id="cb20-1348"><a href="#cb20-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1349"><a href="#cb20-1349" aria-hidden="true" tabindex="-1"></a>**1. Prefer multiple proxies.** No single DIVOP measure is without limitations. We recommend constructing and reporting results for at least three proxies spanning different economic channels (volume, volatility, spreads or analyst-based).</span>
<span id="cb20-1350"><a href="#cb20-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1351"><a href="#cb20-1351" aria-hidden="true" tabindex="-1"></a>**2. Account for Vietnam-specific microstructure.** Daily price limits, T+2 settlement, foreign ownership constraints, and the order-driven market structure all affect DIVOP properties. Flag limit-hit days, include exchange fixed effects, and control for foreign ownership.</span>
<span id="cb20-1352"><a href="#cb20-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1353"><a href="#cb20-1353" aria-hidden="true" tabindex="-1"></a>**3. Vietnam as a natural laboratory for Miller (1977).** The absence of short selling through 2024 and the dominance of retail investors create conditions that closely match Miller's theoretical setting. The introduction of short selling in 2025 creates a natural experiment for examining how relaxation of short-sale constraints affects the DIVOP-return relation.</span>
<span id="cb20-1354"><a href="#cb20-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1355"><a href="#cb20-1355" aria-hidden="true" tabindex="-1"></a>**4. Control for analyst coverage when using DISP measures.** With typical coverage of 5--10 analysts per firm, forecast dispersion is estimated with greater noise than in developed markets. Always include the number of analysts as a control variable and conduct robustness checks with varying minimum-analyst thresholds.</span>
<span id="cb20-1356"><a href="#cb20-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1357"><a href="#cb20-1357" aria-hidden="true" tabindex="-1"></a>**5. Consider constructing a composite index.** When researchers need a single summary measure of disagreement, the PCA-based composite index described in @sec-applications provides a principled approach to aggregating information across the individual proxies. The first principal component typically explains 30-50% of the common variation in the battery of DIVOP measures.</span>
<span id="cb20-1358"><a href="#cb20-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1359"><a href="#cb20-1359" aria-hidden="true" tabindex="-1"></a>**6. Winsorize aggressively.** Several DIVOP proxies (particularly DISP1, Amihud ILLIQ, and SUV) exhibit extreme outliers in the Vietnamese data. Winsorization at the 1st and 99th percentiles (or even 2nd and 98th for DISP1) is essential for obtaining reliable regression results.</span>
<span id="cb20-1360"><a href="#cb20-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1361"><a href="#cb20-1361" aria-hidden="true" tabindex="-1"></a>**7. Be cautious about causal inference.** DIVOP proxies are endogenous, they respond to the same firm characteristics (size, leverage, growth) that also affect returns. Researchers should use appropriate controls, consider instrumental variables where feasible, and be explicit about the limitations of their identification strategy.</span>
<span id="cb20-1362"><a href="#cb20-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1363"><a href="#cb20-1363" aria-hidden="true" tabindex="-1"></a>The DIVOP framework is particularly relevant for the Vietnamese market at this point in its development. As the market matures toward potential FTSE Emerging Market reclassification, as short selling becomes more widely available, and as institutional investor participation grows, the dynamics of opinion divergence and its pricing implications are likely to evolve significantly. The methodology presented in this chapter provides researchers with the tools to document and analyze these changes as they unfold.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/edit/main/20_divop.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>