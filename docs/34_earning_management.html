<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Earnings Management: Detection and Measurement ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./35_pe_ratio.html" rel="next">
<link href="./33_accruals.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-72097b8a1e3a3da1d7b8bbfaaf81c3d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-ed993afc62d41eaa40b4794cd0abf8eb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="27&nbsp; Earnings Management: Detection and Measurement ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta property="og:description" content="">
<meta property="og:image" content="https://mikenguyen13.github.io/tidy_finance_vn_vi/34_earning_management_files/figure-html/fig-power-output-1.png">
<meta property="og:site_name" content="T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta property="og:image:height" content="1460">
<meta property="og:image:width" content="4164">
<meta name="twitter:title" content="27&nbsp; Earnings Management: Detection and Measurement ‚Äì T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://mikenguyen13.github.io/tidy_finance_vn_vi/34_earning_management_files/figure-html/fig-power-output-1.png">
<meta name="twitter:image-height" content="1460">
<meta name="twitter:image-width" content="4164">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">T√†i Ch√≠nh ·ª®ng D·ª•ng v·ªõi Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn/"> 
<span class="menu-text">üìò English Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mikenguyen13.github.io/tidy_finance_vn_vi/"> 
<span class="menu-text">üìó S√°ch Ti·∫øng Vi·ªát</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/mikenguyen13/tidy_finance_vn_vi" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./30_financial_statement_analysis.html">C√°c y·∫øu t·ªë c∆° b·∫£n c·ªßa c√¥ng ty, ƒë·ªãnh gi√° v√† t√≠n hi·ªáu doanh nghi·ªáp</a></li><li class="breadcrumb-item"><a href="./34_earning_management.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L·ªùi n√≥i ƒë·∫ßu</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Th·ªã tr∆∞·ªùng t√†i ch√≠nh, th·ªÉ ch·∫ø v√† d·ªØ li·ªáu Vi·ªát Nam</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_institutional_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">N·ªÅn t·∫£ng th·ªÉ ch·∫ø v√† c·∫•u tr√∫c th·ªã tr∆∞·ªùng c·ªßa th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_accessing_and_managing_financial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Truy c·∫≠p v√† qu·∫£n l√Ω d·ªØ li·ªáu t√†i ch√≠nh VN</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_datacore_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">D·ªØ li·ªáu Datacore</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_market_microstructure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">C·∫•u tr√∫c th·ªã tr∆∞·ªùng vi m√¥ t·∫°i Vi·ªát Nam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_risk_free_rate_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk-Free Rate Construction in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_working_with_stock_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Constructing and Analyzing Equity Return Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_compound_return.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Compound Returns</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">X√¢y d·ª±ng danh m·ª•c ƒë·∫ßu t∆∞, r·ªßi ro v√† c∆° h·ªçc th·ª±c nghi·ªám</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_modern_portfolio_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modern Portfolio Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_univariate_portfolio_sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Portfolio Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_size_sorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Size Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_value_bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Value and Bivariate Sorts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_portfolio_weighting_and_rebalancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Portfolio Weighting and Rebalancing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_missing_data_and_survivorship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Missing Data and Survivorship Bias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_liquidity_and_turnover_measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Liquidity and Turnover Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_beta_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Beta Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh ƒë·ªãnh gi√° t√†i s·∫£n</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_capm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Capital Asset Pricing Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_fama_french.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fama-French Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_momentum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Momentum Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_factor_construction_principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Factor Construction Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_fama_macbeth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Fama-MacBeth Regressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_factor_zoo_and_multiple_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Factor Zoo and Multiple Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_time_series_vs_cross_section.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Time-Series vs.&nbsp;Cross-Sectional Factor Tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">C√°c y·∫øu t·ªë c∆° b·∫£n c·ªßa c√¥ng ty, ƒë·ªãnh gi√° v√† t√≠n hi·ªáu doanh nghi·ªáp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_financial_statement_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Financial Statement Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_discounted_cash_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Discounted Cash Flow Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_info_earnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Information Content of Earnings Announcements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_accruals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Accruals, Earnings Persistence, and Market Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_earning_management.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./35_pe_ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./36_valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Firm Valuation, Financial Distress, and Company Maturity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./37_disclosure_quality_and_timing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Disclosure Quality and Timing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./38_sue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Standardized Earnings Surprises (SUE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./39_divop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Measuring Divergence of Investor Opinion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Quy·ªÅn s·ªü h·ªØu, ma s√°t th·ªã tr∆∞·ªùng v√† r·ªßi ro qu·ªëc t·∫ø</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_institutional_ownership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Institutional Ownership Analytics in Vietnam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./52_institutional_trade_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Institutional Trades, Flows, and Turnover Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./53_governance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Corporate Governance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./54_return_gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Return Gap: Measuring Unobserved Actions of Fund Managers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./55_price_limits_and_volatility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Price Limits and Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./56_market_integration_and_segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Market Integration and Segmentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./57_exchange_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Exchange Rate Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">M√¥ h√¨nh t√†i ch√≠nh n√¢ng cao</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_event_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Event Studies in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./61_tail_risk_extreme_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Tail Risk and Extreme Events</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./62_corporate_finance_estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Corporate Finance Estimators and Identification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./63_structural_models_finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Structural Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">D·ªØ li·ªáu thay th·∫ø v√† Tr√≠ tu·ªá nh√¢n t·∫°o trong t√†i ch√≠nh</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_textual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Textual Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./71_image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Image and Visual Data in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./73_networks_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Networks and Graphs in Finance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./74_multimodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Multimodal Models in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#defining-earnings-management" id="toc-defining-earnings-management" class="nav-link active" data-scroll-target="#defining-earnings-management"><span class="header-section-number">27.0.1</span> Defining Earnings Management</a></li>
  <li><a href="#why-vietnam" id="toc-why-vietnam" class="nav-link" data-scroll-target="#why-vietnam"><span class="header-section-number">27.0.2</span> Why Vietnam?</a></li>
  <li><a href="#sec-models" id="toc-sec-models" class="nav-link" data-scroll-target="#sec-models"><span class="header-section-number">27.1</span> Models of Non-Discretionary Accruals</a>
  <ul class="collapse">
  <li><a href="#notation-and-setup" id="toc-notation-and-setup" class="nav-link" data-scroll-target="#notation-and-setup"><span class="header-section-number">27.1.1</span> Notation and Setup</a></li>
  <li><a href="#five-models" id="toc-five-models" class="nav-link" data-scroll-target="#five-models"><span class="header-section-number">27.1.2</span> Five Models</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">27.1.3</span> Implementation</a></li>
  <li><a href="#the-salkever-1976-correction" id="toc-the-salkever-1976-correction" class="nav-link" data-scroll-target="#the-salkever-1976-correction"><span class="header-section-number">27.1.4</span> The Salkever (1976) Correction</a></li>
  </ul></li>
  <li><a href="#sec-type1" id="toc-sec-type1" class="nav-link" data-scroll-target="#sec-type1"><span class="header-section-number">27.2</span> Type I Error Under the Null Hypothesis</a>
  <ul class="collapse">
  <li><a href="#experimental-design" id="toc-experimental-design" class="nav-link" data-scroll-target="#experimental-design"><span class="header-section-number">27.2.1</span> Experimental Design</a></li>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link" data-scroll-target="#data-generation"><span class="header-section-number">27.2.2</span> Data Generation</a></li>
  <li><a href="#sample-construction" id="toc-sample-construction" class="nav-link" data-scroll-target="#sample-construction"><span class="header-section-number">27.2.3</span> Sample Construction</a></li>
  <li><a href="#estimating-discretionary-accruals" id="toc-estimating-discretionary-accruals" class="nav-link" data-scroll-target="#estimating-discretionary-accruals"><span class="header-section-number">27.2.4</span> Estimating Discretionary Accruals</a></li>
  <li><a href="#firm-level-regressions-and-rejection-rates" id="toc-firm-level-regressions-and-rejection-rates" class="nav-link" data-scroll-target="#firm-level-regressions-and-rejection-rates"><span class="header-section-number">27.2.5</span> Firm-Level Regressions and Rejection Rates</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">27.2.6</span> Results</a></li>
  <li><a href="#binomial-test-for-size-distortion" id="toc-binomial-test-for-size-distortion" class="nav-link" data-scroll-target="#binomial-test-for-size-distortion"><span class="header-section-number">27.2.7</span> Binomial Test for Size Distortion</a></li>
  </ul></li>
  <li><a href="#sec-extreme" id="toc-sec-extreme" class="nav-link" data-scroll-target="#sec-extreme"><span class="header-section-number">27.3</span> Extreme Performance Firms</a>
  <ul class="collapse">
  <li><a href="#constructing-extreme-performance-samples" id="toc-constructing-extreme-performance-samples" class="nav-link" data-scroll-target="#constructing-extreme-performance-samples"><span class="header-section-number">27.3.1</span> Constructing Extreme-Performance Samples</a></li>
  <li><a href="#performance-matching" id="toc-performance-matching" class="nav-link" data-scroll-target="#performance-matching"><span class="header-section-number">27.3.2</span> Performance Matching</a></li>
  </ul></li>
  <li><a href="#sec-power" id="toc-sec-power" class="nav-link" data-scroll-target="#sec-power"><span class="header-section-number">27.4</span> Power Analysis</a>
  <ul class="collapse">
  <li><a href="#artificially-introducing-earnings-management" id="toc-artificially-introducing-earnings-management" class="nav-link" data-scroll-target="#artificially-introducing-earnings-management"><span class="header-section-number">27.4.1</span> Artificially Introducing Earnings Management</a></li>
  <li><a href="#power-functions" id="toc-power-functions" class="nav-link" data-scroll-target="#power-functions"><span class="header-section-number">27.4.2</span> Power Functions</a></li>
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics"><span class="header-section-number">27.4.3</span> Summary Statistics</a></li>
  </ul></li>
  <li><a href="#sec-vietnam" id="toc-sec-vietnam" class="nav-link" data-scroll-target="#sec-vietnam"><span class="header-section-number">27.5</span> Vietnamese Institutional Context</a>
  <ul class="collapse">
  <li><a href="#channels-of-earnings-management" id="toc-channels-of-earnings-management" class="nav-link" data-scroll-target="#channels-of-earnings-management"><span class="header-section-number">27.5.1</span> Channels of Earnings Management</a></li>
  <li><a href="#the-earnings-distribution-test" id="toc-the-earnings-distribution-test" class="nav-link" data-scroll-target="#the-earnings-distribution-test"><span class="header-section-number">27.5.2</span> The Earnings Distribution Test</a></li>
  <li><a href="#accrual-based-vs.-real-earnings-management" id="toc-accrual-based-vs.-real-earnings-management" class="nav-link" data-scroll-target="#accrual-based-vs.-real-earnings-management"><span class="header-section-number">27.5.3</span> Accrual-Based vs.&nbsp;Real Earnings Management</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">27.6</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/34_earning_management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./30_financial_statement_analysis.html">C√°c y·∫øu t·ªë c∆° b·∫£n c·ªßa c√¥ng ty, ƒë·ªãnh gi√° v√† t√≠n hi·ªáu doanh nghi·ªáp</a></li><li class="breadcrumb-item"><a href="./34_earning_management.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Earnings Management: Detection and Measurement</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="setup" class="cell" data-message="false" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.dpi"</span>: <span class="dv">150</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.top"</span>: <span class="va">False</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.right"</span>: <span class="va">False</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.size"</span>: <span class="dv">11</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Earnings management refers to the purposeful intervention by managers in the financial reporting process to achieve outcomes that serve private objectives, whether to meet analyst forecasts, trigger bonus thresholds, avoid covenant violations, or influence equity valuations. While the concept is intuitive, its rigorous detection poses one of the most enduring methodological challenges in empirical accounting research.</p>
<p>The difficulty is fundamental: researchers observe <em>total</em> accruals, which combine a legitimate component (reflecting genuine economic activity) with a discretionary component (reflecting managerial intervention). Separating these two components requires a model of what accruals <em>should</em> be absent manipulation, what the literature calls <strong>non-discretionary accruals (NDA)</strong>. Any residual, the gap between observed accruals and the model‚Äôs prediction, is then attributed to managerial discretion. The quality of the detection method therefore hinges entirely on the quality of this model.</p>
<p>This chapter examines three foundational approaches to measuring earnings management (i.e., the <span class="citation" data-cites="healy1985effect">Healy (<a href="references.html#ref-healy1985effect" role="doc-biblioref">1985</a>)</span> model, the <span class="citation" data-cites="jones1991earnings">Jones (<a href="references.html#ref-jones1991earnings" role="doc-biblioref">1991</a>)</span> model, and the modified Jones model of <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span>) and evaluates their statistical properties using simulation. We then adapt the analysis to the institutional setting of Vietnam, where distinct governance structures, accounting standards, and enforcement regimes create both unique incentives for earnings management and unique challenges for its detection.</p>
<section id="defining-earnings-management" class="level3" data-number="27.0.1">
<h3 data-number="27.0.1" class="anchored" data-anchor-id="defining-earnings-management"><span class="header-section-number">27.0.1</span> Defining Earnings Management</h3>
<p>A useful taxonomy distinguishes three forms:</p>
<ol type="1">
<li><p><strong>Accrual-based earnings management (AEM).</strong> Managers exploit discretion within accounting standards to shift the timing of revenue or expense recognition. Examples include aggressive revenue recognition, delays in write-downs, or manipulation of allowance estimates. This form does not alter the firm‚Äôs underlying cash flows.</p></li>
<li><p><strong>Real earnings management (REM).</strong> Managers take genuine economic actions (e.g., overproduction to reduce unit costs, cutting R&amp;D or advertising expenditure, offering price discounts to accelerate sales) that have real cash flow consequences <span class="citation" data-cites="roychowdhury2006earnings">(<a href="references.html#ref-roychowdhury2006earnings" role="doc-biblioref">Roychowdhury 2006</a>)</span>. These actions may improve current-period earnings at the expense of future value.</p></li>
<li><p><strong>Classification shifting.</strong> Managers reclassify core expenses as non-recurring items to inflate core earnings without changing bottom-line net income. This form leaves both total accruals and cash flows unchanged.</p></li>
</ol>
</section>
<section id="why-vietnam" class="level3" data-number="27.0.2">
<h3 data-number="27.0.2" class="anchored" data-anchor-id="why-vietnam"><span class="header-section-number">27.0.2</span> Why Vietnam?</h3>
<p>Vietnam‚Äôs institutional environment amplifies several channels relevant to earnings management research:</p>
<ul>
<li><p><strong>State-owned enterprise (SOE) incentives.</strong> Partially privatized SOEs face dual pressures: political targets from state shareholders and market expectations from minority investors.</p></li>
<li><p><strong>Regulatory enforcement.</strong> Vietnam‚Äôs State Securities Commission (SSC) has limited resources and a short institutional history relative to bodies like the U.S. SEC. Weaker enforcement reduces the expected cost of manipulation, potentially increasing its prevalence <span class="citation" data-cites="leuz2003earnings">(<a href="references.html#ref-leuz2003earnings" role="doc-biblioref">Leuz, Nanda, and Wysocki 2003</a>)</span>.</p></li>
<li><p><strong>Accounting standards.</strong> VAS (Vietnamese Accounting Standards) are based on older IAS versions and have not fully converged with IFRS. Certain VAS provisions, such as rules-based revenue recognition criteria and prescribed depreciation methods, constrain some forms of discretion while creating predictable opportunities for others.</p></li>
<li><p><strong>Benchmark-beating behavior.</strong> <span class="citation" data-cites="burgstahler1997earnings">Burgstahler and Dichev (<a href="references.html#ref-burgstahler1997earnings" role="doc-biblioref">1997</a>)</span> documented discontinuities around zero earnings and zero earnings changes in U.S. data. The Vietnamese market, with its high retail participation and emphasis on headline profitability, may exhibit similar or even more pronounced patterns.</p></li>
</ul>
</section>
<section id="sec-models" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="sec-models"><span class="header-section-number">27.1</span> Models of Non-Discretionary Accruals</h2>
<section id="notation-and-setup" class="level3" data-number="27.1.1">
<h3 data-number="27.1.1" class="anchored" data-anchor-id="notation-and-setup"><span class="header-section-number">27.1.1</span> Notation and Setup</h3>
<p>Let <span class="math inline">\(i\)</span> index firms and <span class="math inline">\(t\)</span> index fiscal years. Define:</p>
<div id="tbl-em-notation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-em-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.1: Notation for earnings management models
</figcaption>
<div aria-describedby="tbl-em-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(TA_{i,t}\)</span></td>
<td>Total accruals (scaled by lagged assets)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(NDA_{i,t}\)</span></td>
<td>Non-discretionary accruals (model prediction)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(DA_{i,t}\)</span></td>
<td>Discretionary accruals: <span class="math inline">\(DA_{i,t} = TA_{i,t} - NDA_{i,t}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(A_{i,t}\)</span></td>
<td>Total assets</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\Delta Rev_{i,t}\)</span></td>
<td>Change in revenues, scaled by <span class="math inline">\(A_{i,t-1}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\Delta Rec_{i,t}\)</span></td>
<td>Change in net receivables, scaled by <span class="math inline">\(A_{i,t-1}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(PPE_{i,t}\)</span></td>
<td>Gross property, plant, and equipment, scaled by <span class="math inline">\(A_{i,t-1}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(PART_{i,t}\)</span></td>
<td>Indicator equal to 1 for the test (event) year</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Total accruals are computed using the balance sheet approach:</p>
<p><span id="eq-total-accruals"><span class="math display">\[
TA_{i,t} = \frac{(\Delta CA_{i,t} - \Delta Cash_{i,t}) - (\Delta CL_{i,t} - \Delta STD_{i,t}) - Dep_{i,t}}{A_{i,t-1}}
\tag{27.1}\]</span></span></p>
<p>where <span class="math inline">\(\Delta CA\)</span> is the change in current assets, <span class="math inline">\(\Delta Cash\)</span> is the change in cash, <span class="math inline">\(\Delta CL\)</span> is the change in current liabilities, <span class="math inline">\(\Delta STD\)</span> is the change in short-term debt, and <span class="math inline">\(Dep\)</span> is depreciation expense.</p>
</section>
<section id="five-models" class="level3" data-number="27.1.2">
<h3 data-number="27.1.2" class="anchored" data-anchor-id="five-models"><span class="header-section-number">27.1.2</span> Five Models</h3>
<p>We implement five models, each estimating <span class="math inline">\(NDA\)</span> during a firm-specific estimation window and computing <span class="math inline">\(DA\)</span> for the test year as the residual.</p>
<p><strong>Model 1</strong>: <span class="citation" data-cites="healy1985effect">Healy (<a href="references.html#ref-healy1985effect" role="doc-biblioref">1985</a>)</span>. Non-discretionary accruals equal the mean of total accruals during the estimation period:</p>
<p><span id="eq-healy"><span class="math display">\[
NDA^{Healy}_{i,t} = \frac{1}{T} \sum_{s \in \text{est}} TA_{i,s}
\tag{27.2}\]</span></span></p>
<p>This is the simplest possible benchmark. Its limitation is obvious: it treats <em>all</em> time-variation in accruals as discretionary, even variation driven by changes in the firm‚Äôs economic environment.</p>
<p><strong>Model 2</strong>: <span class="citation" data-cites="deangelo1986accounting">DeAngelo (<a href="references.html#ref-deangelo1986accounting" role="doc-biblioref">1986</a>)</span>. Non-discretionary accruals equal last period‚Äôs total accruals:</p>
<p><span id="eq-deangelo"><span class="math display">\[
NDA^{DeAngelo}_{i,t} = TA_{i,t-1}
\tag{27.3}\]</span></span></p>
<p>This is equivalent to assuming that the change in total accruals is entirely discretionary. It performs well when accruals follow a random walk, but poorly when they exhibit mean-reversion or trend.</p>
<p><strong>Model 3</strong>: <span class="citation" data-cites="jones1991earnings">Jones (<a href="references.html#ref-jones1991earnings" role="doc-biblioref">1991</a>)</span>. This model controls for changes in a firm‚Äôs economic environment by regressing accruals on revenue changes and the level of fixed assets:</p>
<p><span id="eq-jones"><span class="math display">\[
TA_{i,t} = \alpha_1 \frac{1}{A_{i,t-1}} + \alpha_2 \Delta Rev_{i,t} + \alpha_3 PPE_{i,t} + \varepsilon_{i,t}
\tag{27.4}\]</span></span></p>
<p>The parameters <span class="math inline">\(\hat{\alpha}_1, \hat{\alpha}_2, \hat{\alpha}_3\)</span> are estimated on the estimation-period data. Non-discretionary accruals for the test year are the fitted values from this regression applied to test-year covariates.</p>
<p>The economic logic is that revenue growth generates legitimate working capital accruals (higher receivables and inventory), while fixed assets proxy for non-discretionary depreciation charges. The intercept is scaled by lagged assets rather than included as a conventional constant, following <span class="citation" data-cites="jones1991earnings">Jones (<a href="references.html#ref-jones1991earnings" role="doc-biblioref">1991</a>)</span>.</p>
<p><strong>Model 4: Modified Jones</strong> <span class="citation" data-cites="dechow1995detecting">(<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">Dechow, Sloan, and Sweeney 1995</a>)</span>. The modification adjusts revenue changes for changes in receivables during the test year, on the premise that credit revenue growth is more susceptible to manipulation than cash revenue growth:</p>
<p><span id="eq-mod-jones"><span class="math display">\[
NDA^{ModJones}_{i,t} = \hat{\alpha}_1 \frac{1}{A_{i,t-1}} + \hat{\alpha}_2 (\Delta Rev_{i,t} - \Delta Rec_{i,t}) + \hat{\alpha}_3 PPE_{i,t}
\tag{27.5}\]</span></span></p>
<p>The coefficients are still estimated from the <em>unadjusted</em> Jones model (<a href="#eq-jones" class="quarto-xref">Equation&nbsp;<span>27.4</span></a>) on estimation-period data, but receivables are subtracted from revenues only when computing fitted values for the test year.</p>
<p><strong>Model 5: Industry Model.</strong> This model assumes that the common component of accruals within an industry captures non-discretionary variation:</p>
<p><span id="eq-industry"><span class="math display">\[
TA_{i,t} = \phi_0 + \phi_1 \cdot \widetilde{TA}_{j,t} + \eta_{i,t}
\tag{27.6}\]</span></span></p>
<p>where <span class="math inline">\(\widetilde{TA}_{j,t}\)</span> is the median total accrual across all firms in industry <span class="math inline">\(j\)</span> (excluding firm <span class="math inline">\(i\)</span>), estimated during the estimation period.</p>
</section>
<section id="implementation" class="level3" data-number="27.1.3">
<h3 data-number="27.1.3" class="anchored" data-anchor-id="implementation"><span class="header-section-number">27.1.3</span> Implementation</h3>
<div id="calc-accruals-fn" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_accruals(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute total accruals using the balance sheet approach.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected columns: gvkey/ticker, year/fyear, at, act, che, lct, dlc,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">                      dp, sale, rect, ppegt</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"year"</span> <span class="cf">if</span> <span class="st">"year"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"fyear"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([firm_col, year_col]).copy()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lagged values and changes</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"lag_at"</span>] <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_ca"</span>] <span class="op">=</span> g[<span class="st">"act"</span>].diff()</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_cash"</span>] <span class="op">=</span> g[<span class="st">"che"</span>].diff()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_cl"</span>] <span class="op">=</span> g[<span class="st">"lct"</span>].diff()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_std"</span>] <span class="op">=</span> g[<span class="st">"dlc"</span>].diff()</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev"</span>] <span class="op">=</span> g[<span class="st">"sale"</span>].diff()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rec"</span>] <span class="op">=</span> g[<span class="st">"rect"</span>].diff()</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total accruals (raw)</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"acc_raw"</span>] <span class="op">=</span> (df[<span class="st">"d_ca"</span>] <span class="op">-</span> df[<span class="st">"d_cash"</span>] <span class="op">-</span> df[<span class="st">"d_cl"</span>] <span class="op">+</span> df[<span class="st">"d_std"</span>]) <span class="op">-</span> df[<span class="st">"dp"</span>]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="nda-models" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_healy(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Healy (1985): NDA = mean accruals in estimation period."""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    est_mean <span class="op">=</span> df.loc[<span class="op">~</span>df[<span class="st">"part"</span>], <span class="st">"acc_at"</span>].mean()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_healy"</span>] <span class="op">=</span> est_mean</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_healy"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_healy"</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_deangelo(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""DeAngelo (1986): NDA = prior-period total accruals."""</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_deangelo"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_deangelo"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_deangelo"</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_jones(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Jones (1991): Regression-based NDA controlling for revenue and PPE."""</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]].copy()</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_jones"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_jones"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_jones"</span>]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_mod_jones(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Modified Jones (Dechow et al., 1995): Adjust revenues for receivables."""</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>])</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_mod_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_mod_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate on unadjusted Jones model</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict using adjusted revenue (subtract receivable changes)</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_alt_at"</span>, <span class="st">"ppe_at"</span>]].copy()</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    pred_X.columns <span class="op">=</span> [<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_mod_jones"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_mod_jones"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_mod_jones"</span>]</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_industry(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Industry model: NDA = f(industry median accruals)."""</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"acc_ind"</span>])</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_industry"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_industry"</span>] <span class="op">=</span> np.nan</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(est[<span class="st">"acc_ind"</span>])</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> sm.add_constant(df[<span class="st">"acc_ind"</span>])</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_industry"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_industry"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_industry"</span>]</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="get-nda-all" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_model_vars(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add scaled variables needed by the five NDA models."""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> calc_accruals(df)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sic2"</span>] <span class="op">=</span> df[<span class="st">"sic"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"acc_at"</span>] <span class="op">=</span> df[<span class="st">"acc_raw"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"one_at"</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev_at"</span>] <span class="op">=</span> df[<span class="st">"d_rev"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev_alt_at"</span>] <span class="op">=</span> (df[<span class="st">"d_rev"</span>] <span class="op">-</span> df[<span class="st">"d_rec"</span>]) <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"ppe_at"</span>] <span class="op">=</span> df[<span class="st">"ppegt"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Industry median accruals (estimation period only)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># est_acc = df.loc[~df["part"], ["sic2", "acc_at"]].copy()</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    est_acc <span class="op">=</span> df.loc[df[<span class="st">"part"</span>] <span class="op">==</span> <span class="va">False</span>, [<span class="st">"sic2"</span>, <span class="st">"acc_at"</span>]].copy()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    ind_median <span class="op">=</span> est_acc.groupby(<span class="st">"sic2"</span>)[<span class="st">"acc_at"</span>].median().rename(<span class="st">"acc_ind"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(ind_median, on<span class="op">=</span><span class="st">"sic2"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_nda(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply all five NDA models on a firm-by-firm basis.</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a DataFrame with DA columns for each model.</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"year"</span> <span class="cf">if</span> <span class="st">"year"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"fyear"</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    df_mod <span class="op">=</span> prepare_model_vars(df)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    df_mod[<span class="st">"part"</span>] <span class="op">=</span> df_mod[<span class="st">"part"</span>].astype(<span class="bu">bool</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df_mod.groupby(firm_col):</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> group.sort_values(year_col).copy()</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_healy(g)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_deangelo(g)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_jones(g)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_mod_jones(g)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_industry(g)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        results.append(g)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat(results, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="the-salkever-1976-correction" class="level3" data-number="27.1.4">
<h3 data-number="27.1.4" class="anchored" data-anchor-id="the-salkever-1976-correction"><span class="header-section-number">27.1.4</span> The Salkever (1976) Correction</h3>
<p>An important but underappreciated methodological issue arises when computing standard errors for discretionary accruals under the Jones-type models. In the standard two-stage procedure, the researcher first estimates the Jones model on the estimation period, then computes discretionary accruals for the test year as a <em>prediction error</em>. But the standard error of a prediction error is larger than the standard error of a fitted residual, because it incorporates parameter uncertainty from the first-stage estimation. Ignoring this distinction leads to understated standard errors and inflated rejection rates,exactly the problem documented in <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span>.</p>
<p><span class="citation" data-cites="salkever1976use">Salkever (<a href="references.html#ref-salkever1976use" role="doc-biblioref">1976</a>)</span> provides an elegant solution: run a single regression on the <em>combined</em> estimation and test periods, including a dummy variable <span class="math inline">\(PART\)</span> for the test year. The coefficient on <span class="math inline">\(PART\)</span> equals the prediction error (discretionary accruals), and its standard error correctly accounts for first-stage estimation uncertainty.</p>
<p>For the Jones model, the Salkever single-stage regression is:</p>
<p><span id="eq-salkever"><span class="math display">\[
TA_{i,t} = \alpha_1 \frac{1}{A_{i,t-1}} + \alpha_2 \Delta Rev_{i,t} + \alpha_3 PPE_{i,t} + \delta \cdot PART_{i,t} + u_{i,t}
\tag{27.7}\]</span></span></p>
<p>The coefficient <span class="math inline">\(\hat{\delta}\)</span> is numerically identical to the two-stage <span class="math inline">\(DA\)</span> estimate, but its standard error <span class="math inline">\(\text{se}(\hat{\delta})\)</span> is the correct prediction error standard error.</p>
<div id="salkever-demo" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> demonstrate_salkever(df_firm: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    For a single firm, show that the two-stage Jones DA equals</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    the Salkever one-stage coefficient on PART.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> prepare_model_vars(df_firm)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    needed <span class="op">=</span> [<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>, <span class="st">"part"</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>needed).copy()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚îÄ‚îÄ Two-stage approach ‚îÄ‚îÄ</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    y_est <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    X_est <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    fm_stage1 <span class="op">=</span> sm.OLS(y_est, X_est).fit()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_two_stage"</span>] <span class="op">=</span> fm_stage1.predict(df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]])</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_two_stage"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_two_stage"</span>]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test-year DA from two-stage</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    da_two_stage <span class="op">=</span> df.loc[df[<span class="st">"part"</span>], <span class="st">"da_two_stage"</span>].values</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚îÄ‚îÄ Salkever one-stage ‚îÄ‚îÄ</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part_float"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    y_full <span class="op">=</span> df[<span class="st">"acc_at"</span>]</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    X_full <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>, <span class="st">"part_float"</span>]]</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    fm_salkever <span class="op">=</span> sm.OLS(y_full, X_full).fit()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    da_salkever <span class="op">=</span> fm_salkever.params[<span class="st">"part_float"</span>]</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    se_two_stage_wrong <span class="op">=</span> np.nan  <span class="co"># two-stage doesn't give correct SE</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    se_salkever <span class="op">=</span> fm_salkever.bse[<span class="st">"part_float"</span>]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Method"</span>: [<span class="st">"Two-stage Jones"</span>, <span class="st">"Salkever one-stage"</span>],</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DA estimate"</span>: [da_two_stage[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(da_two_stage) <span class="cf">else</span> np.nan,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                        da_salkever],</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Correct SE"</span>: [<span class="st">"Not available"</span>, <span class="ss">f"</span><span class="sc">{</span>se_salkever<span class="sc">:.6f}</span><span class="ss">"</span>],</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t-statistic"</span>: [<span class="st">"Biased"</span>, <span class="ss">f"</span><span class="sc">{</span>fm_salkever<span class="sc">.</span>tvalues[<span class="st">'part_float'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>],</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="sec-type1" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="sec-type1"><span class="header-section-number">27.2</span> Type I Error Under the Null Hypothesis</h2>
<section id="experimental-design" class="level3" data-number="27.2.1">
<h3 data-number="27.2.1" class="anchored" data-anchor-id="experimental-design"><span class="header-section-number">27.2.1</span> Experimental Design</h3>
<p>To evaluate whether the five models produce well-calibrated test statistics, we conduct a simulation experiment parallel to Table 2 of <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span>. The procedure is:</p>
<ol type="1">
<li>Generate a panel of <span class="math inline">\(N\)</span> firms, each with <span class="math inline">\(T\)</span> years of financial statement data.</li>
<li>For each firm, randomly designate one year as the test year (<span class="math inline">\(PART = 1\)</span>). By construction, <em>no earnings management occurs</em> in this year.</li>
<li>Estimate discretionary accruals using each of the five models.</li>
<li>Regress <span class="math inline">\(DA\)</span> on <span class="math inline">\(PART\)</span> for each firm and record whether the null <span class="math inline">\(H_0:
\delta = 0\)</span> is rejected at the 5% and 1% significance levels.</li>
<li>Compute the rejection rate across all <span class="math inline">\(N\)</span> firms.</li>
</ol>
<p>If the model is well-specified, rejection rates should equal the nominal test size (5% or 1%). Systematic over-rejection indicates that the model produces biased test statistics, a critical flaw for research that relies on these measures to draw causal inferences.</p>
</section>
<section id="data-generation" class="level3" data-number="27.2.2">
<h3 data-number="27.2.2" class="anchored" data-anchor-id="data-generation"><span class="header-section-number">27.2.2</span> Data Generation</h3>
<p>We generate synthetic panel data that preserves the key cross-sectional and time-series properties of Vietnamese listed firms while allowing us to know with certainty that no manipulation exists.</p>
<div id="gen-panel" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_em_panel(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    n_firms: <span class="bu">int</span> <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    n_years: <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2024</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate a synthetic panel of Vietnamese-style financial data.</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    No earnings management is present by construction.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    The data generation process captures:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - AR(1) revenue process</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - Accruals driven by revenue growth and PPE levels</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - Industry-level common shocks</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    - SOE/non-SOE heterogeneity</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    industries <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">41</span>, <span class="dv">46</span>, <span class="dv">47</span>, <span class="dv">52</span>, <span class="dv">62</span>, <span class="dv">64</span>, <span class="dv">68</span>]</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms):</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Firm characteristics</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        sic <span class="op">=</span> rng.choice(industries)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        is_soe <span class="op">=</span> <span class="bu">int</span>(rng.random() <span class="op">&lt;</span> <span class="fl">0.30</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        base_assets <span class="op">=</span> rng.lognormal(mean<span class="op">=</span><span class="dv">12</span>, sigma<span class="op">=</span><span class="fl">1.5</span>)  <span class="co"># VND billions</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        growth_rate <span class="op">=</span> rng.normal(<span class="fl">0.08</span>, <span class="fl">0.04</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Jones model parameters (firm-specific true DGP)</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        true_alpha1 <span class="op">=</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        true_alpha2 <span class="op">=</span> rng.normal(<span class="fl">0.06</span>, <span class="fl">0.03</span>)   <span class="co"># revenue-accrual sensitivity</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        true_alpha3 <span class="op">=</span> rng.normal(<span class="op">-</span><span class="fl">0.04</span>, <span class="fl">0.02</span>)  <span class="co"># depreciation effect</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        at_prev <span class="op">=</span> base_assets</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        sale_prev <span class="op">=</span> base_assets <span class="op">*</span> rng.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        rect_prev <span class="op">=</span> sale_prev <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.25</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(n_years):</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> <span class="dv">2009</span> <span class="op">+</span> t</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evolve fundamentals</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            at <span class="op">=</span> at_prev <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> growth_rate <span class="op">+</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.05</span>))</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            sale <span class="op">=</span> sale_prev <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> rng.normal(<span class="fl">0.06</span>, <span class="fl">0.08</span>))</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>            rect <span class="op">=</span> sale <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.25</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>            ppegt <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.3</span>, <span class="fl">0.7</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate accruals from true Jones DGP + noise</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>            d_rev <span class="op">=</span> sale <span class="op">-</span> sale_prev</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>            one_at <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> at_prev</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>            d_rev_at <span class="op">=</span> d_rev <span class="op">/</span> at_prev</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            ppe_at <span class="op">=</span> ppegt <span class="op">/</span> at_prev</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>            acc_at <span class="op">=</span> (true_alpha1 <span class="op">*</span> one_at </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> true_alpha2 <span class="op">*</span> d_rev_at </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> true_alpha3 <span class="op">*</span> ppe_at</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.03</span>))</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>            acc_raw <span class="op">=</span> acc_at <span class="op">*</span> at_prev</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reverse-engineer balance sheet items consistent with accruals</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>            dp <span class="op">=</span> ppegt <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.12</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>            d_cl <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.02</span>)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>            d_std <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.01</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>            d_cash <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.02</span>)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>            d_ca <span class="op">=</span> acc_raw <span class="op">+</span> dp <span class="op">+</span> d_cl <span class="op">-</span> d_std <span class="op">+</span> d_cash</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>            act <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.3</span>, <span class="fl">0.6</span>)</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>            che <span class="op">=</span> act <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.2</span>)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>            lct <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.15</span>, <span class="fl">0.35</span>)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>            dlc <span class="op">=</span> lct <span class="op">*</span> rng.uniform(<span class="fl">0.1</span>, <span class="fl">0.4</span>)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>            ni <span class="op">=</span> sale <span class="op">*</span> rng.uniform(<span class="fl">0.03</span>, <span class="fl">0.12</span>)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>            ib <span class="op">=</span> ni</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>            records.append({</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ticker"</span>: <span class="ss">f"VN</span><span class="sc">{</span>i<span class="sc">:04d}</span><span class="ss">"</span>,</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fyear"</span>: year,</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                <span class="st">"at"</span>: at,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                <span class="st">"act"</span>: act,</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">"che"</span>: che,</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                <span class="st">"lct"</span>: lct,</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">"dlc"</span>: dlc,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">"dp"</span>: dp,</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sale"</span>: sale,</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                <span class="st">"rect"</span>: rect,</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ppegt"</span>: ppegt,</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ni"</span>: ni,</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ib"</span>: ib,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sic"</span>: sic,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>                <span class="st">"is_soe"</span>: is_soe,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>            at_prev <span class="op">=</span> at</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>            sale_prev <span class="op">=</span> sale</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>            rect_prev <span class="op">=</span> rect</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>panel_raw <span class="op">=</span> generate_em_panel(n_firms<span class="op">=</span><span class="dv">500</span>, n_years<span class="op">=</span><span class="dv">15</span>, seed<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Panel: </span><span class="sc">{</span>panel_raw<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-years, "</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>panel_raw[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Panel: 7,500 firm-years, 500 firms</code></pre>
</div>
</div>
</section>
<section id="sample-construction" class="level3" data-number="27.2.3">
<h3 data-number="27.2.3" class="anchored" data-anchor-id="sample-construction"><span class="header-section-number">27.2.3</span> Sample Construction</h3>
<p>We construct a sample of 500 firms, each with a randomly designated test year, mirroring the design of <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span>.</p>
<div id="sample-construction" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_sample(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    n_sample: <span class="bu">int</span> <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    min_est_years: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">42</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    selection_filter: Optional[<span class="bu">callable</span>] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">    For each firm, randomly assign one year as the test year (part=True).</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Require at least min_est_years of estimation data.</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"fyear"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute accruals and filter for data availability</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> calc_accruals(df)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    required <span class="op">=</span> [<span class="st">"acc_raw"</span>, <span class="st">"lag_at"</span>, <span class="st">"d_rev"</span>, <span class="st">"d_rec"</span>, <span class="st">"ppegt"</span>]</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>required)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">"lag_at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Require minimum years</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    firm_counts <span class="op">=</span> df.groupby(firm_col)[year_col].count()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    eligible <span class="op">=</span> firm_counts[firm_counts <span class="op">&gt;=</span> (min_est_years <span class="op">+</span> <span class="dv">1</span>)].index</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[firm_col].isin(eligible)]</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> selection_filter <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> selection_filter(df)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample n_sample firms</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    firms <span class="op">=</span> df[firm_col].unique()</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(firms) <span class="op">&gt;</span> n_sample:</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        firms <span class="op">=</span> rng.choice(firms, n_sample, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[firm_col].isin(firms)].copy()</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each firm, randomly pick one test year (not the first year)</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> []</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df.groupby(firm_col):</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        years <span class="op">=</span> group[year_col].sort_values().values</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(years) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        test_year <span class="op">=</span> rng.choice(years[<span class="dv">1</span>:])</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        parts.append({firm_col: firm, year_col: test_year, <span class="st">"part"</span>: <span class="va">True</span>})</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    part_df <span class="op">=</span> pd.DataFrame(parts)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(part_df, on<span class="op">=</span>[firm_col, year_col], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].fillna(<span class="va">False</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].astype(<span class="bu">bool</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>sample_1 <span class="op">=</span> construct_sample(panel_raw, n_sample<span class="op">=</span><span class="dv">500</span>, seed<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample 1: </span><span class="sc">{</span>sample_1<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-years, "</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>sample_1[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms, "</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>sample_1[<span class="st">'part'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> test years"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sample 1: 7,000 firm-years, 500 firms, 500 test years</code></pre>
</div>
</div>
</section>
<section id="estimating-discretionary-accruals" class="level3" data-number="27.2.4">
<h3 data-number="27.2.4" class="anchored" data-anchor-id="estimating-discretionary-accruals"><span class="header-section-number">27.2.4</span> Estimating Discretionary Accruals</h3>
<div id="cell-estimate-da" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>da_results <span class="op">=</span> get_all_nda(sample_1)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify: peek at test-year DA across models</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>da_cols <span class="op">=</span> [<span class="st">"da_healy"</span>, <span class="st">"da_deangelo"</span>, <span class="st">"da_jones"</span>, <span class="st">"da_mod_jones"</span>, <span class="st">"da_industry"</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>test_da <span class="op">=</span> da_results[da_results[<span class="st">"part"</span>]][da_cols]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test-year discretionary accruals (first 5 firms):"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>test_da.head().<span class="bu">round</span>(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test-year discretionary accruals (first 5 firms):</code></pre>
</div>
<div id="estimate-da" class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">da_healy</th>
<th data-quarto-table-cell-role="th">da_deangelo</th>
<th data-quarto-table-cell-role="th">da_jones</th>
<th data-quarto-table-cell-role="th">da_mod_jones</th>
<th data-quarto-table-cell-role="th">da_industry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>-0.0791</td>
<td>-0.1320</td>
<td>-0.1252</td>
<td>-0.1511</td>
<td>-0.0791</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>-0.0792</td>
<td>0.0813</td>
<td>-0.1799</td>
<td>-0.1426</td>
<td>-0.0792</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>0.0618</td>
<td>0.1403</td>
<td>0.1458</td>
<td>0.1308</td>
<td>0.0618</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>0.2106</td>
<td>0.2069</td>
<td>0.0578</td>
<td>0.5023</td>
<td>0.2106</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">61</th>
<td>-0.1326</td>
<td>0.0865</td>
<td>-0.1425</td>
<td>-0.1193</td>
<td>-0.1326</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="firm-level-regressions-and-rejection-rates" class="level3" data-number="27.2.5">
<h3 data-number="27.2.5" class="anchored" data-anchor-id="firm-level-regressions-and-rejection-rates"><span class="header-section-number">27.2.5</span> Firm-Level Regressions and Rejection Rates</h3>
<p>For each firm and each model, we regress <span class="math inline">\(DA\)</span> on <span class="math inline">\(PART\)</span> and record whether the null hypothesis of zero discretionary accruals in the test year is rejected.</p>
<div id="type1-regressions" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> firm_regressions(df: pd.DataFrame, models: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">    For each firm and model, regress DA on PART.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Return coefficients, std errors, t-stats, and rejection indicators.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df.groupby(firm_col):</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> model <span class="kw">in</span> models:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            da_col <span class="op">=</span> <span class="ss">f"da_</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[da_col]).copy()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            g[<span class="st">"part_float"</span>] <span class="op">=</span> g[<span class="st">"part"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">5</span> <span class="kw">or</span> g[<span class="st">"part"</span>].<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                fm <span class="op">=</span> sm.OLS(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                    g[da_col], sm.add_constant(g[<span class="st">"part_float"</span>])</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                ).fit()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                coef <span class="op">=</span> fm.params[<span class="st">"part_float"</span>]</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                se <span class="op">=</span> fm.bse[<span class="st">"part_float"</span>]</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                t_stat <span class="op">=</span> fm.tvalues[<span class="st">"part_float"</span>]</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                df_resid <span class="op">=</span> fm.df_resid</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                <span class="co"># One-sided p-values</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                p_neg <span class="op">=</span> stats.t.cdf(t_stat, df_resid)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                p_pos <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> p_neg</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                records.append({</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                    firm_col: firm,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"model"</span>: model,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"coef"</span>: coef,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"se"</span>: se,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"t_stat"</span>: t_stat,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"neg_p01"</span>: p_neg <span class="op">&lt;</span> <span class="fl">0.01</span>,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"neg_p05"</span>: p_neg <span class="op">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"pos_p01"</span>: p_pos <span class="op">&lt;</span> <span class="fl">0.01</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"pos_p05"</span>: p_pos <span class="op">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(records)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [<span class="st">"healy"</span>, <span class="st">"deangelo"</span>, <span class="st">"jones"</span>, <span class="st">"mod_jones"</span>, <span class="st">"industry"</span>]</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>reg_results <span class="op">=</span> firm_regressions(da_results, models)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="results" class="level3" data-number="27.2.6">
<h3 data-number="27.2.6" class="anchored" data-anchor-id="results"><span class="header-section-number">27.2.6</span> Results</h3>
<p><a href="#tbl-type1-coefs" class="quarto-xref">Table&nbsp;<span>27.2</span></a> reports the distribution of estimated coefficients on <span class="math inline">\(PART\)</span> across firms. Under the null of no manipulation, we expect the mean coefficient to be approximately zero.</p>
<div class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>coef_stats <span class="op">=</span> (</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    reg_results</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"model"</span>)[<span class="st">"coef"</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"mean"</span>, <span class="st">"std"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"median"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)])</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>coef_stats.columns <span class="op">=</span> [<span class="st">"Mean"</span>, <span class="st">"Std Dev"</span>, <span class="st">"Q1"</span>, <span class="st">"Median"</span>, <span class="st">"Q3"</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>coef_stats.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>coef_stats.<span class="bu">round</span>(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-type1-coefs" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="11">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-type1-coefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.2: Distribution of firm-level discretionary accrual estimates (coefficient on PART) under the null hypothesis of no earnings management. All five models produce mean estimates near zero, as expected.
</figcaption>
<div aria-describedby="tbl-type1-coefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Std Dev</th>
<th data-quarto-table-cell-role="th">Q1</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">Q3</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">deangelo</th>
<td>0.0110</td>
<td>0.2584</td>
<td>-0.1604</td>
<td>0.0140</td>
<td>0.1839</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">healy</th>
<td>0.0047</td>
<td>0.1506</td>
<td>-0.0993</td>
<td>0.0050</td>
<td>0.1066</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">industry</th>
<td>0.0047</td>
<td>0.1506</td>
<td>-0.0993</td>
<td>0.0050</td>
<td>0.1066</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">jones</th>
<td>0.0035</td>
<td>0.1739</td>
<td>-0.1134</td>
<td>0.0069</td>
<td>0.1125</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">mod_jones</th>
<td>0.0068</td>
<td>0.1807</td>
<td>-0.1127</td>
<td>0.0108</td>
<td>0.1177</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-type1-rejection" class="quarto-xref">Table&nbsp;<span>27.3</span></a> reports rejection rates. The critical comparison is whether these rates approximate the nominal test size.</p>
<div class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rejection_rates <span class="op">=</span> (</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    reg_results</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"model"</span>)[[<span class="st">"neg_p01"</span>, <span class="st">"neg_p05"</span>, <span class="st">"pos_p01"</span>, <span class="st">"pos_p05"</span>]]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>rejection_rates.columns <span class="op">=</span> [</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Neg (1%)"</span>, <span class="st">"Neg (5%)"</span>, <span class="st">"Pos (1%)"</span>, <span class="st">"Pos (5%)"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>rejection_rates.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>rejection_rates</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-type1-rejection" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="12">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-type1-rejection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.3: Type I error rates for one-sided tests of earnings management under the null hypothesis. Rates exceeding the nominal size (5% or 1%) indicate that the model over-rejects‚Äîa significant concern for the Jones and Modified Jones models.
</figcaption>
<div aria-describedby="tbl-type1-rejection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Neg (1%)</th>
<th data-quarto-table-cell-role="th">Neg (5%)</th>
<th data-quarto-table-cell-role="th">Pos (1%)</th>
<th data-quarto-table-cell-role="th">Pos (5%)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">deangelo</th>
<td>0.0109</td>
<td>0.0457</td>
<td>0.0043</td>
<td>0.0478</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">healy</th>
<td>0.0100</td>
<td>0.0380</td>
<td>0.0080</td>
<td>0.0500</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">industry</th>
<td>0.0100</td>
<td>0.0380</td>
<td>0.0080</td>
<td>0.0500</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">jones</th>
<td>0.0280</td>
<td>0.0800</td>
<td>0.0380</td>
<td>0.1000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">mod_jones</th>
<td>0.0320</td>
<td>0.0740</td>
<td>0.0300</td>
<td>0.0900</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="binomial-test-for-size-distortion" class="level3" data-number="27.2.7">
<h3 data-number="27.2.7" class="anchored" data-anchor-id="binomial-test-for-size-distortion"><span class="header-section-number">27.2.7</span> Binomial Test for Size Distortion</h3>
<p>We formally test whether observed rejection rates differ from nominal sizes using a two-sided binomial test. Small <span class="math inline">\(p\)</span>-values indicate significant mis-calibration of the test statistic.</p>
<div class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binom_test_rate(series: pd.Series, nominal: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Two-sided binomial test for rejection rate = nominal."""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> series.dropna()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">int</span>(x.<span class="bu">sum</span>())</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats.binomtest(k, n, nominal, alternative<span class="op">=</span><span class="st">"two-sided"</span>).pvalue</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>binom_results <span class="op">=</span> {}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model, group <span class="kw">in</span> reg_results.groupby(<span class="st">"model"</span>):</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    binom_results[model] <span class="op">=</span> {</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Neg (1%)"</span>: binom_test_rate(group[<span class="st">"neg_p01"</span>], <span class="fl">0.01</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Neg (5%)"</span>: binom_test_rate(group[<span class="st">"neg_p05"</span>], <span class="fl">0.05</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pos (1%)"</span>: binom_test_rate(group[<span class="st">"pos_p01"</span>], <span class="fl">0.01</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pos (5%)"</span>: binom_test_rate(group[<span class="st">"pos_p05"</span>], <span class="fl">0.05</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>binom_df <span class="op">=</span> pd.DataFrame(binom_results).T.<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>binom_df.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>binom_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-binom-test" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="13">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-binom-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.4: Binomial test p-values for whether rejection rates equal nominal test sizes. Small values (e.g., &lt; 0.05) indicate statistically significant size distortion.
</figcaption>
<div aria-describedby="tbl-binom-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Neg (1%)</th>
<th data-quarto-table-cell-role="th">Neg (5%)</th>
<th data-quarto-table-cell-role="th">Pos (1%)</th>
<th data-quarto-table-cell-role="th">Pos (5%)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">deangelo</th>
<td>0.8117</td>
<td>0.7486</td>
<td>0.3423</td>
<td>0.9150</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">healy</th>
<td>1.0000</td>
<td>0.2581</td>
<td>0.8236</td>
<td>1.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">industry</th>
<td>1.0000</td>
<td>0.2581</td>
<td>0.8236</td>
<td>1.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">jones</th>
<td>0.0006</td>
<td>0.0038</td>
<td>0.0000</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">mod_jones</th>
<td>0.0001</td>
<td>0.0179</td>
<td>0.0002</td>
<td>0.0002</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Interpreting Over-Rejection
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the Jones and Modified Jones models show rejection rates significantly above 5%, this signals that the standard two-stage procedure produces anti-conservative test statistics. The <span class="citation" data-cites="salkever1976use">Salkever (<a href="references.html#ref-salkever1976use" role="doc-biblioref">1976</a>)</span> correction addresses this by computing standard errors that reflect first-stage estimation uncertainty. In practical research on Vietnamese firms, where sample sizes per firm are often short (10‚Äì15 years of listed history), this correction is especially important because prediction error variance is a larger fraction of residual variance with fewer estimation-period observations.</p>
</div>
</div>
</section>
</section>
<section id="sec-extreme" class="level2" data-number="27.3">
<h2 data-number="27.3" class="anchored" data-anchor-id="sec-extreme"><span class="header-section-number">27.3</span> Extreme Performance Firms</h2>
<p>A well-known weakness of accrual-based models is their poor performance when test firms experience extreme economic performance. <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span> documented that all five models over-reject the null hypothesis when test firm-years are drawn from the tails of the earnings or cash flow distribution. <span class="citation" data-cites="kothari2005performance">Kothari, Leone, and Wasley (<a href="references.html#ref-kothari2005performance" role="doc-biblioref">2005</a>)</span> subsequently proposed ‚Äúperformance matching‚Äù as a partial remedy.</p>
<p>The intuition for the problem is straightforward: the Jones model assumes a linear, symmetric relationship between revenue changes and accruals. But firms experiencing extreme growth or contraction generate accruals that deviate nonlinearly from the model‚Äôs predictions, even absent any manipulation. This nonlinearity is misattributed to discretionary accruals.</p>
<section id="constructing-extreme-performance-samples" class="level3" data-number="27.3.1">
<h3 data-number="27.3.1" class="anchored" data-anchor-id="constructing-extreme-performance-samples"><span class="header-section-number">27.3.1</span> Constructing Extreme-Performance Samples</h3>
<div id="extreme-sample" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_earnings_deciles(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute firm-year earnings (scaled) and assign to deciles."""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"lag_at_earn"</span>] <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"earn"</span>] <span class="op">=</span> df[<span class="st">"ib"</span>] <span class="op">/</span> df[<span class="st">"lag_at_earn"</span>]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"earn_decile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"earn"</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>panel_with_earn <span class="op">=</span> add_earnings_deciles(panel_raw)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># High-earners sample (top decile)</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_high_earn(df):</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> add_earnings_deciles(df)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[<span class="st">"earn_decile"</span>] <span class="op">==</span> <span class="dv">10</span>]</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Low-earners sample (bottom decile)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_low_earn(df):</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> add_earnings_deciles(df)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[<span class="st">"earn_decile"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>sample_high <span class="op">=</span> construct_sample(</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    panel_raw, n_sample<span class="op">=</span><span class="dv">300</span>, seed<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    selection_filter<span class="op">=</span>filter_high_earn</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>sample_low <span class="op">=</span> construct_sample(</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    panel_raw, n_sample<span class="op">=</span><span class="dv">300</span>, seed<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    selection_filter<span class="op">=</span>filter_low_earn</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"High-earnings sample: </span><span class="sc">{</span>sample_high[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Low-earnings sample: </span><span class="sc">{</span>sample_low[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>High-earnings sample: 164 firms
Low-earnings sample: 203 firms</code></pre>
</div>
</div>
<div id="tbl-extreme-rejection" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="15">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-extreme-rejection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.5: Type I error rates (5% one-sided) when test firm-years are drawn from extreme earnings deciles. Over-rejection is expected because accrual models misattribute performance-driven accrual variation to managerial discretion.
</figcaption>
<div aria-describedby="tbl-extreme-rejection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>extreme_results <span class="op">=</span> {}</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, sample_df <span class="kw">in</span> [(<span class="st">"High earners"</span>, sample_high), (<span class="st">"Low earners"</span>, sample_low)]:</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> get_all_nda(sample_df)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    rates <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[[<span class="st">"neg_p05"</span>, <span class="st">"pos_p05"</span>]].mean().<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    rates.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> Neg(5%)"</span>, <span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> Pos(5%)"</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    extreme_results[label] <span class="op">=</span> rates</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> extreme_results:</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    extreme_df <span class="op">=</span> pd.concat(extreme_results.values(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    extreme_df.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    extreme_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</figure>
</div>
</section>
<section id="performance-matching" class="level3" data-number="27.3.2">
<h3 data-number="27.3.2" class="anchored" data-anchor-id="performance-matching"><span class="header-section-number">27.3.2</span> Performance Matching</h3>
<p><span class="citation" data-cites="kothari2005performance">Kothari, Leone, and Wasley (<a href="references.html#ref-kothari2005performance" role="doc-biblioref">2005</a>)</span> propose adjusting discretionary accruals by subtracting the DA of a performance-matched firm (one in the same industry with similar ROA). This removes the systematic component of accruals correlated with performance. The matched discretionary accrual is:</p>
<p><span id="eq-performance-match"><span class="math display">\[
DA^{PM}_{i,t} = DA_{i,t} - DA_{i^*,t}
\tag{27.8}\]</span></span></p>
<p>where <span class="math inline">\(i^*\)</span> is the matched control firm. This approach is particularly relevant in Vietnam, where the cross-section of listed firms includes many high-growth firms alongside stagnant SOEs, which is performance heterogeneity that standard models may mischaracterize.</p>
</section>
</section>
<section id="sec-power" class="level2" data-number="27.4">
<h2 data-number="27.4" class="anchored" data-anchor-id="sec-power"><span class="header-section-number">27.4</span> Power Analysis</h2>
<section id="artificially-introducing-earnings-management" class="level3" data-number="27.4.1">
<h3 data-number="27.4.1" class="anchored" data-anchor-id="artificially-introducing-earnings-management"><span class="header-section-number">27.4.1</span> Artificially Introducing Earnings Management</h3>
<p>A model that never rejects is useless even if its Type I error rate is perfect. We need to evaluate <strong>power</strong>: the probability of detecting manipulation when it truly exists. Following <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span>, we introduce known artificial manipulation into test-year financial statements and measure detection rates.</p>
<p>We consider three forms of manipulation at varying magnitudes:</p>
<ol type="1">
<li><p><strong>Expense manipulation.</strong> Decrease current liabilities by the manipulation amount (e.g., delaying recognition of accrued expenses): <span class="math display">\[LCT'_{i,t} = LCT_{i,t} - \lambda \cdot A_{i,t-1}\]</span></p></li>
<li><p><strong>Revenue manipulation.</strong> Increase sales and receivables by the manipulation amount (e.g., premature revenue recognition or channel stuffing): <span class="math display">\[Sale'_{i,t} = Sale_{i,t} + \lambda \cdot A_{i,t-1}, \quad Rect'_{i,t} = Rect_{i,t} + \lambda \cdot A_{i,t-1}\]</span></p></li>
<li><p><strong>Margin manipulation.</strong> Increase sales by the gross amount needed to inflate net income by <span class="math inline">\(\lambda \cdot A_{i,t-1}\)</span>, increasing both receivables and current liabilities proportionally.</p></li>
</ol>
<p>The parameter <span class="math inline">\(\lambda\)</span> represents manipulation as a fraction of lagged total assets, ranging from 0% to 50%.</p>
<div id="manipulate-fn" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> manipulate(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    level: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    manip_type: <span class="bu">str</span> <span class="op">=</span> <span class="st">"expense"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Introduce artificial earnings management of a given type and level</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    into test-year (part=True) observations.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">    df : DataFrame with 'part' indicator and required financial variables.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">    level : Manipulation as fraction of lagged total assets.</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    manip_type : One of 'expense', 'revenue', 'margin'.</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"fyear"</span> <span class="cf">if</span> <span class="st">"fyear"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"year"</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([firm_col, year_col]).copy()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    lag_at <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    manip_amt <span class="op">=</span> lag_at <span class="op">*</span> level</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> manip_type <span class="op">==</span> <span class="st">"expense"</span>:</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decrease current liabilities in test year</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"lct"</span>] <span class="op">-=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> manip_type <span class="op">==</span> <span class="st">"revenue"</span>:</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Increase sales and receivables in test year</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"sale"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"rect"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"act"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reverse in following year</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        next_part <span class="op">=</span> g[<span class="st">"part"</span>].shift(<span class="dv">1</span>).fillna(<span class="va">False</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        df.loc[next_part, <span class="st">"sale"</span>] <span class="op">-=</span> manip_amt[next_part]</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> manip_type <span class="op">==</span> <span class="st">"margin"</span>:</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute net income ratio for scaling</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        est_mask <span class="op">=</span> <span class="op">~</span>df[<span class="st">"part"</span>]</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        ni_ratio <span class="op">=</span> g.<span class="bu">apply</span>(</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: (x.loc[<span class="op">~</span>x[<span class="st">"part"</span>], <span class="st">"ni"</span>] <span class="op">/</span> x.loc[<span class="op">~</span>x[<span class="st">"part"</span>], <span class="st">"sale"</span>]).median()</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"_ni_ratio"</span>] <span class="op">=</span> df[firm_col].<span class="bu">map</span>(ni_ratio)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>        gross_amt <span class="op">=</span> np.where(</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"_ni_ratio"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, manip_amt <span class="op">/</span> df[<span class="st">"_ni_ratio"</span>], <span class="dv">0</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"sale"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"rect"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"act"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        net_effect <span class="op">=</span> gross_amt <span class="op">-</span> manip_amt</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"lct"</span>] <span class="op">+=</span> net_effect[df[<span class="st">"part"</span>]]</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>        df.drop(columns<span class="op">=</span>[<span class="st">"_ni_ratio"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="power-analysis" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.50</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>manip_types <span class="op">=</span> [<span class="st">"expense"</span>, <span class="st">"revenue"</span>, <span class="st">"margin"</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>power_records <span class="op">=</span> []</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level <span class="kw">in</span> levels:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mtype <span class="kw">in</span> manip_types:</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Copy base sample and introduce manipulation</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        manip_sample <span class="op">=</span> sample_1.copy()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> level <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            manip_sample <span class="op">=</span> manipulate(manip_sample, level<span class="op">=</span>level, manip_type<span class="op">=</span>mtype)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate DA and run tests</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        da <span class="op">=</span> get_all_nda(manip_sample)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Power = positive one-sided rejection rate at 5%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        power <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[<span class="st">"pos_p05"</span>].mean()</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> model_name, pwr <span class="kw">in</span> power.items():</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            power_records.append({</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"level"</span>: level,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: mtype,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"model"</span>: model_name,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"power"</span>: pwr,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>power_df <span class="op">=</span> pd.DataFrame(power_records)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="power-analysis-parallel" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.50</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>manip_types <span class="op">=</span> [<span class="st">"expense"</span>, <span class="st">"revenue"</span>, <span class="st">"margin"</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> Parallel, delayed</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _run_one(level, mtype, base_sample, models):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    manip_sample <span class="op">=</span> base_sample.copy()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> level <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        manip_sample <span class="op">=</span> manipulate(manip_sample, level<span class="op">=</span>level, manip_type<span class="op">=</span>mtype)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> get_all_nda(manip_sample)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    power <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[<span class="st">"pos_p05"</span>].mean()</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"level"</span>: level, <span class="st">"type"</span>: mtype, <span class="st">"model"</span>: m, <span class="st">"power"</span>: p}</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> m, p <span class="kw">in</span> power.items()</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip redundant level=0 runs (all manip_types identical when level=0)</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>combos <span class="op">=</span> [(<span class="fl">0.0</span>, <span class="st">"expense"</span>)] <span class="op">+</span> [</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    (l, m) <span class="cf">for</span> l <span class="kw">in</span> levels <span class="cf">if</span> l <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">for</span> m <span class="kw">in</span> manip_types</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> Parallel(n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>)(</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    delayed(_run_one)(lvl, mt, sample_1, models)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lvl, mt <span class="kw">in</span> combos</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand level=0 result across all manip_types</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> []</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (lvl, mt), batch <span class="kw">in</span> <span class="bu">zip</span>(combos, results):</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lvl <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mtype <span class="kw">in</span> manip_types:</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            flat.extend([{<span class="op">**</span>r, <span class="st">"type"</span>: mtype} <span class="cf">for</span> r <span class="kw">in</span> batch])</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        flat.extend(batch)</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>power_df <span class="op">=</span> pd.DataFrame(flat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  16 out of  16 | elapsed:  2.0min finished</code></pre>
</div>
</div>
</section>
<section id="power-functions" class="level3" data-number="27.4.2">
<h3 data-number="27.4.2" class="anchored" data-anchor-id="power-functions"><span class="header-section-number">27.4.2</span> Power Functions</h3>
<p><a href="#fig-power" class="quarto-xref">Figure&nbsp;<span>27.1</span></a> plots the estimated power functions. The key questions are: (i) which model has the highest power for a given manipulation level and type, and (ii) at what magnitudes does manipulation become reliably detectable?</p>
<div id="cell-fig-power" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>model_colors <span class="op">=</span> {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"healy"</span>: <span class="st">"#2196F3"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deangelo"</span>: <span class="st">"#FF9800"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jones"</span>: <span class="st">"#4CAF50"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod_jones"</span>: <span class="st">"#E91E63"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"industry"</span>: <span class="st">"#9C27B0"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, mtype <span class="kw">in</span> <span class="bu">enumerate</span>(manip_types):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[idx]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> power_df[power_df[<span class="st">"type"</span>] <span class="op">==</span> mtype]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model_name <span class="kw">in</span> models:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        m_data <span class="op">=</span> subset[subset[<span class="st">"model"</span>] <span class="op">==</span> model_name].sort_values(<span class="st">"level"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        ax.plot(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>            m_data[<span class="st">"level"</span>] <span class="op">*</span> <span class="dv">100</span>, m_data[<span class="st">"power"</span>],</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="st">"o"</span>, markersize<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>model_name.replace(<span class="st">"_"</span>, <span class="st">" "</span>).title(),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>model_colors[model_name],</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    ax.set_title(mtype.title(), fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Manipulation (</span><span class="sc">% o</span><span class="st">f assets)"</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">1.02</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(mticker.PercentFormatter(xmax<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="fl">0.05</span>, color<span class="op">=</span><span class="st">"grey"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"5</span><span class="sc">% s</span><span class="st">ize"</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Rejection Rate (Power)"</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(fontsize<span class="op">=</span><span class="dv">8</span>, loc<span class="op">=</span><span class="st">"center left"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>))</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-power" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="34_earning_management_files/figure-html/fig-power-output-1.png" width="2082" height="730" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.1: Power functions for the five earnings management detection models across three manipulation types. Power increases with manipulation magnitude but remains low for economically plausible levels (&lt; 10% of assets), highlighting the fundamental difficulty of detecting earnings management.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="summary-statistics" class="level3" data-number="27.4.3">
<h3 data-number="27.4.3" class="anchored" data-anchor-id="summary-statistics"><span class="header-section-number">27.4.3</span> Summary Statistics</h3>
<p><a href="#tbl-power-summary" class="quarto-xref">Table&nbsp;<span>27.6</span></a> reports power at selected manipulation levels for the Jones and Modified Jones models, which are most commonly used in applied research.</p>
<div class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>power_summary <span class="op">=</span> (</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    power_df[power_df[<span class="st">"model"</span>].isin([<span class="st">"jones"</span>, <span class="st">"mod_jones"</span>])]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .pivot_table(index<span class="op">=</span>[<span class="st">"model"</span>, <span class="st">"level"</span>], columns<span class="op">=</span><span class="st">"type"</span>, values<span class="op">=</span><span class="st">"power"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>power_summary.index.names <span class="op">=</span> [<span class="st">"Model"</span>, <span class="st">"Level (% assets)"</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>power_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="tbl-power-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-power-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27.6: Power of the Jones and Modified Jones models at selected manipulation levels. Even at 10% of assets‚Äîa large amount of manipulation‚Äîdetection rates remain well below 50% for most manipulation types, underscoring the low statistical power of standard tests.
</figcaption>
<div aria-describedby="tbl-power-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">expense</th>
<th data-quarto-table-cell-role="th">margin</th>
<th data-quarto-table-cell-role="th">revenue</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">Level (% assets)</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="6" data-quarto-table-cell-role="th" data-valign="top">jones</th>
<th data-quarto-table-cell-role="th">0.00</th>
<td>0.100</td>
<td>0.100</td>
<td>0.100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.05</th>
<td>0.154</td>
<td>0.132</td>
<td>0.142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.10</th>
<td>0.218</td>
<td>0.126</td>
<td>0.178</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.20</th>
<td>0.432</td>
<td>0.122</td>
<td>0.300</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.30</th>
<td>0.660</td>
<td>0.122</td>
<td>0.436</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.50</th>
<td>0.912</td>
<td>0.122</td>
<td>0.710</td>
</tr>
<tr class="odd">
<th rowspan="6" data-quarto-table-cell-role="th" data-valign="top">mod_jones</th>
<th data-quarto-table-cell-role="th">0.00</th>
<td>0.090</td>
<td>0.090</td>
<td>0.090</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.05</th>
<td>0.130</td>
<td>0.106</td>
<td>0.128</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.10</th>
<td>0.198</td>
<td>0.174</td>
<td>0.190</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.20</th>
<td>0.404</td>
<td>0.368</td>
<td>0.422</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.30</th>
<td>0.636</td>
<td>0.598</td>
<td>0.652</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.50</th>
<td>0.884</td>
<td>0.878</td>
<td>0.922</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Implications for Vietnamese Research
</div>
</div>
<div class="callout-body-container callout-body">
<p>The power analysis has stark implications for earnings management research in Vietnam. The typical Vietnamese listed firm has been listed for 10‚Äì15 years, providing far fewer estimation-period observations than in the U.S. context where <span class="citation" data-cites="dechow1995detecting">Dechow, Sloan, and Sweeney (<a href="references.html#ref-dechow1995detecting" role="doc-biblioref">1995</a>)</span> had decades of Compustat data. Shorter estimation windows increase parameter uncertainty in the Jones model, further reducing power. Combined with the noisier financial data common in emerging markets, researchers should interpret non-rejection of the null as uninformative rather than as evidence of clean financial reporting.</p>
</div>
</div>
</section>
</section>
<section id="sec-vietnam" class="level2" data-number="27.5">
<h2 data-number="27.5" class="anchored" data-anchor-id="sec-vietnam"><span class="header-section-number">27.5</span> Vietnamese Institutional Context</h2>
<section id="channels-of-earnings-management" class="level3" data-number="27.5.1">
<h3 data-number="27.5.1" class="anchored" data-anchor-id="channels-of-earnings-management"><span class="header-section-number">27.5.1</span> Channels of Earnings Management</h3>
<p>Several features of the Vietnamese institutional environment create distinctive earnings management incentives and opportunities:</p>
<p><strong>Tax-driven manipulation.</strong> Vietnamese corporate income tax (CIT) rates have declined from 28% (pre-2009) to 20% (2016 onwards), with preferential rates for firms in Special Economic Zones and high-tech sectors. The close alignment between VAS accounting and tax accounting creates incentives to manage earnings downward to reduce tax obligations‚Äîa pattern documented in developing economies with code-law accounting traditions <span class="citation" data-cites="ball2003incentives">(<a href="references.html#ref-ball2003incentives" role="doc-biblioref">Ball, Robin, and Wu 2003</a>)</span>.</p>
<p><strong>IPO and seasoned equity offering (SEO) incentives.</strong> Vietnam has experienced several waves of SOE equitization (partial privatization). Managers have incentives to inflate earnings before share offerings to maximize proceeds. The SSC requires minimum profitability thresholds for listing eligibility, creating sharp incentives around these regulatory cutoffs, which is a natural setting for the discontinuity analysis of <span class="citation" data-cites="burgstahler1997earnings">Burgstahler and Dichev (<a href="references.html#ref-burgstahler1997earnings" role="doc-biblioref">1997</a>)</span>.</p>
<p><strong>Real earnings management in manufacturing.</strong> <span class="citation" data-cites="roychowdhury2006earnings">Roychowdhury (<a href="references.html#ref-roychowdhury2006earnings" role="doc-biblioref">2006</a>)</span> identifies overproduction, discretionary expenditure cuts, and sales manipulation as the three main channels of real earnings management. Vietnam‚Äôs large manufacturing sector (textiles, electronics assembly, food processing) provides ample scope for overproduction-based REM, where unit costs are reduced by spreading fixed overhead across larger production runs.</p>
<p><strong>Related-party transactions.</strong> Transactions with affiliated entities are a well-documented channel for earnings manipulation in Asian markets. Vietnamese conglomerates (<em>t·∫≠p ƒëo√†n</em>) often feature complex cross-ownership structures where transfer pricing between subsidiaries can shift profits across reporting entities.</p>
</section>
<section id="the-earnings-distribution-test" class="level3" data-number="27.5.2">
<h3 data-number="27.5.2" class="anchored" data-anchor-id="the-earnings-distribution-test"><span class="header-section-number">27.5.2</span> The Earnings Distribution Test</h3>
<p><span class="citation" data-cites="burgstahler1997earnings">Burgstahler and Dichev (<a href="references.html#ref-burgstahler1997earnings" role="doc-biblioref">1997</a>)</span> observed a striking discontinuity in the distribution of reported earnings around zero: far more firms report small positive earnings than small losses, relative to what a smooth distribution would predict. This pattern is interpreted as evidence that firms manage earnings to avoid reporting losses.</p>
<p>We apply this test to Vietnamese-style data to illustrate the methodology.</p>
<div id="cell-fig-earnings-distribution" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate earnings for a larger sample with benchmark-beating behavior</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>rng_dist <span class="op">=</span> np.random.default_rng(<span class="dv">2024</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>n_firms_dist <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>n_years_dist <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>earnings <span class="op">=</span> []</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms_dist):</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    base_earn <span class="op">=</span> rng_dist.normal(<span class="fl">0.06</span>, <span class="fl">0.08</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(n_years_dist):</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> base_earn <span class="op">+</span> rng_dist.normal(<span class="dv">0</span>, <span class="fl">0.04</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate benchmark-beating: firms near zero bump earnings up</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">-</span><span class="fl">0.01</span> <span class="op">&lt;</span> e <span class="op">&lt;</span> <span class="fl">0.005</span>:</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            e <span class="op">+=</span> rng_dist.uniform(<span class="fl">0.005</span>, <span class="fl">0.015</span>) <span class="op">*</span> (rng_dist.random() <span class="op">&lt;</span> <span class="fl">0.6</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        earnings.append(e)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>earn_array <span class="op">=</span> np.array(earnings)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.01</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>ax.hist(earn_array, bins<span class="op">=</span>bins, color<span class="op">=</span><span class="st">"steelblue"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.85</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"firebrick"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">"Zero threshold"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Earnings / Total Assets"</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Earnings Distribution Around Zero"</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-earnings-distribution" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-earnings-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="34_earning_management_files/figure-html/fig-earnings-distribution-output-1.png" width="1180" height="730" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-earnings-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.2: Distribution of scaled earnings around zero. A discontinuity‚Äîexcess density just above zero and a deficit just below‚Äîwould suggest benchmark-beating behavior. The red dashed line marks the zero threshold.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-earnings-change-dist" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year-over-year changes</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>earn_changes <span class="op">=</span> np.diff(earn_array.reshape(n_firms_dist, n_years_dist), axis<span class="op">=</span><span class="dv">1</span>).flatten()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>bins_chg <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.005</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax.hist(earn_changes, bins<span class="op">=</span>bins_chg, color<span class="op">=</span><span class="st">"darkorange"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.85</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"firebrick"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">"Zero change"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Change in Earnings / Total Assets"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Earnings Change Distribution Around Zero"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-earnings-change-dist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-earnings-change-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="34_earning_management_files/figure-html/fig-earnings-change-dist-output-1.png" width="1180" height="730" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-earnings-change-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.3: Distribution of year-over-year earnings changes around zero. A discontinuity here suggests that firms manage earnings to avoid reporting declines, even when small.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="accrual-based-vs.-real-earnings-management" class="level3" data-number="27.5.3">
<h3 data-number="27.5.3" class="anchored" data-anchor-id="accrual-based-vs.-real-earnings-management"><span class="header-section-number">27.5.3</span> Accrual-Based vs.&nbsp;Real Earnings Management</h3>
<p><span class="citation" data-cites="cohen2008real">Cohen, Dey, and Lys (<a href="references.html#ref-cohen2008real" role="doc-biblioref">2008</a>)</span> document a shift from AEM to REM following the passage of the Sarbanes-Oxley Act (SOX) in 2002, suggesting that tighter regulatory scrutiny redirects manipulation toward less detectable channels. <span class="citation" data-cites="zang2012evidence">Zang (<a href="references.html#ref-zang2012evidence" role="doc-biblioref">2012</a>)</span> provides further evidence that firms trade off between AEM and REM based on their relative costs.</p>
<p>In Vietnam, where regulatory enforcement of accounting standards is weaker than in post-SOX America, we might expect AEM to remain the dominant channel. However, as Vietnam moves toward IFRS adoption and strengthens SSC oversight, the AEM-to-REM substitution hypothesis becomes testable.</p>
<p>We can measure REM using the <span class="citation" data-cites="roychowdhury2006earnings">Roychowdhury (<a href="references.html#ref-roychowdhury2006earnings" role="doc-biblioref">2006</a>)</span> approach. Three proxies capture different manipulation channels:</p>
<p><strong>Abnormal cash flow from operations.</strong> Estimate normal CFO as a function of sales and sales changes:</p>
<p><span id="eq-abnormal-cfo"><span class="math display">\[
\frac{CFO_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t}}{A_{i,t-1}} + \beta_3 \frac{\Delta S_{i,t}}{A_{i,t-1}} + \varepsilon_{i,t}
\tag{27.9}\]</span></span></p>
<p><strong>Abnormal production costs.</strong> Production costs = COGS + change in inventory. Normal levels are modeled as:</p>
<p><span id="eq-abnormal-prod"><span class="math display">\[
\frac{PROD_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t}}{A_{i,t-1}} + \beta_3 \frac{\Delta S_{i,t}}{A_{i,t-1}} + \beta_4 \frac{\Delta S_{i,t-1}}{A_{i,t-1}} + \varepsilon_{i,t}
\tag{27.10}\]</span></span></p>
<p><strong>Abnormal discretionary expenditures.</strong> R&amp;D + advertising + SGA, modeled as:</p>
<p><span id="eq-abnormal-disc"><span class="math display">\[
\frac{DISC_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t-1}}{A_{i,t-1}} + \varepsilon_{i,t}
\tag{27.11}\]</span></span></p>
<p>Residuals from these regressions serve as proxies for real manipulation. A firm that overproduces will show abnormally <em>high</em> production costs and abnormally <em>low</em> CFO (cash tied up in inventory).</p>
</section>
</section>
<section id="summary" class="level2" data-number="27.6">
<h2 data-number="27.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">27.6</span> Summary</h2>
<p>This chapter examined the measurement and detection of earnings management, with a focus on methodological rigor and adaptation to Vietnam‚Äôs institutional environment. The key takeaways are:</p>
<ul>
<li><p>Detecting earnings management requires separating discretionary from non-discretionary accruals, which depends critically on the quality of the non-discretionary accrual model. All five canonical models have known weaknesses.</p></li>
<li><p>Under the null hypothesis of no manipulation, the Jones and Modified Jones models over-reject when standard two-stage standard errors are used. The <span class="citation" data-cites="salkever1976use">Salkever (<a href="references.html#ref-salkever1976use" role="doc-biblioref">1976</a>)</span> correction provides properly calibrated inference.</p></li>
<li><p>When test firms experience extreme financial performance, all models exhibit severe size distortion, misattributing performance-driven accrual variation to managerial discretion. Performance matching <span class="citation" data-cites="kothari2005performance">(<a href="references.html#ref-kothari2005performance" role="doc-biblioref">Kothari, Leone, and Wasley 2005</a>)</span> partially addresses this.</p></li>
<li><p>Power analysis reveals that economically plausible levels of manipulation (below 10% of assets) are detected with very low probability. This casts doubt on studies that report null results as evidence of no manipulation.</p></li>
<li><p>Vietnam‚Äôs institutional features, such aSOE governance, VAS accounting rules, weak enforcement, and thin audit coverage‚Äîcreate a rich setting for earnings management research, but the methodological challenges are amplified by shorter time series and noisier data.</p></li>
</ul>
<p>Researchers working with Vietnamese data should: (i) use the Salkever correction for proper inference, (ii) implement performance matching, (iii) consider multiple models and triangulate results, and (iv) supplement accrual-based approaches with real earnings management and distributional tests.</p>
<!-- ## Exercises

1.  **Salkever equivalence.** Using the `demonstrate_salkever()` function, verify numerically that the two-stage Jones $DA$ estimate equals the Salkever coefficient on $PART$ for a randomly selected firm. Report both estimates to six decimal places.

2.  **Modified Jones with Salkever.** Extend the Salkever approach to the Modified Jones model. In the one-stage regression, how should $\Delta Rev$ be specified‚Äîadjusted or unadjusted? Justify your choice.

3.  **Performance matching.** Implement the @kothari2005performance performance-matching procedure: for each test firm-year, find a control firm in the same 2-digit industry with the closest ROA, and subtract its $DA$. Re-run the Type I error analysis with performance-matched $DA$. Does performance matching reduce over-rejection for extreme-performance samples?

4.  **SOE vs. non-SOE detection.** Split the sample by SOE status and estimate discretionary accruals separately for each subsample. Are there systematic differences in estimated $DA$ that might reflect genuine differences in accrual quality, or could they be artifacts of the model specification?

5.  **Earnings discontinuity test.** Using the synthetic earnings data (or actual Vietnamese data if available), formally test for a discontinuity at zero using the approach of @burgstahler1997earnings. Compute the standardized difference between the bin just above and just below zero: $$
    z = \frac{n_{+} - n_{-}}{\sqrt{N \cdot p \cdot (1-p)}}
    $$ where $n_{+}$ and $n_{-}$ are the counts in the two adjacent bins and $p$ is the expected proportion under smoothness.

6.  **Real earnings management.** Implement the @roychowdhury2006earnings model for abnormal production costs (@eq-abnormal-prod) using the synthetic panel. Estimate the model cross-sectionally by year and 2-digit industry. What fraction of the cross-sectional variation in production costs is explained by the model?

7.  **Power under Vietnamese conditions.** Re-run the power analysis with a shortened estimation window (7 years instead of 10) to simulate the typical data availability for Vietnamese firms listed after 2007. How does the reduction in estimation data affect detection power? What is the minimum manipulation level that can be detected with 50% power?

8.  **Stub-period revenue manipulation.** @stubben2010discretionary proposes a revenue-based measure of earnings management that regresses changes in receivables on changes in revenue, arguing that revenue manipulation is easier to detect through its receivable footprint than through the broad accrual models. Implement this approach and compare its Type I error and power properties to the Jones model on Vietnamese data. -->


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-ball2003incentives" class="csl-entry" role="listitem">
Ball, Ray, Ashok Robin, and Joanna Shuang Wu. 2003. <span>‚ÄúIncentives Versus Standards: Properties of Accounting Income in Four East Asian Countries.‚Äù</span> <em>Journal of Accounting and Economics</em> 36 (1-3): 235‚Äì70.
</div>
<div id="ref-burgstahler1997earnings" class="csl-entry" role="listitem">
Burgstahler, David, and Ilia Dichev. 1997. <span>‚ÄúEarnings Management to Avoid Earnings Decreases and Losses.‚Äù</span> <em>Journal of Accounting and Economics</em> 24 (1): 99‚Äì126.
</div>
<div id="ref-cohen2008real" class="csl-entry" role="listitem">
Cohen, Daniel A, Aiyesha Dey, and Thomas Z Lys. 2008. <span>‚ÄúReal and Accrual-Based Earnings Management in the Pre-and Post-Sarbanes-Oxley Periods.‚Äù</span> <em>The Accounting Review</em> 83 (3): 757‚Äì87.
</div>
<div id="ref-deangelo1986accounting" class="csl-entry" role="listitem">
DeAngelo, Linda Elizabeth. 1986. <span>‚ÄúAccounting Numbers as Market Valuation Substitutes: A Study of Management Buyouts of Public Stockholders.‚Äù</span> <em>Accounting Review</em>, 400‚Äì420.
</div>
<div id="ref-dechow1995detecting" class="csl-entry" role="listitem">
Dechow, Patricia M, Richard G Sloan, and Amy P Sweeney. 1995. <span>‚ÄúDetecting Earnings Management.‚Äù</span> <em>Accounting Review</em>, 193‚Äì225.
</div>
<div id="ref-healy1985effect" class="csl-entry" role="listitem">
Healy, Paul M. 1985. <span>‚ÄúThe Effect of Bonus Schemes on Accounting Decisions.‚Äù</span> <em>Journal of Accounting and Economics</em> 7 (1-3): 85‚Äì107.
</div>
<div id="ref-jones1991earnings" class="csl-entry" role="listitem">
Jones, Jennifer J. 1991. <span>‚ÄúEarnings Management During Import Relief Investigations.‚Äù</span> <em>Journal of Accounting Research</em> 29 (2): 193‚Äì228.
</div>
<div id="ref-kothari2005performance" class="csl-entry" role="listitem">
Kothari, Sagar P, Andrew J Leone, and Charles E Wasley. 2005. <span>‚ÄúPerformance Matched Discretionary Accrual Measures.‚Äù</span> <em>Journal of Accounting and Economics</em> 39 (1): 163‚Äì97.
</div>
<div id="ref-leuz2003earnings" class="csl-entry" role="listitem">
Leuz, Christian, Dhananjay Nanda, and Peter D Wysocki. 2003. <span>‚ÄúEarnings Management and Investor Protection: An International Comparison.‚Äù</span> <em>Journal of Financial Economics</em> 69 (3): 505‚Äì27.
</div>
<div id="ref-roychowdhury2006earnings" class="csl-entry" role="listitem">
Roychowdhury, Sugata. 2006. <span>‚ÄúEarnings Management Through Real Activities Manipulation.‚Äù</span> <em>Journal of Accounting and Economics</em> 42 (3): 335‚Äì70.
</div>
<div id="ref-salkever1976use" class="csl-entry" role="listitem">
Salkever, David S. 1976. <span>‚ÄúThe Use of Dummy Variables to Compute Predictions, Prediction Errors, and Confidence Intervals.‚Äù</span> <em>Journal of Econometrics</em> 4 (4): 393‚Äì97.
</div>
<div id="ref-zang2012evidence" class="csl-entry" role="listitem">
Zang, Amy Y. 2012. <span>‚ÄúEvidence on the Trade-Off Between Real Activities Manipulation and Accrual-Based Earnings Management.‚Äù</span> <em>The Accounting Review</em> 87 (2): 675‚Äì703.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const year = new Date().getFullYear();
  document.getElementById("copyright").textContent = "¬© " + year;
});
</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LG91D0C6RB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LG91D0C6RB');
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mikenguyen13\.github\.io\/tidy_finance_vn_vi\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./33_accruals.html" class="pagination-link" aria-label="Accruals, Earnings Persistence, and Market Efficiency">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Accruals, Earnings Persistence, and Market Efficiency</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./35_pe_ratio.html" class="pagination-link" aria-label="P/E Ratio">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">P/E Ratio</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Earnings Management: Detection and Measurement</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"figure.dpi"</span>: <span class="dv">150</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.top"</span>: <span class="va">False</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"axes.spines.right"</span>: <span class="va">False</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.size"</span>: <span class="dv">11</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>Earnings management refers to the purposeful intervention by managers in the financial reporting process to achieve outcomes that serve private objectives, whether to meet analyst forecasts, trigger bonus thresholds, avoid covenant violations, or influence equity valuations. While the concept is intuitive, its rigorous detection poses one of the most enduring methodological challenges in empirical accounting research.</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>The difficulty is fundamental: researchers observe *total* accruals, which combine a legitimate component (reflecting genuine economic activity) with a discretionary component (reflecting managerial intervention). Separating these two components requires a model of what accruals *should* be absent manipulation, what the literature calls **non-discretionary accruals (NDA)**. Any residual, the gap between observed accruals and the model's prediction, is then attributed to managerial discretion. The quality of the detection method therefore hinges entirely on the quality of this model.</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>This chapter examines three foundational approaches to measuring earnings management (i.e., the @healy1985effect model, the @jones1991earnings model, and the modified Jones model of @dechow1995detecting) and evaluates their statistical properties using simulation. We then adapt the analysis to the institutional setting of Vietnam, where distinct governance structures, accounting standards, and enforcement regimes create both unique incentives for earnings management and unique challenges for its detection.</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="fu">### Defining Earnings Management</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>A useful taxonomy distinguishes three forms:</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Accrual-based earnings management (AEM).** Managers exploit discretion within accounting standards to shift the timing of revenue or expense recognition. Examples include aggressive revenue recognition, delays in write-downs, or manipulation of allowance estimates. This form does not alter the firm's underlying cash flows.</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Real earnings management (REM).** Managers take genuine economic actions (e.g., overproduction to reduce unit costs, cutting R&amp;D or advertising expenditure, offering price discounts to accelerate sales) that have real cash flow consequences <span class="co">[</span><span class="ot">@roychowdhury2006earnings</span><span class="co">]</span>. These actions may improve current-period earnings at the expense of future value.</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Classification shifting.** Managers reclassify core expenses as non-recurring items to inflate core earnings without changing bottom-line net income. This form leaves both total accruals and cash flows unchanged.</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Vietnam?</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>Vietnam's institutional environment amplifies several channels relevant to earnings management research:</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**State-owned enterprise (SOE) incentives.** Partially privatized SOEs face dual pressures: political targets from state shareholders and market expectations from minority investors.</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Regulatory enforcement.** Vietnam's State Securities Commission (SSC) has limited resources and a short institutional history relative to bodies like the U.S. SEC. Weaker enforcement reduces the expected cost of manipulation, potentially increasing its prevalence <span class="co">[</span><span class="ot">@leuz2003earnings</span><span class="co">]</span>.</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Accounting standards.** VAS (Vietnamese Accounting Standards) are based on older IAS versions and have not fully converged with IFRS. Certain VAS provisions, such as rules-based revenue recognition criteria and prescribed depreciation methods, constrain some forms of discretion while creating predictable opportunities for others.</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Benchmark-beating behavior.** @burgstahler1997earnings documented discontinuities around zero earnings and zero earnings changes in U.S. data. The Vietnamese market, with its high retail participation and emphasis on headline profitability, may exhibit similar or even more pronounced patterns.</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models of Non-Discretionary Accruals {#sec-models}</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### Notation and Setup</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>Let $i$ index firms and $t$ index fiscal years. Define:</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Symbol <span class="pp">|</span> Definition <span class="pp">|</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------------------------|-----------------------------------------|</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $TA_{i,t}$ <span class="pp">|</span> Total accruals (scaled by lagged assets) <span class="pp">|</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $NDA_{i,t}$ <span class="pp">|</span> Non-discretionary accruals (model prediction) <span class="pp">|</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $DA_{i,t}$ <span class="pp">|</span> Discretionary accruals: $DA_{i,t} = TA_{i,t} - NDA_{i,t}$ <span class="pp">|</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $A_{i,t}$ <span class="pp">|</span> Total assets <span class="pp">|</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $\Delta Rev_{i,t}$ <span class="pp">|</span> Change in revenues, scaled by $A_{i,t-1}$ <span class="pp">|</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $\Delta Rec_{i,t}$ <span class="pp">|</span> Change in net receivables, scaled by $A_{i,t-1}$ <span class="pp">|</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $PPE_{i,t}$ <span class="pp">|</span> Gross property, plant, and equipment, scaled by $A_{i,t-1}$ <span class="pp">|</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $PART_{i,t}$ <span class="pp">|</span> Indicator equal to 1 for the test (event) year <span class="pp">|</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>: Notation for earnings management models {#tbl-em-notation}</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>Total accruals are computed using the balance sheet approach:</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>TA_{i,t} = \frac{(\Delta CA_{i,t} - \Delta Cash_{i,t}) - (\Delta CL_{i,t} - \Delta STD_{i,t}) - Dep_{i,t}}{A_{i,t-1}}</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>$$ {#eq-total-accruals}</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>where $\Delta CA$ is the change in current assets, $\Delta Cash$ is the change in cash, $\Delta CL$ is the change in current liabilities, $\Delta STD$ is the change in short-term debt, and $Dep$ is depreciation expense.</span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a><span class="fu">### Five Models</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>We implement five models, each estimating $NDA$ during a firm-specific estimation window and computing $DA$ for the test year as the residual.</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>**Model 1**: @healy1985effect. Non-discretionary accruals equal the mean of total accruals during the estimation period:</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>NDA^{Healy}_{i,t} = \frac{1}{T} \sum_{s \in \text{est}} TA_{i,s}</span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>$$ {#eq-healy}</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>This is the simplest possible benchmark. Its limitation is obvious: it treats *all* time-variation in accruals as discretionary, even variation driven by changes in the firm's economic environment.</span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>**Model 2**: @deangelo1986accounting. Non-discretionary accruals equal last period's total accruals:</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>NDA^{DeAngelo}_{i,t} = TA_{i,t-1}</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>$$ {#eq-deangelo}</span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>This is equivalent to assuming that the change in total accruals is entirely discretionary. It performs well when accruals follow a random walk, but poorly when they exhibit mean-reversion or trend.</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>**Model 3**: @jones1991earnings. This model controls for changes in a firm's economic environment by regressing accruals on revenue changes and the level of fixed assets:</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>TA_{i,t} = \alpha_1 \frac{1}{A_{i,t-1}} + \alpha_2 \Delta Rev_{i,t} + \alpha_3 PPE_{i,t} + \varepsilon_{i,t}</span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>$$ {#eq-jones}</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>The parameters $\hat{\alpha}_1, \hat{\alpha}_2, \hat{\alpha}_3$ are estimated on the estimation-period data. Non-discretionary accruals for the test year are the fitted values from this regression applied to test-year covariates.</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>The economic logic is that revenue growth generates legitimate working capital accruals (higher receivables and inventory), while fixed assets proxy for non-discretionary depreciation charges. The intercept is scaled by lagged assets rather than included as a conventional constant, following @jones1991earnings.</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>**Model 4: Modified Jones** <span class="co">[</span><span class="ot">@dechow1995detecting</span><span class="co">]</span>. The modification adjusts revenue changes for changes in receivables during the test year, on the premise that credit revenue growth is more susceptible to manipulation than cash revenue growth:</span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>NDA^{ModJones}_{i,t} = \hat{\alpha}_1 \frac{1}{A_{i,t-1}} + \hat{\alpha}_2 (\Delta Rev_{i,t} - \Delta Rec_{i,t}) + \hat{\alpha}_3 PPE_{i,t}</span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>$$ {#eq-mod-jones}</span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>The coefficients are still estimated from the *unadjusted* Jones model (@eq-jones) on estimation-period data, but receivables are subtracted from revenues only when computing fitted values for the test year.</span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>**Model 5: Industry Model.** This model assumes that the common component of accruals within an industry captures non-discretionary variation:</span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>TA_{i,t} = \phi_0 + \phi_1 \cdot \widetilde{TA}_{j,t} + \eta_{i,t}</span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>$$ {#eq-industry}</span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>where $\widetilde{TA}_{j,t}$ is the median total accrual across all firms in industry $j$ (excluding firm $i$), estimated during the estimation period.</span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementation</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-accruals-fn</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Function to compute total accruals from balance sheet data"</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_accruals(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute total accruals using the balance sheet approach.</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected columns: gvkey/ticker, year/fyear, at, act, che, lct, dlc,</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a><span class="co">                      dp, sale, rect, ppegt</span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"year"</span> <span class="cf">if</span> <span class="st">"year"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"fyear"</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([firm_col, year_col]).copy()</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lagged values and changes</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"lag_at"</span>] <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_ca"</span>] <span class="op">=</span> g[<span class="st">"act"</span>].diff()</span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_cash"</span>] <span class="op">=</span> g[<span class="st">"che"</span>].diff()</span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_cl"</span>] <span class="op">=</span> g[<span class="st">"lct"</span>].diff()</span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_std"</span>] <span class="op">=</span> g[<span class="st">"dlc"</span>].diff()</span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev"</span>] <span class="op">=</span> g[<span class="st">"sale"</span>].diff()</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rec"</span>] <span class="op">=</span> g[<span class="st">"rect"</span>].diff()</span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total accruals (raw)</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"acc_raw"</span>] <span class="op">=</span> (df[<span class="st">"d_ca"</span>] <span class="op">-</span> df[<span class="st">"d_cash"</span>] <span class="op">-</span> df[<span class="st">"d_cl"</span>] <span class="op">+</span> df[<span class="st">"d_std"</span>]) <span class="op">-</span> df[<span class="st">"dp"</span>]</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nda-models</span></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Implementations of five non-discretionary accrual models"</span></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_healy(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Healy (1985): NDA = mean accruals in estimation period."""</span></span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a>    est_mean <span class="op">=</span> df.loc[<span class="op">~</span>df[<span class="st">"part"</span>], <span class="st">"acc_at"</span>].mean()</span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_healy"</span>] <span class="op">=</span> est_mean</span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_healy"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_healy"</span>]</span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_deangelo(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""DeAngelo (1986): NDA = prior-period total accruals."""</span></span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_deangelo"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_deangelo"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_deangelo"</span>]</span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_jones(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Jones (1991): Regression-based NDA controlling for revenue and PPE."""</span></span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>])</span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]].copy()</span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_jones"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_jones"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_jones"</span>]</span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_mod_jones(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Modified Jones (Dechow et al., 1995): Adjust revenues for receivables."""</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>])</span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_mod_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_mod_jones"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate on unadjusted Jones model</span></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict using adjusted revenue (subtract receivable changes)</span></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_alt_at"</span>, <span class="st">"ppe_at"</span>]].copy()</span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a>    pred_X.columns <span class="op">=</span> [<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_mod_jones"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_mod_jones"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_mod_jones"</span>]</span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_industry(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Industry model: NDA = f(industry median accruals)."""</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]].dropna(subset<span class="op">=</span>[<span class="st">"acc_at"</span>, <span class="st">"acc_ind"</span>])</span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(est) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"nda_industry"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"da_industry"</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(est[<span class="st">"acc_ind"</span>])</span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>    pred_X <span class="op">=</span> sm.add_constant(df[<span class="st">"acc_ind"</span>])</span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_industry"</span>] <span class="op">=</span> model.predict(pred_X)</span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_industry"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_industry"</span>]</span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-nda-all</span></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Master function to apply all five models to a panel"</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_model_vars(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add scaled variables needed by the five NDA models."""</span></span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> calc_accruals(df)</span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sic2"</span>] <span class="op">=</span> df[<span class="st">"sic"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"acc_at"</span>] <span class="op">=</span> df[<span class="st">"acc_raw"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"one_at"</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev_at"</span>] <span class="op">=</span> df[<span class="st">"d_rev"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"d_rev_alt_at"</span>] <span class="op">=</span> (df[<span class="st">"d_rev"</span>] <span class="op">-</span> df[<span class="st">"d_rec"</span>]) <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"ppe_at"</span>] <span class="op">=</span> df[<span class="st">"ppegt"</span>] <span class="op">/</span> df[<span class="st">"lag_at"</span>]</span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Industry median accruals (estimation period only)</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>    <span class="co"># est_acc = df.loc[~df["part"], ["sic2", "acc_at"]].copy()</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>    est_acc <span class="op">=</span> df.loc[df[<span class="st">"part"</span>] <span class="op">==</span> <span class="va">False</span>, [<span class="st">"sic2"</span>, <span class="st">"acc_at"</span>]].copy()</span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a>    ind_median <span class="op">=</span> est_acc.groupby(<span class="st">"sic2"</span>)[<span class="st">"acc_at"</span>].median().rename(<span class="st">"acc_ind"</span>)</span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(ind_median, on<span class="op">=</span><span class="st">"sic2"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_nda(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply all five NDA models on a firm-by-firm basis.</span></span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a DataFrame with DA columns for each model.</span></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"year"</span> <span class="cf">if</span> <span class="st">"year"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"fyear"</span></span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a>    df_mod <span class="op">=</span> prepare_model_vars(df)</span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>    df_mod[<span class="st">"part"</span>] <span class="op">=</span> df_mod[<span class="st">"part"</span>].astype(<span class="bu">bool</span>)</span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df_mod.groupby(firm_col):</span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> group.sort_values(year_col).copy()</span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_healy(g)</span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_deangelo(g)</span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_jones(g)</span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_mod_jones(g)</span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> fit_industry(g)</span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a>        results.append(g)</span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat(results, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Salkever (1976) Correction</span></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>An important but underappreciated methodological issue arises when computing standard errors for discretionary accruals under the Jones-type models. In the standard two-stage procedure, the researcher first estimates the Jones model on the estimation period, then computes discretionary accruals for the test year as a *prediction error*. But the standard error of a prediction error is larger than the standard error of a fitted residual, because it incorporates parameter uncertainty from the first-stage estimation. Ignoring this distinction leads to understated standard errors and inflated rejection rates,exactly the problem documented in @dechow1995detecting.</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a>@salkever1976use provides an elegant solution: run a single regression on the *combined* estimation and test periods, including a dummy variable $PART$ for the test year. The coefficient on $PART$ equals the prediction error (discretionary accruals), and its standard error correctly accounts for first-stage estimation uncertainty.</span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a>For the Jones model, the Salkever single-stage regression is:</span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>TA_{i,t} = \alpha_1 \frac{1}{A_{i,t-1}} + \alpha_2 \Delta Rev_{i,t} + \alpha_3 PPE_{i,t} + \delta \cdot PART_{i,t} + u_{i,t}</span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>$$ {#eq-salkever}</span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a>The coefficient $\hat{\delta}$ is numerically identical to the two-stage $DA$ estimate, but its standard error $\text{se}(\hat{\delta})$ is the correct prediction error standard error.</span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: salkever-demo</span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Demonstration of the Salkever (1976) equivalence"</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> demonstrate_salkever(df_firm: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a><span class="co">    For a single firm, show that the two-stage Jones DA equals</span></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a><span class="co">    the Salkever one-stage coefficient on PART.</span></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> prepare_model_vars(df_firm)</span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a>    needed <span class="op">=</span> [<span class="st">"acc_at"</span>, <span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>, <span class="st">"part"</span>]</span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>needed).copy()</span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚îÄ‚îÄ Two-stage approach ‚îÄ‚îÄ</span></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"part"</span>]]</span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>    y_est <span class="op">=</span> est[<span class="st">"acc_at"</span>]</span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a>    X_est <span class="op">=</span> est[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]]</span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a>    fm_stage1 <span class="op">=</span> sm.OLS(y_est, X_est).fit()</span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nda_two_stage"</span>] <span class="op">=</span> fm_stage1.predict(df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>]])</span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"da_two_stage"</span>] <span class="op">=</span> df[<span class="st">"acc_at"</span>] <span class="op">-</span> df[<span class="st">"nda_two_stage"</span>]</span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test-year DA from two-stage</span></span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a>    da_two_stage <span class="op">=</span> df.loc[df[<span class="st">"part"</span>], <span class="st">"da_two_stage"</span>].values</span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚îÄ‚îÄ Salkever one-stage ‚îÄ‚îÄ</span></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part_float"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a>    y_full <span class="op">=</span> df[<span class="st">"acc_at"</span>]</span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a>    X_full <span class="op">=</span> df[[<span class="st">"one_at"</span>, <span class="st">"d_rev_at"</span>, <span class="st">"ppe_at"</span>, <span class="st">"part_float"</span>]]</span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a>    fm_salkever <span class="op">=</span> sm.OLS(y_full, X_full).fit()</span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a>    da_salkever <span class="op">=</span> fm_salkever.params[<span class="st">"part_float"</span>]</span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a>    se_two_stage_wrong <span class="op">=</span> np.nan  <span class="co"># two-stage doesn't give correct SE</span></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a>    se_salkever <span class="op">=</span> fm_salkever.bse[<span class="st">"part_float"</span>]</span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Method"</span>: [<span class="st">"Two-stage Jones"</span>, <span class="st">"Salkever one-stage"</span>],</span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DA estimate"</span>: [da_two_stage[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(da_two_stage) <span class="cf">else</span> np.nan,</span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a>                        da_salkever],</span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Correct SE"</span>: [<span class="st">"Not available"</span>, <span class="ss">f"</span><span class="sc">{</span>se_salkever<span class="sc">:.6f}</span><span class="ss">"</span>],</span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t-statistic"</span>: [<span class="st">"Biased"</span>, <span class="ss">f"</span><span class="sc">{</span>fm_salkever<span class="sc">.</span>tvalues[<span class="st">'part_float'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>],</span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a><span class="fu">## Type I Error Under the Null Hypothesis {#sec-type1}</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Experimental Design</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a>To evaluate whether the five models produce well-calibrated test statistics, we conduct a simulation experiment parallel to Table 2 of @dechow1995detecting. The procedure is:</span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Generate a panel of $N$ firms, each with $T$ years of financial statement data.</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>For each firm, randomly designate one year as the test year ($PART = 1$). By construction, *no earnings management occurs* in this year.</span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Estimate discretionary accruals using each of the five models.</span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Regress $DA$ on $PART$ for each firm and record whether the null $H_0:</span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a>    \delta = 0$ is rejected at the 5% and 1% significance levels.</span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Compute the rejection rate across all $N$ firms.</span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a>If the model is well-specified, rejection rates should equal the nominal test size (5% or 1%). Systematic over-rejection indicates that the model produces biased test statistics, a critical flaw for research that relies on these measures to draw causal inferences.</span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Generation</span></span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a>We generate synthetic panel data that preserves the key cross-sectional and time-series properties of Vietnamese listed firms while allowing us to know with certainty that no manipulation exists.</span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gen-panel</span></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Generate synthetic Vietnamese panel data for Type I error analysis"</span></span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_em_panel(</span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a>    n_firms: <span class="bu">int</span> <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a>    n_years: <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a>    seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2024</span>,</span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate a synthetic panel of Vietnamese-style financial data.</span></span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a><span class="co">    No earnings management is present by construction.</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a><span class="co">    The data generation process captures:</span></span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a><span class="co">    - AR(1) revenue process</span></span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a><span class="co">    - Accruals driven by revenue growth and PPE levels</span></span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a><span class="co">    - Industry-level common shocks</span></span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a><span class="co">    - SOE/non-SOE heterogeneity</span></span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a>    industries <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">41</span>, <span class="dv">46</span>, <span class="dv">47</span>, <span class="dv">52</span>, <span class="dv">62</span>, <span class="dv">64</span>, <span class="dv">68</span>]</span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms):</span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Firm characteristics</span></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a>        sic <span class="op">=</span> rng.choice(industries)</span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a>        is_soe <span class="op">=</span> <span class="bu">int</span>(rng.random() <span class="op">&lt;</span> <span class="fl">0.30</span>)</span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a>        base_assets <span class="op">=</span> rng.lognormal(mean<span class="op">=</span><span class="dv">12</span>, sigma<span class="op">=</span><span class="fl">1.5</span>)  <span class="co"># VND billions</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a>        growth_rate <span class="op">=</span> rng.normal(<span class="fl">0.08</span>, <span class="fl">0.04</span>)</span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Jones model parameters (firm-specific true DGP)</span></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a>        true_alpha1 <span class="op">=</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a>        true_alpha2 <span class="op">=</span> rng.normal(<span class="fl">0.06</span>, <span class="fl">0.03</span>)   <span class="co"># revenue-accrual sensitivity</span></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>        true_alpha3 <span class="op">=</span> rng.normal(<span class="op">-</span><span class="fl">0.04</span>, <span class="fl">0.02</span>)  <span class="co"># depreciation effect</span></span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>        at_prev <span class="op">=</span> base_assets</span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a>        sale_prev <span class="op">=</span> base_assets <span class="op">*</span> rng.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a>        rect_prev <span class="op">=</span> sale_prev <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.25</span>)</span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(n_years):</span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> <span class="dv">2009</span> <span class="op">+</span> t</span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evolve fundamentals</span></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>            at <span class="op">=</span> at_prev <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> growth_rate <span class="op">+</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.05</span>))</span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>            sale <span class="op">=</span> sale_prev <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> rng.normal(<span class="fl">0.06</span>, <span class="fl">0.08</span>))</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>            rect <span class="op">=</span> sale <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.25</span>)</span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a>            ppegt <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.3</span>, <span class="fl">0.7</span>)</span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate accruals from true Jones DGP + noise</span></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a>            d_rev <span class="op">=</span> sale <span class="op">-</span> sale_prev</span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a>            one_at <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> at_prev</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a>            d_rev_at <span class="op">=</span> d_rev <span class="op">/</span> at_prev</span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a>            ppe_at <span class="op">=</span> ppegt <span class="op">/</span> at_prev</span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a>            acc_at <span class="op">=</span> (true_alpha1 <span class="op">*</span> one_at </span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> true_alpha2 <span class="op">*</span> d_rev_at </span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> true_alpha3 <span class="op">*</span> ppe_at</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a>                      <span class="op">+</span> rng.normal(<span class="dv">0</span>, <span class="fl">0.03</span>))</span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a>            acc_raw <span class="op">=</span> acc_at <span class="op">*</span> at_prev</span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reverse-engineer balance sheet items consistent with accruals</span></span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a>            dp <span class="op">=</span> ppegt <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.12</span>)</span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a>            d_cl <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.02</span>)</span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a>            d_std <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.01</span>)</span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a>            d_cash <span class="op">=</span> rng.normal(<span class="dv">0</span>, at <span class="op">*</span> <span class="fl">0.02</span>)</span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>            d_ca <span class="op">=</span> acc_raw <span class="op">+</span> dp <span class="op">+</span> d_cl <span class="op">-</span> d_std <span class="op">+</span> d_cash</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a>            act <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.3</span>, <span class="fl">0.6</span>)</span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a>            che <span class="op">=</span> act <span class="op">*</span> rng.uniform(<span class="fl">0.05</span>, <span class="fl">0.2</span>)</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a>            lct <span class="op">=</span> at <span class="op">*</span> rng.uniform(<span class="fl">0.15</span>, <span class="fl">0.35</span>)</span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a>            dlc <span class="op">=</span> lct <span class="op">*</span> rng.uniform(<span class="fl">0.1</span>, <span class="fl">0.4</span>)</span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>            ni <span class="op">=</span> sale <span class="op">*</span> rng.uniform(<span class="fl">0.03</span>, <span class="fl">0.12</span>)</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a>            ib <span class="op">=</span> ni</span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a>            records.append({</span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ticker"</span>: <span class="ss">f"VN</span><span class="sc">{</span>i<span class="sc">:04d}</span><span class="ss">"</span>,</span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fyear"</span>: year,</span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>                <span class="st">"at"</span>: at,</span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a>                <span class="st">"act"</span>: act,</span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a>                <span class="st">"che"</span>: che,</span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a>                <span class="st">"lct"</span>: lct,</span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>                <span class="st">"dlc"</span>: dlc,</span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a>                <span class="st">"dp"</span>: dp,</span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sale"</span>: sale,</span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a>                <span class="st">"rect"</span>: rect,</span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ppegt"</span>: ppegt,</span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ni"</span>: ni,</span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ib"</span>: ib,</span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sic"</span>: sic,</span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a>                <span class="st">"is_soe"</span>: is_soe,</span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>            at_prev <span class="op">=</span> at</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>            sale_prev <span class="op">=</span> sale</span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a>            rect_prev <span class="op">=</span> rect</span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a>panel_raw <span class="op">=</span> generate_em_panel(n_firms<span class="op">=</span><span class="dv">500</span>, n_years<span class="op">=</span><span class="dv">15</span>, seed<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Panel: </span><span class="sc">{</span>panel_raw<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-years, "</span></span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>panel_raw[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample Construction</span></span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a>We construct a sample of 500 firms, each with a randomly designated test year, mirroring the design of @dechow1995detecting.</span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sample-construction</span></span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct analysis sample with random test-year assignment"</span></span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_sample(</span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame,</span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a>    n_sample: <span class="bu">int</span> <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a>    min_est_years: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a>    seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">42</span>,</span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a>    selection_filter: Optional[<span class="bu">callable</span>] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a><span class="co">    For each firm, randomly assign one year as the test year (part=True).</span></span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a><span class="co">    Require at least min_est_years of estimation data.</span></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"fyear"</span></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute accruals and filter for data availability</span></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> calc_accruals(df)</span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a>    required <span class="op">=</span> [<span class="st">"acc_raw"</span>, <span class="st">"lag_at"</span>, <span class="st">"d_rev"</span>, <span class="st">"d_rec"</span>, <span class="st">"ppegt"</span>]</span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>required)</span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">"lag_at"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Require minimum years</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a>    firm_counts <span class="op">=</span> df.groupby(firm_col)[year_col].count()</span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a>    eligible <span class="op">=</span> firm_counts[firm_counts <span class="op">&gt;=</span> (min_est_years <span class="op">+</span> <span class="dv">1</span>)].index</span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[firm_col].isin(eligible)]</span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> selection_filter <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> selection_filter(df)</span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample n_sample firms</span></span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a>    firms <span class="op">=</span> df[firm_col].unique()</span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(firms) <span class="op">&gt;</span> n_sample:</span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a>        firms <span class="op">=</span> rng.choice(firms, n_sample, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[firm_col].isin(firms)].copy()</span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each firm, randomly pick one test year (not the first year)</span></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> []</span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df.groupby(firm_col):</span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a>        years <span class="op">=</span> group[year_col].sort_values().values</span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(years) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a>        test_year <span class="op">=</span> rng.choice(years[<span class="dv">1</span>:])</span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a>        parts.append({firm_col: firm, year_col: test_year, <span class="st">"part"</span>: <span class="va">True</span>})</span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a>    part_df <span class="op">=</span> pd.DataFrame(parts)</span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(part_df, on<span class="op">=</span>[firm_col, year_col], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].fillna(<span class="va">False</span>)</span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"part"</span>] <span class="op">=</span> df[<span class="st">"part"</span>].astype(<span class="bu">bool</span>)</span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>sample_1 <span class="op">=</span> construct_sample(panel_raw, n_sample<span class="op">=</span><span class="dv">500</span>, seed<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sample 1: </span><span class="sc">{</span>sample_1<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> firm-years, "</span></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>sample_1[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms, "</span></span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>sample_1[<span class="st">'part'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> test years"</span>)</span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimating Discretionary Accruals</span></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: estimate-da</span></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Apply all five models to Sample 1"</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a>da_results <span class="op">=</span> get_all_nda(sample_1)</span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify: peek at test-year DA across models</span></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>da_cols <span class="op">=</span> [<span class="st">"da_healy"</span>, <span class="st">"da_deangelo"</span>, <span class="st">"da_jones"</span>, <span class="st">"da_mod_jones"</span>, <span class="st">"da_industry"</span>]</span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a>test_da <span class="op">=</span> da_results[da_results[<span class="st">"part"</span>]][da_cols]</span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test-year discretionary accruals (first 5 firms):"</span>)</span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>test_da.head().<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="fu">### Firm-Level Regressions and Rejection Rates</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a>For each firm and each model, we regress $DA$ on $PART$ and record whether the null hypothesis of zero discretionary accruals in the test year is rejected.</span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: type1-regressions</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Compute firm-specific t-statistics and rejection rates"</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> firm_regressions(df: pd.DataFrame, models: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="co">    For each firm and model, regress DA on PART.</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="co">    Return coefficients, std errors, t-stats, and rejection indicators.</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> []</span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> firm, group <span class="kw">in</span> df.groupby(firm_col):</span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> model <span class="kw">in</span> models:</span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a>            da_col <span class="op">=</span> <span class="ss">f"da_</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>            g <span class="op">=</span> group.dropna(subset<span class="op">=</span>[da_col]).copy()</span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>            g[<span class="st">"part_float"</span>] <span class="op">=</span> g[<span class="st">"part"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(g) <span class="op">&lt;</span> <span class="dv">5</span> <span class="kw">or</span> g[<span class="st">"part"</span>].<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a>                fm <span class="op">=</span> sm.OLS(</span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>                    g[da_col], sm.add_constant(g[<span class="st">"part_float"</span>])</span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a>                ).fit()</span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>                coef <span class="op">=</span> fm.params[<span class="st">"part_float"</span>]</span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>                se <span class="op">=</span> fm.bse[<span class="st">"part_float"</span>]</span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a>                t_stat <span class="op">=</span> fm.tvalues[<span class="st">"part_float"</span>]</span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>                df_resid <span class="op">=</span> fm.df_resid</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a>                <span class="co"># One-sided p-values</span></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>                p_neg <span class="op">=</span> stats.t.cdf(t_stat, df_resid)</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a>                p_pos <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> p_neg</span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>                records.append({</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a>                    firm_col: firm,</span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"model"</span>: model,</span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"coef"</span>: coef,</span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"se"</span>: se,</span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"t_stat"</span>: t_stat,</span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"neg_p01"</span>: p_neg <span class="op">&lt;</span> <span class="fl">0.01</span>,</span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"neg_p05"</span>: p_neg <span class="op">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"pos_p01"</span>: p_pos <span class="op">&lt;</span> <span class="fl">0.01</span>,</span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"pos_p05"</span>: p_pos <span class="op">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(records)</span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [<span class="st">"healy"</span>, <span class="st">"deangelo"</span>, <span class="st">"jones"</span>, <span class="st">"mod_jones"</span>, <span class="st">"industry"</span>]</span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a>reg_results <span class="op">=</span> firm_regressions(da_results, models)</span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a><span class="fu">### Results</span></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a>@tbl-type1-coefs reports the distribution of estimated coefficients on $PART$ across firms. Under the null of no manipulation, we expect the mean coefficient to be approximately zero.</span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-type1-coefs</span></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Distribution of firm-level discretionary accrual estimates (coefficient on PART) under the null hypothesis of no earnings management. All five models produce mean estimates near zero, as expected."</span></span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a>coef_stats <span class="op">=</span> (</span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a>    reg_results</span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"model"</span>)[<span class="st">"coef"</span>]</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"mean"</span>, <span class="st">"std"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>),</span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a>          <span class="st">"median"</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)])</span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a>coef_stats.columns <span class="op">=</span> [<span class="st">"Mean"</span>, <span class="st">"Std Dev"</span>, <span class="st">"Q1"</span>, <span class="st">"Median"</span>, <span class="st">"Q3"</span>]</span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a>coef_stats.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a>coef_stats.<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a>@tbl-type1-rejection reports rejection rates. The critical comparison is whether these rates approximate the nominal test size.</span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-type1-rejection</span></span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Type I error rates for one-sided tests of earnings management under the null hypothesis. Rates exceeding the nominal size (5% or 1%) indicate that the model over-rejects‚Äîa significant concern for the Jones and Modified Jones models."</span></span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a>rejection_rates <span class="op">=</span> (</span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a>    reg_results</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"model"</span>)[[<span class="st">"neg_p01"</span>, <span class="st">"neg_p05"</span>, <span class="st">"pos_p01"</span>, <span class="st">"pos_p05"</span>]]</span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a>rejection_rates.columns <span class="op">=</span> [</span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Neg (1%)"</span>, <span class="st">"Neg (5%)"</span>, <span class="st">"Pos (1%)"</span>, <span class="st">"Pos (5%)"</span></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a>rejection_rates.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a>rejection_rates</span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binomial Test for Size Distortion</span></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a>We formally test whether observed rejection rates differ from nominal sizes using a two-sided binomial test. Small $p$-values indicate significant mis-calibration of the test statistic.</span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-binom-test</span></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Binomial test p-values for whether rejection rates equal nominal test sizes. Small values (e.g., &lt; 0.05) indicate statistically significant size distortion."</span></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binom_test_rate(series: pd.Series, nominal: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Two-sided binomial test for rejection rate = nominal."""</span></span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> series.dropna()</span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">int</span>(x.<span class="bu">sum</span>())</span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats.binomtest(k, n, nominal, alternative<span class="op">=</span><span class="st">"two-sided"</span>).pvalue</span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a>binom_results <span class="op">=</span> {}</span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model, group <span class="kw">in</span> reg_results.groupby(<span class="st">"model"</span>):</span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a>    binom_results[model] <span class="op">=</span> {</span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Neg (1%)"</span>: binom_test_rate(group[<span class="st">"neg_p01"</span>], <span class="fl">0.01</span>),</span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Neg (5%)"</span>: binom_test_rate(group[<span class="st">"neg_p05"</span>], <span class="fl">0.05</span>),</span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pos (1%)"</span>: binom_test_rate(group[<span class="st">"pos_p01"</span>], <span class="fl">0.01</span>),</span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pos (5%)"</span>: binom_test_rate(group[<span class="st">"pos_p05"</span>], <span class="fl">0.05</span>),</span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a>binom_df <span class="op">=</span> pd.DataFrame(binom_results).T.<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a>binom_df.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a>binom_df</span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting Over-Rejection</span></span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a>If the Jones and Modified Jones models show rejection rates significantly above 5%, this signals that the standard two-stage procedure produces anti-conservative test statistics. The @salkever1976use correction addresses this by computing standard errors that reflect first-stage estimation uncertainty. In practical research on Vietnamese firms, where sample sizes per firm are often short (10‚Äì15 years of listed history), this correction is especially important because prediction error variance is a larger fraction of residual variance with fewer estimation-period observations.</span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extreme Performance Firms {#sec-extreme}</span></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a>A well-known weakness of accrual-based models is their poor performance when test firms experience extreme economic performance. @dechow1995detecting documented that all five models over-reject the null hypothesis when test firm-years are drawn from the tails of the earnings or cash flow distribution. @kothari2005performance subsequently proposed "performance matching" as a partial remedy.</span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a>The intuition for the problem is straightforward: the Jones model assumes a linear, symmetric relationship between revenue changes and accruals. But firms experiencing extreme growth or contraction generate accruals that deviate nonlinearly from the model's predictions, even absent any manipulation. This nonlinearity is misattributed to discretionary accruals.</span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a><span class="fu">### Constructing Extreme-Performance Samples</span></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extreme-sample</span></span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Construct samples from top and bottom earnings deciles"</span></span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_earnings_deciles(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute firm-year earnings (scaled) and assign to deciles."""</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"lag_at_earn"</span>] <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"earn"</span>] <span class="op">=</span> df[<span class="st">"ib"</span>] <span class="op">/</span> df[<span class="st">"lag_at_earn"</span>]</span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"earn_decile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"earn"</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a>panel_with_earn <span class="op">=</span> add_earnings_deciles(panel_raw)</span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a><span class="co"># High-earners sample (top decile)</span></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_high_earn(df):</span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> add_earnings_deciles(df)</span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[<span class="st">"earn_decile"</span>] <span class="op">==</span> <span class="dv">10</span>]</span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a><span class="co"># Low-earners sample (bottom decile)</span></span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_low_earn(df):</span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> add_earnings_deciles(df)</span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[<span class="st">"earn_decile"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a>sample_high <span class="op">=</span> construct_sample(</span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a>    panel_raw, n_sample<span class="op">=</span><span class="dv">300</span>, seed<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a>    selection_filter<span class="op">=</span>filter_high_earn</span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a>sample_low <span class="op">=</span> construct_sample(</span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a>    panel_raw, n_sample<span class="op">=</span><span class="dv">300</span>, seed<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a>    selection_filter<span class="op">=</span>filter_low_earn</span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"High-earnings sample: </span><span class="sc">{</span>sample_high[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Low-earnings sample: </span><span class="sc">{</span>sample_low[<span class="st">'ticker'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> firms"</span>)</span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-extreme-rejection</span></span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Type I error rates (5% one-sided) when test firm-years are drawn from extreme earnings deciles. Over-rejection is expected because accrual models misattribute performance-driven accrual variation to managerial discretion."</span></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a>extreme_results <span class="op">=</span> {}</span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, sample_df <span class="kw">in</span> [(<span class="st">"High earners"</span>, sample_high), (<span class="st">"Low earners"</span>, sample_low)]:</span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> get_all_nda(sample_df)</span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a>    regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a>    rates <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[[<span class="st">"neg_p05"</span>, <span class="st">"pos_p05"</span>]].mean().<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a>    rates.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> Neg(5%)"</span>, <span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> Pos(5%)"</span>]</span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a>    extreme_results[label] <span class="op">=</span> rates</span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> extreme_results:</span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a>    extreme_df <span class="op">=</span> pd.concat(extreme_results.values(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a>    extreme_df.index.name <span class="op">=</span> <span class="st">"Model"</span></span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a>    extreme_df</span>
<span id="cb27-784"><a href="#cb27-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-785"><a href="#cb27-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a><span class="fu">### Performance Matching</span></span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a>@kothari2005performance propose adjusting discretionary accruals by subtracting the DA of a performance-matched firm (one in the same industry with similar ROA). This removes the systematic component of accruals correlated with performance. The matched discretionary accrual is:</span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a>DA^{PM}_{i,t} = DA_{i,t} - DA_{i^*,t}</span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a>$$ {#eq-performance-match}</span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a>where $i^*$ is the matched control firm. This approach is particularly relevant in Vietnam, where the cross-section of listed firms includes many high-growth firms alongside stagnant SOEs, which is performance heterogeneity that standard models may mischaracterize.</span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a><span class="fu">## Power Analysis {#sec-power}</span></span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a><span class="fu">### Artificially Introducing Earnings Management</span></span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a>A model that never rejects is useless even if its Type I error rate is perfect. We need to evaluate **power**: the probability of detecting manipulation when it truly exists. Following @dechow1995detecting, we introduce known artificial manipulation into test-year financial statements and measure detection rates.</span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a>We consider three forms of manipulation at varying magnitudes:</span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Expense manipulation.** Decrease current liabilities by the manipulation amount (e.g., delaying recognition of accrued expenses): $$LCT'_{i,t} = LCT_{i,t} - \lambda \cdot A_{i,t-1}$$</span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Revenue manipulation.** Increase sales and receivables by the manipulation amount (e.g., premature revenue recognition or channel stuffing): $$Sale'_{i,t} = Sale_{i,t} + \lambda \cdot A_{i,t-1}, \quad Rect'_{i,t} = Rect_{i,t} + \lambda \cdot A_{i,t-1}$$</span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Margin manipulation.** Increase sales by the gross amount needed to inflate net income by $\lambda \cdot A_{i,t-1}$, increasing both receivables and current liabilities proportionally.</span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a>The parameter $\lambda$ represents manipulation as a fraction of lagged total assets, ranging from 0% to 50%.</span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: manipulate-fn</span></span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Function to introduce artificial manipulation"</span></span>
<span id="cb27-817"><a href="#cb27-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-818"><a href="#cb27-818" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> manipulate(</span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame,</span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a>    level: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a>    manip_type: <span class="bu">str</span> <span class="op">=</span> <span class="st">"expense"</span>,</span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a><span class="co">    Introduce artificial earnings management of a given type and level</span></span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a><span class="co">    into test-year (part=True) observations.</span></span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a><span class="co">    df : DataFrame with 'part' indicator and required financial variables.</span></span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a><span class="co">    level : Manipulation as fraction of lagged total assets.</span></span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a><span class="co">    manip_type : One of 'expense', 'revenue', 'margin'.</span></span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a>    firm_col <span class="op">=</span> <span class="st">"ticker"</span> <span class="cf">if</span> <span class="st">"ticker"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"gvkey"</span></span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> <span class="st">"fyear"</span> <span class="cf">if</span> <span class="st">"fyear"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"year"</span></span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([firm_col, year_col]).copy()</span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(firm_col)</span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a>    lag_at <span class="op">=</span> g[<span class="st">"at"</span>].shift(<span class="dv">1</span>)</span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a>    manip_amt <span class="op">=</span> lag_at <span class="op">*</span> level</span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> manip_type <span class="op">==</span> <span class="st">"expense"</span>:</span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decrease current liabilities in test year</span></span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"lct"</span>] <span class="op">-=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> manip_type <span class="op">==</span> <span class="st">"revenue"</span>:</span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Increase sales and receivables in test year</span></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"sale"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"rect"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"act"</span>] <span class="op">+=</span> manip_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reverse in following year</span></span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a>        next_part <span class="op">=</span> g[<span class="st">"part"</span>].shift(<span class="dv">1</span>).fillna(<span class="va">False</span>)</span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a>        df.loc[next_part, <span class="st">"sale"</span>] <span class="op">-=</span> manip_amt[next_part]</span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> manip_type <span class="op">==</span> <span class="st">"margin"</span>:</span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute net income ratio for scaling</span></span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a>        est_mask <span class="op">=</span> <span class="op">~</span>df[<span class="st">"part"</span>]</span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a>        ni_ratio <span class="op">=</span> g.<span class="bu">apply</span>(</span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: (x.loc[<span class="op">~</span>x[<span class="st">"part"</span>], <span class="st">"ni"</span>] <span class="op">/</span> x.loc[<span class="op">~</span>x[<span class="st">"part"</span>], <span class="st">"sale"</span>]).median()</span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"_ni_ratio"</span>] <span class="op">=</span> df[firm_col].<span class="bu">map</span>(ni_ratio)</span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a>        gross_amt <span class="op">=</span> np.where(</span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"_ni_ratio"</span>] <span class="op">&gt;</span> <span class="dv">0</span>, manip_amt <span class="op">/</span> df[<span class="st">"_ni_ratio"</span>], <span class="dv">0</span></span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"sale"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"rect"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"act"</span>] <span class="op">+=</span> gross_amt[df[<span class="st">"part"</span>]]</span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a>        net_effect <span class="op">=</span> gross_amt <span class="op">-</span> manip_amt</span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"part"</span>], <span class="st">"lct"</span>] <span class="op">+=</span> net_effect[df[<span class="st">"part"</span>]]</span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a>        df.drop(columns<span class="op">=</span>[<span class="st">"_ni_ratio"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: power-analysis</span></span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Power analysis across manipulation levels and types"</span></span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.50</span>]</span>
<span id="cb27-882"><a href="#cb27-882" aria-hidden="true" tabindex="-1"></a>manip_types <span class="op">=</span> [<span class="st">"expense"</span>, <span class="st">"revenue"</span>, <span class="st">"margin"</span>]</span>
<span id="cb27-883"><a href="#cb27-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a>power_records <span class="op">=</span> []</span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level <span class="kw">in</span> levels:</span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mtype <span class="kw">in</span> manip_types:</span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Copy base sample and introduce manipulation</span></span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a>        manip_sample <span class="op">=</span> sample_1.copy()</span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> level <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a>            manip_sample <span class="op">=</span> manipulate(manip_sample, level<span class="op">=</span>level, manip_type<span class="op">=</span>mtype)</span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate DA and run tests</span></span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a>        da <span class="op">=</span> get_all_nda(manip_sample)</span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a>        regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Power = positive one-sided rejection rate at 5%</span></span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a>        power <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[<span class="st">"pos_p05"</span>].mean()</span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> model_name, pwr <span class="kw">in</span> power.items():</span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a>            power_records.append({</span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a>                <span class="st">"level"</span>: level,</span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: mtype,</span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a>                <span class="st">"model"</span>: model_name,</span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a>                <span class="st">"power"</span>: pwr,</span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a>power_df <span class="op">=</span> pd.DataFrame(power_records)</span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: power-analysis-parallel</span></span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Power analysis across manipulation levels and types"</span></span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.50</span>]</span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a>manip_types <span class="op">=</span> [<span class="st">"expense"</span>, <span class="st">"revenue"</span>, <span class="st">"margin"</span>]</span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> Parallel, delayed</span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _run_one(level, mtype, base_sample, models):</span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a>    manip_sample <span class="op">=</span> base_sample.copy()</span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> level <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a>        manip_sample <span class="op">=</span> manipulate(manip_sample, level<span class="op">=</span>level, manip_type<span class="op">=</span>mtype)</span>
<span id="cb27-926"><a href="#cb27-926" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> get_all_nda(manip_sample)</span>
<span id="cb27-927"><a href="#cb27-927" aria-hidden="true" tabindex="-1"></a>    regs <span class="op">=</span> firm_regressions(da, models)</span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a>    power <span class="op">=</span> regs.groupby(<span class="st">"model"</span>)[<span class="st">"pos_p05"</span>].mean()</span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"level"</span>: level, <span class="st">"type"</span>: mtype, <span class="st">"model"</span>: m, <span class="st">"power"</span>: p}</span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> m, p <span class="kw">in</span> power.items()</span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip redundant level=0 runs (all manip_types identical when level=0)</span></span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a>combos <span class="op">=</span> [(<span class="fl">0.0</span>, <span class="st">"expense"</span>)] <span class="op">+</span> [</span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a>    (l, m) <span class="cf">for</span> l <span class="kw">in</span> levels <span class="cf">if</span> l <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">for</span> m <span class="kw">in</span> manip_types</span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> Parallel(n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>)(</span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a>    delayed(_run_one)(lvl, mt, sample_1, models)</span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lvl, mt <span class="kw">in</span> combos</span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand level=0 result across all manip_types</span></span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> []</span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (lvl, mt), batch <span class="kw">in</span> <span class="bu">zip</span>(combos, results):</span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lvl <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mtype <span class="kw">in</span> manip_types:</span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a>            flat.extend([{<span class="op">**</span>r, <span class="st">"type"</span>: mtype} <span class="cf">for</span> r <span class="kw">in</span> batch])</span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a>        flat.extend(batch)</span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a>power_df <span class="op">=</span> pd.DataFrame(flat)</span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a><span class="fu">### Power Functions</span></span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a>@fig-power plots the estimated power functions. The key questions are: (i) which model has the highest power for a given manipulation level and type, and (ii) at what magnitudes does manipulation become reliably detectable?</span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-power</span></span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Power functions for the five earnings management detection models across three manipulation types. Power increases with manipulation magnitude but remains low for economically plausible levels (&lt; 10% of assets), highlighting the fundamental difficulty of detecting earnings management."</span></span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a>model_colors <span class="op">=</span> {</span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a>    <span class="st">"healy"</span>: <span class="st">"#2196F3"</span>,</span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deangelo"</span>: <span class="st">"#FF9800"</span>,</span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jones"</span>: <span class="st">"#4CAF50"</span>,</span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod_jones"</span>: <span class="st">"#E91E63"</span>,</span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>    <span class="st">"industry"</span>: <span class="st">"#9C27B0"</span>,</span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, mtype <span class="kw">in</span> <span class="bu">enumerate</span>(manip_types):</span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[idx]</span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> power_df[power_df[<span class="st">"type"</span>] <span class="op">==</span> mtype]</span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model_name <span class="kw">in</span> models:</span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a>        m_data <span class="op">=</span> subset[subset[<span class="st">"model"</span>] <span class="op">==</span> model_name].sort_values(<span class="st">"level"</span>)</span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a>        ax.plot(</span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a>            m_data[<span class="st">"level"</span>] <span class="op">*</span> <span class="dv">100</span>, m_data[<span class="st">"power"</span>],</span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="st">"o"</span>, markersize<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>model_name.replace(<span class="st">"_"</span>, <span class="st">" "</span>).title(),</span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>model_colors[model_name],</span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a>    ax.set_title(mtype.title(), fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Manipulation (</span><span class="sc">% o</span><span class="st">f assets)"</span>)</span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">1.02</span>)</span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(mticker.PercentFormatter(xmax<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="fl">0.05</span>, color<span class="op">=</span><span class="st">"grey"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"5</span><span class="sc">% s</span><span class="st">ize"</span>)</span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Rejection Rate (Power)"</span>)</span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(fontsize<span class="op">=</span><span class="dv">8</span>, loc<span class="op">=</span><span class="st">"center left"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>))</span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary Statistics</span></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>@tbl-power-summary reports power at selected manipulation levels for the Jones and Modified Jones models, which are most commonly used in applied research.</span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-power-summary</span></span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Power of the Jones and Modified Jones models at selected manipulation levels. Even at 10% of assets‚Äîa large amount of manipulation‚Äîdetection rates remain well below 50% for most manipulation types, underscoring the low statistical power of standard tests."</span></span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a>power_summary <span class="op">=</span> (</span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a>    power_df[power_df[<span class="st">"model"</span>].isin([<span class="st">"jones"</span>, <span class="st">"mod_jones"</span>])]</span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a>    .pivot_table(index<span class="op">=</span>[<span class="st">"model"</span>, <span class="st">"level"</span>], columns<span class="op">=</span><span class="st">"type"</span>, values<span class="op">=</span><span class="st">"power"</span>)</span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a>power_summary.index.names <span class="op">=</span> [<span class="st">"Model"</span>, <span class="st">"Level (% assets)"</span>]</span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a>power_summary</span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implications for Vietnamese Research</span></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a>The power analysis has stark implications for earnings management research in Vietnam. The typical Vietnamese listed firm has been listed for 10‚Äì15 years, providing far fewer estimation-period observations than in the U.S. context where @dechow1995detecting had decades of Compustat data. Shorter estimation windows increase parameter uncertainty in the Jones model, further reducing power. Combined with the noisier financial data common in emerging markets, researchers should interpret non-rejection of the null as uninformative rather than as evidence of clean financial reporting.</span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">## Vietnamese Institutional Context {#sec-vietnam}</span></span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">### Channels of Earnings Management</span></span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a>Several features of the Vietnamese institutional environment create distinctive earnings management incentives and opportunities:</span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a>**Tax-driven manipulation.** Vietnamese corporate income tax (CIT) rates have declined from 28% (pre-2009) to 20% (2016 onwards), with preferential rates for firms in Special Economic Zones and high-tech sectors. The close alignment between VAS accounting and tax accounting creates incentives to manage earnings downward to reduce tax obligations‚Äîa pattern documented in developing economies with code-law accounting traditions <span class="co">[</span><span class="ot">@ball2003incentives</span><span class="co">]</span>.</span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a>**IPO and seasoned equity offering (SEO) incentives.** Vietnam has experienced several waves of SOE equitization (partial privatization). Managers have incentives to inflate earnings before share offerings to maximize proceeds. The SSC requires minimum profitability thresholds for listing eligibility, creating sharp incentives around these regulatory cutoffs, which is a natural setting for the discontinuity analysis of @burgstahler1997earnings.</span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a>**Real earnings management in manufacturing.** @roychowdhury2006earnings identifies overproduction, discretionary expenditure cuts, and sales manipulation as the three main channels of real earnings management. Vietnam's large manufacturing sector (textiles, electronics assembly, food processing) provides ample scope for overproduction-based REM, where unit costs are reduced by spreading fixed overhead across larger production runs.</span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a>**Related-party transactions.** Transactions with affiliated entities are a well-documented channel for earnings manipulation in Asian markets. Vietnamese conglomerates (*t·∫≠p ƒëo√†n*) often feature complex cross-ownership structures where transfer pricing between subsidiaries can shift profits across reporting entities.</span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Earnings Distribution Test</span></span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a>@burgstahler1997earnings observed a striking discontinuity in the distribution of reported earnings around zero: far more firms report small positive earnings than small losses, relative to what a smooth distribution would predict. This pattern is interpreted as evidence that firms manage earnings to avoid reporting losses.</span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1044"><a href="#cb27-1044" aria-hidden="true" tabindex="-1"></a>We apply this test to Vietnamese-style data to illustrate the methodology.</span>
<span id="cb27-1045"><a href="#cb27-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-earnings-distribution</span></span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of scaled earnings around zero. A discontinuity‚Äîexcess density just above zero and a deficit just below‚Äîwould suggest benchmark-beating behavior. The red dashed line marks the zero threshold."</span></span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate earnings for a larger sample with benchmark-beating behavior</span></span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a>rng_dist <span class="op">=</span> np.random.default_rng(<span class="dv">2024</span>)</span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a>n_firms_dist <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a>n_years_dist <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a>earnings <span class="op">=</span> []</span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_firms_dist):</span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a>    base_earn <span class="op">=</span> rng_dist.normal(<span class="fl">0.06</span>, <span class="fl">0.08</span>)</span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(n_years_dist):</span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> base_earn <span class="op">+</span> rng_dist.normal(<span class="dv">0</span>, <span class="fl">0.04</span>)</span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate benchmark-beating: firms near zero bump earnings up</span></span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">-</span><span class="fl">0.01</span> <span class="op">&lt;</span> e <span class="op">&lt;</span> <span class="fl">0.005</span>:</span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a>            e <span class="op">+=</span> rng_dist.uniform(<span class="fl">0.005</span>, <span class="fl">0.015</span>) <span class="op">*</span> (rng_dist.random() <span class="op">&lt;</span> <span class="fl">0.6</span>)</span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a>        earnings.append(e)</span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a>earn_array <span class="op">=</span> np.array(earnings)</span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.01</span>)</span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a>ax.hist(earn_array, bins<span class="op">=</span>bins, color<span class="op">=</span><span class="st">"steelblue"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.85</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"firebrick"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">"Zero threshold"</span>)</span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Earnings / Total Assets"</span>)</span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Earnings Distribution Around Zero"</span>)</span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-1085"><a href="#cb27-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-earnings-change-dist</span></span>
<span id="cb27-1086"><a href="#cb27-1086" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of year-over-year earnings changes around zero. A discontinuity here suggests that firms manage earnings to avoid reporting declines, even when small."</span></span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a><span class="co"># Year-over-year changes</span></span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a>earn_changes <span class="op">=</span> np.diff(earn_array.reshape(n_firms_dist, n_years_dist), axis<span class="op">=</span><span class="dv">1</span>).flatten()</span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a>bins_chg <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.005</span>)</span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a>ax.hist(earn_changes, bins<span class="op">=</span>bins_chg, color<span class="op">=</span><span class="st">"darkorange"</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.85</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"firebrick"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">"Zero change"</span>)</span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Change in Earnings / Total Assets"</span>)</span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Earnings Change Distribution Around Zero"</span>)</span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">### Accrual-Based vs. Real Earnings Management</span></span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a>@cohen2008real document a shift from AEM to REM following the passage of the Sarbanes-Oxley Act (SOX) in 2002, suggesting that tighter regulatory scrutiny redirects manipulation toward less detectable channels. @zang2012evidence provides further evidence that firms trade off between AEM and REM based on their relative costs.</span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a>In Vietnam, where regulatory enforcement of accounting standards is weaker than in post-SOX America, we might expect AEM to remain the dominant channel. However, as Vietnam moves toward IFRS adoption and strengthens SSC oversight, the AEM-to-REM substitution hypothesis becomes testable.</span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a>We can measure REM using the @roychowdhury2006earnings approach. Three proxies capture different manipulation channels:</span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a>**Abnormal cash flow from operations.** Estimate normal CFO as a function of sales and sales changes:</span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a>\frac{CFO_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t}}{A_{i,t-1}} + \beta_3 \frac{\Delta S_{i,t}}{A_{i,t-1}} + \varepsilon_{i,t}</span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a>$$ {#eq-abnormal-cfo}</span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a>**Abnormal production costs.** Production costs = COGS + change in inventory. Normal levels are modeled as:</span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1120"><a href="#cb27-1120" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1121"><a href="#cb27-1121" aria-hidden="true" tabindex="-1"></a>\frac{PROD_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t}}{A_{i,t-1}} + \beta_3 \frac{\Delta S_{i,t}}{A_{i,t-1}} + \beta_4 \frac{\Delta S_{i,t-1}}{A_{i,t-1}} + \varepsilon_{i,t}</span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a>$$ {#eq-abnormal-prod}</span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1124"><a href="#cb27-1124" aria-hidden="true" tabindex="-1"></a>**Abnormal discretionary expenditures.** R&amp;D + advertising + SGA, modeled as:</span>
<span id="cb27-1125"><a href="#cb27-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1126"><a href="#cb27-1126" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1127"><a href="#cb27-1127" aria-hidden="true" tabindex="-1"></a>\frac{DISC_{i,t}}{A_{i,t-1}} = \beta_0 + \beta_1 \frac{1}{A_{i,t-1}} + \beta_2 \frac{S_{i,t-1}}{A_{i,t-1}} + \varepsilon_{i,t}</span>
<span id="cb27-1128"><a href="#cb27-1128" aria-hidden="true" tabindex="-1"></a>$$ {#eq-abnormal-disc}</span>
<span id="cb27-1129"><a href="#cb27-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1130"><a href="#cb27-1130" aria-hidden="true" tabindex="-1"></a>Residuals from these regressions serve as proxies for real manipulation. A firm that overproduces will show abnormally *high* production costs and abnormally *low* CFO (cash tied up in inventory).</span>
<span id="cb27-1131"><a href="#cb27-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1132"><a href="#cb27-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb27-1133"><a href="#cb27-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1134"><a href="#cb27-1134" aria-hidden="true" tabindex="-1"></a>This chapter examined the measurement and detection of earnings management, with a focus on methodological rigor and adaptation to Vietnam's institutional environment. The key takeaways are:</span>
<span id="cb27-1135"><a href="#cb27-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1136"><a href="#cb27-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Detecting earnings management requires separating discretionary from non-discretionary accruals, which depends critically on the quality of the non-discretionary accrual model. All five canonical models have known weaknesses.</span>
<span id="cb27-1137"><a href="#cb27-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1138"><a href="#cb27-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Under the null hypothesis of no manipulation, the Jones and Modified Jones models over-reject when standard two-stage standard errors are used. The @salkever1976use correction provides properly calibrated inference.</span>
<span id="cb27-1139"><a href="#cb27-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1140"><a href="#cb27-1140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When test firms experience extreme financial performance, all models exhibit severe size distortion, misattributing performance-driven accrual variation to managerial discretion. Performance matching <span class="co">[</span><span class="ot">@kothari2005performance</span><span class="co">]</span> partially addresses this.</span>
<span id="cb27-1141"><a href="#cb27-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1142"><a href="#cb27-1142" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Power analysis reveals that economically plausible levels of manipulation (below 10% of assets) are detected with very low probability. This casts doubt on studies that report null results as evidence of no manipulation.</span>
<span id="cb27-1143"><a href="#cb27-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1144"><a href="#cb27-1144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Vietnam's institutional features, such aSOE governance, VAS accounting rules, weak enforcement, and thin audit coverage‚Äîcreate a rich setting for earnings management research, but the methodological challenges are amplified by shorter time series and noisier data.</span>
<span id="cb27-1145"><a href="#cb27-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1146"><a href="#cb27-1146" aria-hidden="true" tabindex="-1"></a>Researchers working with Vietnamese data should: (i) use the Salkever correction for proper inference, (ii) implement performance matching, (iii) consider multiple models and triangulate results, and (iv) supplement accrual-based approaches with real earnings management and distributional tests.</span>
<span id="cb27-1147"><a href="#cb27-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1148"><a href="#cb27-1148" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Exercises</span></span>
<span id="cb27-1149"><a href="#cb27-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1150"><a href="#cb27-1150" aria-hidden="true" tabindex="-1"></a><span class="co">1.  **Salkever equivalence.** Using the `demonstrate_salkever()` function, verify numerically that the two-stage Jones $DA$ estimate equals the Salkever coefficient on $PART$ for a randomly selected firm. Report both estimates to six decimal places.</span></span>
<span id="cb27-1151"><a href="#cb27-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1152"><a href="#cb27-1152" aria-hidden="true" tabindex="-1"></a><span class="co">2.  **Modified Jones with Salkever.** Extend the Salkever approach to the Modified Jones model. In the one-stage regression, how should $\Delta Rev$ be specified‚Äîadjusted or unadjusted? Justify your choice.</span></span>
<span id="cb27-1153"><a href="#cb27-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1154"><a href="#cb27-1154" aria-hidden="true" tabindex="-1"></a><span class="co">3.  **Performance matching.** Implement the @kothari2005performance performance-matching procedure: for each test firm-year, find a control firm in the same 2-digit industry with the closest ROA, and subtract its $DA$. Re-run the Type I error analysis with performance-matched $DA$. Does performance matching reduce over-rejection for extreme-performance samples?</span></span>
<span id="cb27-1155"><a href="#cb27-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1156"><a href="#cb27-1156" aria-hidden="true" tabindex="-1"></a><span class="co">4.  **SOE vs. non-SOE detection.** Split the sample by SOE status and estimate discretionary accruals separately for each subsample. Are there systematic differences in estimated $DA$ that might reflect genuine differences in accrual quality, or could they be artifacts of the model specification?</span></span>
<span id="cb27-1157"><a href="#cb27-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1158"><a href="#cb27-1158" aria-hidden="true" tabindex="-1"></a><span class="co">5.  **Earnings discontinuity test.** Using the synthetic earnings data (or actual Vietnamese data if available), formally test for a discontinuity at zero using the approach of @burgstahler1997earnings. Compute the standardized difference between the bin just above and just below zero: $$</span></span>
<span id="cb27-1159"><a href="#cb27-1159" aria-hidden="true" tabindex="-1"></a><span class="co">    z = \frac{n_{+} - n_{-}}{\sqrt{N \cdot p \cdot (1-p)}}</span></span>
<span id="cb27-1160"><a href="#cb27-1160" aria-hidden="true" tabindex="-1"></a><span class="co">    $$ where $n_{+}$ and $n_{-}$ are the counts in the two adjacent bins and $p$ is the expected proportion under smoothness.</span></span>
<span id="cb27-1161"><a href="#cb27-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1162"><a href="#cb27-1162" aria-hidden="true" tabindex="-1"></a><span class="co">6.  **Real earnings management.** Implement the @roychowdhury2006earnings model for abnormal production costs (@eq-abnormal-prod) using the synthetic panel. Estimate the model cross-sectionally by year and 2-digit industry. What fraction of the cross-sectional variation in production costs is explained by the model?</span></span>
<span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a><span class="co">7.  **Power under Vietnamese conditions.** Re-run the power analysis with a shortened estimation window (7 years instead of 10) to simulate the typical data availability for Vietnamese firms listed after 2007. How does the reduction in estimation data affect detection power? What is the minimum manipulation level that can be detected with 50% power?</span></span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1166"><a href="#cb27-1166" aria-hidden="true" tabindex="-1"></a><span class="co">8.  **Stub-period revenue manipulation.** @stubben2010discretionary proposes a revenue-based measure of earnings management that regresses changes in receivables on changes in revenue, arguing that revenue manipulation is easier to detect through its receivable footprint than through the broad accrual models. Implement this approach and compare its Type I error and power properties to the Jones model on Vietnamese data. --&gt;</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span id="copyright"></span> Mike. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/edit/main/34_earning_management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mikenguyen13/tidy_finance_vn_vi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>