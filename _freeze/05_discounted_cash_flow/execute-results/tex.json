{
  "hash": "5b176ed4e7e5a488bdb111b61a0c5b5e",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Discounted Cash Flow Analysis\nformat:\n  html:\n    toc: true\n    number-sections: true\njupyter: python3\nexecute:\n  echo: true\n  warning: false\n  message: false\n---\n\n## What Is a Company Worth?\n\nThe previous chapters examined how markets price securities in equilibrium and how financial statements reveal company fundamentals. But these approaches leave a central question unanswered: What is the *intrinsic value* of a business, independent of its current market price?\n\nDiscounted Cash Flow (DCF) analysis answers this question by valuing a company based on its ability to generate cash for investors. The core insight is simple: a business is worth the present value of all future cash it will produce. This principle that value equals discounted future cash flows underlies virtually all of finance, from bond pricing to real estate valuation.\n\nDCF analysis stands apart from other valuation approaches in three important ways. First, it explicitly accounts for the **time value of money** (i.e., the principle that a dollar today is worth more than a dollar tomorrow). By discounting future cash flows at an appropriate rate, we incorporate both time preferences and risk. Second, DCF is **forward-looking**, making it particularly suitable for companies where historical performance may not reflect future potential. Third, DCF is **flexible** enough to accommodate various business models and capital structures, making it applicable across industries and company sizes.\n\n### Valuation Methods Overview\n\nCompany valuation methods broadly fall into three categories:\n\n- **Market-based approaches** compare companies using relative metrics like Price-to-Earnings or EV/EBITDA ratios. These are quick but assume comparable companies are fairly valued.\n- **Asset-based methods** focus on the net value of tangible and intangible assets. These work well for liquidation scenarios but miss going-concern value.\n- **Income-based techniques** value companies based on their ability to generate future cash flows. DCF is the most rigorous income-based method.\n\nWe focus on DCF because it forces analysts to make explicit assumptions about growth, profitability, and risk. These assumptions are often hidden in other methods. Even when DCF isn't the final word on valuation, the discipline of building a DCF model deepens understanding of what drives value.\n\n### The Three Pillars of DCF\n\nEvery DCF analysis rests on three components:\n\n1. **Free Cash Flow (FCF) forecasts**: The expected future cash available for distribution to investors after operating expenses, taxes, and investments\n2. **Terminal value**: The company's value beyond the explicit forecast period, often representing a majority of total valuation\n3. **Discount rate**: Typically the Weighted Average Cost of Capital (WACC), which adjusts future cash flows to present value by incorporating risk and capital structure\n\nWe make simplifying assumptions throughout this chapter. In particular, we assume firms conduct only operating activities (i.e., financial statements do not include non-operating items like excess cash or investment securities). Real-world valuations require valuing these separately. Entire textbooks are devoted to valuation nuances; our goal is to establish the conceptual framework and practical implementation.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.formula.api as smf\n\nfrom plotnine import *\nfrom mizani.formatters import percent_format, comma_format\nfrom itertools import product\n```\n:::\n\n\n## Understanding Free Cash Flow\n\nBefore diving into calculations, we need to understand what Free Cash Flow represents and why it matters for valuation.\n\n### Why Free Cash Flow, Not Net Income?\n\nAccountants report net income, but DCF uses free cash flow. Why the difference?\n\nNet income includes non-cash items (like depreciation) and ignores cash needs (like capital expenditures and working capital investments). A company can report strong profits while burning cash, or generate substantial cash while reporting losses. Free cash flow captures what actually matters for valuation: the cash available to distribute to all capital providers (both debt holders and equity holders) after funding operations and investments.\n\n### The Free Cash Flow Formula\n\nWe calculate FCF using the following formula:\n\n$$\n\\text{FCF} = \\text{EBIT} \\times (1 - \\tau) + \\text{D\\&A} - \\Delta\\text{WC} - \\text{CAPEX}\n$$\n\nwhere:\n\n- **EBIT** (Earnings Before Interest and Taxes): Core operating profit before financing costs and taxes\n- **$\\tau$**: Corporate tax rate applied to operating profits\n- **D&A** (Depreciation & Amortization): Non-cash charges that reduce reported earnings but don't consume cash\n- **$\\Delta$WC** (Change in Working Capital): Cash tied up in (or released from) operations (increases in receivables and inventory consume cash, while increases in payables provide cash)\n- **CAPEX** (Capital Expenditures): Investments in long-term assets required to maintain and grow operations\n\nAn alternative formulation starts from EBIT directly:\n\n$$\n\\text{FCF} = \\text{EBIT} + \\text{D\\&A} - \\text{Taxes} - \\Delta\\text{WC} - \\text{CAPEX}\n$$\n\nBoth formulations yield the same result when taxes are calculated consistently. The key insight is that FCF represents cash generated from operations after all reinvestment needs (i.e., cash that could theoretically be distributed to investors without impairing the business).\n\n## Loading Historical Financial Data\n\nWe use FPT Corporation, one of Vietnam's largest technology companies, as our case study. FPT provides IT services, telecommunications, and education. It's a diversified business with meaningful capital requirements and growth potential.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nimport sqlite3\n\ntidy_finance = sqlite3.connect(database=\"data/tidy_finance_python.sqlite\")\n\ncomp_vn = pd.read_sql_query(\n    sql=\"SELECT * FROM comp_vn\",\n    con=tidy_finance,\n    parse_dates={\"date\"}\n)\n\n# Filter to FPT and examine the data structure\nfpt_data = comp_vn[comp_vn[\"symbol\"] == \"FPT\"].copy()\nfpt_data[\"year\"] = fpt_data[\"year\"].astype(int)\nfpt_data = fpt_data.sort_values(\"year\").reset_index(drop=True)\n\nprint(f\"Available years: {fpt_data['year'].min()} to {fpt_data['year'].max()}\")\nprint(f\"Number of observations: {len(fpt_data)}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAvailable years: 2002 to 2023\nNumber of observations: 22\n```\n:::\n:::\n\n\n### Computing Historical Free Cash Flow\n\nLet's calculate the components needed for FCF from the financial statement data:\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\n# Extract and compute FCF components\nhistorical_data = (fpt_data\n    .assign(\n        # Revenue for ratio calculations\n        revenue=lambda x: x[\"is_net_revenue\"],\n        \n        # EBIT = Earnings before interest and taxes\n        # Approximate as EBT + Interest Expense\n        ebit=lambda x: x[\"is_ebt\"] + x[\"is_interest_expense\"],\n        \n        # Tax payments (use actual tax expense)\n        taxes=lambda x: x[\"is_cit_expense\"],\n        \n        # Depreciation and amortization (non-cash add-back)\n        depreciation=lambda x: x[\"cfo_depreciation\"],\n        \n        # Change in working capital components\n        # Positive delta_wc means cash is consumed (tied up in working capital)\n        delta_working_capital=lambda x: (\n            x[\"cfo_receive\"] +      # Change in receivables\n            x[\"cfo_inventory\"] -    # Change in inventory  \n            x[\"cfo_payale\"]         # Change in payables (negative = cash source)\n        ),\n        \n        # Capital expenditures\n        capex=lambda x: x[\"capex\"]\n    )\n    .loc[:, [\n        \"year\", \"revenue\", \"ebit\", \"taxes\", \"depreciation\",\n        \"delta_working_capital\", \"capex\"\n    ]]\n)\n\n# Calculate Free Cash Flow\nhistorical_data[\"fcf\"] = (\n    historical_data[\"ebit\"] \n    - historical_data[\"taxes\"]\n    + historical_data[\"depreciation\"]\n    - historical_data[\"delta_working_capital\"]\n    - historical_data[\"capex\"]\n)\n\nhistorical_data\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>revenue</th>\n      <th>ebit</th>\n      <th>taxes</th>\n      <th>depreciation</th>\n      <th>delta_working_capital</th>\n      <th>capex</th>\n      <th>fcf</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2002</td>\n      <td>1.514961e+12</td>\n      <td>2.698700e+10</td>\n      <td>0.000000e+00</td>\n      <td>1.261500e+10</td>\n      <td>-2.561760e+11</td>\n      <td>2.202800e+10</td>\n      <td>2.737500e+11</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2003</td>\n      <td>4.148298e+12</td>\n      <td>5.676100e+10</td>\n      <td>0.000000e+00</td>\n      <td>1.837700e+10</td>\n      <td>-5.078740e+11</td>\n      <td>3.753300e+10</td>\n      <td>5.454790e+11</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2004</td>\n      <td>8.734781e+12</td>\n      <td>2.145902e+11</td>\n      <td>1.795700e+10</td>\n      <td>2.947900e+10</td>\n      <td>-4.280270e+11</td>\n      <td>5.252100e+10</td>\n      <td>6.016182e+11</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2005</td>\n      <td>1.410079e+13</td>\n      <td>3.753490e+11</td>\n      <td>4.251500e+10</td>\n      <td>5.381700e+10</td>\n      <td>-4.471110e+11</td>\n      <td>1.428320e+11</td>\n      <td>6.909300e+11</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2006</td>\n      <td>2.139975e+13</td>\n      <td>6.672593e+11</td>\n      <td>7.368682e+10</td>\n      <td>1.068192e+11</td>\n      <td>-1.173099e+12</td>\n      <td>2.459780e+11</td>\n      <td>1.627513e+12</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>2007</td>\n      <td>1.349889e+13</td>\n      <td>1.071941e+12</td>\n      <td>1.487146e+11</td>\n      <td>1.709335e+11</td>\n      <td>-1.873794e+12</td>\n      <td>4.802762e+11</td>\n      <td>2.487677e+12</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>2008</td>\n      <td>1.638184e+13</td>\n      <td>1.320573e+12</td>\n      <td>1.890384e+11</td>\n      <td>2.395799e+11</td>\n      <td>-1.419506e+11</td>\n      <td>6.690461e+11</td>\n      <td>8.440192e+11</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>2009</td>\n      <td>1.840403e+13</td>\n      <td>1.807221e+12</td>\n      <td>2.916482e+11</td>\n      <td>3.041813e+11</td>\n      <td>-8.065011e+11</td>\n      <td>7.632280e+11</td>\n      <td>1.863027e+12</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>2010</td>\n      <td>2.001730e+13</td>\n      <td>2.261341e+12</td>\n      <td>3.314359e+11</td>\n      <td>3.294060e+11</td>\n      <td>-2.360993e+12</td>\n      <td>8.672138e+11</td>\n      <td>3.753090e+12</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>2011</td>\n      <td>2.537025e+13</td>\n      <td>2.751044e+12</td>\n      <td>4.223952e+11</td>\n      <td>3.759567e+11</td>\n      <td>-2.099380e+12</td>\n      <td>4.524081e+11</td>\n      <td>4.351578e+12</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>2012</td>\n      <td>2.459430e+13</td>\n      <td>2.635219e+12</td>\n      <td>4.210738e+11</td>\n      <td>3.995598e+11</td>\n      <td>8.043763e+11</td>\n      <td>7.083318e+11</td>\n      <td>1.100997e+12</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>2013</td>\n      <td>2.702789e+13</td>\n      <td>2.690568e+12</td>\n      <td>4.503170e+11</td>\n      <td>4.429860e+11</td>\n      <td>-1.947751e+12</td>\n      <td>9.110216e+11</td>\n      <td>3.719967e+12</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>2014</td>\n      <td>3.264466e+13</td>\n      <td>2.625389e+12</td>\n      <td>3.800994e+11</td>\n      <td>5.472736e+11</td>\n      <td>-3.078130e+12</td>\n      <td>1.417399e+12</td>\n      <td>4.453295e+12</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>2015</td>\n      <td>3.795970e+13</td>\n      <td>3.113651e+12</td>\n      <td>4.130641e+11</td>\n      <td>7.328801e+11</td>\n      <td>-1.951778e+12</td>\n      <td>1.974295e+12</td>\n      <td>3.410951e+12</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>2016</td>\n      <td>3.953147e+13</td>\n      <td>3.388085e+12</td>\n      <td>4.382078e+11</td>\n      <td>9.334397e+11</td>\n      <td>-9.242713e+11</td>\n      <td>1.428472e+12</td>\n      <td>3.379116e+12</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>2017</td>\n      <td>4.265861e+13</td>\n      <td>4.623663e+12</td>\n      <td>7.270039e+11</td>\n      <td>1.039417e+12</td>\n      <td>-4.638788e+12</td>\n      <td>1.100498e+12</td>\n      <td>8.474367e+12</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>2018</td>\n      <td>2.321354e+13</td>\n      <td>4.095947e+12</td>\n      <td>6.236054e+11</td>\n      <td>1.164692e+12</td>\n      <td>-1.033438e+12</td>\n      <td>2.452902e+12</td>\n      <td>3.217569e+12</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>2019</td>\n      <td>2.771696e+13</td>\n      <td>5.023518e+12</td>\n      <td>7.528183e+11</td>\n      <td>1.354613e+12</td>\n      <td>-5.308818e+11</td>\n      <td>3.230818e+12</td>\n      <td>2.925377e+12</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>2020</td>\n      <td>2.983040e+13</td>\n      <td>5.648794e+12</td>\n      <td>8.397114e+11</td>\n      <td>1.490607e+12</td>\n      <td>-8.040730e+11</td>\n      <td>3.014322e+12</td>\n      <td>4.089441e+12</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>2021</td>\n      <td>3.565726e+13</td>\n      <td>6.821202e+12</td>\n      <td>9.879053e+11</td>\n      <td>1.643916e+12</td>\n      <td>-2.821825e+12</td>\n      <td>2.908134e+12</td>\n      <td>7.390903e+12</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>2022</td>\n      <td>4.400953e+13</td>\n      <td>8.308009e+12</td>\n      <td>1.170940e+12</td>\n      <td>1.833064e+12</td>\n      <td>-3.746661e+12</td>\n      <td>3.209581e+12</td>\n      <td>9.507213e+12</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>2023</td>\n      <td>5.261790e+13</td>\n      <td>1.003565e+13</td>\n      <td>1.414956e+12</td>\n      <td>2.286514e+12</td>\n      <td>-2.147304e+12</td>\n      <td>3.948982e+12</td>\n      <td>9.105534e+12</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Understanding the Historical Pattern\n\nBefore forecasting, we should understand the historical trends in FCF and its components:\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n# Calculate key ratios relative to revenue\nhistorical_ratios = (historical_data\n    .assign(\n        # Revenue growth (year-over-year)\n        revenue_growth=lambda x: x[\"revenue\"].pct_change(),\n        \n        # Operating margin: EBIT as % of revenue\n        operating_margin=lambda x: x[\"ebit\"] / x[\"revenue\"],\n        \n        # Depreciation as % of revenue\n        depreciation_margin=lambda x: x[\"depreciation\"] / x[\"revenue\"],\n        \n        # Tax rate (taxes as % of revenue, for simplicity)\n        tax_margin=lambda x: x[\"taxes\"] / x[\"revenue\"],\n        \n        # Working capital intensity\n        working_capital_margin=lambda x: x[\"delta_working_capital\"] / x[\"revenue\"],\n        \n        # Capital intensity\n        capex_margin=lambda x: x[\"capex\"] / x[\"revenue\"],\n        \n        # FCF margin\n        fcf_margin=lambda x: x[\"fcf\"] / x[\"revenue\"]\n    )\n)\n\n# Display key metrics\ndisplay_cols = [\n    \"year\", \"revenue_growth\", \"operating_margin\", \"depreciation_margin\",\n    \"tax_margin\", \"working_capital_margin\", \"capex_margin\", \"fcf_margin\"\n]\n\nhistorical_ratios[display_cols].round(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>revenue_growth</th>\n      <th>operating_margin</th>\n      <th>depreciation_margin</th>\n      <th>tax_margin</th>\n      <th>working_capital_margin</th>\n      <th>capex_margin</th>\n      <th>fcf_margin</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2002</td>\n      <td>NaN</td>\n      <td>0.018</td>\n      <td>0.008</td>\n      <td>0.000</td>\n      <td>-0.169</td>\n      <td>0.015</td>\n      <td>0.181</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2003</td>\n      <td>1.738</td>\n      <td>0.014</td>\n      <td>0.004</td>\n      <td>0.000</td>\n      <td>-0.122</td>\n      <td>0.009</td>\n      <td>0.131</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2004</td>\n      <td>1.106</td>\n      <td>0.025</td>\n      <td>0.003</td>\n      <td>0.002</td>\n      <td>-0.049</td>\n      <td>0.006</td>\n      <td>0.069</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2005</td>\n      <td>0.614</td>\n      <td>0.027</td>\n      <td>0.004</td>\n      <td>0.003</td>\n      <td>-0.032</td>\n      <td>0.010</td>\n      <td>0.049</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2006</td>\n      <td>0.518</td>\n      <td>0.031</td>\n      <td>0.005</td>\n      <td>0.003</td>\n      <td>-0.055</td>\n      <td>0.011</td>\n      <td>0.076</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>2007</td>\n      <td>-0.369</td>\n      <td>0.079</td>\n      <td>0.013</td>\n      <td>0.011</td>\n      <td>-0.139</td>\n      <td>0.036</td>\n      <td>0.184</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>2008</td>\n      <td>0.214</td>\n      <td>0.081</td>\n      <td>0.015</td>\n      <td>0.012</td>\n      <td>-0.009</td>\n      <td>0.041</td>\n      <td>0.052</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>2009</td>\n      <td>0.123</td>\n      <td>0.098</td>\n      <td>0.017</td>\n      <td>0.016</td>\n      <td>-0.044</td>\n      <td>0.041</td>\n      <td>0.101</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>2010</td>\n      <td>0.088</td>\n      <td>0.113</td>\n      <td>0.016</td>\n      <td>0.017</td>\n      <td>-0.118</td>\n      <td>0.043</td>\n      <td>0.187</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>2011</td>\n      <td>0.267</td>\n      <td>0.108</td>\n      <td>0.015</td>\n      <td>0.017</td>\n      <td>-0.083</td>\n      <td>0.018</td>\n      <td>0.172</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>2012</td>\n      <td>-0.031</td>\n      <td>0.107</td>\n      <td>0.016</td>\n      <td>0.017</td>\n      <td>0.033</td>\n      <td>0.029</td>\n      <td>0.045</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>2013</td>\n      <td>0.099</td>\n      <td>0.100</td>\n      <td>0.016</td>\n      <td>0.017</td>\n      <td>-0.072</td>\n      <td>0.034</td>\n      <td>0.138</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>2014</td>\n      <td>0.208</td>\n      <td>0.080</td>\n      <td>0.017</td>\n      <td>0.012</td>\n      <td>-0.094</td>\n      <td>0.043</td>\n      <td>0.136</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>2015</td>\n      <td>0.163</td>\n      <td>0.082</td>\n      <td>0.019</td>\n      <td>0.011</td>\n      <td>-0.051</td>\n      <td>0.052</td>\n      <td>0.090</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>2016</td>\n      <td>0.041</td>\n      <td>0.086</td>\n      <td>0.024</td>\n      <td>0.011</td>\n      <td>-0.023</td>\n      <td>0.036</td>\n      <td>0.085</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>2017</td>\n      <td>0.079</td>\n      <td>0.108</td>\n      <td>0.024</td>\n      <td>0.017</td>\n      <td>-0.109</td>\n      <td>0.026</td>\n      <td>0.199</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>2018</td>\n      <td>-0.456</td>\n      <td>0.176</td>\n      <td>0.050</td>\n      <td>0.027</td>\n      <td>-0.045</td>\n      <td>0.106</td>\n      <td>0.139</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>2019</td>\n      <td>0.194</td>\n      <td>0.181</td>\n      <td>0.049</td>\n      <td>0.027</td>\n      <td>-0.019</td>\n      <td>0.117</td>\n      <td>0.106</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>2020</td>\n      <td>0.076</td>\n      <td>0.189</td>\n      <td>0.050</td>\n      <td>0.028</td>\n      <td>-0.027</td>\n      <td>0.101</td>\n      <td>0.137</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>2021</td>\n      <td>0.195</td>\n      <td>0.191</td>\n      <td>0.046</td>\n      <td>0.028</td>\n      <td>-0.079</td>\n      <td>0.082</td>\n      <td>0.207</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>2022</td>\n      <td>0.234</td>\n      <td>0.189</td>\n      <td>0.042</td>\n      <td>0.027</td>\n      <td>-0.085</td>\n      <td>0.073</td>\n      <td>0.216</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>2023</td>\n      <td>0.196</td>\n      <td>0.191</td>\n      <td>0.043</td>\n      <td>0.027</td>\n      <td>-0.041</td>\n      <td>0.075</td>\n      <td>0.173</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Visualizing Historical Ratios\n\n@fig-500 shows the historical evolution of key financial ratios that drive FCF. Understanding these patterns helps inform our forecasts.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\n# Prepare data for plotting\nratio_columns = [\n    \"operating_margin\", \"depreciation_margin\", \"tax_margin\",\n    \"working_capital_margin\", \"capex_margin\"\n]\n\nratios_long = (historical_ratios\n    .melt(\n        id_vars=[\"year\"],\n        value_vars=ratio_columns,\n        var_name=\"ratio\",\n        value_name=\"value\"\n    )\n    .assign(\n        ratio=lambda x: x[\"ratio\"].str.replace(\"_\", \" \").str.title()\n    )\n)\n\nratios_figure = (\n    ggplot(ratios_long, aes(x=\"year\", y=\"value\", color=\"ratio\"))\n    + geom_line(size=1)\n    + geom_point(size=2)\n    + scale_y_continuous(labels=percent_format())\n    + labs(\n        x=\"\", y=\"Ratio (% of Revenue)\", color=\"\",\n        title=\"Key Financial Ratios of FPT Over Time\"\n    )\n    + theme(legend_position=\"right\")\n)\n\nratios_figure.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Historical financial ratios reveal the operating characteristics of FPT. These patterns inform our forecast assumptions.](05_discounted_cash_flow_files/figure-pdf/fig-500-output-1.pdf){#fig-500 fig-alt='Title: Key financial ratios of FPT over time. The figure shows a line chart with years on the horizontal axis and financial ratios on the vertical axis.' fig-pos='H'}\n:::\n:::\n\n\nSeveral patterns emerge from the historical data. Operating margins show the profitability of core operations. Depreciation margins indicate asset intensity. CAPEX margins reveal investment requirements. Working capital margins can be volatile, reflecting changes in credit terms and inventory management.\n\n## Forecasting Free Cash Flow\n\nWith historical patterns established, we now project FCF into the future. This requires forecasting both revenue growth and the ratios that convert revenue into cash flow.\n\n### The Ratio-Based Forecasting Approach\n\nWe use a ratio-based approach that links all FCF components to revenue. This makes forecasting tractable: rather than projecting absolute dollar amounts for each component, we forecast (1) revenue growth and (2) how each component scales with revenue.\n\nThis approach embeds a key assumption: that the relationship between revenue and FCF components remains stable. In reality, operating leverage, investment needs, and working capital requirements may change as companies mature. Sophisticated valuations model these dynamics explicitly.\n\n### Setting Forecast Assumptions\n\nFor our five-year forecast, we make the following assumptions about FPT's financial ratios. These should reflect industry analysis, company guidance, and competitive dynamics. Here we use estimates for illustration:\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n# Define the forecast horizon\nlast_historical_year = historical_data[\"year\"].max()\nforecast_years = list(range(last_historical_year + 1, last_historical_year + 6))\nn_forecast_years = len(forecast_years)\n\nprint(f\"Forecast period: {forecast_years[0]} to {forecast_years[-1]}\")\n\n# Define forecast ratios\n# In practice, these would come from detailed analysis\nforecast_assumptions = pd.DataFrame({\n    \"year\": forecast_years,\n    # Operating margin: slight improvement as scale increases\n    \"operating_margin\": [0.12, 0.125, 0.13, 0.13, 0.135],\n    # Depreciation: stable as % of revenue\n    \"depreciation_margin\": [0.03, 0.03, 0.03, 0.028, 0.028],\n    # Tax rate: stable\n    \"tax_margin\": [0.02, 0.02, 0.02, 0.02, 0.02],\n    # Working capital: modest cash consumption\n    \"working_capital_margin\": [0.01, 0.01, 0.008, 0.008, 0.008],\n    # CAPEX: declining as % of revenue as growth moderates\n    \"capex_margin\": [0.05, 0.048, 0.045, 0.042, 0.04]\n})\n\nforecast_assumptions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nForecast period: 2024 to 2028\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>operating_margin</th>\n      <th>depreciation_margin</th>\n      <th>tax_margin</th>\n      <th>working_capital_margin</th>\n      <th>capex_margin</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2024</td>\n      <td>0.120</td>\n      <td>0.030</td>\n      <td>0.02</td>\n      <td>0.010</td>\n      <td>0.050</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2025</td>\n      <td>0.125</td>\n      <td>0.030</td>\n      <td>0.02</td>\n      <td>0.010</td>\n      <td>0.048</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2026</td>\n      <td>0.130</td>\n      <td>0.030</td>\n      <td>0.02</td>\n      <td>0.008</td>\n      <td>0.045</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2027</td>\n      <td>0.130</td>\n      <td>0.028</td>\n      <td>0.02</td>\n      <td>0.008</td>\n      <td>0.042</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2028</td>\n      <td>0.135</td>\n      <td>0.028</td>\n      <td>0.02</td>\n      <td>0.008</td>\n      <td>0.040</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Forecasting Revenue Growth\n\nRevenue growth is often the most important and most uncertain assumption in DCF analysis. We demonstrate two approaches: using historical averages and linking growth to macroeconomic forecasts.\n\n**Approach 1: Historical Average**\n\nA simple approach uses the historical average growth rate:\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nhistorical_growth = historical_ratios[\"revenue_growth\"].dropna()\navg_historical_growth = historical_growth.mean()\n\nprint(f\"Average historical revenue growth: {avg_historical_growth:.1%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAverage historical revenue growth: 25.2%\n```\n:::\n:::\n\n\n**Approach 2: GDP-Linked Growth**\n\nA more sophisticated approach links company growth to GDP forecasts from institutions like the IMF. This captures the intuition that company revenues often move with broader economic activity.\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\n# Vietnam GDP growth forecasts (illustrative, based on IMF WEO style projections)\n# In practice, download from IMF WEO database\ngdp_forecasts = pd.DataFrame({\n    \"year\": forecast_years,\n    \"gdp_growth\": [0.065, 0.063, 0.060, 0.058, 0.055]  # Gradually declining to long-term\n})\n\n# Assume FPT grows at a premium to GDP (tech sector outperformance)\n# This premium should reflect company-specific factors\ngrowth_premium = 0.05  # 5 percentage points above GDP\n\nforecast_assumptions = forecast_assumptions.merge(gdp_forecasts, on=\"year\")\nforecast_assumptions[\"revenue_growth\"] = (\n    forecast_assumptions[\"gdp_growth\"] + growth_premium\n)\n\nforecast_assumptions[[\"year\", \"gdp_growth\", \"revenue_growth\"]]\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>gdp_growth</th>\n      <th>revenue_growth</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2024</td>\n      <td>0.065</td>\n      <td>0.115</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2025</td>\n      <td>0.063</td>\n      <td>0.113</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2026</td>\n      <td>0.060</td>\n      <td>0.110</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2027</td>\n      <td>0.058</td>\n      <td>0.108</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2028</td>\n      <td>0.055</td>\n      <td>0.105</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Building the Forecast\n\nNow we combine our assumptions to project revenue and FCF:\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\n# Get the last historical revenue as our starting point\nlast_revenue = historical_data.loc[\n    historical_data[\"year\"] == last_historical_year, \"revenue\"\n].values[0]\n\nprint(f\"Last historical revenue ({last_historical_year}): {last_revenue/1e12:.2f} trillion VND\")\n\n# Project revenue forward\nforecast_data = forecast_assumptions.copy()\nforecast_data[\"revenue\"] = None\n\n# Calculate revenue for each forecast year\nfor i, row in forecast_data.iterrows():\n    if i == 0:\n        # First forecast year: grow from last historical\n        forecast_data.loc[i, \"revenue\"] = last_revenue * (1 + row[\"revenue_growth\"])\n    else:\n        # Subsequent years: grow from previous forecast\n        prev_revenue = forecast_data.loc[i-1, \"revenue\"]\n        forecast_data.loc[i, \"revenue\"] = prev_revenue * (1 + row[\"revenue_growth\"])\n\n# Convert revenue to numeric\nforecast_data[\"revenue\"] = forecast_data[\"revenue\"].astype(float)\n\n# Calculate FCF components from ratios\nforecast_data[\"ebit\"] = forecast_data[\"operating_margin\"] * forecast_data[\"revenue\"]\nforecast_data[\"depreciation\"] = forecast_data[\"depreciation_margin\"] * forecast_data[\"revenue\"]\nforecast_data[\"taxes\"] = forecast_data[\"tax_margin\"] * forecast_data[\"revenue\"]\nforecast_data[\"delta_working_capital\"] = forecast_data[\"working_capital_margin\"] * forecast_data[\"revenue\"]\nforecast_data[\"capex\"] = forecast_data[\"capex_margin\"] * forecast_data[\"revenue\"]\n\n# Calculate FCF\nforecast_data[\"fcf\"] = (\n    forecast_data[\"ebit\"]\n    - forecast_data[\"taxes\"]\n    + forecast_data[\"depreciation\"]\n    - forecast_data[\"delta_working_capital\"]\n    - forecast_data[\"capex\"]\n)\n\nforecast_data[[\"year\", \"revenue\", \"ebit\", \"fcf\"]].round(0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLast historical revenue (2023): 52.62 trillion VND\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>revenue</th>\n      <th>ebit</th>\n      <th>fcf</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2024</td>\n      <td>5.866896e+13</td>\n      <td>7.040275e+12</td>\n      <td>4.106827e+12</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2025</td>\n      <td>6.529855e+13</td>\n      <td>8.162319e+12</td>\n      <td>5.027988e+12</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2026</td>\n      <td>7.248139e+13</td>\n      <td>9.422581e+12</td>\n      <td>6.305881e+12</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2027</td>\n      <td>8.030938e+13</td>\n      <td>1.044022e+13</td>\n      <td>7.067226e+12</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2028</td>\n      <td>8.874187e+13</td>\n      <td>1.198015e+13</td>\n      <td>8.430477e+12</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Visualizing the Forecast\n\n@fig-501 compares our forecast ratios with historical values, showing the transition from realized to projected performance.\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\n# Prepare historical data for plotting\nhistorical_plot = (historical_ratios\n    .loc[:, [\"year\", \"operating_margin\", \"depreciation_margin\", \n             \"tax_margin\", \"working_capital_margin\", \"capex_margin\"]]\n    .assign(type=\"Historical\")\n)\n\n# Prepare forecast data for plotting\nforecast_plot = (forecast_data\n    .loc[:, [\"year\", \"operating_margin\", \"depreciation_margin\",\n             \"tax_margin\", \"working_capital_margin\", \"capex_margin\"]]\n    .assign(type=\"Forecast\")\n)\n\n# Combine\ncombined_ratios = pd.concat([historical_plot, forecast_plot], ignore_index=True)\n\n# Reshape for plotting\ncombined_long = combined_ratios.melt(\n    id_vars=[\"year\", \"type\"],\n    var_name=\"ratio\",\n    value_name=\"value\"\n)\n\ncombined_long[\"type\"] = pd.Categorical(\n    combined_long[\"type\"], \n    categories=[\"Historical\", \"Forecast\"]\n)\n\nforecast_ratios_figure = (\n    ggplot(combined_long, aes(x=\"year\", y=\"value\", color=\"ratio\", linetype=\"type\"))\n    + geom_line(size=1)\n    + geom_point(size=2)\n    + scale_y_continuous(labels=percent_format())\n    + labs(\n        x=\"\", y=\"Ratio (% of Revenue)\", color=\"\", linetype=\"\",\n        title=\"Historical and Forecast Financial Ratios for FPT\"\n    )\n    + theme(legend_position=\"right\")\n)\n\nforecast_ratios_figure.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Historical ratios (solid lines) and forecast assumptions (dashed lines) for key financial metrics. The forecast period begins after the last historical observation.](05_discounted_cash_flow_files/figure-pdf/fig-501-output-1.pdf){#fig-501 fig-alt='Title: Historical and forecast financial ratios for FPT. The figure shows line charts comparing historical ratios with forecast assumptions.' fig-pos='H'}\n:::\n:::\n\n\n@fig-502 shows the revenue growth trajectory, comparing historical performance with our GDP-linked forecasts.\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\n# Prepare growth data\nhistorical_growth_df = (historical_ratios\n    .loc[:, [\"year\", \"revenue_growth\"]]\n    .dropna()\n    .assign(type=\"Historical\")\n)\n\nforecast_growth_df = (forecast_data\n    .loc[:, [\"year\", \"revenue_growth\", \"gdp_growth\"]]\n    .assign(type=\"Forecast\")\n)\n\n# Combine for revenue growth\ngrowth_combined = pd.concat([\n    historical_growth_df,\n    forecast_growth_df[[\"year\", \"revenue_growth\", \"type\"]]\n], ignore_index=True)\n\ngrowth_combined[\"type\"] = pd.Categorical(\n    growth_combined[\"type\"],\n    categories=[\"Historical\", \"Forecast\"]\n)\n\ngrowth_figure = (\n    ggplot(growth_combined, aes(x=\"year\", y=\"revenue_growth\", linetype=\"type\"))\n    + geom_line(size=1, color=\"steelblue\")\n    + geom_point(size=2, color=\"steelblue\")\n    + scale_y_continuous(labels=percent_format())\n    + labs(\n        x=\"\", y=\"Revenue Growth Rate\", linetype=\"\",\n        title=\"Historical and Forecast Revenue Growth for FPT\"\n    )\n)\n\ngrowth_figure.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Revenue growth rates: historical (realized) and forecast (GDP-linked with company premium). The forecast assumes FPT grows at a premium to Vietnam's GDP growth.](05_discounted_cash_flow_files/figure-pdf/fig-502-output-1.pdf){#fig-502 fig-alt='Title: Revenue growth rates for FPT. The figure shows historical and forecast revenue growth rates.' fig-pos='H'}\n:::\n:::\n\n\n@fig-503 presents the resulting FCF projections alongside historical values.\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\n# Combine historical and forecast FCF\nfcf_historical = (historical_data\n    .loc[:, [\"year\", \"fcf\"]]\n    .assign(type=\"Historical\")\n)\n\nfcf_forecast = (forecast_data\n    .loc[:, [\"year\", \"fcf\"]]\n    .assign(type=\"Forecast\")\n)\n\nfcf_combined = pd.concat([fcf_historical, fcf_forecast], ignore_index=True)\nfcf_combined[\"type\"] = pd.Categorical(\n    fcf_combined[\"type\"],\n    categories=[\"Historical\", \"Forecast\"]\n)\n\nfcf_figure = (\n    ggplot(fcf_combined, aes(x=\"year\", y=\"fcf/1e12\", fill=\"type\"))\n    + geom_col()\n    + labs(\n        x=\"\", y=\"Free Cash Flow (Trillion VND)\", fill=\"\",\n        title=\"Historical and Forecast Free Cash Flow for FPT\"\n    )\n)\n\nfcf_figure.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Free Cash Flow: historical (realized) and forecast (projected). The forecast reflects our assumptions about revenue growth and operating ratios.](05_discounted_cash_flow_files/figure-pdf/fig-503-output-1.pdf){#fig-503 fig-alt='Title: Free Cash Flow for FPT. The figure shows a bar chart with historical and forecast FCF values.' fig-pos='H'}\n:::\n:::\n\n\n## Terminal Value: Capturing Long-Term Value\n\nA critical component of DCF analysis is the **terminal value** (or continuation value), which represents the company's value beyond the explicit forecast period. In most valuations, terminal value constitutes 50-80% of total enterprise value, making its estimation particularly important.\n\n### The Perpetuity Growth Model\n\nThe most common approach is the **Perpetuity Growth Model** (also called the Gordon Growth Model), which assumes FCF grows at a constant rate forever:\n\n$$\nTV_T = \\frac{FCF_{T+1}}{r - g} = \\frac{FCF_T \\times (1 + g)}{r - g}\n$$\n\nwhere:\n\n- $TV_T$: Terminal value at the end of year $T$\n- $FCF_T$: Free cash flow in the final forecast year\n- $g$: Perpetual growth rate\n- $r$: Discount rate (WACC)\n\n### Choosing the Perpetual Growth Rate\n\nThe perpetual growth rate $g$ should reflect long-term sustainable growth. Key considerations:\n\n1. **No company can grow faster than the economy forever**. If it did, the company would eventually become larger than GDP, which is an impossibility. Long-term GDP growth (nominal, including inflation) provides an upper bound.\n\n2. **Mature companies typically grow at or below GDP growth**. The perpetual growth rate should reflect the company in its \"steady state,\" not its current high-growth phase.\n\n3. **For Vietnam**, long-term nominal GDP growth might be 6-8% given current development stage, but this will moderate over time. A perpetual growth rate of 3-5% is often reasonable.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\ndef compute_terminal_value(last_fcf, growth_rate, discount_rate):\n    \"\"\"\n    Compute terminal value using the perpetuity growth model.\n    \n    Parameters:\n    -----------\n    last_fcf : float\n        Free cash flow in the final forecast year\n    growth_rate : float\n        Perpetual growth rate (g)\n    discount_rate : float\n        Discount rate / WACC (r)\n        \n    Returns:\n    --------\n    float : Terminal value\n    \"\"\"\n    if discount_rate <= growth_rate:\n        raise ValueError(\"Discount rate must exceed growth rate for finite terminal value\")\n    \n    return last_fcf * (1 + growth_rate) / (discount_rate - growth_rate)\n\n\n# Example calculation\nlast_fcf = forecast_data[\"fcf\"].iloc[-1]\nperpetual_growth = 0.04  # 4% perpetual growth\ndiscount_rate = 0.10     # 10% WACC (placeholder)\n\nterminal_value = compute_terminal_value(last_fcf, perpetual_growth, discount_rate)\n\nprint(f\"Last forecast FCF: {last_fcf/1e12:.2f} trillion VND\")\nprint(f\"Terminal value (at {perpetual_growth:.0%} growth, {discount_rate:.0%} WACC): {terminal_value/1e12:.1f} trillion VND\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLast forecast FCF: 8.43 trillion VND\nTerminal value (at 4% growth, 10% WACC): 146.1 trillion VND\n```\n:::\n:::\n\n\n### Alternative: Exit Multiple Approach\n\nPractitioners often cross-check terminal value using the **exit multiple approach**, which assumes the company is sold at the end of the forecast period at a multiple of EBITDA, EBIT, or revenue comparable to similar companies today.\n\nFor example, if comparable companies trade at 10x EBITDA, the terminal value would be:\n\n$$\nTV_T = \\text{EBITDA}_T \\times \\text{Exit Multiple}\n$$\n\nThis approach is simpler but embeds the assumption that current market multiples will persist (a strong assumption that may not hold).\n\n## The Discount Rate: Weighted Average Cost of Capital\n\nThe discount rate converts future cash flows to present value. For FCF (which goes to all capital providers), we use the **Weighted Average Cost of Capital (WACC)**:\n\n$$\nWACC = \\frac{E}{E+D} \\times r_E + \\frac{D}{E+D} \\times r_D \\times (1 - \\tau)\n$$\n\nwhere:\n\n- $E$: Market value of equity\n- $D$: Market value of debt\n- $r_E$: Cost of equity (typically estimated using CAPM)\n- $r_D$: Cost of debt (pre-tax)\n- $\\tau$: Corporate tax rate\n\nThe $(1-\\tau)$ term on debt reflects the tax shield. Interest payments are tax-deductible, reducing the effective cost of debt.\n\n### Estimating WACC Components\n\n**Cost of Equity** is typically estimated using the Capital Asset Pricing Model (see our [CAPM chapter](03_capm.qmd)):\n\n$$\nr_E = r_f + \\beta \\times (r_m - r_f)\n$$\n\nwhere $r_f$ is the risk-free rate, $\\beta$ measures systematic risk, and $(r_m - r_f)$ is the market risk premium.\n\n**Cost of Debt** can be estimated from:\n\n- Interest expense divided by total debt (effective rate)\n- Yields on the company's traded bonds\n- Yields on bonds with similar credit ratings\n\n**Capital Structure Weights** should use market values when available. For equity, market capitalization is straightforward. For debt, book value is often used when market values aren't observable.\n\n### Using Industry WACC Data\n\nProfessor Aswath Damodaran at NYU Stern maintains comprehensive industry WACC data. Let's download and use this resource:\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\nimport requests\nimport os\n\n# Download Damodaran's WACC data\nurl = \"https://pages.stern.nyu.edu/~adamodar/pc/datasets/wacc.xls\"\n\ntry:\n    response = requests.get(url, timeout=10)\n    response.raise_for_status()\n    \n    with open(\"wacc.xls\", \"wb\") as f:\n        f.write(response.content)\n    \n    # Read the data (skip header rows)\n    wacc_data = pd.read_excel(\"wacc.xls\", sheet_name=1, skiprows=18)\n    \n    # Clean up\n    os.remove(\"wacc.xls\")\n    \n    # Find WACC for Computer Services (closest to FPT's business)\n    industry_wacc = wacc_data.loc[\n        wacc_data[\"Industry Name\"] == \"Computer Services\",\n        \"Cost of Capital\"\n    ].values[0]\n    \n    print(f\"Industry WACC (Computer Services): {industry_wacc:.2%}\")\n    \nexcept Exception as e:\n    print(f\"Could not download WACC data: {e}\")\n    # Use a reasonable estimate\n    industry_wacc = 0.10\n    print(f\"Using estimated WACC: {industry_wacc:.2%}\")\n\nwacc = industry_wacc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCould not download WACC data: `Import xlrd` failed. Install xlrd >= 2.0.1 for xls Excel support Use pip or conda to install the xlrd package.\nUsing estimated WACC: 10.00%\n```\n:::\n:::\n\n\n**Note**: Industry WACC provides a useful benchmark, but company-specific factors (leverage, business risk, country risk) may warrant adjustments. For Vietnamese companies, adding a country risk premium may be appropriate.\n\n## Computing Enterprise Value\n\nWith all components in place, we can now compute enterprise value. The DCF formula is:\n\n$$\n\\text{Enterprise Value} = \\sum_{t=1}^{T} \\frac{FCF_t}{(1 + WACC)^t} + \\frac{TV_T}{(1 + WACC)^T}\n$$\n\nThe first term is the present value of forecast-period cash flows; the second is the present value of terminal value.\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\ndef compute_dcf_value(fcf_series, wacc, perpetual_growth):\n    \"\"\"\n    Compute enterprise value using DCF analysis.\n    \n    Parameters:\n    -----------\n    fcf_series : array-like\n        Free cash flows for forecast period\n    wacc : float\n        Weighted average cost of capital\n    perpetual_growth : float\n        Perpetual growth rate for terminal value\n        \n    Returns:\n    --------\n    dict : Components of DCF valuation\n    \"\"\"\n    fcf = np.array(fcf_series)\n    n_years = len(fcf)\n    \n    # Discount factors\n    discount_factors = (1 + wacc) ** np.arange(1, n_years + 1)\n    \n    # Present value of forecast period cash flows\n    pv_fcf = fcf / discount_factors\n    pv_fcf_total = pv_fcf.sum()\n    \n    # Terminal value and its present value\n    terminal_value = compute_terminal_value(fcf[-1], perpetual_growth, wacc)\n    pv_terminal = terminal_value / discount_factors[-1]\n    \n    # Total enterprise value\n    enterprise_value = pv_fcf_total + pv_terminal\n    \n    return {\n        \"pv_fcf\": pv_fcf_total,\n        \"terminal_value\": terminal_value,\n        \"pv_terminal\": pv_terminal,\n        \"enterprise_value\": enterprise_value,\n        \"terminal_pct\": pv_terminal / enterprise_value\n    }\n\n\n# Compute DCF value\nperpetual_growth = 0.04  # 4% perpetual growth\n\ndcf_result = compute_dcf_value(\n    fcf_series=forecast_data[\"fcf\"].values,\n    wacc=wacc,\n    perpetual_growth=perpetual_growth\n)\n\nprint(\"DCF Valuation Results\")\nprint(\"=\" * 50)\nprint(f\"PV of Forecast Period FCF: {dcf_result['pv_fcf']/1e12:.1f} trillion VND\")\nprint(f\"Terminal Value: {dcf_result['terminal_value']/1e12:.1f} trillion VND\")\nprint(f\"PV of Terminal Value: {dcf_result['pv_terminal']/1e12:.1f} trillion VND\")\nprint(f\"Enterprise Value: {dcf_result['enterprise_value']/1e12:.1f} trillion VND\")\nprint(f\"Terminal Value as % of EV: {dcf_result['terminal_pct']:.1%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDCF Valuation Results\n==================================================\nPV of Forecast Period FCF: 22.7 trillion VND\nTerminal Value: 146.1 trillion VND\nPV of Terminal Value: 90.7 trillion VND\nEnterprise Value: 113.4 trillion VND\nTerminal Value as % of EV: 80.0%\n```\n:::\n:::\n\n\nNote that terminal value often represents 60-80% of enterprise value. This highlights the importance of terminal value assumptions and the inherent uncertainty in DCF analysis.\n\n## Sensitivity Analysis\n\nGiven the uncertainty in DCF inputs, sensitivity analysis is essential. We examine how enterprise value changes with different assumptions about WACC and perpetual growth.\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\n# Define ranges for sensitivity analysis\nwacc_range = np.arange(0.08, 0.14, 0.01)  # 8% to 13%\ngrowth_range = np.arange(0.02, 0.06, 0.01)  # 2% to 5%\n\n# Create all combinations\nsensitivity_results = []\n\nfor w in wacc_range:\n    for g in growth_range:\n        if w > g:  # Must have WACC > growth for valid terminal value\n            result = compute_dcf_value(\n                fcf_series=forecast_data[\"fcf\"].values,\n                wacc=w,\n                perpetual_growth=g\n            )\n            sensitivity_results.append({\n                \"wacc\": w,\n                \"growth_rate\": g,\n                \"enterprise_value\": result[\"enterprise_value\"] / 1e12  # In trillions\n            })\n\nsensitivity_df = pd.DataFrame(sensitivity_results)\n\n# Create heatmap\nsensitivity_figure = (\n    ggplot(sensitivity_df, aes(x=\"wacc\", y=\"growth_rate\", fill=\"enterprise_value\"))\n    + geom_tile()\n    + geom_text(\n        aes(label=\"enterprise_value\"),\n        format_string=\"{:.0f}\",\n        color=\"white\",\n        size=9\n    )\n    + scale_x_continuous(labels=percent_format())\n    + scale_y_continuous(labels=percent_format())\n    + scale_fill_gradient(low=\"darkblue\", high=\"lightblue\")\n    + labs(\n        x=\"WACC\", y=\"Perpetual Growth Rate\",\n        fill=\"EV\\n(Trillion VND)\",\n        title=\"DCF Sensitivity: Enterprise Value by WACC and Growth Rate\"\n    )\n)\n\nsensitivity_figure.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Sensitivity of enterprise value to WACC and perpetual growth rate assumptions. Small changes in these inputs can substantially affect valuation.](05_discounted_cash_flow_files/figure-pdf/fig-504-output-1.pdf){#fig-504 fig-alt='Title: DCF Sensitivity Analysis. The figure shows a heatmap of enterprise values for different combinations of WACC and growth rate.' fig-pos='H'}\n:::\n:::\n\n\nThe sensitivity analysis reveals several important insights:\n\n1. **Valuation is highly sensitive to inputs**: Small changes in WACC or growth rate produce large changes in enterprise value. A 1 percentage point change in WACC can shift value by 20% or more.\n\n2. **The relationship is non-linear**: The impact of growth rate changes is amplified at lower WACCs because the terminal value formula has $(r-g)$ in the denominator.\n\n3. **Reasonable people can disagree**: Given input uncertainty, DCF should be thought of as producing a *range* of values, not a single precise number.\n\n## From Enterprise Value to Equity Value\n\nOur DCF analysis yields **enterprise value** (i.e., the total value of the company's operations to all capital providers). To determine **equity value** (what shareholders own), we must adjust for the claims of debt holders and any non-operating assets:\n\n$$\n\\text{Equity Value} = \\text{Enterprise Value} + \\text{Non-Operating Assets} - \\text{Debt}\n$$\n\n**Non-Operating Assets** include:\n\n- Excess cash beyond operating needs\n- Marketable securities\n- Non-core real estate or investments\n\n**Debt** includes:\n\n- Short-term debt\n- Long-term debt\n- Capital lease obligations\n- Preferred stock (if treated as debt-like)\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\n# Get most recent balance sheet data for FPT\nlatest_year = fpt_data[\"year\"].max()\nlatest_data = fpt_data[fpt_data[\"year\"] == latest_year].iloc[0]\n\n# Extract debt and cash (column names may vary)\ntotal_debt = latest_data.get(\"total_debt\", 0)\ncash = latest_data.get(\"ca_cce\", 0)\n\n# Compute equity value\nenterprise_value = dcf_result[\"enterprise_value\"]\nequity_value = enterprise_value - total_debt + cash\n\nprint(\"From Enterprise Value to Equity Value\")\nprint(\"=\" * 50)\nprint(f\"Enterprise Value: {enterprise_value/1e12:.1f} trillion VND\")\nprint(f\"Less: Total Debt: {total_debt/1e12:.1f} trillion VND\")\nprint(f\"Plus: Cash: {cash/1e12:.1f} trillion VND\")\nprint(f\"Equity Value: {equity_value/1e12:.1f} trillion VND\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFrom Enterprise Value to Equity Value\n==================================================\nEnterprise Value: 113.4 trillion VND\nLess: Total Debt: 0.0 trillion VND\nPlus: Cash: 8.3 trillion VND\nEquity Value: 121.7 trillion VND\n```\n:::\n:::\n\n\n### Implied Share Price\n\nIf we know the number of shares outstanding, we can compute an implied share price:\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\n# Get shares outstanding (this would come from market data)\n# Using placeholder - in practice, get from exchange data\nshares_outstanding = latest_data.get(\"total_equity\", equity_value) / 25000  # Rough estimate\n\nimplied_price = equity_value / shares_outstanding\n\nprint(f\"\\nImplied Share Price: {implied_price:,.0f} VND\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nImplied Share Price: 101,645 VND\n```\n:::\n:::\n\n\nComparing the implied price to the current market price tells us whether the stock appears under- or overvalued according to our DCF model.\n\n## Limitations and Practical Considerations\n\nDCF analysis is powerful but has important limitations:\n\n### Sensitivity to Assumptions\n\nAs our sensitivity analysis showed, small changes in inputs produce large changes in value. This is particularly problematic because the most influential inputs (long-term growth, WACC) are the hardest to estimate accurately.\n\n### Terminal Value Dominance\n\nTerminal value often represents 60-80% of total value, yet it's based on assumptions about the very distant future. This concentrates valuation risk in the most uncertain component.\n\n### Garbage In, Garbage Out\n\nDCF is only as good as its inputs. Unrealistic growth assumptions, optimistic margins, or inappropriate discount rates produce meaningless valuations. The discipline of DCF lies in forcing analysts to justify their assumptions.\n\n### Not Suitable for All Companies\n\nDCF works best for companies with:\n\n- Positive and predictable cash flows\n- Stable or predictably changing margins\n- Reasonable visibility into future operations\n\nIt struggles with:\n\n- Early-stage companies with no profits\n- Highly cyclical businesses\n- Companies undergoing major transitions\n- Financial institutions (which require different approaches)\n\n### Complement with Other Methods\n\nWise practitioners use DCF alongside other valuation methods:\n\n- **Comparable company analysis**: How do similar companies trade?\n- **Precedent transactions**: What have acquirers paid for similar businesses?\n- **Sum-of-the-parts**: Value divisions separately and add\n\nWhen methods converge, confidence increases. When they diverge, it prompts investigation into why.\n\n## Key Takeaways\n\nThis chapter introduced Discounted Cash Flow analysis as a framework for intrinsic valuation. The main insights are:\n\n1. **Free Cash Flow is the foundation**: FCF represents cash available to all investors after operating expenses, taxes, and investments. It differs from net income by excluding non-cash items and including investment needs.\n\n2. **Ratio-based forecasting links components to revenue**: By expressing FCF components as percentages of revenue, we can systematically forecast cash flows based on revenue growth assumptions and operating ratio projections.\n\n3. **Terminal value captures long-term value**: The perpetuity growth model assumes FCF grows at a constant rate forever. The perpetual growth rate should not exceed long-term economic growth.\n\n4. **WACC is the appropriate discount rate**: The Weighted Average Cost of Capital reflects the blended cost of debt and equity financing, adjusted for the tax shield on interest.\n\n5. **DCF produces enterprise value**: To derive equity value, subtract debt and add non-operating assets. Dividing by shares outstanding yields an implied share price.\n\n6. **Sensitivity analysis is essential**: Given input uncertainty, presenting a range of values based on different assumptions is more honest than a single point estimate.\n\n7. **DCF complements other methods**: No single valuation method is definitive. Cross-checking DCF with market multiples and transaction comparables provides a more complete picture.\n\nThe true value of DCF analysis lies not in producing a precise number but in forcing rigorous thinking about what drives company value. The process of building a DCF model (i.e., forecasting growth, projecting margins, estimating risk) develops deep understanding of the business being valued.\n\n",
    "supporting": [
      "05_discounted_cash_flow_files/figure-pdf"
    ],
    "filters": []
  }
}