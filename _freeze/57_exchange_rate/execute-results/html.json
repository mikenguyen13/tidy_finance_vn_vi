{
  "hash": "57c291517679e46dbab2765e5e80934a",
  "result": {
    "engine": "jupyter",
    "markdown": "# Exchange Rate Dynamics\n\n::: callout-note\nIn this chapter, we construct a comprehensive exchange rate database for the Vietnamese Dong (VND) against major currencies, analyze the statistical properties of VND returns, test covered and uncovered interest rate parity, estimate the currency exposure of Vietnamese listed firms, model volatility regimes using GARCH, and evaluate hedging strategies for international investors.\n:::\n\nExchange rates sit at the intersection of macroeconomics and finance. For international investors considering Vietnamese equities, the VND/USD exchange rate is not a secondary concern; it is a first-order determinant of dollar-denominated returns. A Vietnamese stock portfolio that earns 15% in VND terms but coincides with a 5% VND depreciation delivers only about 10% in USD terms. Conversely, periods of VND stability or appreciation amplify returns for foreign investors. Understanding exchange rate dynamics is therefore essential for anyone working with Vietnamese financial data in an international context.\n\nVietnam presents a distinctive exchange rate regime. Unlike freely floating currencies such as the USD/EUR or USD/JPY, the VND operates under a managed float. The State Bank of Vietnam (SBV) sets a daily reference rate and allows trading within a band (currently $\\pm$ 3% on the interbank market and $\\pm$ 5% against the official rate for commercial banks). This regime creates specific patterns in VND returns that differ fundamentally from those observed in freely floating pairs: clustered movements near band boundaries, discrete adjustments when the SBV shifts the reference rate, and periods of near-zero volatility punctuated by sharp moves during policy changes.\n\nThis chapter develops tools for working with these dynamics. We progress from data construction through statistical characterization to economic applications: interest rate parity tests, firm-level exposure estimation, GARCH volatility modeling, and hedging strategy evaluation.\n\n## Theoretical Foundations {#sec-fx-theory}\n\n### Exchange Rate Determination\n\nThe modern theory of exchange rate determination rests on several building blocks. @dornbusch1976expectations provides the canonical \"overshooting\" model: because goods prices are sticky while asset prices adjust instantly, a monetary shock causes the exchange rate to overshoot its long-run equilibrium. @frankel1979mark extends this to a real interest differential model where the exchange rate depends on relative money supplies, income levels, and interest rates across countries.\n\nDespite elegant theory, @meese1983empirical delivered a devastating empirical result: no structural model of exchange rates consistently outperforms a random walk in out-of-sample forecasting. This finding, confirmed repeatedly over four decades and surveyed by @rossi2013exchange, means that exchange rate changes are, to a first approximation, unpredictable. For practical purposes, the best forecast of tomorrow's VND/USD rate is today's rate.\n\n### Interest Rate Parity\n\nTwo parity conditions link exchange rates to interest rates:\n\n**Covered Interest Rate Parity (CIP):** Arbitrage between spot and forward markets should equalize the forward premium with the interest rate differential:\n\n$$\nF_{t,t+k} = S_t \\cdot \\frac{(1 + r^{VND}_{t,k})}{(1 + r^{USD}_{t,k})}\n$$ {#eq-cip}\n\nwhere $S_t$ is the spot rate (VND per USD), $F_{t,t+k}$ is the $k$-period forward rate, and $r^{VND}_{t,k}$ and $r^{USD}_{t,k}$ are the domestic and foreign interest rates for maturity $k$. CIP should hold exactly in the absence of transaction costs, credit risk, and capital controls. @du2018deviations document that CIP violations have widened significantly in major currency pairs since 2008, driven by post-crisis bank balance sheet constraints. In Vietnam, capital controls and limited forward market liquidity create additional CIP deviations.\n\n**Uncovered Interest Rate Parity (UIP):** The expected depreciation should equal the interest rate differential:\n\n$$\n\\mathbb{E}_t[\\Delta s_{t+k}] = r^{VND}_{t,k} - r^{USD}_{t,k}\n$$ {#eq-uip}\n\nwhere $\\Delta s_{t+k} = \\ln(S_{t+k}/S_t)$. UIP is an equilibrium condition, not an arbitrage condition, it requires risk-neutral investors. @fama1984forward famously showed that the forward premium predicts exchange rate changes with the *wrong sign*: high-interest-rate currencies tend to appreciate rather than depreciate, contradicting UIP. This \"forward premium anomaly\" is the foundation of the carry trade.\n\n### The Carry Trade\n\nThe carry trade exploits UIP violations by borrowing in low-interest-rate currencies and investing in high-interest-rate currencies. @lustig2007cross show that a portfolio of carry trade positions earns a significant risk premium, which they link to consumption growth risk. @menkhoff2012carry identify global FX volatility as the key risk factor: carry trades lose money precisely when global volatility spikes, a \"crash risk\" documented by @brunnermeier2008carry.\n\nVietnam, with interest rates typically 3-8 percentage points above U.S. rates, is a natural candidate for carry trade inflows. The managed exchange rate regime provides an additional attraction: the SBV's implicit defense of the band reduces short-term volatility, increasing the Sharpe ratio of the carry position, until a band adjustment or devaluation erases accumulated gains in a single move.\n\n### The Trilemma\n\n@obstfeld2005trilemma formalize the \"impossible trinity\": a country cannot simultaneously maintain (i) a fixed exchange rate, (ii) an independent monetary policy, and (iii) free capital mobility. Vietnam navigates this trilemma by maintaining partial capital controls alongside its managed float, allowing some degree of monetary policy independence. Understanding where Vietnam sits on the trilemma at any given time is essential for interpreting exchange rate data: periods of tighter capital controls produce artificially low exchange rate volatility that does not reflect true economic uncertainty.\n\n## The VND Exchange Rate Regime {#sec-fx-regime}\n\n### Historical Evolution\n\nThe VND/USD exchange rate has evolved through several distinct phases:\n\n| Period | Regime | Key Features |\n|------------------------|------------------------|------------------------|\n| Pre-1999 | Narrow band | SBV set the rate with minimal flexibility |\n| 1999-2007 | Gradual crawl | Slow, controlled depreciation (\\~1-2% per year) |\n| 2008-2011 | Crisis adjustments | Multiple discrete devaluations (2008, 2010, 2011) |\n| 2012-2015 | Stabilization | Tight band, rare adjustments, building reserves |\n| 2016-present | Reference rate mechanism | Daily reference rate based on a basket; $\\pm$ 3% band |\n\n: Evolution of the VND/USD exchange rate regime. {#tbl-regime-history}\n\nThe 2016 reform, shifting from a fixed peg to a daily reference rate influenced by a currency basket, was a significant structural change. The reference rate now incorporates the previous day's closing interbank rate, supply-demand conditions, and movements in currencies of major trading partners (USD, EUR, CNY, JPY, KRW).\n\n### Band Mechanics\n\nThe SBV announces a daily reference rate each morning. Commercial banks may quote rates within a band around this reference. The interbank market operates with a narrower $\\pm$ 3% band. When the spot rate approaches the band ceiling, the SBV may intervene by selling USD from reserves, widening the band, or adjusting the reference rate.\n\nThis regime creates distinctive statistical properties:\n\n1.  **Return clustering near zero:** On most days, the VND/USD rate barely moves, producing a spike at zero in the return distribution.\n2.  **Discrete jumps:** Reference rate adjustments create large single-day moves that appear as outliers.\n3.  **Bounded volatility:** The band constrains daily moves, producing a return distribution with thinner tails than a freely floating currency.\n4.  **Asymmetric adjustment:** Depreciation pressure (VND weakening) is more common than appreciation, reflecting persistent inflation differentials.\n\n## Data Construction {#sec-fx-data}\n\n### Loading Libraries\n\n::: {#setup .cell execution_count=1}\n``` {.python .cell-code code-summary=\"Import libraries and configure environment\"}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nfrom scipy import stats\nfrom arch import arch_model\nfrom linearmodels.panel import PanelOLS\nimport warnings\nwarnings.filterwarnings('ignore')\n\nplt.rcParams.update({\n    'figure.figsize': (12, 6),\n    'figure.dpi': 150,\n    'font.size': 11,\n    'axes.spines.top': False,\n    'axes.spines.right': False\n})\n```\n:::\n\n\n### Retrieving Exchange Rate Data\n\nWe extract daily spot rates for the VND against all major currencies, along with the SBV reference rate and forward rates where available.\n\n::: {#data-load .cell execution_count=2}\n``` {.python .cell-code code-summary=\"Load exchange rate data\"}\nfrom datacore import DataCoreClient\n\nclient = DataCoreClient()\n\n# Spot exchange rates: VND per unit of foreign currency\nfx_spot = client.get_exchange_rates(\n    base_currency='VND',\n    quote_currencies=['USD', 'EUR', 'JPY', 'CNY', 'KRW',\n                      'SGD', 'THB', 'GBP', 'AUD'],\n    start_date='2005-01-01',\n    end_date='2024-12-31',\n    fields=['date', 'from_currency', 'to_currency', 'rate',\n            'bid', 'ask', 'reference_rate']\n)\n\n# Forward rates (VND/USD)\nfx_forward = client.get_fx_forwards(\n    pair='VND/USD',\n    start_date='2010-01-01',\n    end_date='2024-12-31',\n    tenors=['1M', '3M', '6M', '12M'],\n    fields=['date', 'tenor', 'forward_rate', 'forward_points']\n)\n\n# Interest rates for parity tests\ninterest_rates = client.get_interest_rates(\n    countries=['VN', 'US'],\n    start_date='2005-01-01',\n    end_date='2024-12-31',\n    instruments=['interbank_overnight', 'deposit_3m',\n                 'government_bond_1y', 'government_bond_10y']\n)\n\nprint(f\"Spot observations: {fx_spot.shape[0]:,}\")\nprint(f\"Forward observations: {fx_forward.shape[0]:,}\")\nprint(f\"Interest rate observations: {interest_rates.shape[0]:,}\")\n```\n:::\n\n\n### Constructing the VND/USD Time Series\n\nWe focus primarily on the VND/USD pair, the dominant bilateral rate for Vietnam, while using other pairs for cross-rate analysis.\n\n::: {#construct-vnd-usd .cell execution_count=3}\n``` {.python .cell-code code-summary=\"Construct clean VND/USD spot rate series with log returns\"}\n# Filter VND/USD\nvnd_usd = fx_spot[\n    (fx_spot['from_currency'] == 'VND') &\n    (fx_spot['to_currency'] == 'USD')\n].copy()\n\nvnd_usd['date'] = pd.to_datetime(vnd_usd['date'])\nvnd_usd = vnd_usd.sort_values('date').set_index('date')\n\n# Log returns: positive = VND depreciation, negative = VND appreciation\nvnd_usd['log_return'] = np.log(vnd_usd['rate'] / vnd_usd['rate'].shift(1))\n\n# Bid-ask spread as fraction of mid rate\nvnd_usd['spread_pct'] = (vnd_usd['ask'] - vnd_usd['bid']) / vnd_usd['rate']\n\n# Distance from reference rate (in %)\nvnd_usd['deviation_from_ref'] = (\n    (vnd_usd['rate'] - vnd_usd['reference_rate'])\n    / vnd_usd['reference_rate'] * 100\n)\n\n# Rolling volatility measures\nvnd_usd['vol_30d'] = vnd_usd['log_return'].rolling(30).std() * np.sqrt(252)\nvnd_usd['vol_90d'] = vnd_usd['log_return'].rolling(90).std() * np.sqrt(252)\n\nvnd_usd = vnd_usd.dropna(subset=['log_return'])\n\nprint(f\"VND/USD series: {len(vnd_usd)} daily observations\")\nprint(f\"Date range: {vnd_usd.index.min()} to {vnd_usd.index.max()}\")\nprint(f\"\\nSummary of daily log returns:\")\nprint(vnd_usd['log_return'].describe().round(6))\n```\n:::\n\n\n### Multi-Currency Panel\n\nFor cross-rate analysis and ASEAN comparisons, we construct a panel of log returns for all currency pairs.\n\n::: {#multi-currency .cell execution_count=4}\n``` {.python .cell-code code-summary=\"Construct multi-currency return panel\"}\n# Pivot to wide format: one column per currency pair\nfx_wide = fx_spot.pivot_table(\n    index='date', columns='to_currency', values='rate'\n)\nfx_wide.index = pd.to_datetime(fx_wide.index)\nfx_wide = fx_wide.sort_index()\n\n# Compute log returns for all pairs\nfx_returns = np.log(fx_wide / fx_wide.shift(1)).dropna()\n\n# Summary statistics\nfx_summary = pd.DataFrame({\n    'Mean (ann.)': fx_returns.mean() * 252,\n    'Vol (ann.)': fx_returns.std() * np.sqrt(252),\n    'Skewness': fx_returns.skew(),\n    'Kurtosis': fx_returns.kurtosis(),\n    'Min': fx_returns.min(),\n    'Max': fx_returns.max()\n})\nprint(\"VND Cross-Rate Return Statistics (Daily):\")\nprint(fx_summary.round(4))\n```\n:::\n\n\n## Statistical Properties of VND Returns {#sec-fx-statistics}\n\n### Return Distribution\n\nThe distribution of VND/USD log returns deviates sharply from normality. The managed float regime produces a return distribution that is leptokurtic (fat-tailed) and concentrated near zero, with occasional large discrete jumps from reference rate adjustments.\n\n::: {#fig-return-distribution .cell execution_count=5}\n``` {.python .cell-code code-summary=\"Plot VND/USD return distribution with normal overlay\"}\nfig, axes = plt.subplots(1, 2, figsize=(14, 5))\n\n# Panel A: Histogram with normal overlay\nreturns = vnd_usd['log_return']\nmu, sigma = returns.mean(), returns.std()\n\naxes[0].hist(returns, bins=100, density=True, color='#2C5F8A',\n             alpha=0.7, edgecolor='white', label='Empirical')\nx_range = np.linspace(returns.min(), returns.max(), 200)\naxes[0].plot(x_range, stats.norm.pdf(x_range, mu, sigma),\n             color='#C0392B', linewidth=2, label='Normal fit')\naxes[0].set_xlabel('Daily Log Return')\naxes[0].set_ylabel('Density')\naxes[0].set_title('Panel A: Return Distribution')\naxes[0].legend()\n\n# Panel B: QQ plot\nstats.probplot(returns, dist='norm', plot=axes[1])\naxes[1].set_title('Panel B: Normal Q-Q Plot')\naxes[1].get_lines()[0].set_color('#2C5F8A')\naxes[1].get_lines()[0].set_markersize(3)\naxes[1].get_lines()[1].set_color('#C0392B')\n\nplt.tight_layout()\nplt.show()\n\n# Formal tests\njb_stat, jb_p = stats.jarque_bera(returns)\nprint(f\"\\nJarque-Bera test: statistic = {jb_stat:.1f}, p-value = {jb_p:.2e}\")\nprint(f\"Skewness: {returns.skew():.4f}\")\nprint(f\"Excess Kurtosis: {returns.kurtosis():.4f}\")\n```\n:::\n\n\n### Autocorrelation Structure\n\nFreely floating exchange rate returns are approximately uncorrelated (consistent with the random walk result of @meese1983empirical). Managed exchange rates, however, may exhibit serial correlation because the central bank smooths adjustments over multiple days.\n\n::: {#fig-autocorrelation .cell execution_count=6}\n``` {.python .cell-code code-summary=\"Plot ACF of returns and squared returns\"}\nfrom statsmodels.graphics.tsaplots import plot_acf\n\nfig, axes = plt.subplots(2, 1, figsize=(12, 8))\n\n# ACF of returns\nplot_acf(vnd_usd['log_return'].dropna(), lags=40, ax=axes[0],\n         color='#2C5F8A', vlines_kwargs={'color': '#2C5F8A'})\naxes[0].set_title('Autocorrelation of Daily Returns')\naxes[0].set_ylabel('ACF')\n\n# ACF of squared returns (volatility clustering)\nplot_acf(vnd_usd['log_return'].dropna() ** 2, lags=40, ax=axes[1],\n         color='#C0392B', vlines_kwargs={'color': '#C0392B'})\naxes[1].set_title('Autocorrelation of Squared Returns (Volatility Clustering)')\naxes[1].set_ylabel('ACF')\n\nplt.tight_layout()\nplt.show()\n\n# Ljung-Box test\nfrom statsmodels.stats.diagnostic import acorr_ljungbox\nlb_returns = acorr_ljungbox(returns, lags=10, return_df=True)\nlb_squared = acorr_ljungbox(returns ** 2, lags=10, return_df=True)\nprint(\"Ljung-Box Test (Returns, lag 10):\")\nprint(f\"  Statistic: {lb_returns['lb_stat'].iloc[-1]:.2f}, \"\n      f\"p-value: {lb_returns['lb_pvalue'].iloc[-1]:.4f}\")\nprint(\"Ljung-Box Test (Squared Returns, lag 10):\")\nprint(f\"  Statistic: {lb_squared['lb_stat'].iloc[-1]:.2f}, \"\n      f\"p-value: {lb_squared['lb_pvalue'].iloc[-1]:.4f}\")\n```\n:::\n\n\n### Reference Rate Adjustments and Structural Breaks\n\nThe SBV periodically adjusts the reference rate or the trading band width, events that create structural breaks in the exchange rate series. Identifying these breaks is essential for accurate modeling.\n\n::: {#fig-structural-breaks .cell execution_count=7}\n``` {.python .cell-code code-summary=\"Identify and plot major exchange rate adjustments\"}\n# Detect large daily moves (proxy for policy adjustments)\nthreshold = vnd_usd['log_return'].std() * 3\nlarge_moves = vnd_usd[vnd_usd['log_return'].abs() > threshold].copy()\n\n# Known major adjustment dates (approximate)\npolicy_events = pd.DataFrame({\n    'date': pd.to_datetime([\n        '2008-06-10', '2008-12-25', '2009-11-25',\n        '2010-02-11', '2010-08-18', '2011-02-11',\n        '2011-08-10', '2015-08-12', '2015-08-19',\n        '2016-01-04'\n    ]),\n    'event': [\n        'Band widened to +/-1%', 'Band widened to +/-3%',\n        'Devaluation ~5.4%', 'Devaluation ~3.4%',\n        'Band narrowed to +/-1%', 'Devaluation ~8.5%',\n        'Band widened to +/-1%', 'Devaluation ~1%',\n        'Devaluation ~1%', 'New reference rate mechanism'\n    ]\n})\n\nfig, ax = plt.subplots(figsize=(14, 6))\nax.plot(vnd_usd.index, vnd_usd['rate'], color='#2C5F8A',\n        linewidth=1.5, label='VND/USD Spot')\n\nif 'reference_rate' in vnd_usd.columns:\n    ref_clean = vnd_usd['reference_rate'].dropna()\n    if len(ref_clean) > 0:\n        ax.plot(ref_clean.index, ref_clean, color='#E67E22',\n                linewidth=1, alpha=0.7, label='SBV Reference Rate')\n\n# Mark policy events\nfor _, event in policy_events.iterrows():\n    if event['date'] >= vnd_usd.index.min():\n        rate_at_event = vnd_usd['rate'].asof(event['date'])\n        ax.annotate(\n            event['event'],\n            xy=(event['date'], rate_at_event),\n            xytext=(0, 30), textcoords='offset points',\n            fontsize=7, rotation=45, ha='left',\n            arrowprops=dict(arrowstyle='->', color='#C0392B',\n                           lw=0.8),\n            color='#C0392B'\n        )\n\nax.set_ylabel('VND per USD')\nax.set_title('VND/USD Exchange Rate with Policy Events')\nax.legend(loc='upper left')\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Cross-Currency Correlations\n\nUnderstanding how VND co-moves with other currencies is important for diversification and for identifying common drivers (e.g., USD strength affects all Asian currencies).\n\n::: {#fig-cross-correlations .cell execution_count=8}\n``` {.python .cell-code code-summary=\"Compute and visualize cross-currency return correlations\"}\n# Correlation matrix of daily returns\ncorr_matrix = fx_returns.corr()\n\nfig, ax = plt.subplots(figsize=(9, 8))\nmask = np.triu(np.ones_like(corr_matrix, dtype=bool), k=1)\nsns.heatmap(\n    corr_matrix, mask=mask, annot=True, fmt='.2f',\n    cmap='RdBu_r', center=0, vmin=-1, vmax=1,\n    square=True, linewidths=0.5, ax=ax,\n    cbar_kws={'label': 'Correlation'}\n)\nax.set_title('Cross-Rate Return Correlations (VND Base)')\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Interest Rate Parity Tests {#sec-fx-parity}\n\n### Testing Covered Interest Rate Parity\n\nCIP deviations are measured as the gap between the forward premium and the interest rate differential:\n\n$$\n\\text{CIP Deviation}_t = f_{t,k} - s_t - (r^{VND}_{t,k} - r^{USD}_{t,k})\n$$ {#eq-cip-deviation}\n\nwhere $f_{t,k} = \\ln F_{t,t+k}$ and $s_t = \\ln S_t$ are log forward and spot rates. Under exact CIP, this deviation is zero.\n\n::: {#cip-test .cell execution_count=9}\n``` {.python .cell-code code-summary=\"Compute CIP deviations for VND/USD\"}\n# Merge spot, forward, and interest rate data\nvnd_usd_monthly = vnd_usd['rate'].resample('M').last().to_frame('spot')\nvnd_usd_monthly.index = vnd_usd_monthly.index.to_period('M').to_timestamp()\n\n# Forward rates (3-month tenor)\nfwd_3m = fx_forward[fx_forward['tenor'] == '3M'].copy()\nfwd_3m['date'] = pd.to_datetime(fwd_3m['date'])\nfwd_3m = fwd_3m.set_index('date').resample('M').last()\n\n# Interest rate differential\nvn_rates = interest_rates[\n    (interest_rates['country'] == 'VN') &\n    (interest_rates['instrument'] == 'deposit_3m')\n].set_index('date')['rate'].resample('M').last()\n\nus_rates = interest_rates[\n    (interest_rates['country'] == 'US') &\n    (interest_rates['instrument'] == 'deposit_3m')\n].set_index('date')['rate'].resample('M').last()\n\n# Align and compute CIP deviation\ncip_data = pd.DataFrame({\n    'spot': vnd_usd_monthly['spot'],\n    'forward': fwd_3m['forward_rate'],\n    'r_vnd': vn_rates / 100,\n    'r_usd': us_rates / 100\n}).dropna()\n\n# CIP deviation (annualized, in basis points)\ncip_data['log_spot'] = np.log(cip_data['spot'])\ncip_data['log_forward'] = np.log(cip_data['forward'])\ncip_data['forward_premium'] = (\n    (cip_data['log_forward'] - cip_data['log_spot']) * 4\n)\ncip_data['rate_diff'] = cip_data['r_vnd'] - cip_data['r_usd']\ncip_data['cip_deviation'] = (\n    (cip_data['forward_premium'] - cip_data['rate_diff']) * 10000\n)\n\nprint(\"CIP Deviation Summary (basis points, annualized):\")\nprint(cip_data['cip_deviation'].describe().round(1))\nprint(f\"\\nMean deviation: {cip_data['cip_deviation'].mean():.1f} bps\")\nt_stat, p_val = stats.ttest_1samp(cip_data['cip_deviation'].dropna(), 0)\nprint(f\"One-sample t-test: t = {t_stat:.2f}, p = {p_val:.4f}\")\n```\n:::\n\n\n::: {#fig-cip-deviation .cell execution_count=10}\n``` {.python .cell-code code-summary=\"Plot CIP deviations over time\"}\nfig, axes = plt.subplots(2, 1, figsize=(14, 8), height_ratios=[2, 1])\n\n# Panel A: CIP deviation time series\naxes[0].fill_between(\n    cip_data.index, 0, cip_data['cip_deviation'],\n    where=cip_data['cip_deviation'] > 0,\n    color='#C0392B', alpha=0.4, label='Positive (VND forward expensive)'\n)\naxes[0].fill_between(\n    cip_data.index, 0, cip_data['cip_deviation'],\n    where=cip_data['cip_deviation'] <= 0,\n    color='#27AE60', alpha=0.4, label='Negative'\n)\naxes[0].axhline(y=0, color='black', linewidth=0.5)\naxes[0].set_ylabel('CIP Deviation (bps)')\naxes[0].set_title('Panel A: CIP Deviations for VND/USD')\naxes[0].legend()\n\n# Panel B: Interest rate differential\naxes[1].plot(cip_data.index, cip_data['r_vnd'] * 100,\n             color='#C0392B', label='Vietnam 3M')\naxes[1].plot(cip_data.index, cip_data['r_usd'] * 100,\n             color='#2C5F8A', label='US 3M')\naxes[1].set_ylabel('Interest Rate (%)')\naxes[1].set_xlabel('Date')\naxes[1].set_title('Panel B: Interest Rate Differential')\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Testing Uncovered Interest Rate Parity\n\nThe standard UIP regression is:\n\n$$\n\\Delta s_{t+k} = \\alpha + \\beta (r^{VND}_{t,k} - r^{USD}_{t,k}) + \\varepsilon_{t+k}\n$$ {#eq-uip-regression}\n\nUnder UIP, $\\alpha = 0$ and $\\beta = 1$. The @fama1984forward anomaly corresponds to $\\beta < 1$ (often $\\beta < 0$), implying that high-interest-rate currencies appreciate rather than depreciate.\n\n::: {#uip-test .cell execution_count=11}\n``` {.python .cell-code code-summary=\"Fama regression test of UIP for VND/USD\"}\n# Monthly exchange rate changes\ncip_data['delta_s'] = (\n    np.log(cip_data['spot'].shift(-3) / cip_data['spot'])\n)\n\n# Fama regression\nuip_data = cip_data[['delta_s', 'rate_diff']].dropna()\n\nuip_model = sm.OLS(\n    uip_data['delta_s'],\n    sm.add_constant(uip_data['rate_diff'])\n).fit(cov_type='HAC', cov_kwds={'maxlags': 4})\n\nprint(\"UIP (Fama) Regression: delta_s_{t+3m} = alpha + beta(r_VND - r_USD) + eps\")\nprint(f\"\\nalpha = {uip_model.params['const']:.4f} \"\n      f\"(t = {uip_model.tvalues['const']:.2f})\")\nprint(f\"beta = {uip_model.params['rate_diff']:.4f} \"\n      f\"(t = {uip_model.tvalues['rate_diff']:.2f})\")\nprint(f\"R-squared = {uip_model.rsquared:.4f}\")\nprint(f\"\\nH0: beta = 1 (Wald test):\")\nwald_stat = ((uip_model.params['rate_diff'] - 1) /\n             uip_model.bse['rate_diff']) ** 2\nprint(f\"  Chi2 = {wald_stat:.2f}, p = {1 - stats.chi2.cdf(wald_stat, 1):.4f}\")\n```\n:::\n\n\n::: callout-note\n## Interpreting UIP Failures in Vietnam\n\nA managed exchange rate complicates UIP tests. When the SBV successfully defends the VND within a narrow band, realized exchange rate changes are artificially compressed regardless of interest rate differentials. The resulting beta estimate reflects the credibility of the peg as much as it reflects the risk premium. Periods of active SBV intervention should be treated separately from periods of relative flexibility.\n:::\n\n### Carry Trade Returns\n\nWe construct a simple VND carry trade strategy: borrow USD at the U.S. short rate, convert to VND, invest at the Vietnamese short rate, and convert back at maturity. The excess return is:\n\n$$\n\\text{Carry}_{t \\to t+k} = (r^{VND}_{t,k} - r^{USD}_{t,k}) - \\Delta s_{t+k}\n$$ {#eq-carry}\n\nA positive carry return means the interest rate differential more than compensated for any VND depreciation.\n\n::: {#carry-trade .cell execution_count=12}\n``` {.python .cell-code code-summary=\"Compute and analyze VND carry trade returns\"}\ncarry = cip_data.copy()\ncarry['carry_return'] = carry['rate_diff'] / 4 - carry['delta_s']\ncarry = carry.dropna(subset=['carry_return'])\n\n# Annualize\nann_carry = carry['carry_return'].mean() * 4\nann_vol = carry['carry_return'].std() * 2\nsharpe = ann_carry / ann_vol\n\nprint(\"VND/USD Carry Trade Performance (3-Month Rolling):\")\nprint(f\"Annualized return: {ann_carry:.4f} ({ann_carry*100:.2f}%)\")\nprint(f\"Annualized volatility: {ann_vol:.4f} ({ann_vol*100:.2f}%)\")\nprint(f\"Sharpe ratio: {sharpe:.2f}\")\nprint(f\"Skewness: {carry['carry_return'].skew():.2f}\")\nprint(f\"Kurtosis: {carry['carry_return'].kurtosis():.2f}\")\nprint(f\"\\nMax quarterly loss: {carry['carry_return'].min():.4f}\")\nprint(f\"Max quarterly gain: {carry['carry_return'].max():.4f}\")\n```\n:::\n\n\n::: {#fig-carry-cumulative .cell execution_count=13}\n``` {.python .cell-code code-summary=\"Plot cumulative carry trade returns\"}\nfig, axes = plt.subplots(2, 1, figsize=(14, 8), height_ratios=[2, 1])\n\n# Panel A: Cumulative return\ncum_carry = (1 + carry['carry_return']).cumprod()\naxes[0].plot(carry.index, cum_carry, color='#2C5F8A', linewidth=2)\naxes[0].fill_between(carry.index, 1, cum_carry,\n                     where=cum_carry > 1, color='#27AE60', alpha=0.2)\naxes[0].fill_between(carry.index, 1, cum_carry,\n                     where=cum_carry < 1, color='#C0392B', alpha=0.2)\naxes[0].axhline(y=1, color='gray', linewidth=0.5)\naxes[0].set_ylabel('Cumulative Return (VND 1 invested)')\naxes[0].set_title('Panel A: VND/USD Carry Trade Cumulative Return')\n\n# Panel B: Quarterly returns\naxes[1].bar(carry.index, carry['carry_return'] * 100,\n            color=['#27AE60' if x > 0 else '#C0392B'\n                   for x in carry['carry_return']],\n            alpha=0.7, width=60)\naxes[1].axhline(y=0, color='black', linewidth=0.5)\naxes[1].set_ylabel('Quarterly Return (%)')\naxes[1].set_xlabel('Date')\naxes[1].set_title('Panel B: Quarterly Carry Returns')\n\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Volatility Modeling {#sec-fx-volatility}\n\n### GARCH Estimation\n\nThe strong autocorrelation in squared VND/USD returns (@fig-autocorrelation) motivates GARCH modeling [@bollerslev1986generalized]. We estimate a GARCH(1,1) model for daily VND/USD log returns:\n\n$$\nr_t = \\mu + \\varepsilon_t, \\quad \\varepsilon_t = \\sigma_t z_t, \\quad z_t \\sim D(0,1)\n$$ {#eq-garch-mean}\n\n$$\n\\sigma_t^2 = \\omega + \\alpha \\varepsilon_{t-1}^2 + \\beta \\sigma_{t-1}^2\n$$ {#eq-garch-var}\n\nwhere $\\alpha$ captures the ARCH effect (impact of yesterday's shock on today's variance) and $\\beta$ captures persistence (how slowly volatility reverts to its long-run mean). The unconditional variance is $\\bar{\\sigma}^2 = \\omega / (1 - \\alpha - \\beta)$.\n\n::: {#garch-estimation .cell execution_count=14}\n``` {.python .cell-code code-summary=\"Estimate GARCH(1,1) models with normal and Student-t innovations\"}\nreturns_bps = vnd_usd['log_return'] * 10000  # Scale to basis points\n\n# GARCH(1,1) with normal innovations\ngarch_norm = arch_model(\n    returns_bps, vol='Garch', p=1, q=1, dist='normal'\n)\nres_norm = garch_norm.fit(disp='off')\n\n# GARCH(1,1) with Student-t innovations\ngarch_t = arch_model(\n    returns_bps, vol='Garch', p=1, q=1, dist='t'\n)\nres_t = garch_t.fit(disp='off')\n\n# GJR-GARCH (asymmetric: depreciation shocks may increase vol more)\ngjr = arch_model(\n    returns_bps, vol='Garch', p=1, o=1, q=1, dist='t'\n)\nres_gjr = gjr.fit(disp='off')\n\nprint(\"=\" * 60)\nprint(\"GARCH(1,1) - Normal Innovations\")\nprint(\"=\" * 60)\nprint(res_norm.summary().tables[1])\n\nprint(\"\\n\" + \"=\" * 60)\nprint(\"GARCH(1,1) - Student-t Innovations\")\nprint(\"=\" * 60)\nprint(res_t.summary().tables[1])\n\nprint(\"\\n\" + \"=\" * 60)\nprint(\"GJR-GARCH(1,1,1) - Student-t Innovations\")\nprint(\"=\" * 60)\nprint(res_gjr.summary().tables[1])\n\n# Model comparison\nprint(\"\\nModel Comparison:\")\nprint(f\"{'Model':<25} {'AIC':>10} {'BIC':>10} {'LogLik':>12}\")\nfor name, res in [('GARCH-Normal', res_norm),\n                   ('GARCH-t', res_t),\n                   ('GJR-GARCH-t', res_gjr)]:\n    print(f\"{name:<25} {res.aic:>10.1f} {res.bic:>10.1f} \"\n          f\"{res.loglikelihood:>12.1f}\")\n```\n:::\n\n\n::: {#fig-garch-volatility .cell execution_count=15}\n``` {.python .cell-code code-summary=\"Plot GARCH conditional volatility versus realized volatility\"}\nfig, ax = plt.subplots(figsize=(14, 6))\n\n# GARCH conditional volatility (annualized, from basis points)\ncond_vol = res_t.conditional_volatility / 10000 * np.sqrt(252)\n\nax.plot(vnd_usd.index[-len(cond_vol):], cond_vol,\n        color='#C0392B', linewidth=1.2, alpha=0.9,\n        label='GARCH(1,1) Conditional Vol')\nax.plot(vnd_usd.index, vnd_usd['vol_30d'],\n        color='#2C5F8A', linewidth=1, alpha=0.6,\n        label='30-Day Realized Vol')\n\nax.set_ylabel('Annualized Volatility')\nax.set_xlabel('Date')\nax.set_title('VND/USD Volatility: GARCH vs Realized')\nax.legend()\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Volatility Regime Identification\n\nWe classify the VND/USD market into volatility regimes using the GARCH conditional volatility:\n\n::: {#volatility-regimes .cell execution_count=16}\n``` {.python .cell-code code-summary=\"Classify volatility regimes and analyze their properties\"}\n# Merge conditional volatility back to main DataFrame\nvol_series = pd.Series(\n    cond_vol.values,\n    index=vnd_usd.index[-len(cond_vol):]\n)\nvnd_usd['cond_vol'] = vol_series\n\n# Classify regimes based on percentiles\nvnd_usd['vol_regime'] = pd.cut(\n    vnd_usd['cond_vol'],\n    bins=[0, vnd_usd['cond_vol'].quantile(0.33),\n          vnd_usd['cond_vol'].quantile(0.67), np.inf],\n    labels=['Low', 'Medium', 'High']\n)\n\n# Regime statistics\nregime_stats = (\n    vnd_usd.groupby('vol_regime')\n    .agg(\n        n_days=('log_return', 'count'),\n        mean_return=('log_return', lambda x: x.mean() * 252),\n        volatility=('log_return', lambda x: x.std() * np.sqrt(252)),\n        mean_spread=('spread_pct', 'mean'),\n        skewness=('log_return', 'skew')\n    )\n    .round(4)\n)\nprint(\"Volatility Regime Characteristics:\")\nprint(regime_stats)\n```\n:::\n\n\n::: {#fig-regime-scatter .cell execution_count=17}\n``` {.python .cell-code code-summary=\"Scatter plot of returns vs conditional volatility by regime\"}\nfig, ax = plt.subplots(figsize=(10, 6))\n\ncolors_regime = {'Low': '#27AE60', 'Medium': '#F1C40F', 'High': '#C0392B'}\nfor regime in ['Low', 'Medium', 'High']:\n    subset = vnd_usd[vnd_usd['vol_regime'] == regime]\n    ax.scatter(\n        subset['cond_vol'] * 100,\n        subset['log_return'] * 100,\n        color=colors_regime[regime], alpha=0.3, s=8, label=regime\n    )\n\nax.axhline(y=0, color='gray', linewidth=0.5)\nax.set_xlabel('Conditional Volatility (% annualized)')\nax.set_ylabel('Daily Return (%)')\nax.set_title('VND/USD Returns by Volatility Regime')\nax.legend(title='Regime')\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Exchange Rate Exposure of Vietnamese Firms {#sec-fx-exposure}\n\n### The Jorion Framework\n\n@jorion1990exchange introduced the standard two-factor model for estimating firm-level exchange rate exposure:\n\n$$\nR_{i,t} = \\alpha_i + \\beta_i^{MKT} R_{m,t} + \\gamma_i \\Delta s_t + \\varepsilon_{i,t}\n$$ {#eq-jorion}\n\nwhere $R_{i,t}$ is the stock return of firm $i$, $R_{m,t}$ is the market return, and $\\Delta s_t$ is the exchange rate change (VND/USD log return, where positive = VND depreciation). The coefficient $\\gamma_i$ is the **residual exchange rate exposure**, the sensitivity of firm $i$'s returns to currency movements after controlling for market-wide effects.\n\nA positive $\\gamma_i$ means the firm benefits from VND depreciation (typical for exporters), while a negative $\\gamma_i$ means the firm is hurt by depreciation (typical for importers or firms with USD-denominated debt).\n\n::: {#exposure-estimation .cell execution_count=18}\n``` {.python .cell-code code-summary=\"Estimate firm-level exchange rate exposure using the Jorion model\"}\n# Load equity returns\nequity = client.get_monthly_returns(\n    exchanges=['HOSE', 'HNX'],\n    start_date='2012-01-01',\n    end_date='2024-12-31',\n    fields=['ticker', 'month_end', 'monthly_return', 'market_cap']\n)\n\n# Market return (VW)\nmarket_ret = (\n    equity\n    .groupby('month_end')\n    .apply(lambda g: np.average(g['monthly_return'],\n                                 weights=g['market_cap']))\n    .reset_index(name='market_return')\n)\n\n# Monthly VND/USD returns\nfx_monthly = (\n    vnd_usd['log_return']\n    .resample('M').sum()\n    .to_frame('fx_return')\n)\nfx_monthly.index = fx_monthly.index.to_period('M').to_timestamp()\n\n# Merge all data\nexposure_data = (\n    equity\n    .merge(market_ret, on='month_end')\n    .merge(fx_monthly, left_on='month_end', right_index=True, how='inner')\n)\n\n# Estimate exposure for each firm\ndef estimate_exposure(group, min_obs=36):\n    \"\"\"Estimate Jorion exposure model for a single firm.\"\"\"\n    if len(group) < min_obs:\n        return None\n    \n    y = group['monthly_return']\n    X = sm.add_constant(group[['market_return', 'fx_return']])\n    \n    try:\n        model = sm.OLS(y, X).fit(cov_type='HC1')\n        return pd.Series({\n            'gamma': model.params['fx_return'],\n            'gamma_se': model.bse['fx_return'],\n            'gamma_t': model.tvalues['fx_return'],\n            'gamma_p': model.pvalues['fx_return'],\n            'beta_mkt': model.params['market_return'],\n            'r_squared': model.rsquared,\n            'n_obs': model.nobs\n        })\n    except Exception:\n        return None\n\nexposures = (\n    exposure_data\n    .groupby('ticker')\n    .apply(estimate_exposure)\n    .dropna()\n)\n\nprint(f\"Estimated exposure for {len(exposures)} firms\")\nprint(f\"\\nExposure (gamma) Summary:\")\nprint(exposures['gamma'].describe().round(4))\nprint(f\"\\nSignificant at 5%: \"\n      f\"{(exposures['gamma_p'] < 0.05).sum()} / {len(exposures)} \"\n      f\"({(exposures['gamma_p'] < 0.05).mean():.1%})\")\n```\n:::\n\n\n::: {#fig-exposure-distribution .cell execution_count=19}\n``` {.python .cell-code code-summary=\"Plot distribution of exchange rate exposures\"}\nfig, axes = plt.subplots(1, 2, figsize=(14, 5))\n\n# Panel A: Distribution of gamma\nsig = exposures['gamma_p'] < 0.05\naxes[0].hist(exposures.loc[~sig, 'gamma'], bins=40, color='#BDC3C7',\n             alpha=0.7, label='Insignificant', edgecolor='white')\naxes[0].hist(exposures.loc[sig & (exposures['gamma'] > 0), 'gamma'],\n             bins=20, color='#27AE60', alpha=0.8,\n             label='Significant positive', edgecolor='white')\naxes[0].hist(exposures.loc[sig & (exposures['gamma'] < 0), 'gamma'],\n             bins=20, color='#C0392B', alpha=0.8,\n             label='Significant negative', edgecolor='white')\naxes[0].axvline(x=0, color='black', linewidth=0.8)\naxes[0].set_xlabel('Exchange Rate Exposure (gamma)')\naxes[0].set_ylabel('Number of Firms')\naxes[0].set_title('Panel A: Cross-Sectional Distribution')\naxes[0].legend(fontsize=9)\n\n# Panel B: Exposure vs market beta\naxes[1].scatter(exposures['beta_mkt'], exposures['gamma'],\n                c=exposures['gamma_t'].clip(-3, 3),\n                cmap='RdBu_r', s=15, alpha=0.6)\naxes[1].axhline(y=0, color='gray', linewidth=0.5)\naxes[1].axvline(x=1, color='gray', linewidth=0.5, linestyle='--')\naxes[1].set_xlabel('Market Beta')\naxes[1].set_ylabel('FX Exposure (gamma)')\naxes[1].set_title('Panel B: Market Beta vs FX Exposure')\n\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Industry-Level Exposure\n\nExchange rate exposure varies systematically across industries. Export-oriented sectors (textiles, seafood, electronics) should have positive exposure (benefiting from VND weakness), while import-dependent sectors (oil and gas, machinery, consumer goods) should have negative exposure.\n\n::: {#industry-exposure .cell execution_count=20}\n``` {.python .cell-code code-summary=\"Compute and compare exposure by industry\"}\n# Get industry classification\nindustry = client.get_firm_info(\n    exchanges=['HOSE', 'HNX'],\n    fields=['ticker', 'icb_sector', 'icb_industry']\n)\n\nexposure_industry = exposures.reset_index().merge(\n    industry, on='ticker', how='left'\n)\n\n# Industry-level average exposure\nindustry_avg = (\n    exposure_industry\n    .groupby('icb_sector')\n    .agg(\n        n_firms=('gamma', 'count'),\n        mean_gamma=('gamma', 'mean'),\n        median_gamma=('gamma', 'median'),\n        pct_significant=('gamma_p', lambda x: (x < 0.05).mean())\n    )\n    .sort_values('mean_gamma', ascending=False)\n    .round(3)\n)\n\nprint(\"Exchange Rate Exposure by Industry:\")\nprint(industry_avg.to_string())\n```\n:::\n\n\n::: {#fig-industry-exposure .cell execution_count=21}\n``` {.python .cell-code code-summary=\"Bar chart of industry-level FX exposure\"}\nfig, ax = plt.subplots(figsize=(12, 6))\n\ncolors_bar = ['#27AE60' if x > 0 else '#C0392B'\n              for x in industry_avg['mean_gamma']]\nbars = ax.barh(range(len(industry_avg)), industry_avg['mean_gamma'],\n               color=colors_bar, alpha=0.85)\nax.set_yticks(range(len(industry_avg)))\nax.set_yticklabels(industry_avg.index, fontsize=9)\nax.axvline(x=0, color='black', linewidth=0.8)\nax.set_xlabel('Average Exchange Rate Exposure (gamma)')\nax.set_title('Exchange Rate Exposure by Industry')\n\nfor i, (_, row) in enumerate(industry_avg.iterrows()):\n    label = f\"({row['pct_significant']:.0%} sig.)\"\n    ax.text(row['mean_gamma'] + 0.01 * np.sign(row['mean_gamma']),\n            i, label, va='center', fontsize=8, color='gray')\n\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Time-Varying Exposure\n\nExchange rate exposure is not constant, firms adjust hedging strategies, trade patterns shift, and the exchange rate regime itself evolves. We estimate rolling 36-month exposures:\n\n::: {#rolling-exposure .cell execution_count=22}\n``` {.python .cell-code code-summary=\"Estimate rolling 36-month exchange rate exposures\"}\ndef rolling_exposure(group, window=36, min_obs=24):\n    \"\"\"Estimate rolling FX exposure with 36-month windows.\"\"\"\n    results = []\n    group = group.sort_values('month_end')\n    \n    for i in range(window, len(group) + 1):\n        sub = group.iloc[i - window:i]\n        if len(sub) < min_obs:\n            continue\n        \n        y = sub['monthly_return']\n        X = sm.add_constant(sub[['market_return', 'fx_return']])\n        \n        try:\n            model = sm.OLS(y, X).fit()\n            results.append({\n                'month_end': sub['month_end'].iloc[-1],\n                'gamma': model.params['fx_return'],\n                'gamma_se': model.bse['fx_return']\n            })\n        except Exception:\n            pass\n    \n    return pd.DataFrame(results)\n\n# Compute for a sample of large firms\nlarge_firms = (\n    equity.groupby('ticker')['market_cap']\n    .last().nlargest(20).index\n)\n\nrolling_results = {}\nfor ticker in large_firms:\n    firm_data = exposure_data[exposure_data['ticker'] == ticker]\n    result = rolling_exposure(firm_data)\n    if len(result) > 0:\n        rolling_results[ticker] = result\n\nprint(f\"Rolling exposures computed for {len(rolling_results)} firms\")\n```\n:::\n\n\n::: {#fig-rolling-exposure .cell execution_count=23}\n``` {.python .cell-code code-summary=\"Plot rolling FX exposures for selected firms\"}\nfig, ax = plt.subplots(figsize=(14, 6))\n\nplot_colors = plt.cm.Set1(np.linspace(0, 1, min(6, len(rolling_results))))\nfor i, (ticker, df) in enumerate(list(rolling_results.items())[:6]):\n    ax.plot(pd.to_datetime(df['month_end']), df['gamma'],\n            linewidth=1.5, label=ticker, color=plot_colors[i])\n    if i == 0:\n        ax.fill_between(\n            pd.to_datetime(df['month_end']),\n            df['gamma'] - 1.96 * df['gamma_se'],\n            df['gamma'] + 1.96 * df['gamma_se'],\n            alpha=0.1, color=plot_colors[i]\n        )\n\nax.axhline(y=0, color='gray', linewidth=0.8)\nax.set_ylabel('Exchange Rate Exposure (gamma)')\nax.set_xlabel('Date')\nax.set_title('Rolling 36-Month Exchange Rate Exposure')\nax.legend(ncol=3, fontsize=9)\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Currency Hedging for International Investors {#sec-fx-hedging}\n\n### The Hedging Decision\n\nFor a foreign investor holding Vietnamese equities, the unhedged USD-denominated return is:\n\n$$\nR^{USD}_{i,t} \\approx R^{VND}_{i,t} + \\Delta s_t + R^{VND}_{i,t} \\cdot \\Delta s_t\n$$ {#eq-unhedged-return}\n\nwhere the cross-product term is usually small. Under a full hedge using forward contracts, the return becomes:\n\n$$\nR^{USD,\\text{hedged}}_{i,t} \\approx R^{VND}_{i,t} + (f_t - s_t)\n$$ {#eq-hedged-return}\n\nwhere $f_t - s_t$ is the forward premium (which, by CIP, approximately equals $r^{USD}_t - r^{VND}_t$). In Vietnam, where VND rates exceed USD rates, the forward premium is negative, hedging costs money because the investor forgoes the interest rate differential.\n\n@campbell2010global show that the optimal hedge ratio depends on the correlation between equity returns and currency returns. When the correlation is positive (VND depreciation coincides with equity losses), hedging reduces overall portfolio variance more effectively.\n\n::: {#hedging-analysis .cell execution_count=24}\n``` {.python .cell-code code-summary=\"Compare hedged vs unhedged portfolio returns for a foreign investor\"}\n# Construct VW equity index in VND\nequity_index = (\n    equity\n    .groupby('month_end')\n    .apply(lambda g: np.average(g['monthly_return'],\n                                 weights=g['market_cap']))\n    .reset_index(name='equity_vnd')\n)\nequity_index['month_end'] = pd.to_datetime(equity_index['month_end'])\n\n# Merge with FX returns and forward premium\nhedge_data = (\n    equity_index\n    .merge(fx_monthly, left_on='month_end', right_index=True, how='inner')\n)\n\n# Forward premium\nif len(cip_data) > 0:\n    fwd_premium_monthly = (\n        cip_data['forward_premium']\n        .resample('M').last() / 12\n    )\n    hedge_data = hedge_data.merge(\n        fwd_premium_monthly.to_frame('fwd_premium'),\n        left_on='month_end', right_index=True, how='left'\n    )\n    hedge_data['fwd_premium'] = hedge_data['fwd_premium'].fillna(\n        hedge_data['fwd_premium'].mean()\n    )\nelse:\n    hedge_data['fwd_premium'] = -0.003\n\n# Unhedged USD return\nhedge_data['return_unhedged'] = (\n    hedge_data['equity_vnd'] + hedge_data['fx_return']\n    + hedge_data['equity_vnd'] * hedge_data['fx_return']\n)\n\n# Fully hedged USD return\nhedge_data['return_hedged'] = (\n    hedge_data['equity_vnd'] + hedge_data['fwd_premium']\n)\n\n# 50% hedge ratio\nhedge_data['return_50pct'] = (\n    0.5 * hedge_data['return_hedged']\n    + 0.5 * hedge_data['return_unhedged']\n)\n\n# Performance comparison\nfor strategy, col in [('VND (Local)', 'equity_vnd'),\n                       ('USD Unhedged', 'return_unhedged'),\n                       ('USD 50% Hedged', 'return_50pct'),\n                       ('USD Fully Hedged', 'return_hedged')]:\n    r = hedge_data[col]\n    ann_ret = (1 + r).prod() ** (12 / len(r)) - 1\n    ann_vol = r.std() * np.sqrt(12)\n    sharpe = r.mean() / r.std() * np.sqrt(12)\n    print(f\"{strategy:<22} Return: {ann_ret:>7.2%}  Vol: {ann_vol:>7.2%}  \"\n          f\"Sharpe: {sharpe:>5.2f}\")\n```\n:::\n\n\n::: {#fig-hedging-comparison .cell execution_count=25}\n``` {.python .cell-code code-summary=\"Plot cumulative returns for different hedging strategies\"}\nfig, ax = plt.subplots(figsize=(12, 6))\n\nstrategies = {\n    'VND (Local)': ('equity_vnd', '#2C5F8A', '-'),\n    'USD Unhedged': ('return_unhedged', '#C0392B', '-'),\n    'USD 50% Hedged': ('return_50pct', '#E67E22', '--'),\n    'USD Fully Hedged': ('return_hedged', '#27AE60', '-'),\n}\n\nfor label, (col, color, ls) in strategies.items():\n    cum = (1 + hedge_data.set_index('month_end')[col]).cumprod()\n    ax.plot(cum.index, cum, label=label, color=color,\n            linewidth=2, linestyle=ls)\n\nax.set_ylabel('Cumulative Wealth')\nax.set_xlabel('Date')\nax.set_title('Vietnamese Equity Returns: Hedging Comparison')\nax.legend()\nax.set_yscale('log')\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n### Optimal Hedge Ratio\n\nThe minimum-variance hedge ratio is:\n\n$$\nh^* = \\frac{\\text{Cov}(R^{VND}_t, \\Delta s_t)}{\\text{Var}(\\Delta s_t)}\n$$ {#eq-optimal-hedge}\n\nThis is the OLS slope from regressing local equity returns on exchange rate changes. When the correlation between equity and currency is positive (bad for unhedged investors), $h^* > 0$ and hedging reduces variance.\n\n::: {#optimal-hedge .cell execution_count=26}\n``` {.python .cell-code code-summary=\"Estimate optimal hedge ratio and rolling hedge ratio\"}\n# Full-sample optimal hedge ratio\nhedge_reg = sm.OLS(\n    hedge_data['equity_vnd'],\n    sm.add_constant(hedge_data['fx_return'])\n).fit()\n\nh_star = hedge_reg.params['fx_return']\nprint(f\"Optimal hedge ratio (full sample): {h_star:.3f}\")\nprint(f\"Equity-currency correlation: \"\n      f\"{hedge_data['equity_vnd'].corr(hedge_data['fx_return']):.3f}\")\n\n# Rolling 36-month optimal hedge ratio\nrolling_cov = hedge_data['equity_vnd'].rolling(36).cov(\n    hedge_data['fx_return']\n)\nrolling_var = hedge_data['fx_return'].rolling(36).var()\nhedge_data['h_star_rolling'] = rolling_cov / rolling_var\n\nprint(f\"\\nRolling hedge ratio range: \"\n      f\"[{hedge_data['h_star_rolling'].min():.2f}, \"\n      f\"{hedge_data['h_star_rolling'].max():.2f}]\")\n```\n:::\n\n\n## ASEAN Currency Comparison {#sec-fx-asean}\n\nTo put the VND in perspective, we compare its properties with other ASEAN currencies and the Chinese Yuan.\n\n::: {#fig-asean-comparison .cell execution_count=27}\n``` {.python .cell-code code-summary=\"Compare VND with ASEAN and Asian currency pairs\"}\n# Compute annual statistics for each currency\ncomparison = pd.DataFrame()\nfor currency in fx_returns.columns:\n    r = fx_returns[currency].dropna()\n    if len(r) > 252:\n        comparison.loc[currency, 'Ann. Depreciation (%)'] = r.mean() * 252 * 100\n        comparison.loc[currency, 'Ann. Volatility (%)'] = r.std() * np.sqrt(252) * 100\n        comparison.loc[currency, 'Skewness'] = r.skew()\n        comparison.loc[currency, 'Kurtosis'] = r.kurtosis()\n        comparison.loc[currency, 'Max Daily Loss (%)'] = r.max() * 100\n        comparison.loc[currency, 'Sharpe (Carry)'] = (\n            r.mean() * 252 / (r.std() * np.sqrt(252))\n        )\n\nprint(\"ASEAN + Asian Currency Comparison (VND base, vs USD):\")\nprint(comparison.round(2).to_string())\n\n# Risk-return scatter\nfig, ax = plt.subplots(figsize=(9, 7))\nfor currency in comparison.index:\n    ax.scatter(\n        comparison.loc[currency, 'Ann. Volatility (%)'],\n        comparison.loc[currency, 'Ann. Depreciation (%)'],\n        s=120, zorder=5\n    )\n    ax.annotate(\n        f'VND/{currency}',\n        (comparison.loc[currency, 'Ann. Volatility (%)'] + 0.15,\n         comparison.loc[currency, 'Ann. Depreciation (%)']),\n        fontsize=10\n    )\n\nax.axhline(y=0, color='gray', linewidth=0.5)\nax.set_xlabel('Annualized Volatility (%)')\nax.set_ylabel('Annualized Depreciation (%)')\nax.set_title('ASEAN Currency Risk-Return Characteristics')\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Exchange Rate and Equity Market Co-Movement {#sec-fx-comovement}\n\nThe relationship between VND/USD movements and the Vietnamese equity market is central to portfolio construction. We examine this at both the aggregate and conditional levels.\n\n::: {#fig-equity-fx-comovement .cell execution_count=28}\n``` {.python .cell-code code-summary=\"Analyze equity-FX co-movement at the aggregate level\"}\nfig, axes = plt.subplots(1, 2, figsize=(14, 5))\n\n# Panel A: Scatter plot\naxes[0].scatter(\n    hedge_data['fx_return'] * 100,\n    hedge_data['equity_vnd'] * 100,\n    c=hedge_data.index, cmap='viridis', s=20, alpha=0.7\n)\nz = np.polyfit(hedge_data['fx_return'], hedge_data['equity_vnd'], 1)\nx_line = np.linspace(hedge_data['fx_return'].min(),\n                     hedge_data['fx_return'].max(), 100)\naxes[0].plot(x_line * 100, np.polyval(z, x_line) * 100,\n             color='#C0392B', linewidth=2)\naxes[0].axhline(y=0, color='gray', linewidth=0.5)\naxes[0].axvline(x=0, color='gray', linewidth=0.5)\naxes[0].set_xlabel('VND/USD Change (%)')\naxes[0].set_ylabel('VN-Index Return (%)')\naxes[0].set_title('Panel A: Monthly Equity-FX Relationship')\n\nrho = hedge_data['equity_vnd'].corr(hedge_data['fx_return'])\naxes[0].text(0.05, 0.95, f'rho = {rho:.3f}', transform=axes[0].transAxes,\n             fontsize=12, verticalalignment='top',\n             bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))\n\n# Panel B: Rolling 36-month correlation\nrolling_corr = (\n    hedge_data['equity_vnd']\n    .rolling(36)\n    .corr(hedge_data['fx_return'])\n)\naxes[1].plot(hedge_data['month_end'], rolling_corr,\n             color='#2C5F8A', linewidth=2)\naxes[1].axhline(y=0, color='gray', linewidth=0.8, linestyle='--')\naxes[1].fill_between(\n    hedge_data['month_end'], 0, rolling_corr,\n    where=rolling_corr < 0, color='#C0392B', alpha=0.2\n)\naxes[1].fill_between(\n    hedge_data['month_end'], 0, rolling_corr,\n    where=rolling_corr > 0, color='#27AE60', alpha=0.2\n)\naxes[1].set_xlabel('Date')\naxes[1].set_ylabel('Rolling Correlation')\naxes[1].set_title('Panel B: 36-Month Rolling Equity-FX Correlation')\n\nplt.tight_layout()\nplt.show()\n```\n:::\n\n\n## Summary {#sec-fx-summary}\n\nThis chapter has developed a comprehensive toolkit for working with exchange rate data in the Vietnamese context. The key findings and methods are in @tbl-fx-summary.\n\n| Topic | Finding | Implication |\n|-------------------|------------------------|------------------------|\n| VND regime | Managed float with +/-3% band, daily reference rate | Returns are non-normal; clustered near zero with discrete jumps |\n| Return distribution | Fat tails, excess kurtosis, positive skewness | Standard normal-based risk models underestimate tail risk |\n| CIP | Persistent positive deviations (\\~50-200 bps) | Capital controls and limited arbitrage; hedging is expensive |\n| UIP | beta \\< 1 in Fama regression | Carry trade is profitable on average; crash risk in devaluations |\n| Carry trade | Positive Sharpe but negative skewness | Steady gains punctuated by sharp losses during devaluations |\n| GARCH | Strong persistence (alpha + beta approx 0.99); Student-t preferred | Volatility clustering; regime switches around policy events |\n| Firm exposure | \\~15-25% significant; systematic industry patterns | Exporters benefit from depreciation; importers hurt |\n| Hedging | Full hedge eliminates FX risk but costs \\~3-5% p.a. | Optimal partial hedge depends on equity-FX correlation |\n| ASEAN comparison | VND has lowest volatility but steady depreciation | Managed float compresses vol; does not eliminate trend risk |\n\n: Summary of findings on VND exchange rate dynamics. {#tbl-fx-summary}\n\nFor researchers using Vietnamese equity data, the exchange rate dimension is not optional. Any study that converts VND returns to USD, uses international factor models, or examines firms with trade exposure must account for the distinctive properties of the VND regime. The tools developed in this chapter, from GARCH volatility modeling to rolling exposure estimation, provide the building blocks for incorporating exchange rate dynamics into broader empirical asset pricing work.\n\n```{=html}\n<!-- ## Exercises {#sec-fx-exercises}\n\n1. **Real effective exchange rate.** Construct a trade-weighted real exchange rate for Vietnam using bilateral rates against the top 10 trading partners, weighted by trade shares, and deflated by relative CPI. Does the REER predict future VND/USD movements?\n\n2. **SBV intervention detection.** Using reserve data from the SBV (or proxies from the balance of payments), estimate a probit model for the probability of SBV intervention as a function of the deviation from the reference rate, reserve levels, and global risk indicators. How do intervention episodes affect subsequent exchange rate volatility?\n\n3. **Currency factor in asset pricing.** Add a currency factor (VND/USD return) to the Vietnamese Fama-French model. Does the currency factor carry a significant risk premium in the cross-section of Vietnamese stocks? Use Fama-MacBeth cross-sectional regressions.\n\n4. **Regime-switching GARCH.** Estimate a Markov-switching GARCH model with two states (high and low volatility). Do the regime probabilities align with known SBV policy changes? How does the model compare to standard GARCH in out-of-sample volatility forecasting?\n\n5. **Carry trade with risk management.** Augment the simple carry trade with a stop-loss rule: close the position when the trailing 20-day realized volatility exceeds the 90th percentile of its historical distribution. How does this rule affect the return, volatility, and Sharpe ratio of the carry trade?\n\n6. **Cross-listing premium and FX exposure.** Some Vietnamese firms issue depositary receipts or are cross-listed abroad. Compare their exchange rate exposure to purely domestic-listed peers. Does cross-listing reduce exposure, consistent with broader hedging opportunities?\n\n7. **Forward premium decomposition.** Decompose the VND/USD forward premium into an expected depreciation component (from a survey or random walk forecast) and a risk premium component (the residual). How does the risk premium vary with global risk aversion proxies (VIX, MOVE)?\n\n8. **Conditional exposure.** Estimate @jorion1990exchange exposures separately in appreciation months (VND strengthens) and depreciation months. Is exposure asymmetric, do firms react differently to appreciation vs. depreciation? What industries show the strongest asymmetry? -->\n```\n\n",
    "supporting": [
      "57_exchange_rate_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}